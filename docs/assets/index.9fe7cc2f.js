var En=Object.defineProperty;var Cn=(t,e,n)=>e in t?En(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var $e=(t,e,n)=>(Cn(t,typeof e!="symbol"?e+"":e,n),n);import{D as Sn,a as it,i as $t,p as Et,u as Ze,b as je,r as j,d as O,c as re,e as I,o as b,f as y,g as f,h as S,j as he,t as K,k as G,F as q,l as ne,w as Ce,m as N,n as X,q as $,s as E,v as Z,x as Mn,y as Dn,z,A as Oe,T as Bn,B as oe,C as Tn,E as Ln,G as jn,H as at,R as On,I as Ae,J as ze,K as An,L as Nn,M as ge,N as Ct,O as lt,P as Fn,Q as In,S as Rn,U as Pn,V as zn,W as ae,X as Vn,Y as Hn,Z as Kn,_ as Un,$ as Jn,a0 as St,a1 as ve,a2 as Yn,a3 as Gn,a4 as Mt,a5 as qn,a6 as Wn,a7 as Xn,a8 as Zn,a9 as Dt,aa as Qn,ab as eo,ac as to,ad as no,ae as oo,af as so,ag as io,ah as ao,ai as lo,aj as ro}from"./vendor.ceba1abb.js";var R=Object.freeze(Object.defineProperty({__proto__:null,get svg(){return zt},get g(){return et},get asstSvg(){return Vt},get foreign(){return Ht}},Symbol.toStringTag,{value:"Module"}));const co=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};co();class te{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(e,n="",o=[],s=!1){n!=""&&(this.path=n),o!=[]&&(this.tags=o),this.content=e;const i=this.get_time();this.atime=i,s==!0&&(this.ctime=i)}set_default(e){this.path=e,this.content="",this.tags=[];const n=this.get_time();this.atime=n,this.ctime=n}copy(e){Object.assign(this,e)}duplicate(e,n=""){const o=new te;return o.copy(this),o.content=e,o.path=n,o.update_time(),o.update_tag(),o}update_content2(e){this.content=e}update_time(){console.log(`update_time path=${this.path}`),this.atime=this.get_time()}update_tag(){return this.tags=this.build_tag(this.content),this.tags}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const n=o=>`00${o}`.slice(-2);return`${e.getFullYear()}/${n(e.getMonth()+1)}/${n(e.getDate())} ${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}`}update_time_all(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){const n=[],o=[0,0,0,0,0],s=e.split(/\r\n|\n|\r/);for(let i=0;i<s.length;i++)if(s[i].search(/^\s*#/)!=-1){const l=s[i].split(" "),r=l[0].length;l.shift();const d=l.join(" ");n.push({text:d,line:i,tag:r,num:o[r]}),o[r]++}return n}split(e){const n=[],o=this.content.split(/\r\n|\n|\r/),s=this.tags.filter(function(d){return d.tag==e}),i=[],a=o.length;for(var l=0;l<s.length;l++){const d=s[l].line;i.push({start:d,end:a,title:s[l].text}),l!=0&&(i[l-1].end=d-1)}const r=this.path.replace(".","_");return i.reverse(),i.forEach(d=>{const p=o.splice(d.start,d.end).join(`\r
`),h=this.duplicate(p,`${r}/${d.title}`);n.push(h)}),n.reverse(),n}}class uo extends Sn{constructor(){super("OdenDB");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class po{constructor(e){this.db=new uo,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async n=>{const o=await this.dbx.get(n);return o!=null?o.data:null},this.write=async(n,o)=>{const s=JSON.stringify(o);await this.dbx.put({key:n,data:s,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async n=>{console.log(`delete key=${n}`),await this.dbx.delete(n),this.set_time_DB()},this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(o=>{e[o.key]=o.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class Ue{constructor(e){this.ctime="",this.atime="",this.read=async n=>{const o=new URLSearchParams;o.append("filename",n);const s=await this.post_cmdEx("load_file_md",o);return s!=null?s.data:null},this.write=async(n,o)=>{const s=new URLSearchParams;return s.append("filename",n),s.append("source",JSON.stringify(o)),console.dir(s),this.post_cmdEx("save",s)},this.get_cmdEx=async n=>{const o="http://localhost:5000/api/viewer/"+n;return console.log(`[store_RST:get_cmdEx] api=${o}`),it.get(o).then(s=>s.data).catch(s=>{throw s.response.status})},this.post_cmdEx=async(n,o)=>{const s="http://localhost:5000/api_oden/"+n;return console.log(`[store_RST:post_cmdEx] api=${s}`),console.dir(o),it.post(s,o).then(i=>(console.log("response.data = ",i.data),i.data)).catch(i=>(console.log("Error = ",i.response),i.response))},this.caller=e}}class ho{constructor(e){this.write=(n,o)=>{this.storeDB.write(n,o),this.storeRST.write(n,o)},this.delete=n=>{this.storeDB.delete(n)},this.rename=async(n,o,s)=>{console.log(`[rename] _key_org=${n}, _key_new=${o}`);const i=this.as(await this.get(n));return i.path=o,await this.write(o,i),s&&await this.delete(n),i},this.split=async n=>{console.log(`[split] _key_org=${n}`);const s=this.as(await this.get(n)).split(1);return s.forEach(i=>{this.write(i.path,i)}),s},this.merge=(n,o)=>{console.log(`[merge] _path=${n}`);const s=new te;return s.set_default(n),s.update_content2(o),s.update_time(),s.update_tag(),this.write(n,s),s},this.as=n=>Object.assign(new te,n),this.sync_DB=()=>this.storeDB.sync_DB(),this._=e,this.storeDB=new po(this._),this.storeRST=new Ue(this._)}async get(e){console.log(`[get] _key=${e}`);const n=await this.read(e);return n!=null?JSON.parse(n):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,n){console.log(`[set] _key=${e}`);const o=this.as(await this.get(e));return o.path==""&&(o.path=e),o.update_content2(n),o.update_time(),o.update_tag(),this.write(e,o),o}async set_ex(e,n,o){console.log(`[set_ex] _key=${e}`);const s=this.as(n);return n.path==""&&(n.path=e),o!=null&&o.hasOwnProperty("no_upate_time")||s.update_time(),s.update_tag(),this.write(e,s),s}async read(e){return await this.storeDB.read(e)}create(e){console.log(`[create] _key=${e}`);const n=new te;return e!=null&&(n.set_default(e),this.write(e,n)),n}}const Ve="menu.json";class mo{constructor(e){this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const n=await this._.mgrCache.getLstContent(e),o=this.buildMenu(n);return console.log(`${n.length}/${o.length}`),this._.contentEx.set(Ve,JSON.stringify(o)),o}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const n=await this._.contentEx.get(Ve);return JSON.parse(n.content)}}buildMenu(e){function n(s){const i=new Set;return s.forEach(a=>{i.add(a.group)}),[...i]}function o(s){console.log("storeEx_index:buildMenuEx");const i=n(s);return s.reduce((a,l)=>{if(l.path==Ve)return a;let r=l.group,d=l.title,c=`${r}/${d}`;return i.includes(c)&&(r=c,d=".index",c=`${r}/${d}`),a.push({key:c,group:r,title:d,path:l.path,atime:l.atime}),a},[])}return o(e).sort(this.compare_group)}compare_group(e,n){let o=e.group,s=n.group;o==s&&(o=`${e.group}/${e.title}`,s=`${n.group}/${n.title}`);const i=o.toUpperCase(),a=s.toUpperCase();let l=0;return i>a?l=1:i<a&&(l=-1),l}}class go{constructor(e){this.backupEx=(n,o,s)=>{const i=()=>{const l=new URLSearchParams;l.append("lstContent",JSON.stringify(n)),Ue.post_cmdEx("backup_contents",l).then(r=>console.log(r)).catch(r=>console.log(r))},a=()=>{const l=new Blob([JSON.stringify(n)],{type:"text/plain"}),r=(c,p)=>{const h=new Date,u=m=>`00${m}`.slice(-2);return`${c}_${h.getFullYear()}${u(h.getMonth()+1)}${u(h.getDate())}_${u(h.getHours())}.${p}`},d=document.createElement("a");d.download=r("lstData","json"),d.href=URL.createObjectURL(l),d.click(),URL.revokeObjectURL(d.href)};switch(console.log(`[backup] mode=${o}`),o){case"backup":i();break;case"export":a();break}},this._=e}async restoreEx(e,n,o){function s(r){r.forEach(d=>{const c=new te;c.copy(d),c.update_tag(),l.write(c.path,c)})}async function i(r,d){Ue.get_cmdEx("restore_contents").then(c=>{s(c),r(c)}).catch(c=>{console.log(c),d(null)})}async function a(r,d,c){const p=new FileReader;p.onload=()=>{var m;console.log("onload");const h=(m=p.result)!=null?m:"",u=JSON.parse(h);s(u),d(u)},p.onerror=h=>{c("error")},p.readAsText(r)}console.log("[importExport:restore]");const l=this._.contentEx;return new Promise(function(r,d){switch(e){case"restore":i(r,d);break;case"import":a(n,r,d);break}})}}class fo{constructor(e){this.journal2=async(n,o)=>{const s=(a,l)=>`
## ${this._.contentEx.as(a).cnv_time(o)}
${l}
`;console.log("[journal]");const i=await this.geolocation();return n.content+=s(n,i),n},this.geolocation=()=>new Promise(n=>{let o="";navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{o=`(Latitude,longitude)=(${s.coords.latitude},${s.coords.longitude})
`,n(o)},s=>{switch(s.code){case 1:o="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:o="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:o="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}n(o)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),n(o))}),this.chat=async(n,o,s)=>{const i=m=>["sun","mon","tue","wed","thu","fri","sat"][m],a=m=>{const v=B=>`00${B}`.slice(-2),k=`${m.getFullYear()}/${v(m.getMonth()+1)}/${v(m.getDate())}(${i(m.getDay())})`,x=`${v(m.getHours())}:${v(m.getMinutes())}`;return[k,x]},l=(m,v)=>m!==v?`
## ${v}
`:"",r=m=>{const v=s.isNoList?"":"- ",k=s.isAddTime?`${m} : `:"";return`${v}${k}${o}
${h}`};console.log("[chat]");const d=n.content.indexOf(`
`),[c,p]=a(new Date),h=s.isAddGeo?await this.geolocation()+`
`:"",u=l(n.content.substring(0,d),c)+r(p);return n.content=`${c}${n.content.substring(d)}${u}`,n},this._=e}async path_rename(e,n,o){console.log(`_from=${e}, _to=${n}`);const s=this.collect_filename_by_group(e,o);for(let i=0;i<s.length;i++){const a=s[i],l=`${a[1]}/${a[0]}`,r=`${n}${a[2]}/${a[0]}`;await this._.contentEx.rename(l,r)}}async path_delete(e,n){console.log(`_path=${e}`);const o=this.collect_filename_by_group(e,n);for(let s=0;s<o.length;s++){const i=o[s],a=`${i[1]}/${i[0]}`;await this._.contentEx.delete(a)}}async path_merge(e,n,o){console.log(`_path=${e}`);const s=[],i=this.collect_filename_by_group(e,o);for(let l=0;l<i.length;l++){const r=i[l],d=`${r[1]}/${r[0]}`,c=await this._.contentEx.get(d);s.push(c.content)}const a=s.join(`\r
`);return this._.contentEx.merge(n,a)}collect_filename_by_group(e,n){console.log(`[collect_filename_by_group] pat=${e}`);const o=[],s=e.length!=0?1:0;return n.forEach((i,a)=>{if(i.group==e){const l=i.group.substring(e.length+s);o.push([i.title,i.group,l.length!=0?`/${l}`:""])}}),o}}class _o{constructor(e){this._=e}async getLstContent(e){console.log("[getLstContent]");const n=i=>{const a=e.path==""?!0:i.path.indexOf(e.path)!=-1,l=e.keyword==""?!0:i.content.toLowerCase().indexOf(e.keyword)!=-1;return a&&l},o=await this.buildLstContent();return e!=null?o.filter(n):o}async buildLstContent(){var i;console.log("[buildLstContent]");const e=a=>{var d,c;let l=a.path;(l==""||l==null)&&(l=`@test/${new Date().toLocaleString()}`);const r=l.split("/");return a.title=(d=r.pop())!=null?d:".",a.group=(c=r.join("/"))!=null?c:"@test",a.tags=[],a.htags=[],a},n=await this._.contentEx.storeDB.getStrageEx(),o=[],s=a=>n[a];for(const a of Object.keys(n))try{o.push(e(JSON.parse((i=s(a))!=null?i:"")))}catch(l){console.log(`@ error key=${a},e=${l} - other error`)}return o}}class vo{constructor(){this.contentEx=new ho(this),this.mgrExchange=new go(this),this.mgrEtc=new fo(this),this.mgrMenu=new mo(this),this.mgrCache=new _o(this),console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,n){return this.contentEx.set(e,n)}async cmd_save_ex(e,n,o){return this.contentEx.set_ex(e,n,o)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_copy(e,n){await this.contentEx.rename(e,n,!1)}async cmd_rename(e,n,o){await this.contentEx.rename(e,n,o)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,n="",o=null){const s=await this.mgrCache.getLstContent(o);this.mgrExchange.backupEx(s,e,n)}async cmd_restoreEx(e,n,o=""){await this.mgrExchange.restoreEx(e,n,o)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,n){const o=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,n,o)}async cmd_path_delete(e){const n=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,n)}async cmd_path_merge(e,n){const o=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,n,o)}async cmd_chat(e,n,o){const i=(()=>{const r=new Date;return`${e}${o.mode}_${r.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${i}`);const a=await this.contentEx.get(i),l=await this.mgrEtc.chat(a,n,o);return await this.contentEx.set(i,l.content),[l,i]}}class bo{constructor(e){this.KEY="",console.log(e),this.KEY=e}get(e){var n;if(localStorage.getItem(this.KEY)!=null){const o=JSON.parse((n=localStorage.getItem(this.KEY))!=null?n:"");e(o),console.log(o)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const yo=1e3*60*10,Bt=Symbol(),wo=()=>{const t=Ze();je();const e=j({storeEx:new vo,persisted:new bo("lifeLog-Viewer-params"),filename:"",obj:new te,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),n=g=>{console.log(`[update_filename] : new=${g}`),o(g)},o=async g=>{console.log(`[load_obj] : new=${g}`),e.persisted.set({filename:g});const _=t.currentRoute.value.name.toString();if(g!=""){if(g.indexOf(_)==-1){t.push(g.indexOf(".mm")!=-1?"/mm/":"/"),console.log("router.push");return}const C=await e.storeEx.cmd_load(g);l(C)}else l(r(""));e.filename=g},s=()=>{console.log("restore_filename"),e.persisted.get(g=>{n(g.filename)})},i=async g=>{if(g==""){console.log("skip save - empty data");return}r(g,{update_time:!0,update:!0}),await e.storeEx.cmd_save_ex(e.filename,e.obj),p()},a=()=>{console.log("[auto_save] start"),e.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(e.intervalId_autoSave)),e.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await B("export",null,null),e.intervalId_autoSave=null},yo)},l=(g,_)=>{const C=g instanceof te?g:Object.assign(new te,g);_!=null&&_.hasOwnProperty("update_time")&&C.update_time(),e.tags=C.update_tag(),e.obj=C},r=(g,_)=>(e.obj.content=g,_!=null&&_.hasOwnProperty("update_time")&&e.obj.update_time(),e.tags=e.obj.update_tag(),e.obj),d=async(g,_)=>{if(console.log(g),_!=null){const C=await e.storeEx.cmd_load(_);C.position=g,await e.storeEx.cmd_save_ex(_,C,{no_upate_time:!0})}else e.obj.position=g},c=g=>{e.dictMenu=g},p=()=>{setTimeout(async()=>{c(await e.storeEx.cmd_rebuild()),a()},250)},h=g=>{e.jump=g,g!=-1&&(console.log(`jump=${g}`),e.ObjTag=JSON.parse(JSON.stringify(e.tags[g])),console.log(JSON.stringify(e.ObjTag)))},u=g=>{e.height=g},m=async(g,_)=>{const[C,D]=await e.storeEx.cmd_chat(e.path_expand,g,_);l(C,{update_time:!0}),n(D),p()},v=async(g,_)=>{const C=await e.storeEx.cmd_exist(g);if(_==C)return!0;{const D=_?`error : ${g} is not exist. please enter exist filename.`:`error : ${g} is already exist. please enter other filename.`;return console.log(D),!1}},k=async(g,_,C=!0)=>{await v(g,!1)&&(n(""),await e.storeEx.cmd_rename(_,g,C),n(g),p())},x=async(g,_)=>{const C=A(_)[0],D=A(g)[0];n(""),await e.storeEx.cmd_path_rename(C,D),p()},B=async(g,_,C)=>{console.log(`[do_cmd] mode=${g}`);let D=_!=""?_:e.filename,H="",se;switch(g){case"update_jump":h(_);break;case"rebuild_menu":p();break;case"filter_menu":const Pe=_;_!=null&&(Pe.path=Pe.isUnderFolder?A(e.filename)[0]:""),c(await e.storeEx.cmd_getMenu(Pe));break;case"open_file":n(_);break;case"restore_file":s();break;case"save_file":await i(_);break;case"new":await v(_,!1)&&(await e.storeEx.cmd_create(_),n(_),p());break;case"delete":await v(D,!0)&&(n(""),await e.storeEx.cmd_delete(D),p());break;case"rename":k(_,C);break;case"copy":k(_,C,!1);break;case"backup":e.storeEx.cmd_backup("backup");break;case"export":e.storeEx.cmd_backup("export");break;case"restore":await e.storeEx.cmd_restoreEx("restore",null),p();break;case"import":await e.storeEx.cmd_restoreEx("import",_),p();break;case"split":await v(D,!0)&&(await e.storeEx.cmd_split(D),p());break;case"path_rename":x(_,C);break;case"path_delete":H=A(_)[0],await e.storeEx.cmd_path_delete(H),n(""),p();break;case"path_merge":H=A(_)[0],D=`${H}.md`,await v(D,!1)&&(await e.storeEx.cmd_path_merge(H,D),n(D),p());break;case"print":const $n=t.resolve({path:`/print/${e.filename}`});window.open($n.href,"_blank");break;case"journal":m("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":m(_,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":m(_,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":se={keyword:C.filter.toLowerCase(),isUnderFolder:C.isCheck,path:""},c(await e.storeEx.cmd_getMenu(se));break;case"update_position":await d(_,C);break;case"move_archive":k(`@archive/${_}`,_);break;case"move_path_archive":x(`@archive/${_}`,_);break;case"export_archive":se={keyword:"",isUnderFolder:!0,path:"@archive/"},e.storeEx.cmd_backup("export","",se);break}},A=g=>{const _=g.split("/"),C=_[_.length-1];return[_.slice(0,-1).join("/"),C]};return{store_data:{state:e,update_height:u,do_cmd:B}}},ko=()=>{Et(Bt,wo())},Q=()=>$t(Bt),xo=()=>{const t=j({objParam:null});return{store_dlg:{state:t,update_param:n=>{t.objParam=n}}}},Tt=Symbol(),$o=()=>{Et(Tt,xo())},Ne=()=>$t(Tt);const Eo=O({setup(t){return ko(),$o(),(e,n)=>{const o=I("routerView");return b(),re(o)}}});var F=(t,e)=>{const n=t.__vccOpts||t;for(const[o,s]of e)n[o]=s;return n};const Co={key:0},So={key:1,class:"line"},Mo={key:2,class:"dropdown"},Do=O({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const n=t,o=j({isOpen:!1,item:n.item,isFolder:n.item.children&&n.item.children.length,isActive:!0}),s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const l=a.cmd;s(l,null)}};return(a,l)=>{const r=I("fa"),d=I("MenuTreeItem",!0);return b(),y("div",{class:"menu_tree",onClick:l[0]||(l[0]=c=>i(f(o).item)),onContextmenu:l[1]||(l[1]=Ce(()=>{},["right","prevent"]))},[f(o).item.title!=""?(b(),y("div",Co,[S(r,{icon:f(o).item.icon},null,8,["icon"]),he(" "+K(f(o).item.title),1)])):G("",!0),f(o).item.title==""?(b(),y("div",So)):G("",!0),f(o).isFolder?(b(),y("div",Mo,[(b(!0),y(q,null,ne(f(o).item.children,(c,p)=>(b(),y("div",{key:p},[S(d,{item:c,onEvent_callback:s},null,8,["item"])]))),128))])):G("",!0)],32)}}});var Bo=F(Do,[["__scopeId","data-v-d08517be"]]);const To=O({props:{mouse:null,items:null},emits:["event_callback"],setup(t,{emit:e}){const n=t,o=j({items:n.items,pos_x:-1,pos_y:-1,style:"display:none"});N(()=>n.mouse,(a,l)=>{console.log("props"),o.pos_x=n.mouse.clientX,o.pos_y=n.mouse.clientY,o.items=n.items,o.style="display:block"});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{o.style=a?"display:block":"display:none"};return(a,l)=>(b(),y("div",{class:"menu",style:X(f(o).style),onMouseover:l[0]||(l[0]=r=>i(!0)),onMouseleave:l[1]||(l[1]=r=>i(!1))},[(b(!0),y(q,null,ne(f(o).items,r=>(b(),y("div",{key:r.path},[S(Bo,{item:r,onEvent_callback:s},null,8,["item"])]))),128))],36))}});var Lt=F(To,[["__scopeId","data-v-62ad7429"]]);const Lo=O({props:{objMenu:null},emits:["event_callback"],setup(t,{emit:e}){const o=j({items:t.objMenu,event:void 0,style:"display:none"}),s=(l,r)=>{console.log(`[event_callback] cmd=${l}`),e("event_callback",l,r)},i=l=>{console.log("onClick"),o.event=l},a=l=>{o.style=l?"display:block":"display:none"};return(l,r)=>{const d=I("fa");return b(),y("div",{class:"dropdown",onClick:i,onMouseover:r[0]||(r[0]=c=>a(!0)),onMouseleave:r[1]||(r[1]=c=>a(!1))},[S(d,{icon:"bars"}),S(Lt,{class:"menu",mouse:f(o).event,items:f(o).items,onEvent_callback:s,style:X(f(o).style)},null,8,["mouse","items","style"])],32)}}});var jo=F(Lo,[["__scopeId","data-v-1a158634"]]);const Oo={key:0,class:"dropdown"},Ao=["onClick"],No={class:"title_sub2"},Fo={class:"title"},Io={class:"title_sub"},Ro=O({props:{objMenuItem:null},emits:["event_callback"],setup(t,{emit:e}){const n=t,o=j({items:[],items2:[],isShowDlg:!1});N(()=>n.objMenuItem,(l,r)=>{o.items=s(l),o.items2=o.items.slice(0,5)});const s=l=>{console.log("[cnvLstRecent]");function r(c,p){const h=c.atime,u=p.atime;let m=0;return h>u?m=-1:h<u&&(m=1),m}const d=[...l];return d.sort(r),d.slice(0,15)},i=l=>{const r=o.items[l].path;e("event_callback","open_file",r),o.isShowDlg=!1},a=l=>{o.isShowDlg=l};return(l,r)=>{const d=I("fa");return b(),y("span",{onMouseover:r[0]||(r[0]=c=>a(!0)),onMouseleave:r[1]||(r[1]=c=>a(!1))},[S(d,{icon:"history"}),f(o).isShowDlg?(b(),y("ul",Oo,[(b(!0),y(q,null,ne(f(o).items,(c,p)=>(b(),y("li",{class:"item",key:p,onClick:h=>i(p)},[S(d,{class:"title_item",icon:"file-alt"}),$("span",No,K(c.group)+"/",1),$("span",Fo,K(c.title),1),$("span",Io,"["+K(c.atime)+"]",1)],8,Ao))),128))])):G("",!0)],32)}}});var Po=F(Ro,[["__scopeId","data-v-2f025744"]]);const zo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],Vo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"copy",cmd:"dlg_copy",icon:"copy",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],Ho=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],jt={dlg_import:{init:(t,e)=>{t.title="Restore",t.isFileOpen=!0,t.isNoEdit=!0,t.edit=""},action:t=>["import"]},dlg_delete:{init:(t,e)=>{t.title="Delete",t.isReadOnly=!0,t.edit=e},action:t=>["delete",t.edit,""]},dlg_rename:{init:(t,e)=>{t.title="Rename",t.edit=e},action:t=>["rename",t.edit,t.edit_org]},dlg_new:{init:(t,e)=>{t.title="Create",t.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:t=>["new",t.edit,""]},dlg_copy:{init:(t,e)=>{t.title="Copy",t.edit=e},action:t=>["copy",t.edit,t.edit_org]},dlg_path_rename:{init:(t,e)=>{t.title="Rename of Path",t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_rename",t.edit,t.edit_org]},dlg_path_delete:{init:(t,e)=>{t.title="Delete of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_delete",t.edit,""]},dlg_path_merge:{init:(t,e)=>{t.title="Merge of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_merge",t.edit,""]},dlg_tweet:{init:(t,e)=>{t.title="Tweet",t.edit=""},action:t=>["tweet",t.edit,""]},dlg_bookmark:{init:(t,e)=>{t.title="Bookmark",t.edit="",t.isMulti=!0},action:t=>["bookmark",t.edit,""]},dlg_filter:{init:(t,e)=>{t.title="Filter",t.title2="target under folder",t.edit="",t.edit_org="@",t.isCheck=!0},action:t=>(console.log("dlg_filter"),["filter",t.filename,{filter:t.edit,isCheck:t.check}])}};const Ko=t=>(Mn("data-v-389d700f"),t=t(),Dn(),t),Uo={class:"nav"},Jo=["title"],Yo={class:"form"},Go={class:"cmd"},qo=Ko(()=>$("span",{class:"item"},null,-1)),Wo=O({emits:["event_callback"],setup(t,{emit:e}){const{store_data:n}=Q();Ne();const o=E(null),s=E(null),i=j({filename:"@",objMenu:zo,dctMenu:[]}),a=(c,p)=>{if(console.log(`[event_callback] cmd=${c}`),c!="top")if(c=="cmd"){const h=s.value,u=h.getAttribute("url"),m=h.getAttribute("cmd");console.log(`url=${u}`),console.log(`cmd=${m}`),m=="add_bookmark"&&a("bookmark",u)}else e("event_callback",c,p)};Z(()=>{console.log("[mounted]")});const l=c=>{console.log(`[doAction] cmd=${c}`),e("event_callback",c,!0)};N(()=>n.state.filename,(c,p)=>{console.log(`[watch:filename] ${c}`),d(c)}),N(()=>n.state.dictMenu,(c,p)=>{i.dctMenu=c}),N(()=>n.state.jump,(c,p)=>{window.setTimeout(()=>{r()},500)});const r=()=>{o.value.scrollIntoView({})},d=c=>{console.log(`[onChanged_filename] new=${c}`),i.filename=c,r()};return(c,p)=>{const h=I("fa");return b(),y("header",{class:"appbar",ref_key:"appbar",ref:o,_click:"event_callback('top', true)"},[$("nav",Uo,[S(jo,{class:"item",objMenu:f(i).objMenu,onEvent_callback:a,title:"menu"},null,8,["objMenu"]),$("section",{class:"item logo",onClick:p[0]||(p[0]=u=>a("filelist",!0)),title:f(i).filename},"Oden",8,Jo),S(Po,{class:"item",objMenuItem:f(i).dctMenu,onEvent_callback:a,title:"history"},null,8,["objMenuItem"]),f(i).filename!==""?(b(),y("span",{key:0,class:"item name",onClick:p[1]||(p[1]=u=>a("dlg_rename",null))},"["+K(f(i).filename)+"]",1)):G("",!0),$("span",{class:"item mark",onClick:p[2]||(p[2]=u=>l("toggle_editor")),title:"editor/viewer"},[S(h,{icon:"edit"})]),$("form",Yo,[$("span",{class:"item",id:"api_do",url:"",cmd:"",onClick:p[3]||(p[3]=u=>a("cmd")),ref_key:"api",ref:s},"cmd",512)])]),$("span",Go,[$("span",{class:"item",onClick:p[4]||(p[4]=u=>l("dlg_filter")),title:"filter"},[S(h,{icon:"paw"})]),$("span",{class:"item",onClick:p[5]||(p[5]=u=>l("dlg_tweet")),title:"tweet"},[S(h,{icon:"grimace"})]),$("span",{class:"item",onClick:p[6]||(p[6]=u=>l("dlg_bookmark")),title:"bookmark"},[S(h,{icon:"bookmark"})]),qo])],512)}}});var Ot=F(Wo,[["__scopeId","data-v-389d700f"]]);const Xo=["title","onContextmenu","onDblclick"],Zo={key:0},Qo=O({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const n=t,o=j({isOpen:!1,item:n.item,isFolder:n.item.children&&n.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:s}=Q();N(()=>s.state.filename,(h,u)=>{d(h)});const i=(h,u)=>{console.log(`[event_callback] cmd=${h}`),e("event_callback",h,u)},a=(h,u)=>{console.log(`[event_callbackEx] cmd=${h}`),e("event_callback",h,o.item.path)};Z(()=>{d(s.state.filename)});const l=h=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const u=h.path;console.log(`onClick-filename=${u}`),s.do_cmd("open_file",u)}},r=h=>{console.log("onClickEx"),o.menu=o.isFolder?Ho:Vo,o.event=h},d=h=>{o.item.path==h,h.indexOf(o.item.name)!=-1&&(o.isOpen=!0),o.class_item=o.item.path==h?"item active":"item"},c=()=>o.isFolder?"folder":o.class_item,p=()=>o.isFolder?o.isOpen?"folder-open":"folder":o.item.file=="mm"?"pen":"file";return(h,u)=>{const m=I("fa"),v=I("tree-item",!0);return b(),y("div",{class:"file_tree",onContextmenu:u[1]||(u[1]=Ce(()=>{},["prevent"]))},[S(Lt,{mouse:f(o).event,items:f(o).menu,onEvent_callback:a},null,8,["mouse","items"]),$("div",{class:z(c()),title:f(o).item.time,onClick:u[0]||(u[0]=k=>l(f(o).item)),onContextmenu:Ce(r,["prevent"]),onDblclick:Ce(r,["prevent"])},[S(m,{icon:p(),onClick:r},null,8,["icon"]),he(" "+K(f(o).item.name),1)],42,Xo),f(o).isOpen?(b(),y("div",Zo,[(b(!0),y(q,null,ne(f(o).item.children,(k,x)=>(b(),y("div",{key:x},[S(v,{item:k,onEvent_callback:i},null,8,["item"])]))),128))])):G("",!0)],32)}}});var es=F(Qo,[["__scopeId","data-v-7267c9d4"]]);const ts={class:"tree"},ns=O({emits:["event_callback"],setup(t,{emit:e}){const n=j({items:void 0}),{store_data:o}=Q();N(()=>o.state.dictMenu,(a,l)=>{i(a)});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)};Z(()=>{console.log("[mounted]"),i(o.state.dictMenu)});const i=a=>{console.log("[onChanged_dictMenu]"),n.items=void 0;const l=a,r={name:"",children:[],path:"",file:"",time:""},d="/",c={[d]:r},p=h=>h.split(".").slice(1);l.forEach(function(h){h.key.split("/").reduce(function(u,m){if(u[m])return u[m];{const v={name:m,children:[],path:h.path,file:p(m),time:h.atime};return u[d].children.push(v),u[d].file="",u[m]={[d]:v}}},c)}),console.dir(r),setTimeout(()=>{n.items=r.children},250)};return(a,l)=>(b(),y("div",ts,[S(Bn,{_appear:"",name:"flip-list",tag:"div"},{default:Oe(()=>[(b(!0),y(q,null,ne(f(n).items,r=>(b(),y("div",{key:r.path},[S(es,{item:r,onEvent_callback:s},null,8,["item"])]))),128))]),_:1})]))}});var At=F(ns,[["__scopeId","data-v-15645628"]]);const os=O({props:{level:null},setup(t){const e=t,n=oe(()=>`h${e.level}`);return(o,s)=>(b(),re(Tn(f(n)),{class:"h_tag"},{default:Oe(()=>[Ln(o.$slots,"default",{},void 0,!0)]),_:3}))}});var ss=F(os,[["__scopeId","data-v-8ea48e02"]]);const is=O({emits:["event_callback"],components:{heading:ss},setup(t,e){const{store_data:n}=Q(),o=j({listTag:[]});N(()=>n.state.tags,(a,l)=>{o.listTag=a});function s(a){n.do_cmd("update_jump",a)}function i(a){return`${a.text}`}return{state:o,dispTitle:i,jumpSource:s}}}),as={class:"tag"},ls=["onClick"];function rs(t,e,n,o,s,i){const a=I("heading");return b(),y("div",as,[(b(!0),y(q,null,ne(t.state.listTag,(l,r)=>(b(),y("div",{key:r,onClick:d=>t.jumpSource(r),class:"item"},[S(a,{level:l.tag},{default:Oe(()=>[he(K(t.dispTitle(l)),1)]),_:2},1032,["level"])],8,ls))),128))])}var cs=F(is,[["render",rs],["__scopeId","data-v-c506de12"]]);const ds=O({emits:["event_callback"],setup(t,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(s,i)=>{console.log(`cmd=${s}, name=${i}`),e.emit("event_callback",s,i)}}}}),us={class:"main",style:{_height:"100px"}},ps=["onClick","title"];function hs(t,e,n,o,s,i){const a=I("fa");return b(),y("div",us,[(b(!0),y(q,null,ne(t.objToolbar,(l,r)=>(b(),y("button",{class:"btn-item",key:r,onClick:d=>t.event_callback("action",l.cmd),title:l.cmd},[S(a,{icon:l.icon},null,8,["icon"])],8,ps))),128))])}var ms=F(ds,[["render",hs],["__scopeId","data-v-495368bc"]]);const Me={};class gs{constructor(e,n){$e(this,"cmdid",0);$e(this,"monaco",null);$e(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=n}add(e,n,o,s,i=null){let a;switch(s.length){case 0:a=this.generateCommand(e,i);break;case 1:a=this.generateHeaderCommand(s[0]);break;case 2:a=this.generateWrapperCommand(s[0],s[1]);break}Me[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:o,contextMenuGroupId:n&&"navigation",contextMenuOrder:n&&1.5,run:Me[e]})}generateCommand(e,n){return(o,s)=>{n(o)}}generateWrapperCommand(e,n){const o=e.length+n.length;return this.editor,this.editor.getModel(),this.monaco,(s,i)=>{const a=s.getModel(),l=s.getSelections();if(l==null)return;const r=[];return l.forEach(d=>{r.push(new i.Selection(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn+o)),a.pushEditOperations([],[{range:{startLineNumber:d.startLineNumber,startColumn:d.startColumn,endLineNumber:d.startLineNumber,endColumn:d.startColumn},text:e},{range:{startLineNumber:d.endLineNumber,startColumn:d.endColumn,endLineNumber:d.endLineNumber,endColumn:d.endColumn},text:n}])}),s.setSelections(r),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(n,o)=>{const s=n.getModel();let i=n.getSelections();return i==null&&(i=[n.getSelection()]),i.forEach(a=>{const l=s.findNextMatch("^(#+ )",{lineNumber:a.startLineNumber,column:1},!0,!1,null,!0);if(l!=null&&l.range.startLineNumber==a.startLineNumber&&l.range.startColumn==1){if(l.matches[1]==e)return;s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:l.matches[1].length+1},text:""}])}s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:1},text:e}])}),null}}}function fs(t,e){const n=s=>{const i=a=>`00${a}`.slice(-2);return`${s.getFullYear()}/${i(s.getMonth()+1)}/${i(s.getDate())} ${i(s.getHours())}:${i(s.getMinutes())}:${i(s.getSeconds())}`};console.log("[setupShortcutKeys]");const o=new gs(t,e);o.add("Bold","8_",[],["**","**"]),o.add("Italic","1_",[],["__","__"]),o.add("Underline","9_",[],["<u>","</u>"]),o.add("Strikethrough",!1,[t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.KEY_S],["~~","~~"]),o.add("Code",!1,[],["`","`"]),o.add("Link",!1,[],["[","]()"]),o.add("Link-2",!1,[],["[](",")"]),o.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),o.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),o.add("Header 1",!1,[],["# ",""]),o.add("Header 2",!1,[],["## ",""]),o.add("Header 3",!1,[],["### ",""]),o.add("Header 4",!1,[],["#### ",""]),o.add("Header 5",!1,[],["##### ",""]),o.add("Header 6",!1,[],["###### ",""]),o.add("Check",!1,[],["- [ ] ",""]),o.add("Blockquotes",!1,[],["> ",""]),o.add("Today",!1,[],[`${n(new Date)}`,""]),o.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),o.add("Format","8_",[],[],s=>{console.log("format"),s.getAction("editor.action.formatDocument").run()})}const _s={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},vs=O({emits:["event_callback"],components:{ToolbarEditor:ms},props:{isActive_preview:{type:Boolean,default:!1}},setup(t,e){const n=E(null),o={editor:void 0},{store_data:s}=Q(),i=j({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});Z(()=>{console.log("[mounted]"),l(),m(s.state.obj.content)}),N(()=>s.state.obj.content,(g,_)=>{console.log("[watch-body]"),i.filename!=""&&x(),m(g),B(s.state.obj.position,!0),i.filename=s.state.filename}),N(()=>s.state.ObjTag,(g,_)=>{console.log(`[watch](ObjTag)-${g}`),a(g)}),N(()=>t.isActive_preview,(g,_)=>{console.log(`[watch](editor_toggle)-${g}`),g==!0&&k()});const a=g=>{const _=D=>{h(D)};console.log(`[jump_cursor]ObjTag={${Object.values(g)}}`);const C=g.line;_(C),setTimeout(()=>{const D=o.editor;i.pos_scroll=D.getScrollTop()},500)},l=()=>{const g=()=>{const _=(H,se)=>{fs(H,se)},C=document.getElementById("container");if(console.log(`root=${C}`),C==null)return;const D=jn.create(C,_s);return _(at,D),console.log(`editor=${D}`),D.onDidScrollChange(H=>{i.scrollInfo.height=H.scrollHeight,i.scrollInfo.top=H.scrollTop}),D};o.editor=g(),r()},r=()=>{o.editor.onDidBlurEditorText(g=>{k()})},d=(g,_)=>{switch(console.log(`[event_callback] cmd=${g}`),g){case"action":c(_);break;case"save":k();break}},c=g=>{console.log("[action]"),Me[g]!=null&&Me[g](o.editor,at)},p=()=>o.editor.getValue(),h=g=>{const _=new On(g+1,0,g+1,0);console.log(`Line=${g}`),o.editor.revealRangeAtTop(_)},u=()=>o.editor.getModel().getAlternativeVersionId(),m=g=>{o.editor.setValue(g),i.iVersion=u()},v=()=>{const g=u();return console.info(`iVersion=${i.iVersion}, iVersion_cur=${g}`),i.iVersion!=g},k=(g=!1)=>{if(!v())return;g||x();const _=p();s.do_cmd("save_file",_),i.iVersion=u(),console.info(`iVersion=${i.iVersion}`)},x=()=>{const g=o.editor,_={top:g.getScrollTop(),height:g.getScrollHeight(),contentHeight:g.getLayoutInfo().height,scrolled:i.pos_scroll!=g.getScrollTop()};return v()?(s.do_cmd("update_position",_,void 0),k(!0)):s.do_cmd("update_position",_,i.filename),_},B=(g,_=!1)=>{if(g==null)return;console.log(`[e-set]value=${JSON.stringify(g)}`);const C=o.editor;if(_?!0:g.scrolled){const H=g.top/g.height;console.log(`per=${H}`);const se=C.getScrollHeight();C.setScrollTop(se*H)}else a(s.state.ObjTag);setTimeout(()=>{i.pos_scroll=C.getScrollTop()},500)};oe(()=>o.editor.getScrollTop());const A=oe(()=>`${s.state.height-27}px`);return{editorEx:o,event_callback:d,HeightEx:A,md_editor_monaco:n,get_position:x,set_position:B}}}),bs={class:"editor"};function ys(t,e,n,o,s,i){const a=I("ToolbarEditor");return b(),y("div",bs,[S(a,{class:"toolbar",onEvent_callback:t.event_callback},null,8,["onEvent_callback"]),$("div",{id:"container",ref:"md_editor_monaco",class:"core",style:X({height:t.HeightEx})},null,4)])}var ws=F(vs,[["render",ys],["__scopeId","data-v-edf1b242"]]);const ks=O({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(t){const e=E(null),{store_data:n}=Q(),o=j({pos_scroll:-1,filename:"",observer_scroll:null});Z(()=>{function c(){const p=new ze.Renderer;p.link=function(h,u,m){return console.log(`href=${h}, title=${u}, text=${m}`),h.indexOf("http")!=-1?`<a target="_blank" href="${h}">${m}</a>`:`<a target="_blank" href="#${h}">${m}</a>`},p.code=function(h,u,m){return h.match(/^sequenceDiagram/)||h.match(/^graph/)||h.match(/^gantt/)?'<div class="mermaid">'+h+`
</div>`:`<pre><code>
`+An.highlightAuto(h).value+`
</code></pre>`},ze.setOptions({renderer:p,langPrefix:"",breaks:!0}),Nn.init()}console.log("[mounted]"),c(),o.observer_scroll=new s}),Ae(()=>{}),N(()=>n.state.obj.content,(c,p)=>{console.log("[watch-body]"),o.filename!=""&&a(),setTimeout(()=>{o.observer_scroll.build(),l(n.state.obj.position,!0),o.filename=n.state.filename},0)});class s{constructor(){this.observer=null,this.tocMap=null,this.elm_target_before=null}destructor(){}build(){const p=()=>document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),h=()=>document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5"),u=(x,B)=>{const A=this.tocMap.get(x);B?(this.elm_target_before!=null&&this.elm_target_before.classList.remove("active"),A.classList.add("active"),this.elm_target_before=null):this.elm_target_before=A},m={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},v=this.set_callback(u,m),k=this.build_toc_map(v,p(),h());this.observer=v,this.tocMap=k}set_callback(p,h){const u=m=>{m.forEach(v=>{p(v.target,v.intersectionRatio)})};return new IntersectionObserver(u,h)}build_toc_map(p,h,u){const m=new Map;return console.log(`el_contents=${h.length}`),console.log(`el_tocs=${u.length}`),h.forEach((v,k)=>{p.observe(v),m.set(u.item(k),v),m.set(v,u.item(k))}),m}}N(()=>n.state.ObjTag,(c,p)=>{console.log(`[watch](ObjTag)-${c}`),i(c)}),N(()=>t.isActive_preview,(c,p)=>{console.log(`[watch](editor_toggle)-${c}`)});function i(c){const p=(m,v)=>{console.log(`tag=${m}, num=${v}`);const k=e.value,x=k.querySelectorAll(".md_core_viewer > h"+m);x.length!=0&&(k.scrollTop=x[v].getBoundingClientRect().top-k.getBoundingClientRect().top+k.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(c)}}`);const h=c.tag,u=c.num;p(h,u),setTimeout(()=>{const m=e.value;o.pos_scroll=m.scrollTop},0)}const a=()=>{const c=e.value,p={top:c.scrollTop,height:c.scrollHeight,contentHeight:0,scrolled:o.pos_scroll!=c.scrollTop};return n.do_cmd("update_position",p,o.filename),p},l=(c,p=!1)=>{if(console.log(`[v-set]value=${JSON.stringify(c)}`),e.value==null)return;const h=e.value;if(c==null){h.scrollTop=0;return}if(p?!0:c.scrolled){const m=c.top/c.height;console.log(`per=${m}`),console.log(`scrollTop=${h.scrollTop}, scrollHeight=${h.scrollHeight}`),h.scrollTop=h.scrollHeight*m}else i(n.state.ObjTag);setTimeout(()=>{o.pos_scroll=h.scrollTop},0)},r=oe(()=>ze.parse(n.state.obj.content)),d=oe(()=>n.state.height+"px");return{status,Markdown:r,HeightEx:d,md_viewer:e,get_position:a,set_position:l}}}),xs=["innerHTML"];function $s(t,e,n,o,s,i){return b(),y("div",{class:"md_core_viewer note",innerHTML:t.Markdown,style:X({height:t.HeightEx}),ref:"md_viewer"},null,12,xs)}var Nt=F(ks,[["render",$s],["__scopeId","data-v-9568c00e"]]);const Es=O({components:{MarkdownEditor:ws,MarkdownViewer:Nt},props:{editor_toggle:{type:Boolean,default:!0}},setup(t,e){const n=E(),o=E(),s=j({isActive_preview:!0});N(()=>t.editor_toggle,(l,r)=>{console.log(`[watch](editor_toggle)-${l}`),a()}),Z(()=>{console.log("[mounted]"),document.addEventListener("keydown",i)}),Ae(()=>{document.removeEventListener("keydown",i)});const i=l=>{if(l.keyCode===83&&l.ctrlKey){l.preventDefault(),console.log("save"),a();return}else if(l.keyCode===69&&l.ctrlKey){l.preventDefault(),console.log("toggle"),a();return}},a=()=>{var d;const l=s.isActive_preview?{now:n,next:o}:{now:o,next:n},r=(d=l.now.value)==null?void 0:d.get_position();console.log(`isActive_preview=${s.isActive_preview}, scrollIndo=${JSON.stringify(r)}`),s.isActive_preview=!s.isActive_preview,setTimeout(()=>{var c;(c=l.next.value)==null||c.set_position(r)},500)};return{state:s,MdViewer:n,MdEditor:o}}});function Cs(t,e,n,o,s,i){const a=I("MarkdownViewer"),l=I("MarkdownEditor");return b(),y("div",null,[t.state.isActive_preview?(b(),re(a,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:t.state.isActive_preview},null,8,["isActive_preview"])):(b(),re(l,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:t.state.isActive_preview},null,8,["isActive_preview"]))])}var Ss=F(Es,[["render",Cs]]);const Ms={class:"modal-mask"},Ds={class:"modal-wrapper"},Bs={class:"modal-container"},Ts={class:"header"},Ls={class:"form"},js=["disabled"],Os=["disabled"],As={class:"modal-actions"},Ns=["disabled"],Fs=O({emits:["event_callback"],setup(t,{emit:e}){const{store_dlg:n}=Ne(),{store_data:o}=Q(),s=E(null),i=E(null),a=j({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});N(()=>n.state.objParam,u=>{l(u)});const l=u=>{const m=(v,k=!1)=>v!=null?v:k;console.log("[onChanged_objParam]"),a.title=u.title,a.title2=u.title2,a.edit=u.edit,a.edit_org=m(u.edit_org,u.edit),a.check=0,a.isShowDlg=!0,a.isNoEdit=m(u.isNoEdit),a.isFileOpen=m(u.isFileOpen),a.isReadOnly=m(u.isReadOnly),a.isCheck=m(u.isCheck),a.isMulti=m(u.isMulti),a.isDisabled=!0,a.action=u.action,p(!0),setTimeout(()=>{a.isMulti==!0?s.value.focus():i.value.focus()},500)},r=u=>{if(console.log(`[doAction] flg=${u}, edit=${a.edit}`),u){const m=a.action(a);o.do_cmd(m[0],m[1],m[2])}a.isShowDlg=!1,p(!1)},d=u=>{const v=(u.target.files||u.dataTransfer.files)[0],k=a.action(a);o.do_cmd(k[0],v),a.isShowDlg=!1,p(!1)},c=()=>{const u=a.edit_org,m=a.edit==u&&!a.isReadOnly;return console.log(`[isDisabled]=${m}`),m},p=u=>{u==!0?document.addEventListener("keydown",h):document.removeEventListener("keydown",h)},h=u=>{const m=u.key;switch(console.log(`key = ${m}`),m){case"Enter":u.preventDefault(),r(!0);break;case"Escape":u.preventDefault(),r(!1);break}};return(u,m)=>{const v=I("fa");return ge((b(),re(Rn,{persistent:""},{default:Oe(()=>[$("div",Ms,[$("div",Ds,[$("div",Bs,[$("div",Ts,K(f(a).title)+"?",1),$("form",Ls,[f(a).isFileOpen==!0?(b(),y("input",{key:0,class:"input",type:"file",onChange:d},null,32)):G("",!0),f(a).isNoEdit==!1?(b(),y(q,{key:1},[f(a).isMulti==!0?ge((b(),y("textarea",{key:0,class:"input",autofocus:"","onUpdate:modelValue":m[0]||(m[0]=k=>f(a).edit=k),disabled:f(a).isReadOnly,ref_key:"edit",ref:s},null,8,js)),[[lt,f(a).edit]]):ge((b(),y("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":m[1]||(m[1]=k=>f(a).edit=k),disabled:f(a).isReadOnly,ref_key:"edit2",ref:i,placeholder:"type text.."},null,8,Os)),[[lt,f(a).edit]])],64)):G("",!0),f(a).isCheck==!0?(b(),y(q,{key:2},[ge($("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":m[2]||(m[2]=k=>f(a).check=k)},null,512),[[Fn,f(a).check]]),he(" "+K(f(a).title2),1)],64)):G("",!0)]),$("div",As,[$("button",{class:"btn btn-ok",ref:"ok",disabled:c(),onKeydown:m[3]||(m[3]=In(k=>r(!0),["enter"])),onClick:m[4]||(m[4]=k=>r(!0))},[S(v,{icon:"check"}),he(" "+K(f(a).title),1)],40,Ns),$("button",{class:"btn btn-can",onClick:m[5]||(m[5]=k=>r(!1))},"cancel")])])])])]),_:1},512)),[[Ct,f(a).isShowDlg]])}}});var Ft=F(Fs,[["__scopeId","data-v-7ad0a14e"]]);const Is={class:"container"},Rs={class:"main"},Ps=O({emits:["event_callback"],setup(t,{emit:e}){const{store_data:n}=Q(),{store_dlg:o}=Ne();Ze();const s=je(),i=j({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});Z(()=>{console.log("[mounted]"),a(),window.addEventListener("resize",l),document.body.style.overflow="hidden"}),Ae(()=>{console.log("unmounted!"),window.removeEventListener("resize",l)});const a=()=>{const c=u=>{n.do_cmd("restore_file","")};console.log("init");const h=s.fullPath.split("api_bookmark?=");console.log(h),h.length==2?n.do_cmd("bookmark",decodeURIComponent(h.pop())):(s.path.substring(1),c()),n.do_cmd("filter_menu",null),l()},l=()=>{const c=window.innerHeight-40;console.log(`height=${c}`),i.height=c,n.update_height(c)},r=async(c,p)=>{switch(console.log(`[event_callback] cmd=${c}, va0=${p}`),c){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"config":i.objDlgConf={cmd:c,filename:"",commit:""};break;case"filelist":document.querySelector(".col-3");const h=!i.toggle_list;i.toggle_list=h,console.log(i.toggle_list);break;default:if(c.indexOf("dlg_")!=-1){const u=Object.assign({},d(c,p));o.update_param(u)}else n.do_cmd(c,p);break}},d=(c,p)=>{const h=jt[c],u=p!=null?p:n.state.filename;return h.init(h,u),h};return(c,p)=>(b(),y("div",Is,[S(Ot,{ref:"appbar",onEvent_callback:r},null,512),S(Ft,{objParam:f(i).objDlgCmn,onEvent_callback:r},null,8,["objParam"]),$("div",Rs,[f(i).toggle_list?(b(),re(At,{key:0,class:"col-3",onEvent_callback:r,style:X({height:f(i).height+"px"})},null,8,["style"])):G("",!0),S(Ss,{class:"col-2",ref:"pane",editor_toggle:f(i).editor_toggle,style:X({height:f(i).height+"px"})},null,8,["editor_toggle","style"]),S(cs,{class:"col-1",onEvent_callback:r,style:X({height:f(i).height+"px"})},null,8,["style"])])]))}});var zs=F(Ps,[["__scopeId","data-v-46b3456d"]]);const Vs={_class:"container"},Hs=O({emits:["event_callback"],setup(t,{emit:e}){Q();const n=je(),o=j({filename:"",height:window.innerHeight,timer3:-1});Z(()=>{console.log("[mounted]"),s(),document.body.style.overflow="hidden"});const s=()=>{console.log("init");const i=n.path.substring(1);n.fullPath,console.log(`filename=${i}`),o.filename=i,o.timer3=window.setTimeout(()=>{clearTimeout(o.timer3),window.print()},500)};return(i,a)=>(b(),y("div",Vs,[he(K(f(o).filename)+" ",1),S(Nt,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}}),L=Pn(),Ks="_container_rovsp_1",Us="_svg_rovsp_18",Js="_trigger_rovsp_44",Ys="_dragging_rovsp_47",Gs="_hidden_rovsp_53",qs="_text_rovsp_73",Ws="_selected_rovsp_79",Xs="_content_rovsp_79",Zs="_root_rovsp_82",Qs="_edited_rovsp_86",ei="_outline_rovsp_89",ti="_collapse_rovsp_99",ni="_disabled_rovsp_145",oi="_gps_rovsp_156",si="_fit_rovsp_159",ii="_download_rovsp_162",ai="_prev_rovsp_165",li="_next_rovsp_168",ri="_close_rovsp_171";var w={container:Ks,"svg-wrapper":"_svg-wrapper_rovsp_1","asst-svg":"_asst-svg_rovsp_12",svg:Us,trigger:Js,dragging:Ys,"add-btn":"_add-btn_rovsp_47",hidden:Gs,"expand-btn":"_expand-btn_rovsp_64",text:qs,selected:Ws,content:Xs,root:Zs,edited:Qs,outline:ei,collapse:ti,"button-list":"_button-list_rovsp_103","right-bottom":"_right-bottom_rovsp_106","right-top":"_right-top_rovsp_110",disabled:ni,gps:oi,fit:si,download:ii,prev:ai,next:li,close:ri};const W=E(),V=E(),pe=E(),He=E(),ie=E(),U=E();function ci(){const t=this.querySelector(`g.${w["add-btn"]}`);t&&(t.style.opacity="1");const e=this.querySelector(`g.${w["expand-btn"]}`);e&&(e.style.opacity="1")}function di(){const t=this.querySelector(`g.${w["add-btn"]}`);t&&(t.style.opacity="0");const e=this.querySelector(`g.${w["expand-btn"]}`);e&&(e.style.opacity="0")}const ui=t=>{const{g:e}=R;!e||(Te.value=t.transform,e.attr("transform",t.transform.toString()))};function It(t,e){console.log("[onSelect]"),t.stopPropagation();const n=Y(e);console.dir(n)}function Qe(t,e){var l,r;console.log("[onEdit]");const{foreign:n}=R;if(!en||!n||!U.value)return;const o=(l=this.parentNode)==null?void 0:l.parentNode;o.classList.add(w.edited),L.emit("edit-flag",!1),console.log(`name/id=${e.name}/${e.id}`),n.attr("x",e.x-2-(e.left?e.width:0)).attr("y",e.y-M.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const s=U.value;s.textContent=e.name,s.focus(),(r=getSelection())==null||r.selectAllChildren(s);const i=o.querySelector(`:scope > .${w.content}`);i&&Fe(i);const a=d=>{const c=d.key;switch(console.log(`[onEdit] keydown=${c}`),c){case"Enter":if(d.shiftKey)return;d.stopPropagation(),Je(new FocusEvent("")),setTimeout(()=>{Y(e),V.value.focus()},250);break;case"Escape":d.stopPropagation(),Je(new FocusEvent(""),!0),V.value.focus();break}};s.addEventListener("keydown",a)}const Je=(t,e=!1)=>{var i;if(console.log("[onEditBlur]"),(i=document.getElementsByClassName(w.edited)[0])==null||i.classList.remove(w.edited),ie.value==null||U.value==null){console.log("skip not active foreign");return}if(ie.value.style.display=="none"){console.log("skip display=none");return}ie.value.style.display="none";const n=ie.value.getAttribute("data-id"),o=ie.value.getAttribute("data-name"),s=U.value.textContent;e||n&&s!==null&&s!==o&&bn(n,s)},Ee=t=>{if(t.preventDefault(),!W.value)return;console.log("onContextmenu");const e=Ni(W.value,t);Ut.value=e;const n=t.composedPath(),o=n.find(a=>{var l;return(l=a.classList)==null?void 0:l.contains("node")}),s=n.find(a=>a.tagName=="foreignObject");let i=o?1:s?2:0;if(console.log(i),i==1){const{classList:a}=o,l=a.contains(w.root),r=a.contains(w.collapse);a.contains(w.selected)||Y(o),Xt.value.disabled=l,qt.value.disabled=l,Wt.value.disabled=l,Gt.value.disabled=l,Yt.value.disabled=!r,Jt.value.disabled=r||a.contains("leaf"),ee.delete.disabled=l,ee.deleteOne.disabled=l}else i==2||(ee.zoomin.disabled=Te.value.k>=ye[1],ee.zoomin.disabled=Te.value.k<=ye[0]);Kt.value=i,L.emit("showContextmenu",!0)},T=(t,e)=>{var s,i,a;if(console.log(`[onClickMenu] name=${t}`),t.indexOf("icon_")!=-1){const l=ue(),r=(s=M.find(l.id))==null?void 0:s.rawData;r&&(console.log(r),bn(l.id,`${t.slice(5)}${r.name}`));return}let n=ue();const o=n==null?void 0:n.id;switch(t){case"zoomfit":Se();break;case"zoomin":ct(!1);break;case"zoomout":ct(!0);break;case"add":Rt(new MouseEvent("click"),ue());break;case"delete":n=n.parent,wt(o);break;case"delete-one":n=n.parent,ka(o);break;case"collapse":kn(o);break;case"expand":wn(o);break;case"add-sibling":{const l=kt(o,"");l&&(Y(l),fe(l))}break;case"add-sibling-before":{const l=kt(o,"",!0);l&&(Y(l),fe(l))}break;case"add-parent":{const l=xa(o,"");l&&(Y(l),fe(l))}break;case"cut":{const l=(i=M.find(o))==null?void 0:i.rawData;l&&navigator.clipboard.writeText(JSON.stringify(l)),n=n.parent,wt(o)}break;case"copy":{const l=(a=M.find(o))==null?void 0:a.rawData;l&&navigator.clipboard.writeText(JSON.stringify(l))}break;case"paste":navigator.clipboard.readText().then(l=>{const r=zi(l)||{name:l},d=yn(o,r);Y(d)});break;case"edit":fe(ue());break;case"undo":qe();break;case"redo":Ge();break;case"move_focus_x":pi(e==null?void 0:e.direct),n=null;break;case"move_focus_y":hi(e==null?void 0:e.direct),n=null;break;case"text-bold":xt(o,{"font-weight":"bold"});break;case"text-line":xt(o,{"text-decoration":"line-through"});break;case"next":Ge();break;case"prev":qe();break}n&&Y(n)},pi=t=>{let e=null;const n=ue();if(console.log(`seleData.left=${n.left}`),!!(n.left&&t==!1||n.left==!1&&t))if(console.log("to child"),n.children.length!=0)e=n.children[0];else return;else if(console.log("to parent"),n.parent!=null)e=n.parent;else return;const s=Y(e);Fe(s),console.log("@")},hi=t=>{let e=null;const n=ue();if(n==null||n.parent==null)return;let o=+n.id.split("-").pop(),s=n.parent.children.length,i=o+(t?1:-1);if(0<=i&&i<s){e=n.parent.children[i];const a=Y(e);Fe(a)}},Rt=(t,e)=>{const n=yn(e.id,"");n&&(fe(n,t),Y(e))};function fe(t,e=new MouseEvent("click")){const{g:n}=R;if(!n)return;const s=n.selectAll(`g[data-id='${Ie(t)}'] > g.${w.content} > g.${w.text}`).node();s&&(L.emit("edit-flag",!0),Qe.call(s,e,t))}const Pt=(t,e)=>{e.collapse?wn(e.id):kn(e.id)};function mi(t,e){var r;const n=(r=this.parentNode)==null?void 0:r.parentNode;V.value&&V.value.classList.add(w.dragging);const{g:o}=R;if(!o)return;cn(n,e,[t.x-e.x,t.y-e.y]);const s=zn(t,pe.value);s[1]+=M.data.y;const i=o.selectAll("g.node").filter(d=>{if(d!==e&&d!==e.parent&&!d.id.startsWith(e.id)){let c=J,p=d.width+J;d.left&&d.depth!==0&&([c,p]=[p,c]);const h={x0:d.x-c,x1:d.x+p,y0:d.y-J,y1:d.y+d.height+J};return s[0]>h.x0&&s[1]>h.y0&&s[0]<h.x1&&s[1]<h.y1}return!1}),a=Array.from(document.getElementsByClassName(w.outline)),l=i.node();a.forEach(d=>{d!==l&&d.classList.remove(w.outline)}),l==null||l.classList.add(w.outline)}function gi(t,e){var h;const n=(h=this.parentNode)==null?void 0:h.parentNode;V.value&&V.value.classList.remove(w.dragging);const o=document.getElementsByClassName(w.outline)[0];if(o){o.classList.remove(w.outline);const u=o.getAttribute("data-id");if(u)e.px=0,e.py=0,wa(u,e.id);else throw new Error("outline data-id null");return}const s=e.x-M.getRootWidth()/2,i=e.depth===1&&s*(s+e.px)<0,a=i?u=>u.left!==e.left:u=>u.left===e.left,l=n.parentNode;let r=i?{y:1/0,id:e.id}:e,d=i?{y:-1/0,id:e.id}:e;const c=ae(l).selectAll(`g.${ot(e).join(".")}`).filter(u=>u!==e&&a(u)),p=e.y+e.py;c.each(u=>{(i||u.y>e.y)&&u.y<p&&u.y>d.y&&(d=u),(i||u.y<e.y)&&u.y>p&&u.y<r.y&&(r=u)}),i?(e.px=0,e.py=0,$a(e.id)):r.id!==e.id?(e.px=0,e.py=0,yt(e.id,r.id)):d.id!==e.id?(e.px=0,e.py=0,yt(e.id,d.id,1)):cn(n,e,[0,0],500)}const fi=t=>{const{svg:e}=R;!e||(t?(xe(e),e.on("dblclick.zoom",null)):e.on(".zoom",null))},_i=t=>{const{g:e}=R;if(!U.value||!e)return;const n=e.selectAll(`g.${w.text}`);t?n.on("click",Qe):n.on("click",null)},vi=t=>{const{g:e}=R;if(!e)return;const n=e.selectAll(`g.${w.text}`);t?n.on("mousedown",It):n.on("mousedown",null)},bi=t=>{!W.value||(t?(console.log("@switchContextmenu"),W.value.addEventListener("contextmenu",Ee),W.value.addEventListener("dblclick",Ee)):(W.value.removeEventListener("contextmenu",Ee),W.value.removeEventListener("dblclick",Ee)))},yi=t=>{const{g:e}=R;if(!e)return;const n=e.selectAll(`g.node:not(.${w.root}) > g > g.${w.text}`);t?nn(n):n.on(".drag",null)};let zt,et,Vt,Ht;L.on("selection-svg",t=>zt=t);L.on("selection-g",t=>et=t);L.on("selection-asstSvg",t=>Vt=t);L.on("selection-foreign",t=>Ht=t);const Kt=E(0),Ut=E({left:0,top:0}),Jt=E({name:"collapse",disabled:!0}),Yt=E({name:"expand",disabled:!0}),wi=E({name:"add",disabled:!1}),Gt=E({name:"add-parent",disabled:!1}),qt=E({name:"add-sibling",disabled:!1}),Wt=E({name:"add-sibling-before",disabled:!0}),Xt=E({name:"cut",disabled:!1}),ki=E({name:"copy",disabled:!1}),xi=E({name:"paste",disabled:!1}),ee=j({delete:{name:"delete",disabled:!1,note:"D"},deleteOne:{name:"delete-one",disabled:!1,note:"ctrl+D"},collapse:{name:"collapse",disabled:!0},expand:{name:"expand",disabled:!0},zoomin:{name:"zoomin",disabled:!0,note:"]"},zoomout:{name:"zoomout",disabled:!1,note:"["},zoomfit:{name:"zoomfit",disabled:!1},selectall:{name:"selectall",disabled:!0}}),$i=oe(()=>[[wi.value,Gt.value,qt.value,Wt.value],[Xt.value,ki.value,xi.value],[ee.delete,ee.deleteOne],[{name:"selectall",disabled:!0},{name:"text-bold",disabled:!1},{name:"text-line",disabled:!1}],[Jt.value,Yt.value]].filter((t,e)=>e===0||e===1?_e.value.edit:!0)),Ei=oe(()=>[[ee.zoomin,ee.zoomout,ee.zoomfit],[{name:"selectall",disabled:!0}]]),Ci=oe(()=>[[{name:"\u2705"},{name:"\u274E"},{name:"\u{1F195}"},{name:"\u{1F196}"},{name:"\u{1F197}"}],[{name:"\u{1F4D1}"},{name:"\u{1F4C3}"},{name:"\u{1F4DD}"},{name:"\u2B50"},{name:"\u{1F514}"},{name:"\u{1F6A7}"}],[{name:"\u{1F642}"},{name:"\u{1F610}"},{name:"\u{1F616}"},{name:"\u{1F635}"},{name:"\u{1F62B}"},{name:"\u{1F631}"}],[{name:"\u26D4"},{name:"\u{1F6AB}"},{name:"\u{1F516}"},{name:"\u{1F380}"},{name:"\u{1F388}"}],[{name:"\u{1F648}"},{name:"\u{1F649}"},{name:"\u{1F64A}"},{name:"\u{1F44D}"},{name:"\u{1F449}"},{name:"\u{1F448}"}],[{name:"\u{1F340}"},{name:"\u{1F463}"},{name:"\u{1F5EF}"},{name:"\u{1F4A5}"},{name:"\u{1F4A6}"}],[{name:"\u23F0"}]]),Si=oe(()=>{let t;switch(Kt.value){case 0:t=Ei.value;break;case 1:t=$i.value;break;case 2:t=Ci.value;break}return t}),Zt=Vn().source(t=>t.source).target(t=>t.target),Mi=Hn().curve(Kn),Di=({source:t,target:e})=>Mi([t,e]);let De=!1,Qt=Zt;const tt=E(!1);L.on("sharp_corner",t=>{De!==t&&(tt.value=!0),De=!!t,Qt=t?Di:Zt});let Ye=4;L.on("branch",t=>Ye=t||Ye);let ye=[.1,8];L.on("scale-extent",t=>ye=t||ye);let en=!1;L.on("edit-flag",t=>en=!!t);const Bi=6,de=10;let we=16,Be=64,J=Math.min(we/2-1,de);L.on("gap",t=>{!t||(Be=t.xGap,we=t.yGap,J=Math.min(we/2-1,de),J=Math.min(Be/2-1,J))});const Ti=new ResizeObserver(t=>{const{foreign:e}=R;if(!e)return;const n=t[0],o=n.target,{width:s,height:i}=n.contentRect,a=parseInt(getComputedStyle(o).paddingLeft||"0",10),l=parseInt(getComputedStyle(o.parentNode).borderTopWidth||"0",10),r=(a+l)*2;e.attr("width",s+r).attr("height",i+r),e.style("display")!=="none"&&Fe(o),console.log("observer")}),me={side:12,padding:2,margin:8},tn=me.side+me.padding*2,ce={width:16,height:4,radius:4},Te=E(St),xe=Un().on("zoom",ui).scaleExtent(ye),nn=Jn().container(Fi).on("drag",mi).on("end",gi),nt=E(!0);let on;L.on("mindmap-context",t=>t?on=t:null);const _e=E({drag:!0,edit:!0});class Li{constructor(e=20){this.length=e,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(e){const n=ve.exports.cloneDeep(e);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(n),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,ve.exports.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,ve.exports.cloneDeep(this.snapshots[this.cursor])):null}}const ke=new Li,sn=E(!1),an=E(!1),ji=()=>{sn.value=ke.hasPrev,an.value=ke.hasNext},Oi=(t,e)=>{const n=-e/2,o=-t/2,s=t/2,i=e/2;return`M${i},${s}H${s}V${i}H${o}V${s}H${n}V${o}H${o}V${n}H${s}V${o}H${i}V${s}Z`},ln=t=>{const e=t.split(`
`);return e.length>1&&e[e.length-1]===""&&e.pop(),e},Ai=(t,e)=>{Gn(t).then(n=>{const o=n.toDataURL(),s=open();s&&(s.document.write(`<img src='${o}'>`),s.document.title=e,s.document.close())})},rn=(t,e)=>Yn().duration(t).ease(e),Ni=(t,e)=>{const{pageX:n,pageY:o}=e,s=t.getBoundingClientRect(),i=s.left+window.pageXOffset,a=s.top+window.pageYOffset;return{left:n-i,top:o-a}};function Fi(){var t,e;return(e=(t=this.parentNode)==null?void 0:t.parentNode)==null?void 0:e.parentNode}function Y(t){const e=t instanceof SVGGElement?t:document.querySelector(`g[data-id='${Ie(t)}']`),n=document.getElementsByClassName(w.selected)[0];if(e)n?n!==e?(console.log("remove & add selected"),n.classList.remove(w.selected),e.classList.add(w.selected)):(console.log("edit-flag - same"),L.emit("edit-flag",!0)):(console.log("add selected"),e.classList.add(w.selected));else throw new Error("selectGNode failed");return e}function ue(){console.log("getSelectedGData");const t=ae(`.${w.selected}`),e=t==null?void 0:t.data();if((e==null?void 0:e.length)==0)return console.log("data null"),null;const n=e[0];return console.log(`id/name=${n.id}/${n.name}`),n}const rt=t=>{const{asstSvg:e}=R;if(!e)throw new Error("asstSvg undefined");const n=ln(t),o=e.append("text");o.selectAll("tspan").data(n).enter().append("tspan").text(i=>i).attr("x",0);const s=o.node().getBBox();return o.remove(),{width:Math.max(s.width,22),height:Math.max(s.height,22)*n.length}},cn=(t,e,n,o=0)=>{const s=rn(o,Mt);e.px=n[0],e.py=n[1],ae(t).transition(s).attr("transform",un),ae(`g[data-id='${Ie(e)}'] > path`).transition(s).attr("d",i=>Le(i))},Ii=()=>{const{svg:t}=R;if(!t)return;const e=M.data;xe.translateTo(t,0+e.width/2,0+e.height/2)},Se=()=>{const{svg:t}=R;if(!t||!pe.value||!V.value)return;const e=pe.value.getBBox(),n=V.value.getBoundingClientRect(),o=Math.min(n.width/e.width,n.height/e.height),s={x:n.width/2,y:n.height/2},i={x:e.width*o/2,y:e.height*o/2},a=St.translate(-e.x*o+s.x-i.x,-e.y*o+s.y-i.y).scale(o);xe.transform(t,a)},Fe=t=>{const{svg:e}=R;if(e&&V.value){const{k:n}=Te.value,o=t.getBoundingClientRect(),{x:s,y:i,width:a,height:l}=V.value.getBoundingClientRect(),r=o.x-s,d=r+o.width,c=o.y-i,p=c+o.height,h=2;let u=0,m=0;r<0&&(u=-r/n+h),(o.width>a||d>a)&&(u=-(d-a)/n-h),c<0&&(m=-c/n+h),(o.height>l||p>l)&&(m=-(p-l)/n-h),xe.translateBy(e,u,m)}},ct=t=>{const{svg:e}=R;!e||xe.scaleBy(e,t?1.1:.9)},Ri=()=>{!W.value||Ai(W.value,M.data.name)},Ge=()=>{const t=ke.next();t&&(M.data=t,P(!1))},qe=()=>{const t=ke.prev();t&&(M.data=t,P(!1))},Pi=()=>{U.value&&(console.log("bindForeignDiv:enter"),Ti.observe(U.value),U.value.addEventListener("blur",Je),U.value.addEventListener("mousedown",t=>{t.stopPropagation()}),U.value.addEventListener("keydown",t=>{t.stopPropagation(),t.key}),V.value.addEventListener("keydown",t=>{const e=t.key;if(console.log(`svgEle@keydown=${e}`),t.preventDefault(),t.ctrlKey)switch(e){case"Delete":case"d":T("delete-one");break;case"Enter":T("add-sibling");break;case"Insert":case"i":T("add-sibling");break;case"b":T("text-bold");break;case"l":T("text-line");break;case"c":T("copy");break;case"v":T("paste");break;case"z":T("prev");break;case"y":T("next");break}else if(t.shiftKey)switch(e){case"Enter":T("add");break}else switch(e){case"ArrowRight":T("move_focus_x",{direct:!0});break;case"ArrowLeft":T("move_focus_x",{direct:!1});break;case"ArrowDown":T("move_focus_y",{direct:!0});break;case"ArrowUp":T("move_focus_y",{direct:!1});break;case"Insert":case"i":T("add");break;case"Delete":case"d":T("delete");break;case"Enter":T("edit");break;case"@":T("zoomfit");break;case"[":T("zoomout");break;case"]":T("zoomin");break;case"o":T("collapse");break;case"e":T("expand");break}}))},zi=t=>{let e;try{return e=JSON.parse(t),"name"in e?e:!1}catch{return!1}},dn=()=>3,ot=t=>{const e=["node"];return t&&e.push(`depth-${t.depth}`),e},Vi=t=>{const e=ot(t);return t&&(t.depth===0&&e.push(w.root),t.collapse?e.push(w.collapse):(!t.children||t.children.length===0)&&e.push("leaf")),e},Hi=t=>[w["add-btn"]],un=t=>`translate(${t.dx+t.px},${t.dy+t.py})`,Ie=t=>t.id,pn=t=>{const e=ln(t.name),n=t.height/e.length,o=t.attr;return e.map(s=>({name:s,height:n,attr:o}))},Le=t=>{let e=0,n=0;const o=Math.max(J-3,0);let s=t.width+o;const i=dn();let a=i;const{parent:l}=t;l&&(e=l.width,n=l.height,l.depth===0&&(De||(e/=2),n/=2,a=0)),t.left&&(l&&(l.depth!==0?e=-e:De&&(e=0)),s=-s);const r=[-t.dx+e-t.px,-t.dy+n+a-t.py],d=[0,t.height+i];return`${Qt({source:r,target:d})}L${s},${d[1]}`},Ki=(t,e)=>{const n=t.height/2;let o=t.width+e+tn/2+me.margin;return t.left&&(o=-o),`translate(${o},${n})`},Ui=(t,e)=>{const o=t.height+dn();let s=t.width+e+4;return t.left&&(s=-s),`translate(${s},${o})`},hn=(t,e,n,o,s)=>{t?(ht(e,de),dt(n,de,Bi),o&&ut(o,de),s&&pt(s,de)):(ht(e,J),dt(n,J),o&&ut(o,J),s&&pt(s,J))},mn=(t,e)=>{const n=t.attr("class",s=>Vi(s).join(" ")).attr("data-id",Ie);(e?n.transition(e):n).attr("transform",un)},gn=(t,e)=>{(e?t.transition(e):t).attr("transform",o=>`translate(${o.left?-o.width:0},0)`)},st=t=>{t.attr("alignment-baseline","text-before-edge").attr("font-weight",e=>{var n;return(n=e.attr)!=null&&n.hasOwnProperty("font-weight")?e.attr["font-weight"]:""}).attr("text-decoration",e=>{var n;return(n=e.attr)!=null&&n.hasOwnProperty("text-decoration")?e.attr["text-decoration"]:""}).text(e=>e.name||" ").attr("x",0).attr("dy",(e,n)=>n?e.height:0)},Ji=t=>{const{side:e,padding:n}=me,o=4,s=-n-e/2,i=e+n*2;t.attr("x",s).attr("y",s).attr("rx",o).attr("ry",o).attr("width",i).attr("height",i)},Yi=t=>{t.attr("x",-ce.width/1.2).attr("y",-ce.height/1.2).attr("width",ce.width*1.8).attr("height",ce.height*1.8).attr("rx",ce.radius).attr("ry",ce.radius).attr("stroke",e=>e.color||"grey").attr("fill",e=>e.color||"grey")},Ke=(t,e)=>{t.attr("cx",e).attr("cy",0).attr("r",2)},dt=(t,e,n=4)=>{t.attr("x",o=>-e-(o.left?o.width:0)).attr("y",-e).attr("rx",n).attr("ry",n).attr("width",o=>o.width+e*2).attr("height",o=>o.height+e*2)},ut=(t,e)=>{t.attr("class",w["expand-btn"]).attr("transform",n=>Ui(n,e)).style("color",n=>n.color)},pt=(t,e)=>{t.attr("class",n=>Hi().join(" ")).attr("transform",n=>Ki(n,e))},ht=(t,e)=>{const n=tn+me.margin,o=e*2;t.attr("class",w.trigger).attr("x",s=>-e-(s.left?s.width+n:0)).attr("y",-e).attr("width",s=>s.width+o+n).attr("height",s=>s.height+o)},fn=(t,e)=>{const n=t.attr("stroke",o=>o.color).attr("stroke-width",Ye);if(e){const o=n.transition(e);tt.value?o.attrTween("d",Gi):o.attr("d",Le)}else n.attr("d",Le)};function Gi(t,e,n){const s=Le(t),i=n[e],a=i.cloneNode(),l=i.getTotalLength();a.setAttribute("d",s);const r=a.getTotalLength(),d=[0],c=10/Math.max(l,r);let p=0;for(;(p+=c)<1;)d.push(p);d.push(1);const h=d.map(u=>{const m=i.getPointAtLength(u*l),v=a.getPointAtLength(u*r);return qn([m.x,m.y],[v.x,v.y])});return u=>u<1?"M"+h.map(m=>m(u)).join("L"):s}const qi=t=>{const e=t.append("tspan");return st(e),e},Wi=t=>(st(t),t),Xi=t=>{const e=t.append("g");return Ji(e.append("rect")),e.append("path").attr("d",Oi(2,me.side)),e},Zi=t=>{const e=t.append("g");return Yi(e.append("rect")),Ke(e.append("circle"),-6),Ke(e.append("circle"),0),Ke(e.append("circle"),6),e},_n=t=>{const e=Xi(t);return e.on("click",Rt),e},Qi=t=>{const e=Zi(t);return e.on("click",Pt),e},ea=(t,e)=>{if(t.select(`:scope > g.${w.content} > g.${w["expand-btn"]}`).on("click",Pt),_e.value.drag||_e.value.edit){const o=t.select(`:scope > g.${w.content} > g.${w.text}`);o.on("mousedown",It),_e.value.drag&&!e&&nn(o),_e.value.edit&&o.on("click",Qe)}nt.value&&t.select(`:scope > g.${w.content}`).on("mouseenter",ci).on("mouseleave",di)},ta=t=>{var h;const e=!((h=t.data()[0])!=null&&h.depth),n=t.append("g");mn(n),fn(n.append("path"));const o=n.append("g").attr("class",w.content),s=o.append("rect"),i=o.append("g").attr("class",w.text),a=i.append("rect"),l=i.append("text");gn(l);const r=l.selectAll("tspan").data(pn).enter().append("tspan");st(r);const d=nt.value?_n(o):void 0;let c;const p=t.data();return p.length!=0&&p[0].children.length!=0&&(c=Qi(o)),hn(e,s,a,c,d),ea(n,e),n.each((u,m)=>{!u.children||Re(u.children,n.filter((v,k)=>m===k))}),o.raise(),n},na=t=>{var c;const e=!((c=t.data()[0])!=null&&c.depth),n=rn(500,Mt);mn(t,n),fn(t.select(":scope > path"),n);const o=t.select(`:scope > g.${w.content}`),s=o.select(":scope > rect"),i=o.select(`g.${w.text}`),a=i.select("rect"),l=i.select("text");gn(l,n),l.selectAll("tspan").data(pn).join(qi,Wi,p=>p.remove());let r=o.select(`g.${w["add-btn"]}`),d=t.data().length!=0?o.select(`g.${w["expand-btn"]}`):void 0;return nt.value?r.node()||(r=_n(o)):r.remove(),hn(e,s,a,d,r),t.each((p,h)=>{!p.children||Re(p.children,t.filter((u,m)=>h===m))}),o.raise(),t},Re=(t=[M.data],e=et)=>{e.selectAll(`g.${ot(t[0]).join(".")}`).data(t,o=>o.gKey).join(ta,na)};class oa{constructor(e,n,o,s){this.w=e,this.h=n,this.y=o,this.c=s,this.cs=s.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function mt(t){t.cs===0?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function be(t){return t.y+t.h}class sa{constructor(e,n,o){this.lowY=e,this.index=n,this.next=o}}function gt(t,e,n){for(;n!==null&&t>=n.lowY;)n=n.next;return new sa(t,e,n)}function ia(t,e,n,o){if(n!==e-1){const s=e-n;t.c[n+1].shift+=o/s,t.c[e].shift-=o/s,t.c[e].change-=o-o/s}}function aa(t,e,n,o){t.c[e].mod+=o,t.c[e].msel+=o,t.c[e].mser+=o,ia(t,e,n,o)}function la(t){return t.cs===0?t.tl:t.c[0]}function ra(t){return t.cs===0?t.tr:t.c[t.cs-1]}function ca(t,e,n,o){const s=t.c[0].el;s.tl=n;const i=o-n.mod-t.c[0].msel;s.mod+=i,s.prelim-=i,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}function da(t,e,n,o){const s=t.c[e].er;s.tr=n;const i=o-n.mod-t.c[e].mser;s.mod+=i,s.prelim-=i,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}function ua(t,e,n){let o=t.c[e-1],s=o.mod,i=t.c[e],a=i.mod;for(;o!==null&&i!==null;){be(o)>n.lowY&&(n=n.next);const l=s+o.prelim+o.w-(a+i.prelim);l>0&&(a+=l,aa(t,e,n.index,l));const r=be(o),d=be(i);r<=d&&(o=ra(o),o!==null&&(s+=o.mod)),r>=d&&(i=la(i),i!==null&&(a+=i.mod))}o===null&&i!==null?ca(t,e,i,a):o!==null&&i===null&&da(t,e,o,s)}function pa(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}function We(t){if(t.cs===0){mt(t);return}We(t.c[0]);let e=gt(be(t.c[0].el),0,null);for(let n=1;n<t.cs;n++){We(t.c[n]);const o=be(t.c[n].er);ua(t,n,e),e=gt(o,n,e)}pa(t),mt(t)}function ha(t){let e=0,n=0;for(let o=0;o<t.cs;o++)e+=t.c[o].shift,n+=e+t.c[o].change,t.c[o].mod+=n}function vn(t,e){e+=t.mod,t.x=t.prelim+e,ha(t);for(let n=0;n<t.cs;n++)vn(t.c[n],e)}function ma(t){We(t),vn(t,0)}class ga{constructor(e,n){this.gap=e,this.bottomPadding=n}addBoundingBox(e,n){return{width:e+this.gap,height:n+this.bottomPadding}}removeBoundingBox(e,n){return{x:e+this.gap/2,y:n}}}class fa{constructor(e){this.bb=e}layout(e){const n=this.convert(e);ma(n);const{boundingBox:o,result:s}=this.assignLayout(n,e);return{result:s,boundingBox:o}}convert(e,n=0){const{width:o,height:s}=this.bb.addBoundingBox(e.width,e.height),i=[];if(e.children&&e.children.length)for(let a=0;a<e.children.length;a++)i[a]=this.convert(e.children[a],n+s);return new oa(o,s,n,i)}assignCoordinates(e,n){const{x:o,y:s}=this.bb.removeBoundingBox(e.x,e.y);n.x=o,n.y=s;for(let i=0;i<e.c.length;i++)this.assignCoordinates(e.c[i],n.children[i])}getSize(e,n){const{x:o,y:s,width:i,height:a}=e;if(n||(n={left:o,right:o+i,top:s,bottom:s+a}),n.left=Math.min(n.left,o),n.right=Math.max(n.right,o+i),n.top=Math.min(n.top,s),n.bottom=Math.max(n.bottom,s+a),e.children)for(const l of e.children)this.getSize(l,n);return n}assignLayout(e,n,o){const{x:s,y:i}=this.bb.removeBoundingBox(e.x,e.y);n.x=s,n.y=i;const{width:a,height:l}=n;o||(o={left:s,right:s+a,top:i,bottom:i+l}),o.left=Math.min(o.left,s),o.right=Math.max(o.right,s+a),o.top=Math.min(o.top,i),o.bottom=Math.max(o.bottom,i+l);for(let r=0;r<e.c.length;r++)this.assignLayout(e.c[r],n.children[r],o);return{result:n,boundingBox:o}}}const ft=t=>[t.width,t.height]=[t.height,t.width],_a=t=>{t.parent?(t.dx=t.x-t.parent.x,t.dy=t.y-t.parent.y):(t.dx=0,t.dy=0)},le=(t,e)=>t.id=e,va=t=>{t.parent?t.depth=t.parent.depth+1:t.depth=0},_t=t=>{t.parent&&t.parent.color&&(t.color=t.parent.color)},ba=t=>{t.depth>1&&t.parent&&(t.left=t.parent.left)},ya=t=>{const e=Object.assign({},t),n=Object.assign({},t);if(!t.collapse){const{children:o}=t;e.children=[],n.children=[],o.forEach(s=>{s.left?e.children.push(s):n.children.push(s),s.parent&&(s.parent=n)})}return{left:e,right:n}},Xe=(t,e,n="0")=>{var s;e.forEach(i=>{i(t,n)});const{children:o}=t;if(o)for(let i=0;i<o.length;){const a=o[i];a.id==="del"?(o.splice(i,1),(s=t.rawData.children)==null||s.splice(i,1)):(Xe(a,e,`${n}-${i}`),i+=1)}},vt=(t,e)=>{const n=new ga(e,t);return new fa(n)};class bt{constructor(e,n,o,s,i=Wn(Xn)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.update=!1,this.colorScale=i,this.getSize=s,this.layout=vt(n,o),this.data=this.createMdataFromData(e,"0"),this.renew(),this.update=!1}createMdataFromData(e,n,o=null){const{name:s,collapse:i,children:a,attr:l}=e,{width:r,height:d}=this.getSize(s),c=o?o.depth+1:0;let p=!1,h=o?o.color:"";c===1?(p=!!e.left,h=this.colorScale(`${this.colorNumber+=1}`)):c!==0&&o&&(p=o.left);const u={id:n,name:s,rawData:e,parent:o,left:p,color:h,depth:c,x:0,y:0,dx:0,dy:0,px:0,py:0,width:r,height:d,children:[],_children:[],collapse:!!i,gKey:this.gKey+=1,attr:l};return a&&(u.collapse?a.forEach((m,v)=>{u._children.push(this.createMdataFromData(m,`${n}-${v}`,u))}):a.forEach((m,v)=>{u.children.push(this.createMdataFromData(m,`${n}-${v}`,u))})),this.update=!1,u}renew(...e){Xe(this.data,[ft,va,ba]),this.data=this.l(this.data);const n=[ft,this.renewXY.bind(this),_a];Xe(this.data,n.concat(e)),this.update=!0}l(e){const{left:n,right:o}=ya(e);return this.layout.layout(n),this.layout.layout(o),this.diffY=o.x-n.x,this.rootWidth=n.height,o.children=e.children,o}renewXY(e){[e.x,e.y]=[e.y,e.x],e.left&&(e.x=-e.x+this.rootWidth,e.y+=this.diffY)}isUpdate(){return this.update}getRootWidth(){return this.rootWidth}setBoundingBox(e,n){this.layout=vt(e,n),this.renew()}find(e){const n=e.split("-").map(s=>~~s);let o=this.data;for(let s=1;s<n.length;s++){const i=n[s],{children:a}=o;if(i<a.length)o=a[i];else return null}return o.id===e?o:null}rename(e,n){if(e.length>0){const o=this.find(e);if(o&&o.name!==n){o.name=n,o.rawData.name=n;const s=this.getSize(o.name);o.width=s.width,o.height=s.height,this.renew()}return o}else return null}moveChild(e,n){var a,l;if(e===n)return null;const o=this.find(e),s=this.find(n),i=n.split("-").pop();if(i&&o&&s){const r=s.parent;(a=r==null?void 0:r.children)==null||a.splice(~~i,1),(l=r==null?void 0:r.rawData.children)==null||l.splice(~~i,1),s.parent=o,s.gKey=this.gKey+=1,s.depth=s.parent.depth+1,s.depth===1?s.color=this.colorScale(`${this.colorNumber+=1}`):s.left=s.parent.left,o.collapse?o._children.push(s):o.children.push(s),o.rawData.children?o.rawData.children.push(s.rawData):o.rawData.children=[s.rawData],this.renew(le,_t)}return s}moveSibling(e,n,o=0){const s=e.split("-"),i=n.split("-");let a=s.pop(),l=i.pop();if(e===n||s.length!==i.length||!a||!l)return null;const r=this.find(e),d=this.find(n);if(d&&r&&r.parent){a=parseInt(a,10),l=parseInt(l,10),a<l&&(l-=1);const{children:c}=r.parent,{children:p}=r.parent.rawData;if(c&&p)return c.splice(a,1),c.splice(l+o,0,r),p.splice(a,1),p.splice(l+o,0,r.rawData),r.depth===1&&(r.left=d.left),this.renew(le),r}return null}add(e,n){const o=this.find(e);if(o)if(o.collapse&&this.expand(e),o.rawData.children||(o.rawData.children=[]),typeof n=="string"){const s=n,i=this.getSize(s),a={name:s},l=o.color?o.color:this.colorScale(`${this.colorNumber+=1}`),r={id:`${o.id}-${o.children.length}`,name:s,rawData:a,parent:o,left:o.left,collapse:!1,color:l,gKey:this.gKey+=1,width:i.width,height:i.height,depth:o.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return o.children.push(r),o.rawData.children.push(a),this.renew(),r}else{const s=n,i=this.createMdataFromData(s,`${o.id}-${o.children.length}`,o);return o.children.push(i),o.rawData.children.push(s),this.renew(),i}return null}expand(e){return this.eoc(e,!1,[_t,le])}collapse(e){return this.eoc(e,!0)}eoc(e,n,o=[]){const s=this.find(e);return s&&(s.collapse=n,s.rawData.collapse=n,[s._children,s.children]=[s.children,s._children],this.renew(...o)),s}delete(e){const n=this.find(e);if(n&&n.parent)n.id="del",this.renew(le);else throw new Error(n?"\u6682\u4E0D\u652F\u6301\u5220\u9664\u6839\u8282\u70B9":"\u672A\u627E\u5230\u9700\u8981\u5220\u9664\u7684\u8282\u70B9")}deleteOne(e){var o;const n=this.find(e);if(n&&n.parent){const{parent:s,children:i,_children:a,collapse:l,rawData:r}=n,d=parseInt(e.split("-").pop(),10);s.children.splice(d,1,...l?a:i),(o=s.rawData.children)==null||o.splice(d,1,...r.children||[]),i.forEach(c=>{c.parent=s,c.depth===1&&(c.rawData.left=c.left)}),this.renew(le)}}addSibling(e,n,o=!1){var i;console.log(`[addSibling] id=${e},name=${n}`);const s=this.find(e);if(s&&s.parent){const a=parseInt(e.split("-").pop(),10),{parent:l,left:r}=s,d={name:n,left:r},c=this.getSize(n),p=o?a:a+1,h=l.color?l.color:this.colorScale(`${this.colorNumber+=1}`),u={name:n,parent:l,children:[],_children:[],color:h,collapse:!1,rawData:d,id:`${l.id}-${p}`,left:r,gKey:this.gKey+=1,depth:s.depth,width:c.width,height:c.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return l.children.splice(p,0,u),(i=l.rawData.children)==null||i.splice(p,0,d),console.log(`index=${a},start=${p},sibling.id=${u.id}`),this.renew(le),u}return null}addParent(e,n){var s;const o=this.find(e);if(o&&o.parent){const{parent:i,left:a,color:l}=o,r=this.getSize(n),d=parseInt(o.id.split("-").pop(),10),c={name:n,children:[o.rawData],left:a};(s=i.rawData.children)==null||s.splice(d,1,c);const p={rawData:c,left:a,name:n,color:l,collapse:!1,parent:i,id:o.id,depth:o.depth,width:r.width,height:r.height,gKey:this.gKey+=1,children:[o],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return o.parent=p,i.children.splice(d,1,p),this.renew(le),p}return null}changeLeft(e){console.log("changeLeft");const n=this.find(e);return n&&(n.left=!n.left,n.rawData.left=n.left,this.renew()),n}applayAttr(e,n){console.log("applayAttr");const o=this.find(e);if(o){let s=o.attr?o.attr:{},i=Object.keys(n)[0];s.hasOwnProperty(i)?delete s[i]:Object.assign(s,n),o.attr=s,o.rawData.attr=s,this.renew()}return o}}let M;L.on("mmdata",t=>t?M=t:null);const P=(t=!0)=>{t&&ke.snap(M.data),on.emit("update:modelValue",Zn([M.data.rawData])),ji(),Re()},bn=(t,e,n=!1)=>{console.log(`rename: id/name=${t}/${e}`),M.rename(t,e),n||P()},wa=(t,e)=>{M.moveChild(t,e),P()},yt=(t,e,n=0)=>{M.moveSibling(t,e,n),P()},yn=(t,e)=>{const n=M.add(t,e);return P(),n},wt=t=>{M.delete(t),P()},ka=t=>{M.deleteOne(t),P()},wn=t=>{M.expand(t),P()},kn=t=>{M.collapse(t),P()},kt=(t,e,n=!1)=>{const o=M.addSibling(t,e,n);return P(),o},xa=(t,e)=>{const n=M.addParent(t,e);return P(),n},$a=t=>{M.changeLeft(t),P()},xt=(t,e)=>{M.applayAttr(t,e),P()};var Ea={translation:{contextmenu:{collapse:"\u6298\u53E0\u8282\u70B9",expand:"\u5C55\u5F00\u8282\u70B9",delete:"\u5220\u9664\u8282\u70B9","delete-one":"\u5220\u9664\u5355\u4E2A\u8282\u70B9",add:"\u65B0\u5EFA\u5B50\u8282\u70B9","add-parent":"\u65B0\u5EFA\u7236\u8282\u70B9","add-sibling":"\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9","add-sibling-before":"\u5728\u6B64\u4E4B\u524D\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9",cut:"\u526A\u5207",copy:"\u62F7\u8D1D",paste:"\u7C98\u8D34",selectall:"\u5168\u9009",zoomin:"\u653E\u5927",zoomout:"\u7F29\u5C0F",zoomfit:"\u7F29\u653E\u81F3\u5408\u9002\u5927\u5C0F"}}},Ca={translation:{contextmenu:{collapse:"collapse",expand:"expand",delete:"delete","delete-one":"delete a single node",add:"add child node","add-parent":"add parent node","add-sibling":"add sibling node","add-sibling-before":"add sibling node before",cut:"cut",copy:"copy",paste:"paste",selectall:"select all",zoomin:"zoom in",zoomout:"zoom out",zoomfit:"zoom fit"}}};Dt.init({fallbackLng:"zh",lng:"zh",resources:{zh:Ea,en:Ca}});const Sa="_container_2lmy6_1",Ma="_menu_2lmy6_1",Da="_disabled_2lmy6_47";var Ba={container:Sa,menu:Ma,disabled:Da};const Ta=O({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(t,e){const n=E(!1),o=Qn(),s=E(),i=E(),a=j({top:0,left:0}),l=8;L.on("showContextmenu",async p=>{if(!s.value||!i.value)return;console.log("showContextmenu"),n.value=!!p,await eo();const{offsetWidth:h,offsetHeight:u}=s.value,{offsetWidth:m,offsetHeight:v}=i.value,{top:k,left:x}=t.position;a.top=k+v>u?u-v-l:k,a.left=x+m>h?x-m:x});const r=()=>n.value=!1;return{style:o,show:n,close:r,onClick:p=>{r();const h=u=>u.disabled==null?`icon_${u.name}`:u.name;e.emit("click-item",h)},menuEle:i,containerEle:s,pos:a,i18n:Dt,note:p=>p?`(${p})`:""}}}),La=["id"],ja=["onClick"];function Oa(t,e,n,o,s,i){return ge((b(),y("div",{class:z(t.style.container),ref:"containerEle"},[$("div",{onMousedown:e[0]||(e[0]=(...a)=>t.close&&t.close(...a))},null,32),$("div",{ref:"menuEle",id:t.style.menu,style:X({top:t.pos.top+"px",left:t.pos.left+"px"})},[$("table",null,[(b(!0),y(q,null,ne(t.groups,(a,l)=>(b(),y("tr",{key:l},[(b(!0),y(q,null,ne(a,r=>(b(),y("td",{key:r.name},[$("div",{class:z(r.disabled?t.style.disabled:""),onClick:d=>t.onClick(r)},K(r.name)+K(t.note(r.note)),11,ja)]))),128))]))),128))])],12,La)],2)),[[Ct,t.show]])}const xn={};xn.$style=Ba;var Aa=F(Ta,[["render",Oa],["__cssModules",xn]]);const Na=O({name:"Mindmap",emits:["event_callback"],components:{Contextmenu:Aa},props:{update:Boolean,modelValue:{type:Array,required:!0}},setup(t,e){to(()=>L.emit("mindmap-context",e)),Z(()=>{if(!V.value||!pe.value||!He.value||!ie.value||!U.value)return;L.emit("selection-svg",ae(V.value)),L.emit("selection-g",ae(pe.value)),L.emit("selection-asstSvg",ae(He.value)),L.emit("selection-foreign",ae(ie.value)),L.emit("mmdata",new bt(ve.exports.cloneDeep(t.modelValue[0]),Be,we,rt)),tt.value=!1,P();const{svg:o,foreign:s}=R;s==null||s.raise(),Pi(),o==null||o.on("mousedown",()=>{console.log("svg@mousedown"),document.getElementsByClassName(w.selected)[0]}),o==null||o.on("blur",()=>{console.log("svg@blur"),M.isUpdate()&&n("blur","")}),fi(!0),bi(!0),vi(!0),yi(!0),_i(!0),Se()}),N(()=>[t.update],o=>{console.log("props.update"),L.emit("mmdata",new bt(ve.exports.cloneDeep(t.modelValue[0]),Be,we,rt)),Re(),setTimeout(async()=>{Se()},500)});const n=(o,s)=>{console.log(`cmd=${o}, name=${s}`),e.emit("event_callback",o,s)};return{wrapperEle:W,svgEle:V,gEle:pe,style:w,asstSvgEle:He,foreignEle:ie,foreignDivEle:U,centerView:Ii,fitView:Se,download:Ri,menu:Si,contextmenuPos:Ut,onClickMenu:T,next:Ge,prev:qe,hasPrev:sn,hasNext:an}}}),Fa=["id"],Ia={ref:"gEle"},Ra={ref:"foreignEle",style:{display:"none"}},Pa={ref:"foreignDivEle",contenteditable:""};function za(t,e,n,o,s,i){const a=I("contextmenu");return b(),y("div",{class:z(t.style.container)},[$("div",{id:t.style["svg-wrapper"],ref:"wrapperEle"},[(b(),y("svg",{class:z(t.style.svg),ref:"svgEle"},[$("g",Ia,[(b(),y("foreignObject",Ra,[$("div",Pa,null,512)],512))],512)],2))],8,Fa),(b(),y("svg",{ref:"asstSvgEle",class:z(t.style["asst-svg"])},null,2)),$("div",{class:z([t.style["button-list"],t.style["right-bottom"]])},[$("button",{onClick:e[0]||(e[0]=l=>t.fitView())},[$("i",{class:z(t.style.fit)},null,2)]),$("button",{onClick:e[1]||(e[1]=l=>t.download())},[$("i",{class:z(t.style.download)},null,2)])],2),$("div",{class:z([t.style["button-list"],t.style["right-top"]])},[$("button",{onClick:e[2]||(e[2]=(...l)=>t.prev&&t.prev(...l)),class:z({[t.style.disabled]:!t.hasPrev})},[$("i",{class:z(t.style.prev)},null,2)],2),$("button",{onClick:e[3]||(e[3]=(...l)=>t.next&&t.next(...l)),class:z({[t.style.disabled]:!t.hasNext})},[$("i",{class:z(t.style.next)},null,2)],2)],2),S(a,{position:t.contextmenuPos,groups:t.menu,onClickItem:t.onClickMenu},null,8,["position","groups","onClickItem"])],2)}var Va=F(Na,[["render",za]]);const Ha={class:"container"},Ka={class:"main"},Ua=O({emits:["event_callback"],setup(t,{emit:e}){const{store_data:n}=Q(),{store_dlg:o}=Ne();Ze();const s=je();E(null);const i=j({height:window.innerHeight,update:!1,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});Z(()=>{console.log("[mounted]"),l(),window.addEventListener("resize",r),document.addEventListener("keydown",a),document.body.style.overflow="hidden"}),Ae(()=>{console.log("unmounted!"),window.removeEventListener("resize",r),document.removeEventListener("keydown",a)});const a=x=>{if(x.keyCode===83&&x.ctrlKey){x.preventDefault(),console.log("save"),m(p.value);return}},l=()=>{const x=B=>{n.do_cmd("restore_file","")};console.log("init"),s.fullPath,s.path.substring(1),x(),n.do_cmd("filter_menu",null),r()},r=()=>{const x=window.innerHeight-40;i.height=x,n.update_height(x)},d=j({center_btn:{value:!0},fit_btn:{value:!0},timetravel:{value:!0},download_btn:{value:!0},add_node_btn:{value:!0},keyboard:{value:!1,disabled:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},sharp_corner:{value:!1},vertical:{value:!1,disabled:!0}}),c=j({branch:{value:4,min:1,max:6},x_gap:{value:42,min:0,max:100},y_gap:{value:9,min:0,max:100}}),p=E([{name:"start",children:[]}]),h=E("en");N(()=>n.state.obj,(x,B)=>{console.log("[watch-body]"),u(x.content)});const u=x=>{try{p.value=JSON.parse(x)}catch(B){console.log(B),p.value=[{name:"@start",children:[]}]}console.log("onChanged_body"),i.update=!i.update},m=x=>{n.do_cmd("save_file",JSON.stringify(p.value))},v=async(x,B)=>{switch(console.log(`[event_callback] cmd=${x}, va0=${B}`),x){case"toggle_editor":m(p.value);break;case"filelist":document.querySelector(".col-3");const A=!i.toggle_list;i.toggle_list=A,console.log(i.toggle_list);break;case"blur":m(p.value);break;default:if(x.indexOf("dlg_")!=-1){const g=Object.assign({},k(x,B));console.log(g),o.update_param(g)}else n.do_cmd(x,B);break}},k=(x,B)=>{const A=jt[x],g=B!=null?B:n.state.filename;return A.init(A,g),A};return(x,B)=>(b(),y("div",Ha,[S(Ot,{ref:"appbar",onEvent_callback:v},null,512),S(Ft,{objParam:f(i).objDlgCmn,onEvent_callback:v},null,8,["objParam"]),$("div",Ka,[f(i).toggle_list?(b(),re(At,{key:0,class:"col-3",onEvent_callback:v,style:X({height:f(i).height+"px"})},null,8,["style"])):G("",!0),S(f(Va),{class:"col-2",modelValue:p.value,"onUpdate:modelValue":B[0]||(B[0]=A=>p.value=A),update:f(i).update,branch:f(c).branch.value,"x-gap":f(c).x_gap.value,"y-gap":f(c).y_gap.value,zoom:f(d).zoom.value,"fit-btn":f(d).fit_btn.value,"center-btn":f(d).center_btn.value,"download-btn":f(d).download_btn.value,drag:f(d).drag.value,edit:f(d).edit.value,"add-node-btn":f(d).add_node_btn.value,"sharp-corner":f(d).sharp_corner.value,ctm:f(d).contextmenu.value,timetravel:f(d).timetravel.value,locale:h.value,style:X({height:f(i).height+"px"}),onEvent_callback:v},null,8,["modelValue","update","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","ctm","timetravel","locale","style"])])]))}});var Ja=F(Ua,[["__scopeId","data-v-064a2248"]]);const Ya=[{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Hs},{name:".mm",path:"/mm/:pathMatch(.*)",component:Ja},{name:".md",path:"/:pathMatch(.*)*",component:zs}],Ga=no({history:oo(),routes:Ya});function qa(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:s,onRegisterError:i}=t;let a;const l=async(r=!0)=>{};return"serviceWorker"in navigator&&(a=new so("./sw.js",{scope:"./"}),a.addEventListener("activated",r=>{r.isUpdate?window.location.reload():o==null||o()}),a.register({immediate:e}).then(r=>{s==null||s(r)}).catch(r=>{i==null||i(r)})),l}qa();io.add(ao);lo(Eo).use(Ga).component("fa",ro).mount("#app");
