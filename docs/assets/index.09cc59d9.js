var ve=Object.defineProperty;var be=(n,e,t)=>e in n?ve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var b=(n,e,t)=>(be(n,typeof e!="symbol"?e+"":e,t),t);import{D as we,a as ie,i as re,p as le,u as de,b as ne,r as T,d as O,c as U,e as j,o as h,f as w,g as k,F,h as x,j as P,t as N,k as A,l as H,w as ue,m as L,n as q,q as C,s as Z,v as G,x as J,y as ke,z as ye,A as $e,B as K,C as Ee,E as xe,G as Ce,H as ae,R as Me,I as te,J as _e,K as Q,L as Se,M as ce,N as je,T as Oe,O as Le,P as Te,Q as De,S as Ae,_ as Ne,U as Ie,V as Be}from"./vendor.9d60e354.js";const Fe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(s){if(s.ep)return;s.ep=!0;const c=t(s);fetch(s.href,c)}};Fe();class R{constructor(){b(this,"id",-1);b(this,"content","");b(this,"path","");b(this,"title","");b(this,"group","");b(this,"atime",Date());b(this,"ctime",Date());b(this,"tags",[]);b(this,"htags",[]);b(this,"position")}set(e,t="",o=[],s=!1){t!=""&&(this.path=t),o!=[]&&(this.tags=o),this.content=e;const c=this.get_time();this.atime=c,s==!0&&(this.ctime=c)}set_default(e){this.path=e,this.content="",this.tags=[];const t=this.get_time();this.atime=t,this.ctime=t}copy(e){Object.assign(this,e)}duplicate(e,t=""){const o=new R;return o.copy(this),o.content=e,o.path=t,o.update_contentEx(),o.update_time(),o}update_content(e){e!=null&&(this.content=e),this.update_contentEx()}update_contentEx(){this.atime=this.get_time(),this.tags=this.build_tag(this.content)}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const t=o=>`00${o}`.slice(-2);return`${e.getFullYear()}/${t(e.getMonth()+1)}/${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`}update_time(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){console.log("[build_tag]");const t=[],o=[0,0,0,0,0],s=e.split(/\r\n|\n|\r/);for(let c=0;c<s.length;c++)if(s[c].search(/^\s*#/)!=-1){const i=s[c].split(" "),l=i[0].length;i.shift();const r=i.join(" ");t.push({text:r,line:c,tag:l,num:o[l]}),o[l]++}return t}split(e){const t=[],o=this.content.split(/\r\n|\n|\r/),s=this.tags.filter(function(r){return r.tag==e}),c=[],a=o.length;for(var i=0;i<s.length;i++){const r=s[i].line;c.push({start:r,end:a,title:s[i].text}),i!=0&&(c[i-1].end=r-1)}const l=this.path.replace(".","_");return c.reverse(),c.forEach(r=>{const d=o.splice(r.start,r.end).join(`\r
`),u=this.duplicate(d,`${l}/${r.title}`);t.push(u)}),t.reverse(),t}}class Re extends we{constructor(){super("OdenDB");b(this,"viewer");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class Ve{constructor(e){b(this,"caller");b(this,"db",new Re);b(this,"dbx");b(this,"ctime","");b(this,"atime","");b(this,"getStrageEx",async()=>await this.getAll());b(this,"read",async e=>{const t=await this.dbx.get(e);return t!=null?t.data:null});b(this,"write",async(e,t)=>{const o=JSON.stringify(t);await this.dbx.put({key:e,data:o,ctime:this.set_time_DB()}),this.set_time_DB()});b(this,"delete",async e=>{await this.dbx.delete(e),this.set_time_DB()});this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(o=>{e[o.key]=o.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class Pe{constructor(e){b(this,"_");b(this,"storeLS");b(this,"write",(e,t)=>this.storeLS.write(e,t));b(this,"delete",e=>this.storeLS.delete(e));b(this,"rename",async(e,t)=>{console.log(`[rename] _key_org=${e}, _key_new=${t}`);const o=this.as(await this.get(e));return o.path=t,await this.write(t,o),await this.delete(e),o});b(this,"split",async e=>{console.log(`[split] _key_org=${e}`);const o=this.as(await this.get(e)).split(1);return o.forEach(s=>{this.write(s.path,s)}),o});b(this,"merge",(e,t)=>{console.log(`[merge] _path=${e}`);const o=new R;return o.set_default(e),o.update_content(t),this.write(e,o),o});b(this,"as",e=>Object.assign(new R,e));b(this,"sync_DB",()=>this.storeLS.sync_DB());this._=e,this.storeLS=new Ve(this._)}async get(e){console.log(`[get] _key=${e}`);const t=await this.read(e);return t!=null?JSON.parse(t):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,t){console.log(`[set] _key=${e}`);const o=this.as(await this.get(e));return o.path==""&&(o.path=e),o.update_content(t),this.write(e,o),o}async set_ex(e,t){console.log(`[set_ex] _key=${e}`);const o=this.as(t);return t.path==""&&(t.path=e),o.update_content(void 0),this.write(e,o),o}async read(e){return await this.storeLS.read(e)}create(e){console.log(`[create] _key=${e}`);const t=new R;return e!=null&&(t.set_default(e),this.write(e,t)),t}}const oe="menu.json";class He{constructor(e){b(this,"_");this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const t=await this._.mgrCache.getLstContent(e),o=this.buildMenu(t);return console.log(`${t.length}/${o.length}`),this._.contentEx.set(oe,JSON.stringify(o)),o}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const t=await this._.contentEx.get(oe);return JSON.parse(t.content)}}buildMenu(e){function t(s){const c=new Set;return s.forEach(a=>{c.add(a.group)}),[...c]}function o(s){console.log("storeEx_index:buildMenuEx");const c=t(s);return s.reduce((a,i)=>{if(i.path==oe)return a;let l=i.group,r=i.title,_=`${l}/${r}`;return c.includes(_)&&(l=_,r=".index",_=`${l}/${r}`),a.push({key:_,group:l,title:r,path:i.path,atime:i.atime}),a},[])}return o(e).sort(this.compare_group)}compare_group(e,t){let o=e.group,s=t.group;o==s&&(o=`${e.group}/${e.title}`,s=`${t.group}/${t.title}`);const c=o.toUpperCase(),a=s.toUpperCase();let i=0;return c>a?i=1:c<a&&(i=-1),i}}class W{static async read(e){console.log(`[read] filename=${e}`);const t=new URLSearchParams;return t.append("filename",e),W.post_cmdEx("load_file_md",t)}static write(e,t){console.log(`[write] filename=${e}`);const o=new URLSearchParams;return o.append("filename",e),o.append("source",t),W.post_cmdEx("save_file_md",o)}static async get_cmdEx(e){const t="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:get_cmdEx] api=${t}`),ie.get(t).then(o=>o.data).catch(o=>{throw o.response.status})}static async post_cmdEx(e,t){const o="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:post_cmdEx] api=${o}`),ie.post(o,t).then(s=>s.data).catch(s=>{throw s.response.status})}}class Je{constructor(e){b(this,"_");b(this,"backupEx",(e,t,o)=>{const s=()=>{const a=new URLSearchParams;a.append("lstContent",JSON.stringify(e)),W.post_cmdEx("backup_contents",a).then(i=>console.log(i)).catch(i=>console.log(i))},c=()=>{const a=new Blob([JSON.stringify(e)],{type:"text/plain"}),i=(r,_)=>{const d=new Date,u=m=>`00${m}`.slice(-2);return`${r}_${d.getFullYear()}${u(d.getMonth()+1)}${u(d.getDate())}_${u(d.getHours())}.${_}`},l=document.createElement("a");l.download=i("lstData","json"),l.href=URL.createObjectURL(a),l.click(),URL.revokeObjectURL(l.href)};switch(console.log(`[backup] mode=${t}`),t){case"backup":s();break;case"export":c();break}});this._=e}async restoreEx(e,t,o){function s(l){l.forEach(r=>{const _=new R;_.copy(r),_.update_contentEx(),_.update_time(),i.write(_.path,_)})}async function c(l,r){W.get_cmdEx("restore_contents").then(_=>{s(_),l(_)}).catch(_=>{console.log(_),r(null)})}async function a(l,r,_){const d=new FileReader;d.onload=()=>{var v;console.log("onload");const u=(v=d.result)!=null?v:"",m=JSON.parse(u);s(m),r(m)},d.onerror=u=>{_("error")},d.readAsText(l)}console.log("[importExport:restore]");const i=this._.contentEx;return new Promise(function(l,r){switch(e){case"restore":c(l,r);break;case"import":a(t,l,r);break}})}}class Ue{constructor(e){b(this,"_");b(this,"journal2",async(e,t)=>{const o=(c,a)=>`
## ${this._.contentEx.as(c).cnv_time(t)}
${a}
`;console.log("[journal]");const s=await this.geolocation();return e.content+=o(e,s),e});b(this,"geolocation",()=>new Promise(e=>{let t="";navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{t=`(Latitude,longitude)=(${o.coords.latitude},${o.coords.longitude})
`,e(t)},o=>{switch(o.code){case 1:t="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:t="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:t="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}e(t)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),e(t))}));b(this,"chat",async(e,t,o)=>{const s=m=>["sun","mon","tue","wed","thu","fri","sat"][m],c=m=>{const v=I=>`00${I}`.slice(-2),E=`${m.getFullYear()}/${v(m.getMonth()+1)}/${v(m.getDate())}(${s(m.getDay())})`,M=`${v(m.getHours())}:${v(m.getMinutes())}`;return[E,M]},a=(m,v)=>m!==v?`
## ${v}
`:"",i=m=>{const v=o.isNoList?"":"- ",E=o.isAddTime?`${m} : `:"";return`${v}${E}${t}
${d}`};console.log("[chat]");const l=e.content.indexOf(`
`),[r,_]=c(new Date),d=o.isAddGeo?await this.geolocation()+`
`:"",u=a(e.content.substring(0,l),r)+i(_);return e.content=`${r}${e.content.substring(l)}${u}`,e});this._=e}async path_rename(e,t,o){console.log(`_from=${e}, _to=${t}`);const s=this.collect_filename_by_group(e,o);for(let c=0;c<s.length;c++){const a=s[c],i=`${a[1]}/${a[0]}`,l=`${t}${a[2]}/${a[0]}`;await this._.contentEx.rename(i,l)}}async path_delete(e,t){console.log(`_path=${e}`);const o=this.collect_filename_by_group(e,t);for(let s=0;s<o.length;s++){const c=o[s],a=`${c[1]}/${c[0]}`;await this._.contentEx.delete(a)}}async path_merge(e,t,o){console.log(`_path=${e}`);const s=[],c=this.collect_filename_by_group(e,o);for(let i=0;i<c.length;i++){const l=c[i],r=`${l[1]}/${l[0]}`,_=await this._.contentEx.get(r);s.push(_.content)}const a=s.join(`\r
`);return this._.contentEx.merge(t,a)}collect_filename_by_group(e,t){console.log(`[collect_filename_by_group] group=${e}`);const o=[],s=e.length!=0?1:0;return t.forEach((c,a)=>{if(c.group==e){const i=c.group.substring(e.length+s);o.push([c.title,c.group,i.length!=0?`/${i}`:""])}}),o}}class qe{constructor(e){b(this,"_");this._=e}async getLstContent(e){console.log("[getLstContent]");const t=c=>{const a=e.path==""?!0:c.path.indexOf(e.path)!=-1,i=e.keyword==""?!0:c.content.toLowerCase().indexOf(e.keyword)!=-1;return a&&i},o=await this.buildLstContent();return e!=null?o.filter(t):o}async buildLstContent(){var c;console.log("[buildLstContent]");const e=a=>{var r,_;let i=a.path;(i==""||i==null)&&(i=`@test/${new Date().toLocaleString()}`);const l=i.split("/");return a.title=(r=l.pop())!=null?r:".",a.group=(_=l.join("/"))!=null?_:"@test",a.tags=[],a.htags=[],a},t=await this._.contentEx.storeLS.getStrageEx(),o=[],s=a=>t[a];for(const a of Object.keys(t))try{o.push(e(JSON.parse((c=s(a))!=null?c:"")))}catch(i){console.log(`@ error key=${a},e=${i} - other error`)}return o}}class Ke{constructor(){b(this,"contentEx",new Pe(this));b(this,"mgrExchange",new Je(this));b(this,"mgrEtc",new Ue(this));b(this,"mgrMenu",new He(this));b(this,"mgrCache",new qe(this));console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,t){return this.contentEx.set(e,t)}async cmd_save_ex(e,t){return this.contentEx.set_ex(e,t)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_rename(e,t){await this.contentEx.rename(e,t)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,t="",o=null){const s=await this.mgrCache.getLstContent(o);this.mgrExchange.backupEx(s,e,t)}async cmd_restoreEx(e,t,o=""){await this.mgrExchange.restoreEx(e,t,o)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,t,o)}async cmd_path_delete(e){const t=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,t)}async cmd_path_merge(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,t,o)}async cmd_chat(e,t,o){const c=(()=>{const l=new Date;return`${e}${o.mode}_${l.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${c}`);const a=await this.contentEx.get(c),i=await this.mgrEtc.chat(a,t,o);return await this.contentEx.set(c,i.content),[i,c]}}class Ye{constructor(e){b(this,"KEY","");console.log(e),this.KEY=e}get(e){var t;if(localStorage.getItem(this.KEY)!=null){const o=JSON.parse((t=localStorage.getItem(this.KEY))!=null?t:"");e(o),console.log(o)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const Ge=1e3*60*10,me=Symbol(),We=()=>{const n=de(),e=ne(),t=T({storeEx:new Ke,persisted:new Ye("lifeLog-Viewer-params"),filename:"",obj:new R,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),o=p=>{console.log(`[update_filename] : new=${p}`),p!=t.filename&&s(p)},s=async p=>{const g=y=>{e.path.indexOf(y)==-1&&(console.log(`_value=${y}`),n.push(`/${y}`)),t.persisted.set({filename:y}),t.filename=y};if(console.log(`[load_obj] : new=${p}`),p!=""){const y=await t.storeEx.cmd_load(p);l(y)}else r("");g(p)},c=()=>{console.log("restore_filename"),t.persisted.get(p=>{o(p.filename)})},a=async p=>{if(p==""){console.log("skip save - empty data");return}r(p),l(t.obj),await t.storeEx.cmd_save_ex(t.filename,t.obj),u()},i=()=>{console.log("[auto_save] start"),t.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(t.intervalId_autoSave)),t.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await f("export",null,null),t.intervalId_autoSave=null},Ge)},l=p=>{const g=p instanceof R?p:Object.assign(new R,p);g.update_contentEx(),t.tags=g.tags,t.obj=g},r=p=>{t.obj.content=p},_=async(p,g)=>{if(console.log(p),g!=null){const y=await t.storeEx.cmd_load(g);y.position=p,await t.storeEx.cmd_save_ex(g,y)}else t.obj.position=p},d=p=>{t.dictMenu=p},u=()=>{setTimeout(async()=>{d(await t.storeEx.cmd_rebuild()),i()},250)},m=p=>{t.jump=p,p!=-1&&(console.log(`jump=${p}`),t.ObjTag=JSON.parse(JSON.stringify(t.tags[p])),console.log(JSON.stringify(t.ObjTag)))},v=p=>{t.height=p},E=async(p,g)=>{const[y,S]=await t.storeEx.cmd_chat(t.path_expand,p,g);l(y),o(S),u()},M=async(p,g)=>{const y=await t.storeEx.cmd_exist(p);if(g==y)return!0;{const S=g?`error : ${p} is not exist. please enter exist filename.`:`error : ${p} is already exist. please enter other filename.`;return console.log(S),!1}},I=async(p,g)=>{await M(p,!1)&&(await t.storeEx.cmd_rename(g,p),o(p),u())},B=async(p,g)=>{const y=$(g)[0],S=$(p)[0];await t.storeEx.cmd_path_rename(y,S),o(""),u()},f=async(p,g,y)=>{console.log(`[do_cmd] mode=${p}`);let S=g!=""?g:t.filename,Y="",z;switch(p){case"update_jump":m(g);break;case"rebuild_menu":u();break;case"filter_menu":const ee=g;g!=null&&(ee.path=ee.isUnderFolder?$(t.filename)[0]:""),d(await t.storeEx.cmd_getMenu(ee));break;case"open_file":o(g);break;case"restore_file":c();break;case"save_file":await a(g);break;case"new":await M(g,!1)&&(await t.storeEx.cmd_create(g),o(g),u());break;case"delete":await M(S,!0)&&(await t.storeEx.cmd_delete(S),o(""),u());break;case"rename":I(g,y);break;case"backup":t.storeEx.cmd_backup("backup");break;case"export":t.storeEx.cmd_backup("export");break;case"restore":await t.storeEx.cmd_restoreEx("restore",null),u();break;case"import":await t.storeEx.cmd_restoreEx("import",g),u();break;case"split":await M(S,!0)&&(await t.storeEx.cmd_split(S),u());break;case"path_rename":B(g,y);break;case"path_delete":Y=$(g)[0],await t.storeEx.cmd_path_delete(Y),o(""),u();break;case"path_merge":Y=$(g)[0],S=`${Y}.md`,await M(S,!1)&&(await t.storeEx.cmd_path_merge(Y,S),o(S),u());break;case"print":const fe=n.resolve({path:`/print/${t.filename}`});window.open(fe.href,"_blank");break;case"journal":E("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":E(g,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":E(g,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":z={keyword:y.filter,isUnderFolder:y.isCheck,path:""},d(await t.storeEx.cmd_getMenu(z));break;case"update_position":await _(g,y);break;case"move_archive":I(`@archive/${g}`,g);break;case"move_path_archive":B(`@archive/${g}`,g);break;case"export_archive":z={keyword:"",isUnderFolder:!0,path:"@archive/"},t.storeEx.cmd_backup("export","",z);break}},$=p=>{const g=p.split("/"),y=g[g.length-1];return[g.slice(0,-1).join("/"),y]};return{store_data:{state:t,update_height:v,do_cmd:f}}},ze=()=>{le(me,We())},V=()=>re(me),Qe=()=>{const n=T({objParam:null});return{store_dlg:{state:n,update_param:t=>{n.objParam=t}}}},pe=Symbol(),Xe=()=>{le(pe,Qe())},se=()=>re(pe);const Ze=O({setup(n){return ze(),Xe(),(e,t)=>{const o=j("routerView");return h(),U(o)}}});var D=(n,e)=>{const t=n.__vccOpts||n;for(const[o,s]of e)t[o]=s;return t};const et={key:0,class:"item"},tt={key:1,class:"line"},ot={key:1,class:"folder"},nt={key:2,class:"dropdown"},st=O({props:{item:{type:null,required:!0}},emits:["event_callback"],setup(n,{emit:e}){const t=n,o=T({isOpen:!1,item:t.item,isFolder:t.item.children&&t.item.children.length,isActive:!0}),s=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},c=a=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const i=a.cmd;s(i,null)}};return(a,i)=>{const l=j("fa"),r=j("MenuTreeItem",!0);return h(),w("div",{class:"menu_tree",onClick:i[0]||(i[0]=_=>c(k(o).item)),onContextmenu:i[1]||(i[1]=ue(()=>{},["right","prevent"]))},[k(o).isFolder?A("",!0):(h(),w(F,{key:0},[k(o).item.title!=""?(h(),w("span",et,[x(l,{icon:k(o).item.icon},null,8,["icon"]),P(" "+N(k(o).item.title),1)])):A("",!0),k(o).item.title==""?(h(),w("div",tt)):A("",!0)],64)),k(o).isFolder?(h(),w("span",ot,[x(l,{icon:k(o).item.icon},null,8,["icon"]),P(" "+N(k(o).item.title),1)])):A("",!0),k(o).isFolder?(h(),w("div",nt,[(h(!0),w(F,null,H(k(o).item.children,(_,d)=>(h(),w("div",{key:d},[x(r,{item:_,onEvent_callback:s},null,8,["item"])]))),128))])):A("",!0)],32)}}});var it=D(st,[["__scopeId","data-v-af6b6e1a"]]);const at=O({props:{mouse:{type:null,required:!0},items:{type:Array,required:!0}},emits:["event_callback"],setup(n,{emit:e}){const t=n;console.log(`[props]=${JSON.stringify(t)}`);const o=T({items:t.items,pos_x:-1,pos_y:-1,isShow:!1,style:"display:none"});console.log(`[state]=${JSON.stringify(o)}`),L(()=>t.mouse,(a,i)=>{console.log("props"),o.isShow=!0,o.pos_x=t.mouse.clientX,o.pos_y=t.mouse.clientY,o.items=t.items,o.style="display:block"});const s=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},c=a=>{o.style=a?"display:block":"display:none"};return(a,i)=>(h(),w("div",{class:"menu",style:q(k(o).style),onMouseover:i[0]||(i[0]=l=>c(!0)),onMouseleave:i[1]||(i[1]=l=>c(!1))},[(h(!0),w(F,null,H(k(o).items,l=>(h(),w("div",{key:l.path},[x(it,{item:l,onEvent_callback:s},null,8,["item"])]))),128))],36))}});var ge=D(at,[["__scopeId","data-v-680ebf40"]]);const ct=O({props:{objMenu:{type:Array,required:!0}},emits:["event_callback"],setup(n,{emit:e}){const o=T({items:n.objMenu,event:void 0}),s=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},c=a=>{console.log("onClick"),o.event=a};return(a,i)=>{const l=j("fa");return h(),w("div",{class:"dropdown",onClick:c},[x(l,{icon:"bars"}),x(ge,{mouse:k(o).event,items:k(o).items,onEvent_callback:s},null,8,["mouse","items"])])}}});var rt=D(ct,[["__scopeId","data-v-3a47341c"]]);const lt=O({emits:["event_callback"],props:{objMenuItem:{type:Array,default:[]}},setup(n,e){const t=T({items:[],items2:[],isShowDlg:!1});L(()=>n.objMenuItem,(i,l)=>{t.items=o(i),t.items2=t.items.slice(0,5)});function o(i){console.log("[cnvLstRecent]");function l(_,d){const u=_.atime,m=d.atime;let v=0;return u>m?v=-1:u<m&&(v=1),v}const r=[...i];return r.sort(l),r.slice(0,15)}function s(i){const l=t.items[i].path;e.emit("event_callback","open_file",l),t.isShowDlg=!1}function c(i){t.isShowDlg=i}return{state:t,mouse_hover:c,select_file:s,tooltip:i=>`${i.title}/${i.group}`}}}),dt={class:"base"},ut={key:0,class:"dropdown"},_t=["onClick"],mt={class:"title_sub2"},pt={class:"title"},gt={class:"title_sub"},ht={class:"base2"};function ft(n,e,t,o,s,c){const a=j("fa"),i=j("button2");return h(),w("div",dt,[C("span",{class:"_base",onMouseover:e[0]||(e[0]=l=>n.mouse_hover(!0)),onMouseleave:e[1]||(e[1]=l=>n.mouse_hover(!1))},[x(a,{icon:"history",class:"_item"}),n.state.isShowDlg?(h(),w("ul",ut,[(h(!0),w(F,null,H(n.state.items,(l,r)=>(h(),w("li",{class:"item",key:r,onClick:_=>n.select_file(r)},[x(a,{class:"title_item",icon:"file-alt"}),C("span",mt,N(l.group)+"/ ",1),C("span",pt,N(l.title),1),C("span",gt," ["+N(l.atime)+"]",1)],8,_t))),128))])):A("",!0)],32),C("div",ht,[(h(!0),w(F,null,H(n.state.items2,(l,r)=>(h(),U(i,{class:"btn",key:r,onClick:_=>n.select_file(r)},{default:Z(()=>[P(N(l.title),1)]),_:2},1032,["onClick"]))),128))])])}var vt=D(lt,[["render",ft],["__scopeId","data-v-4be6d922"]]);const bt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],wt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],kt=[{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],yt={dlg_import:{init:(n,e)=>{n.title="Restore",n.isFileOpen=!0,n.isNoEdit=!0,n.edit=""},action:n=>["import"]},dlg_delete:{init:(n,e)=>{n.title="Delete",n.isReadOnly=!0,n.edit=e},action:n=>["delete",n.edit,""]},dlg_rename:{init:(n,e)=>{n.title="Rename",n.edit=e},action:n=>["rename",n.edit,n.edit_org]},dlg_new:{init:(n,e)=>{n.title="Create",n.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:n=>["new",n.edit,""]},dlg_path_rename:{init:(n,e)=>{n.title="Rename of Path",n.edit=e.split("/").slice(0,-1).join("/")+"/"},action:n=>["path_rename",n.edit,n.edit_org]},dlg_path_delete:{init:(n,e)=>{n.title="Delete of Path",n.isReadOnly=!0,n.edit=e.split("/").slice(0,-1).join("/")+"/"},action:n=>["path_delete",n.edit,""]},dlg_path_merge:{init:(n,e)=>{n.title="Merge of Path",n.isReadOnly=!0,n.edit=e.split("/").slice(0,-1).join("/")+"/"},action:n=>["path_merge",n.edit,""]},dlg_tweet:{init:(n,e)=>{n.title="Tweet",n.edit=""},action:n=>["tweet",n.edit,""]},dlg_bookmark:{init:(n,e)=>{n.title="Bookmark",n.edit="",n.isMulti=!0},action:n=>["bookmark",n.edit,""]},dlg_filter:{init:(n,e)=>{n.title="Filter",n.title2="target under folder",n.edit="",n.edit_org="@",n.isCheck=!0},action:n=>(console.log("dlg_filter"),["filter",n.filename,{filter:n.edit,isCheck:n.check}])}};const $t=O({emits:["event_callback"],components:{MenuCmd:rt,MenuRecent2:vt},setup(n,e){const{store_data:t}=V();se();const o=G(null),s=T({filename:"@",objMenu:bt,dctMenu:[]});J(()=>{console.log("[mounted]")});const c=r=>{console.log(`[doAction] cmd=${r}`),e.emit("event_callback",r,!0)};L(()=>t.state.filename,(r,_)=>{console.log(`[watch:filename] ${r}`),i(r)}),L(()=>t.state.dictMenu,(r,_)=>{s.dctMenu=r}),L(()=>t.state.jump,(r,_)=>{window.setTimeout(()=>{a()},500)});const a=()=>{o.value.scrollIntoView({})},i=r=>{console.log(`[onChanged_filename] new=${r}`),s.filename=r,a()};return{state:s,doAction:c,event_callback:(r,_)=>{console.log(`[event_callback] cmd=${r}`),r=="top"?o.value.scrollIntoView({}):e.emit("event_callback",r,_)},appbar:o}}}),Et=n=>(ke("data-v-6bf5fa8b"),n=n(),ye(),n),xt={class:"nav"},Ct=["title"],Mt={class:"cmd"},St=Et(()=>C("span",{class:"item"},null,-1));function jt(n,e,t,o,s,c){const a=j("MenuCmd"),i=j("MenuRecent2"),l=j("fa");return h(),w("header",{class:"appbar",ref:"appbar",onClick:e[6]||(e[6]=r=>n.event_callback("top",!0))},[C("nav",xt,[x(a,{class:"item",objMenu:n.state.objMenu,onEvent_callback:n.event_callback,title:"menu"},null,8,["objMenu","onEvent_callback"]),C("section",{class:"item logo",onClick:e[0]||(e[0]=r=>n.event_callback("filelist",!0)),title:n.state.filename},"Oden",8,Ct),x(i,{class:"item",objMenuItem:n.state.dctMenu,onEvent_callback:n.event_callback,title:"history"},null,8,["objMenuItem","onEvent_callback"]),n.state.filename!==""?(h(),w("span",{key:0,class:"item name",onClick:e[1]||(e[1]=r=>n.event_callback("dlg_rename",null))}," ["+N(n.state.filename)+"] ",1)):A("",!0),C("span",{class:"item mark",onClick:e[2]||(e[2]=r=>n.doAction("toggle_editor")),title:"editor/viewer"},[x(l,{icon:"edit"})])]),C("span",Mt,[C("span",{class:"item",onClick:e[3]||(e[3]=r=>n.doAction("dlg_filter")),title:"filter"},[x(l,{icon:"paw"})]),C("span",{class:"item",onClick:e[4]||(e[4]=r=>n.doAction("dlg_tweet")),title:"tweet"},[x(l,{icon:"grimace"})]),C("span",{class:"item",onClick:e[5]||(e[5]=r=>n.doAction("dlg_bookmark")),title:"bookmark"},[x(l,{icon:"bookmark"})]),St])],512)}var Ot=D($t,[["render",jt],["__scopeId","data-v-6bf5fa8b"]]);const Lt={class:"file_tree"},Tt=["onContextmenu"],Dt=["title"],At={key:1,class:"folder"},Nt={key:0},It=O({props:{item:{type:Object,required:!0}},emits:["event_callback"],setup(n,{emit:e}){const t=n,o=T({isOpen:!1,item:t.item,isFolder:t.item.children&&t.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:s}=V();L(()=>s.state.filename,(_,d)=>{r(_)});const c=(_,d)=>{console.log(`[event_callback] cmd=${_}`),e("event_callback",_,d)},a=(_,d)=>{console.log(`[event_callbackEx] cmd=${_}`),e("event_callback",_,o.item.path)};J(()=>{r(s.state.filename)});const i=_=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const d=_.path;console.log(`onClick-filename=${d}`),s.do_cmd("open_file",d)}},l=_=>{console.log("onClickEx"),o.menu=o.isFolder?kt:wt,o.event=_},r=_=>{o.item.path==_,_.indexOf(o.item.name)!=-1&&(o.isOpen=!0),o.class_item=o.item.path==_?"item active":"item"};return(_,d)=>{const u=j("fa"),m=j("tree-item",!0);return h(),w("div",Lt,[x(ge,{mouse:k(o).event,items:k(o).menu,onEvent_callback:a},null,8,["mouse","items"]),C("div",{onContextmenu:ue(l,["prevent"]),onClick:d[0]||(d[0]=v=>i(k(o).item))},[k(o).isFolder?A("",!0):(h(),w("div",{key:0,class:$e(k(o).class_item),title:k(o).item.time},N(k(o).item.name),11,Dt)),k(o).isFolder?(h(),w("div",At,[x(u,{icon:k(o).isOpen?"folder-open":"folder"},null,8,["icon"]),P(" "+N(k(o).item.name),1)])):A("",!0)],40,Tt),k(o).isOpen?(h(),w("div",Nt,[(h(!0),w(F,null,H(k(o).item.children,(v,E)=>(h(),w("div",{key:E},[x(m,{item:v,onEvent_callback:c},null,8,["item"])]))),128))])):A("",!0)])}}});var Bt=D(It,[["__scopeId","data-v-736aab12"]]);const Ft={class:"tree"},Rt=O({emits:["event_callback"],setup(n,{emit:e}){const t=T({items:void 0}),{store_data:o}=V();L(()=>o.state.dictMenu,(a,i)=>{c(a)});const s=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)};J(()=>{console.log("[mounted]"),c(o.state.dictMenu)});const c=a=>{console.log("[onChanged_dictMenu]"),t.items=void 0;const i=a,l={name:"",children:[],path:"",file:"",time:""},r="/",_={[r]:l};i.forEach(function(d){d.key.split("/").reduce(function(u,m){if(u[m])return u[m];{const v={name:m,children:[],path:d.path,file:"md",time:d.atime};return u[r].children.push(v),u[r].file="",u[m]={[r]:v}}},_)}),console.log(l),setTimeout(()=>{t.items=l.children},500)};return(a,i)=>(h(),w("div",Ft,[(h(!0),w(F,null,H(k(t).items,l=>(h(),w("div",{key:l.path},[x(Bt,{item:l,onEvent_callback:s},null,8,["item"])]))),128))]))}});var Vt=D(Rt,[["__scopeId","data-v-1f034d00"]]);const Pt=O({props:{level:{type:Number,required:!0}},setup(n,e){return{tag:K(()=>`h${n.level}`)}}});function Ht(n,e,t,o,s,c){return h(),U(Ee(n.tag),{class:"h_tag"},{default:Z(()=>[xe(n.$slots,"default",{},void 0,!0)]),_:3})}var Jt=D(Pt,[["render",Ht],["__scopeId","data-v-1765be40"]]);const Ut=O({emits:["event_callback"],components:{heading:Jt},setup(n,e){const{store_data:t}=V(),o=T({listTag:[]});L(()=>t.state.tags,(a,i)=>{console.log(a),o.listTag=a});function s(a){t.do_cmd("update_jump",a)}function c(a){return`${a.text}`}return{state:o,dispTitle:c,jumpSource:s}}}),qt={class:"tag"},Kt=["onClick"];function Yt(n,e,t,o,s,c){const a=j("heading");return h(),w("div",qt,[(h(!0),w(F,null,H(n.state.listTag,(i,l)=>(h(),w("div",{key:l,onClick:r=>n.jumpSource(l),class:"item"},[x(a,{level:i.tag},{default:Z(()=>[P(N(n.dispTitle(i)),1)]),_:2},1032,["level"])],8,Kt))),128))])}var Gt=D(Ut,[["render",Yt],["__scopeId","data-v-1d58b53a"]]);const Wt=O({emits:["event_callback"],setup(n,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(s,c)=>{console.log(`cmd=${s}, name=${c}`),e.emit("event_callback",s,c)}}}}),zt={class:"main",style:{_height:"100px"}},Qt=["onClick","title"];function Xt(n,e,t,o,s,c){const a=j("fa");return h(),w("div",zt,[(h(!0),w(F,null,H(n.objToolbar,(i,l)=>(h(),w("button",{class:"btn-item",key:l,onClick:r=>n.event_callback("action",i.cmd),title:i.cmd},[x(a,{icon:i.icon},null,8,["icon"])],8,Qt))),128))])}var Zt=D(Wt,[["render",Xt],["__scopeId","data-v-2dca080d"]]);const X={};class eo{constructor(e,t){b(this,"cmdid",0);b(this,"monaco",null);b(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=t}add(e,t,o,s,c=null){let a;switch(s.length){case 0:a=this.generateCommand(e,c);break;case 1:a=this.generateHeaderCommand(s[0]);break;case 2:a=this.generateWrapperCommand(s[0],s[1]);break}X[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:o,contextMenuGroupId:t&&"navigation",contextMenuOrder:t&&1.5,run:X[e]})}generateCommand(e,t){return(o,s)=>{t(o)}}generateWrapperCommand(e,t){const o=e.length+t.length;return this.editor,this.editor.getModel(),this.monaco,(s,c)=>{const a=s.getModel(),i=s.getSelections();if(i==null)return;const l=[];return i.forEach(r=>{l.push(new c.Selection(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn+o)),a.pushEditOperations([],[{range:{startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.startLineNumber,endColumn:r.startColumn},text:e},{range:{startLineNumber:r.endLineNumber,startColumn:r.endColumn,endLineNumber:r.endLineNumber,endColumn:r.endColumn},text:t}])}),s.setSelections(l),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(t,o)=>{const s=t.getModel();let c=t.getSelections();return c==null&&(c=[t.getSelection()]),c.forEach(a=>{const i=s.findNextMatch("^(#+ )",{lineNumber:a.startLineNumber,column:1},!0,!1,null,!0);if(i!=null&&i.range.startLineNumber==a.startLineNumber&&i.range.startColumn==1){if(i.matches[1]==e)return;s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:i.matches[1].length+1},text:""}])}s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:1},text:e}])}),null}}}function to(n,e){const t=s=>{const c=a=>`00${a}`.slice(-2);return`${s.getFullYear()}/${c(s.getMonth()+1)}/${c(s.getDate())} ${c(s.getHours())}:${c(s.getMinutes())}:${c(s.getSeconds())}`};console.log("[setupShortcutKeys]");const o=new eo(n,e);o.add("Bold","8_",[],["**","**"]),o.add("Italic","1_",[],["__","__"]),o.add("Underline","9_",[],["<u>","</u>"]),o.add("Strikethrough",!1,[n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.KEY_S],["~~","~~"]),o.add("Code",!1,[],["`","`"]),o.add("Link",!1,[],["[","]()"]),o.add("Link-2",!1,[],["[](",")"]),o.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),o.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),o.add("Header 1",!1,[],["# ",""]),o.add("Header 2",!1,[],["## ",""]),o.add("Header 3",!1,[],["### ",""]),o.add("Header 4",!1,[],["#### ",""]),o.add("Header 5",!1,[],["##### ",""]),o.add("Header 6",!1,[],["###### ",""]),o.add("Check",!1,[],["- [ ] ",""]),o.add("Blockquotes",!1,[],["> ",""]),o.add("Today",!1,[],[`${t(new Date)}`,""]),o.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),o.add("Format","8_",[],[],s=>{console.log("format"),s.getAction("editor.action.formatDocument").run()})}const oo={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},no=O({emits:["event_callback"],components:{ToolbarEditor:Zt},props:{isActive_preview:{type:Boolean,default:!1}},setup(n,e){const t=G(null),o={editor:void 0},{store_data:s}=V(),c=T({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});J(()=>{console.log("[mounted]"),i(),v(s.state.obj.content)}),L(()=>s.state.obj.content,(f,$)=>{console.log("[watch-body]"),c.filename!=""&&M(),v(f),I(s.state.obj.position,!0),c.filename=s.state.filename}),L(()=>s.state.ObjTag,(f,$)=>{console.log(`[watch](ObjTag)-${f}`),a(f)}),L(()=>n.isActive_preview,(f,$)=>{console.log(`[watch](editor_toggle)-${f}`),f==!0&&E()});const a=f=>{const $=g=>{u(g)};console.log(`[jump_cursor]ObjTag={${Object.values(f)}}`);const p=f.line;$(p),setTimeout(()=>{const g=o.editor;c.pos_scroll=g.getScrollTop()},500)},i=()=>{const f=()=>{const $=(y,S)=>{to(y,S)},p=document.getElementById("container");if(console.log(`root=${p}`),p==null)return;const g=Ce.create(p,oo);return $(ae,g),console.log(`editor=${g}`),g.onDidScrollChange(y=>{c.scrollInfo.height=y.scrollHeight,c.scrollInfo.top=y.scrollTop}),g};o.editor=f(),l()},l=()=>{o.editor.onDidBlurEditorText(f=>{E()})},r=(f,$)=>{switch(console.log(`[event_callback] cmd=${f}`),f){case"action":_($);break;case"save":E();break}},_=f=>{console.log("[action]"),X[f]!=null&&X[f](o.editor,ae)},d=()=>o.editor.getValue(),u=f=>{const $=new Me(f+1,0,f+1,0);console.log(`Line=${f}`),o.editor.revealRangeAtTop($)},m=()=>o.editor.getModel().getAlternativeVersionId(),v=f=>{o.editor.setValue(f),c.iVersion=m()},E=()=>{const f=m();if(console.info(`iVersion=${c.iVersion}, iVersion_cur=${f}`),c.iVersion==f)return;M();const $=d();s.do_cmd("save_file",$),c.iVersion=m(),console.info(`iVersion=${c.iVersion}`)},M=()=>{const f=o.editor,$={top:f.getScrollTop(),height:f.getScrollHeight(),contentHeight:f.getLayoutInfo().height,scrolled:c.pos_scroll!=f.getScrollTop()};return s.do_cmd("update_position",$,void 0),$},I=(f,$=!1)=>{if(f==null)return;console.log(`[e-set]value=${JSON.stringify(f)}`);const p=o.editor;if($?!0:f.scrolled){const y=f.top/f.height;console.log(`per=${y}`);const S=p.getScrollHeight();p.setScrollTop(S*y)}else a(s.state.ObjTag);setTimeout(()=>{c.pos_scroll=p.getScrollTop()},500)};K(()=>o.editor.getScrollTop());const B=K(()=>s.state.height-27+"px");return{editorEx:o,event_callback:r,HeightEx:B,md_editor_monaco:t,get_position:M,set_position:I}}}),so={class:"editor"};function io(n,e,t,o,s,c){const a=j("ToolbarEditor");return h(),w("div",so,[x(a,{class:"toolbar",onEvent_callback:n.event_callback},null,8,["onEvent_callback"]),C("div",{id:"container",ref:"md_editor_monaco",class:"core",style:q({height:n.HeightEx})},null,4)])}var ao=D(no,[["render",io],["__scopeId","data-v-1dc20672"]]);const co=O({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(n,e){const t=G(null),{store_data:o}=V(),s=T({contentsPosition:[],tocMap:new Map,observer:null,elm_target_before:null,pos_scroll:-1,filename:""});J(()=>{function d(){const u=new te.Renderer;u.link=function(m,v,E){return m.indexOf("http")!=-1?`<a target="_blank" href="${m}">${E}</a>`:`<a target="_blank" href="#${m}">${E}</a>`},te.setOptions({renderer:u,langPrefix:"",breaks:!0})}console.log("[created]"),d()}),L(()=>o.state.obj.content,(d,u)=>{console.log("[watch-body]"),t.value,s.filename!=""&&i(),setTimeout(()=>{c(),l(o.state.obj.position,!0),s.filename=o.state.filename},0)});function c(){const d=f=>{f.forEach($=>{const p=s.tocMap.get($.target);console.log($.intersectionRatio),$.intersectionRatio?(s.elm_target_before!=null&&s.elm_target_before.classList.remove("active"),p.classList.add("active"),s.elm_target_before=null):s.elm_target_before=p})},u={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},m=new IntersectionObserver(d,u),v=new Map,M=document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),B=document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5");console.log(`el_contents=${M.length}/${JSON.stringify(M)}`),console.log(`el_toc=${B.length}/${JSON.stringify(B)}`),M.forEach((f,$)=>{m.observe(f),v.set(B.item($),f),v.set(f,B.item($))}),s.tocMap=v,s.observer=m}L(()=>o.state.ObjTag,(d,u)=>{console.log(`[watch](ObjTag)-${d}`),a(d)}),L(()=>n.isActive_preview,(d,u)=>{console.log(`[watch](editor_toggle)-${d}`)}),K(()=>t.value.querySelector(".md_core_viewer"));function a(d){const u=(E,M)=>{console.log(`tag=${E}, num=${M}`);const I=t.value,B=I.querySelectorAll(".md_core_viewer > h"+E);B.length!=0&&(I.scrollTop=B[M].getBoundingClientRect().top-I.getBoundingClientRect().top+I.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(d)}}`);const m=d.tag,v=d.num;d.line,u(m,v),setTimeout(()=>{const E=t.value;s.pos_scroll=E.scrollTop},0)}const i=()=>{const d=t.value,u={top:d.scrollTop,height:d.scrollHeight,contentHeight:0,scrolled:s.pos_scroll!=d.scrollTop};return o.do_cmd("update_position",u,s.filename),u},l=(d,u=!1)=>{console.log(`[v-set]value=${JSON.stringify(d)}`);const m=t.value;if(d==null){m.scrollTop=0;return}if(u?!0:d.scrolled){const E=d.top/d.height;console.log(`per=${E}`),console.log(`scrollTop=${m.scrollTop}, scrollHeight=${m.scrollHeight}`),m.scrollTop=m.scrollHeight*E}else a(o.state.ObjTag);setTimeout(()=>{s.pos_scroll=m.scrollTop},0)},r=K(()=>te.parse(o.state.obj.content)),_=K(()=>o.state.height+"px");return{status,Markdown:r,HeightEx:_,md_viewer:t,get_position:i,set_position:l}}}),ro=["innerHTML"];function lo(n,e,t,o,s,c){return h(),w("div",{class:"md_core_viewer note",innerHTML:n.Markdown,style:q({height:n.HeightEx}),ref:"md_viewer"},null,12,ro)}var he=D(co,[["render",lo],["__scopeId","data-v-05199a28"]]);const uo=O({components:{MarkdownEditor:ao,MarkdownViewer:he},props:{editor_toggle:{type:Boolean,default:!0}},setup(n,e){const t=G(),o=G(),s=T({isActive_preview:!0});L(()=>n.editor_toggle,(i,l)=>{console.log(`[watch](editor_toggle)-${i}`),a()}),J(()=>{console.log("[mounted]"),document.addEventListener("keydown",c)}),_e(()=>{document.removeEventListener("keydown",c)});const c=i=>{if(i.keyCode===83&&i.ctrlKey){i.preventDefault(),console.log("save"),a();return}else if(i.keyCode===69&&i.ctrlKey){i.preventDefault(),console.log("toggle"),a();return}},a=()=>{var r;const i=s.isActive_preview?{now:t,next:o}:{now:o,next:t},l=(r=i.now.value)==null?void 0:r.get_position();console.log(`isActive_preview=${s.isActive_preview}, scrollIndo=${JSON.stringify(l)}`),s.isActive_preview=!s.isActive_preview,setTimeout(()=>{var _;(_=i.next.value)==null||_.set_position(l)},500)};return{state:s,MdViewer:t,MdEditor:o}}});function _o(n,e,t,o,s,c){const a=j("MarkdownViewer"),i=j("MarkdownEditor");return h(),w("div",null,[n.state.isActive_preview?(h(),U(a,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:n.state.isActive_preview},null,8,["isActive_preview"])):(h(),U(i,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:n.state.isActive_preview},null,8,["isActive_preview"]))])}var mo=D(uo,[["render",_o]]);const po=O({emits:["event_callback"],setup(n,e){const{store_dlg:t}=se(),{store_data:o}=V(),s=T({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});L(()=>t.state.objParam,d=>{c(d)});const c=d=>{const u=(m,v=!1)=>m!=null?m:v;console.log("[onChanged_objParam]"),s.title=d.title,s.title2=d.title2,s.edit=d.edit,s.edit_org=u(d.edit_org,d.edit),s.check=0,s.isShowDlg=!0,s.isNoEdit=u(d.isNoEdit),s.isFileOpen=u(d.isFileOpen),s.isReadOnly=u(d.isReadOnly),s.isCheck=u(d.isCheck),s.isMulti=u(d.isMulti),s.isDisabled=!0,s.action=d.action,r(!0)},a=d=>{if(console.log(`[doAction] flg=${d}, edit=${s.edit}`),d){const u=s.action(s);o.do_cmd(u[0],u[1],u[2])}s.isShowDlg=!1,r(!1)},i=d=>{const m=(d.target.files||d.dataTransfer.files)[0],v=s.action(s);o.do_cmd(v[0],m),s.isShowDlg=!1,r(!1)},l=()=>{const d=s.edit_org,u=s.edit==d&&!s.isReadOnly;return console.log(`[isDisabled]=${u}`),u},r=d=>{d==!0?document.addEventListener("keydown",_):document.removeEventListener("keydown",_)},_=d=>{if(d.keyCode===27){d.preventDefault(),a(!1);return}};return{state:s,props:n,doAction:a,onFileChange:i,isDisabled:l}}}),go={class:"modal-mask"},ho={class:"modal-wrapper"},fo={class:"modal-container"},vo={class:"header"},bo={ref:"form",class:"form"},wo=["disabled"],ko=["disabled"],yo={class:"modal-actions"},$o=["disabled"];function Eo(n,e,t,o,s,c){const a=j("fa");return Q((h(),U(Oe,{persistent:""},{default:Z(()=>[C("div",go,[C("div",ho,[C("div",fo,[C("div",vo,N(n.state.title)+"?",1),C("form",bo,[n.state.isFileOpen==!0?(h(),w("input",{key:0,class:"input",type:"file",onChange:e[0]||(e[0]=(...i)=>n.onFileChange&&n.onFileChange(...i))},null,32)):A("",!0),n.state.isNoEdit==!1?(h(),w(F,{key:1},[n.state.isMulti==!0?Q((h(),w("textarea",{key:0,class:"input",_autofocus:"","onUpdate:modelValue":e[1]||(e[1]=i=>n.state.edit=i),disabled:n.state.isReadOnly},null,8,wo)),[[ce,n.state.edit]]):Q((h(),w("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":e[2]||(e[2]=i=>n.state.edit=i),disabled:n.state.isReadOnly},null,8,ko)),[[ce,n.state.edit]])],64)):A("",!0),n.state.isCheck==!0?(h(),w(F,{key:2},[Q(C("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=i=>n.state.check=i)},null,512),[[je,n.state.check]]),P(" "+N(n.state.title2),1)],64)):A("",!0)],512),C("div",yo,[C("button",{class:"btn btn-ok",ref:"ok",disabled:n.isDisabled(),onClick:e[4]||(e[4]=i=>n.doAction(!0))},[x(a,{icon:"check"}),P(" "+N(n.state.title),1)],8,$o),C("button",{class:"btn btn-can",onClick:e[5]||(e[5]=i=>n.doAction(!1))},"cancel")])])])])]),_:1},512)),[[Se,n.state.isShowDlg]])}var xo=D(po,[["render",Eo],["__scopeId","data-v-2041bfb8"]]);const Co={class:"container"},Mo={class:"main"},So=O({emits:["event_callback"],setup(n,{emit:e}){const{store_data:t}=V(),{store_dlg:o}=se(),s=de(),c=ne(),a={snackbar:!1,message:"",timeout:-1,color:"green",actions:()=>{console.log("sb_actions")}},i=T({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,snackbar_ex:a,toggle_list:!1});J(()=>{console.log("[mounted]"),l(),window.addEventListener("resize",r),document.body.style.overflow="hidden"}),_e(()=>{console.log("unmounted!"),window.removeEventListener("resize",r)});const l=()=>{console.log("init");const u=c.path.substring(1),v=c.fullPath.split("api_bookmark?=");if(console.log(v),v.length==2){t.do_cmd("bookmark",decodeURIComponent(v.pop()));return}t.do_cmd("filter_menu",null),console.log(`filename=${u}`),u==null||u==""?t.do_cmd("restore_file",""):t.do_cmd("open_file",u),r()},r=()=>{const u=window.innerHeight-45;console.log(`height=${u}`),t.update_height(u)},_=async(u,m)=>{switch(console.log(`[event_callback] cmd=${u}, va0=${m}`),u){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"openSnackbar":break;case"onClick_snackbar":break;case"config":i.objDlgConf={cmd:u,filename:"",commit:""};break;case"print":const v=s.resolve({path:`/print/${t.filename}`});window.open(v.href,"_blank");break;case"filelist":document.querySelector(".col-3");const E=!i.toggle_list;i.toggle_list=E,console.log(i.toggle_list);break;default:if(u.indexOf("dlg_")!=-1){const M=Object.assign({},d(u,m));o.update_param(M)}else t.do_cmd(u,m);break}},d=(u,m)=>{const v=yt[u],E=m!=null?m:t.state.filename;return v.init(v,E),v};return(u,m)=>(h(),w("div",Co,[x(Ot,{ref:"appbar",onEvent_callback:_},null,512),x(xo,{objParam:k(i).objDlgCmn,onEvent_callback:_},null,8,["objParam"]),C("div",Mo,[k(i).toggle_list?(h(),U(Vt,{key:0,class:"col-3",onEvent_callback:_,style:q({height:k(i).height+"px"})},null,8,["style"])):A("",!0),x(mo,{class:"col-2",ref:"pane",editor_toggle:k(i).editor_toggle,style:q({height:k(i).height+"px"})},null,8,["editor_toggle","style"]),x(Gt,{class:"col-1",onEvent_callback:_,style:q({height:k(i).height+"px"})},null,8,["style"])])]))}});var jo=D(So,[["__scopeId","data-v-12732ce5"]]);const Oo={_class:"container"},Lo=O({emits:["event_callback"],setup(n,{emit:e}){V();const t=ne(),o=T({filename:"",height:window.innerHeight,timer3:-1});J(()=>{console.log("[mounted]"),s(),document.body.style.overflow="hidden"});const s=()=>{console.log("init");const c=t.path.substring(1);t.fullPath,console.log(`filename=${c}`),o.filename=c,o.timer3=window.setTimeout(()=>{clearTimeout(o.timer3),window.print()},500)};return(c,a)=>(h(),w("div",Oo,[P(N(k(o).filename)+" ",1),x(he,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}}),To=[{name:"viewer",path:"/:pathMatch(.*)*",component:jo},{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Lo}],Do=Le({history:Te(),routes:To});function Ao(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:s,onRegisterError:c}=n;let a;const i=async(l=!0)=>{};return"serviceWorker"in navigator&&(a=new De("./sw.js",{scope:"./"}),a.addEventListener("activated",l=>{l.isUpdate?window.location.reload():o==null||o()}),a.register({immediate:e}).then(l=>{s==null||s(l)}).catch(l=>{c==null||c(l)})),i}Ao();Ae.add(Ne);Ie(Ze).use(Do).component("fa",Be).mount("#app");
