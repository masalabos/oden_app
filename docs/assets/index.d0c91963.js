var fe=Object.defineProperty;var ve=(c,o,e)=>o in c?fe(c,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[o]=e;var X=(c,o,e)=>(ve(c,typeof o!="symbol"?o+"":o,e),e);import{D as be,a as ae,i as de,p as ue,u as _e,b as ce,r as T,d as j,c as U,e as L,o as v,f as k,g as f,h as x,j as q,t as N,k as I,F as B,l as K,w as Z,m as O,n as P,q as E,s as F,v as H,x as ye,y as ke,z as we,A as te,T as $e,B as G,C as xe,E as Ee,G as Ce,H as le,R as Se,I as oe,J as se,K as Me,L as je,M as Q,N as Oe,O as re,P as Te,Q as Le,S as De,U as Ne,V as Ae,W as Ie,X as Be,_ as Re,Y as Ve,Z as Fe}from"./vendor.664b2697.js";const He=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}};He();class V{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(o,e="",t=[],n=!1){e!=""&&(this.path=e),t!=[]&&(this.tags=t),this.content=o;const s=this.get_time();this.atime=s,n==!0&&(this.ctime=s)}set_default(o){this.path=o,this.content="",this.tags=[];const e=this.get_time();this.atime=e,this.ctime=e}copy(o){Object.assign(this,o)}duplicate(o,e=""){const t=new V;return t.copy(this),t.content=o,t.path=e,t.update_time(),t.update_tag(),t}update_content2(o){this.content=o}update_time(){console.log(`update_time path=${this.path}`),this.atime=this.get_time()}update_tag(){return this.tags=this.build_tag(this.content),this.tags}update_position(o){this.position=o}get_time(){return this.cnv_time(new Date)}cnv_time(o){const e=t=>`00${t}`.slice(-2);return`${o.getFullYear()}/${e(o.getMonth()+1)}/${e(o.getDate())} ${e(o.getHours())}:${e(o.getMinutes())}:${e(o.getSeconds())}`}update_time_all(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(o){return o}build_tag(o){const e=[],t=[0,0,0,0,0],n=o.split(/\r\n|\n|\r/);for(let s=0;s<n.length;s++)if(n[s].search(/^\s*#/)!=-1){const a=n[s].split(" "),r=a[0].length;a.shift();const _=a.join(" ");e.push({text:_,line:s,tag:r,num:t[r]}),t[r]++}return e}split(o){const e=[],t=this.content.split(/\r\n|\n|\r/),n=this.tags.filter(function(_){return _.tag==o}),s=[],i=t.length;for(var a=0;a<n.length;a++){const _=n[a].line;s.push({start:_,end:i,title:n[a].text}),a!=0&&(s[a-1].end=_-1)}const r=this.path.replace(".","_");return s.reverse(),s.forEach(_=>{const p=t.splice(_.start,_.end).join(`\r
`),u=this.duplicate(p,`${r}/${_.title}`);e.push(u)}),e.reverse(),e}}class Pe extends be{constructor(){super("OdenDB");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class Je{constructor(o){this.db=new Pe,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async e=>{const t=await this.dbx.get(e);return t!=null?t.data:null},this.write=async(e,t)=>{const n=JSON.stringify(t);await this.dbx.put({key:e,data:n,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async e=>{console.log(`delete key=${e}`),await this.dbx.delete(e),this.set_time_DB()},this.caller=o,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const o=[];return(await this.dbx.toArray()).forEach(t=>{o[t.key]=t.data}),this.atime=this.get_time_DB(),o}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const o=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",o),this.atime=o,o}get_time_DB(){var o;return(o=localStorage.getItem("update_DB_time"))!=null?o:""}}class Ue{constructor(o){this.ctime="",this.atime="",this.read=async e=>{const t=new URLSearchParams;t.append("filename",e);const n=await this.post_cmdEx("load_file_md",t);return n!=null?n.data:null},this.write=async(e,t)=>{const n=new URLSearchParams;return n.append("filename",e),n.append("source",JSON.stringify(t)),console.dir(n),this.post_cmdEx("save",n)},this.get_cmdEx=async e=>{const t="http://localhost:5000/api_oden/"+e;return console.log(`[store_RST:get_cmdEx] api=${t}`),ae.get(t).then(n=>n.data).catch(n=>{throw n.response.status})},this.post_cmdEx=async(e,t)=>{const n="http://localhost:5000/api_oden/"+e;return console.log(`[store_RST:post_cmdEx] api=${n}`),console.dir(t),ae.post(n,t).then(s=>(console.log("response.data = ",s.data),s.data)).catch(s=>(console.log("Error = ",s.response),s.response))},this.caller=o}}class Ke{constructor(o){this.write=(e,t,n=!0)=>{this.storeDB.write(e,t),n&&this.storeRST.write(e,t)},this.delete=e=>{this.storeDB.delete(e)},this.rename=async(e,t,n)=>{console.log(`[rename] _key_org=${e}, _key_new=${t}`);const s=this.as(await this.get(e));return s.path=t,await this.write(t,s),n&&await this.delete(e),s},this.split=async e=>{console.log(`[split] _key_org=${e}`);const n=this.as(await this.get(e)).split(1);return n.forEach(s=>{this.write(s.path,s)}),n},this.merge=(e,t)=>{console.log(`[merge] _path=${e}`);const n=new V;return n.set_default(e),n.update_content2(t),n.update_time(),n.update_tag(),this.write(e,n),n},this.as=e=>Object.assign(new V,e),this.sync_DB=()=>this.storeDB.sync_DB(),this._=o,this.storeDB=new Je(this._),this.storeRST=new Ue(this._)}async get(o){console.log(`[get] _key=${o}`);const e=await this.read(o);return e!=null?JSON.parse(e):this.create(o)}async exist(o){return console.log(`[exist] _key=${o}`),await this.read(o)!=null}async set(o,e){console.log(`[set] _key=${o}`);const t=this.as(await this.get(o));return t.path==""&&(t.path=o),t.update_content2(e),t.update_time(),t.update_tag(),this.write(o,t),t}async set_ex(o,e,t){console.log(`[set_ex] _key=${o}`);const n=this.as(e);return e.path==""&&(e.path=o),t!=null&&t.hasOwnProperty("no_upate_time")||n.update_time(),n.update_tag(),this.write(o,n),n}async read(o){return await this.storeDB.read(o)}create(o){console.log(`[create] _key=${o}`);const e=new V;return o!=null&&(e.set_default(o),this.write(o,e)),e}}const ie="menu.json";class qe{constructor(o){this._=o}async rebuildMenu(o=null){console.log("[rebuildMenu]");const e=await this._.mgrCache.getLstContent(o),t=this.buildMenu(e);return console.log(`${e.length}/${t.length}`),this._.contentEx.set(ie,JSON.stringify(t)),t}async getMenu(o){if(console.log(`[getMenu] _filter=${JSON.stringify(o)}`),o!=null)return await this.rebuildMenu(o);{const e=await this._.contentEx.get(ie);return JSON.parse(e.content)}}buildMenu(o){function e(n){const s=new Set;return n.forEach(i=>{s.add(i.group)}),[...s]}function t(n){console.log("storeEx_index:buildMenuEx");const s=e(n);return n.reduce((i,a)=>{if(a.path==ie)return i;let r=a.group,_=a.title,l=`${r}/${_}`;return s.includes(l)&&(r=l,_=".index",l=`${r}/${_}`),i.push({key:l,group:r,title:_,path:a.path,atime:a.atime}),i},[])}return t(o).sort(this.compare_group)}compare_group(o,e){let t=o.group,n=e.group;t==n&&(t=`${o.group}/${o.title}`,n=`${e.group}/${e.title}`);const s=t.toUpperCase(),i=n.toUpperCase();let a=0;return s>i?a=1:s<i&&(a=-1),a}}class Ye{constructor(o){this.backupEx=(e,t,n)=>{const s=(a=!0)=>{const r=new URLSearchParams;r.append("lstContent",JSON.stringify(e)),r.append("is_divide",JSON.stringify(a)),this.storeRST.post_cmdEx("backup",r).then(_=>console.log(_)).catch(_=>console.log(_))},i=()=>{const a=new Blob([JSON.stringify(e)],{type:"text/plain"}),r=(l,p)=>{const u=new Date,d=m=>`00${m}`.slice(-2);return`${l}_${u.getFullYear()}${d(u.getMonth()+1)}${d(u.getDate())}_${d(u.getHours())}.${p}`},_=document.createElement("a");_.download=r("lstData","json"),_.href=URL.createObjectURL(a),_.click(),URL.revokeObjectURL(_.href)};switch(console.log(`[backup] mode=${t}`),t){case"backup":s();break;case"backupEx":s(!1);break;case"export":i();break}},this.restoreEx=async(e,t,n)=>{const s=_=>{_.forEach(l=>{const p=new V;p.copy(l),p.update_tag(),r.write(p.path,p,!1)})},i=async(_,l,p=!0)=>{this.storeRST.get_cmdEx(p?"restore":"restore_ex").then(u=>{s(u),_(u)}).catch(u=>{console.log(u),l(null)})},a=async(_,l,p)=>{const u=new FileReader;u.onload=()=>{var y;console.log("onload");const d=(y=u.result)!=null?y:"",m=JSON.parse(d);s(m),l(m)},u.onerror=d=>{p("error")},u.readAsText(_)};console.log("[importExport:restore]");const r=this._.contentEx;return new Promise(function(_,l){switch(e){case"restore":i(_,l);break;case"restoreEx":i(_,l,!1);break;case"import":a(t,_,l);break}})},this._=o,this.storeRST=o.contentEx.storeRST}}class Ge{constructor(o){this.journal2=async(e,t)=>{const n=(i,a)=>`
## ${this._.contentEx.as(i).cnv_time(t)}
${a}
`;console.log("[journal]");const s=await this.geolocation();return e.content+=n(e,s),e},this.geolocation=()=>new Promise(e=>{let t="";navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{t=`(Latitude,longitude)=(${n.coords.latitude},${n.coords.longitude})
`,e(t)},n=>{switch(n.code){case 1:t="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:t="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:t="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}e(t)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),e(t))}),this.chat=async(e,t,n)=>{const s=m=>["sun","mon","tue","wed","thu","fri","sat"][m],i=m=>{const y=A=>`00${A}`.slice(-2),w=`${m.getFullYear()}/${y(m.getMonth()+1)}/${y(m.getDate())}(${s(m.getDay())})`,M=`${y(m.getHours())}:${y(m.getMinutes())}`;return[w,M]},a=(m,y)=>m!==y?`
## ${y}
`:"",r=m=>{const y=n.isNoList?"":"- ",w=n.isAddTime?`${m} : `:"";return`${y}${w}${t}
${u}`};console.log("[chat]");const _=e.content.indexOf(`
`),[l,p]=i(new Date),u=n.isAddGeo?await this.geolocation()+`
`:"",d=a(e.content.substring(0,_),l)+r(p);return e.content=`${l}${e.content.substring(_)}${d}`,e},this._=o}async path_rename(o,e,t){console.log(`_from=${o}, _to=${e}`);const n=this.collect_filename_by_group(o,t);for(let s=0;s<n.length;s++){const i=n[s],a=`${i[1]}/${i[0]}`,r=`${e}${i[2]}/${i[0]}`;await this._.contentEx.rename(a,r)}}async path_delete(o,e){console.log(`_path=${o}`);const t=this.collect_filename_by_group(o,e);for(let n=0;n<t.length;n++){const s=t[n],i=`${s[1]}/${s[0]}`;await this._.contentEx.delete(i)}}async path_merge(o,e,t){console.log(`_path=${o}`);const n=[],s=this.collect_filename_by_group(o,t);for(let a=0;a<s.length;a++){const r=s[a],_=`${r[1]}/${r[0]}`,l=await this._.contentEx.get(_);n.push(l.content)}const i=n.join(`\r
`);return this._.contentEx.merge(e,i)}collect_filename_by_group(o,e){console.log(`[collect_filename_by_group] pat=${o}`);const t=[],n=o.length!=0?1:0;return e.forEach((s,i)=>{if(s.group==o){const a=s.group.substring(o.length+n);t.push([s.title,s.group,a.length!=0?`/${a}`:""])}}),t}}class We{constructor(o){this._=o}async getLstContent(o){console.log("[getLstContent]");const e=s=>{const i=o.path==""?!0:s.path.indexOf(o.path)!=-1,a=o.keyword==""?!0:s.content.toLowerCase().indexOf(o.keyword)!=-1;return i&&a},t=await this.buildLstContent();return o!=null?t.filter(e):t}async buildLstContent(){var s;console.log("[buildLstContent]");const o=i=>{var _,l;let a=i.path;(a==""||a==null)&&(a=`@test/${new Date().toLocaleString()}`);const r=a.split("/");return i.title=(_=r.pop())!=null?_:".",i.group=(l=r.join("/"))!=null?l:"@test",i.tags=[],i.htags=[],i},e=await this._.contentEx.storeDB.getStrageEx(),t=[],n=i=>e[i];for(const i of Object.keys(e))try{t.push(o(JSON.parse((s=n(i))!=null?s:"")))}catch(a){console.log(`@ error key=${i},e=${a} - other error`)}return t}}class ze{constructor(){this.contentEx=new Ke(this),this.mgrExchange=new Ye(this),this.mgrEtc=new Ge(this),this.mgrMenu=new qe(this),this.mgrCache=new We(this),console.log("[constructor]")}async cmd_getMenu(o=null){return this.mgrMenu.getMenu(o)}async cmd_load(o){return this.contentEx.get(o)}async cmd_create(o){return await this.contentEx.get(o)}async cmd_save(o,e){return this.contentEx.set(o,e)}async cmd_save_ex(o,e,t){return this.contentEx.set_ex(o,e,t)}async cmd_delete(o){await this.contentEx.delete(o)}async cmd_copy(o,e){await this.contentEx.rename(o,e,!1)}async cmd_rename(o,e,t){await this.contentEx.rename(o,e,t)}async cmd_exist(o){return this.contentEx.exist(o)}async cmd_backup(o,e="",t=null){const n=await this.mgrCache.getLstContent(t);this.mgrExchange.backupEx(n,o,e)}async cmd_restoreEx(o,e,t=""){await this.mgrExchange.restoreEx(o,e,t)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(o){await this.contentEx.split(o)}async cmd_path_rename(o,e){const t=await this.cmd_getMenu();await this.mgrEtc.path_rename(o,e,t)}async cmd_path_delete(o){const e=await this.cmd_getMenu();await this.mgrEtc.path_delete(o,e)}async cmd_path_merge(o,e){const t=await this.cmd_getMenu();await this.mgrEtc.path_merge(o,e,t)}async cmd_chat(o,e,t){const s=(()=>{const r=new Date;return`${o}${t.mode}_${r.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${s}`);const i=await this.contentEx.get(s),a=await this.mgrEtc.chat(i,e,t);return await this.contentEx.set(s,a.content),[a,s]}}class Xe{constructor(o){this.KEY="",console.log(o),this.KEY=o}get(o){var e;if(localStorage.getItem(this.KEY)!=null){const t=JSON.parse((e=localStorage.getItem(this.KEY))!=null?e:"");o(t),console.log(t)}}set(o){localStorage.setItem(this.KEY,JSON.stringify(o)),console.log(o)}}const Qe=1e3*60*10,me=Symbol(),Ze=()=>{const c=_e(),o=ce(),e=T({storeEx:new ze,persisted:new Xe("lifeLog-Viewer-params"),filename:"",obj:new V,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null,mode:0,config:{}}),t=async()=>{const g="_sys_/config.md",h=await e.storeEx.cmd_load(g);e.config=JSON.parse(h.content)},n=g=>{console.log(`[update_filename] : new=${g}`),s(g)},s=async g=>{const h=$=>{const S=`/?${$}`;console.log(`route.path:${o.path}`),o.path!=S&&(console.log(`set route:${S}`),c.push(S))};if(console.log(`[load_obj] : new=${g}`),g!=""){e.mode=g.indexOf(".mm")!=-1?1:0;const $=await e.storeEx.cmd_load(g);_($)}else _(l(""));e.filename=g,e.persisted.set({filename:g}),h(g)},i=()=>{console.log("restore_filename"),e.persisted.get(g=>{n(g.filename)})},a=async g=>{if(g==""){console.log("skip save - empty data");return}l(g,{update_time:!0,update:!0}),await e.storeEx.cmd_save_ex(e.filename,e.obj),d()},r=()=>{console.log("[auto_save] start"),e.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(e.intervalId_autoSave)),e.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await b("backupEx",null,null),e.intervalId_autoSave=null},Qe)},_=(g,h)=>{const $=g instanceof V?g:Object.assign(new V,g);h!=null&&h.hasOwnProperty("update_time")&&$.update_time(),e.tags=$.update_tag(),e.obj=$},l=(g,h)=>(e.obj.content=g,h!=null&&h.hasOwnProperty("update_time")&&e.obj.update_time(),e.tags=e.obj.update_tag(),e.obj),p=async(g,h)=>{if(console.log(g),h!=null){const $=await e.storeEx.cmd_load(h);$.position=g,await e.storeEx.cmd_save_ex(h,$,{no_upate_time:!0})}else e.obj.position=g},u=g=>{e.dictMenu=g},d=()=>{setTimeout(async()=>{u(await e.storeEx.cmd_rebuild()),r()},250)},m=g=>{e.jump=g,g!=-1&&(console.log(`jump=${g}`),e.ObjTag=JSON.parse(JSON.stringify(e.tags[g])),console.log(JSON.stringify(e.ObjTag)))},y=g=>{e.height=g},w=async(g,h)=>{const[$,S]=await e.storeEx.cmd_chat(e.path_expand,g,h);_($,{update_time:!0}),n(S),d()},M=async(g,h)=>{const $=await e.storeEx.cmd_exist(g);if(h==$)return!0;{const S=h?`error : ${g} is not exist. please enter exist filename.`:`error : ${g} is already exist. please enter other filename.`;return console.log(S),!1}},A=async(g,h,$=!0)=>{await M(g,!1)&&(n(""),await e.storeEx.cmd_rename(h,g,$),n(g),d())},J=async(g,h)=>{const $=C(h)[0],S=C(g)[0];n(""),await e.storeEx.cmd_path_rename($,S),d()},b=async(g,h,$)=>{console.log(`[do_cmd] mode=${g}`);let S=h!=""?h:e.filename,Y="",z;switch(g){case"update_jump":m(h);break;case"rebuild_menu":d();break;case"filter_menu":const ne=h;h!=null&&(ne.path=ne.isUnderFolder?C(e.filename)[0]:""),u(await e.storeEx.cmd_getMenu(ne));break;case"open_file":n(h);break;case"restore_file":i();break;case"save_file":await a(h);break;case"new":await M(h,!1)&&(await e.storeEx.cmd_create(h),n(h),d());break;case"delete":await M(S,!0)&&(n(""),await e.storeEx.cmd_delete(S),d());break;case"rename":A(h,$);break;case"copy":A(h,$,!1);break;case"backup":e.storeEx.cmd_backup("backup");break;case"backupEx":e.storeEx.cmd_backup("backupEx");break;case"export":e.storeEx.cmd_backup("export");break;case"restore":await e.storeEx.cmd_restoreEx("restore",null),d();break;case"restoreEx":await e.storeEx.cmd_restoreEx("restoreEx",null),d();break;case"import":await e.storeEx.cmd_restoreEx("import",h),d();break;case"split":await M(S,!0)&&(await e.storeEx.cmd_split(S),d());break;case"path_rename":J(h,$);break;case"path_delete":Y=C(h)[0],await e.storeEx.cmd_path_delete(Y),n(""),d();break;case"path_merge":Y=C(h)[0],S=`${Y}.md`,await M(S,!1)&&(await e.storeEx.cmd_path_merge(Y,S),n(S),d());break;case"print":const he=c.resolve({path:`/print/${e.filename}`});window.open(he.href,"_blank");break;case"journal":w("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":w(h,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":w(h,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":z={keyword:$.filter.toLowerCase(),isUnderFolder:$.isCheck,path:""},u(await e.storeEx.cmd_getMenu(z));break;case"update_position":await p(h,$);break;case"move_archive":A(`@archive/${h}`,h);break;case"move_path_archive":J(`@archive/${h}`,h);break;case"export_archive":z={keyword:"",isUnderFolder:!0,path:"@archive/"},e.storeEx.cmd_backup("export","",z);break;case"load_config":console.log("@"),t();break}},C=g=>{const h=g.split("/"),$=h[h.length-1];return[h.slice(0,-1).join("/"),$]};return{store_data:{state:e,update_height:y,do_cmd:b}}},et=()=>{ue(me,Ze())},R=()=>de(me),tt=()=>{const c=T({objParam:null});return{store_dlg:{state:c,update_param:e=>{c.objParam=e}}}},pe=Symbol(),ot=()=>{ue(pe,tt())},W=()=>de(pe);const nt=j({setup(c){return et(),ot(),(o,e)=>{const t=L("routerView");return v(),U(t)}}});var D=(c,o)=>{const e=c.__vccOpts||c;for(const[t,n]of o)e[t]=n;return e};const st={key:0},it={key:1,class:"line"},ct={key:2,class:"dropdown"},at=j({props:{item:null},emits:["event_callback"],setup(c,{emit:o}){const e=c,t=T({isOpen:!1,item:e.item,isFolder:e.item.children&&e.item.children.length,isActive:!0}),n=(i,a)=>{console.log(`[event_callback] cmd=${i}`),o("event_callback",i,a)},s=i=>{if(t.isFolder)console.log("onClick-folder"),t.isOpen=!t.isOpen;else{const a=i.cmd;n(a,null)}};return(i,a)=>{const r=L("fa"),_=L("MenuTreeItem",!0);return v(),k("div",{class:"menu_tree",onClick:a[0]||(a[0]=l=>s(f(t).item)),onContextmenu:a[1]||(a[1]=Z(()=>{},["right","prevent"]))},[f(t).item.title!=""?(v(),k("div",st,[x(r,{icon:f(t).item.icon},null,8,["icon"]),q(" "+N(f(t).item.title),1)])):I("",!0),f(t).item.title==""?(v(),k("div",it)):I("",!0),f(t).isFolder?(v(),k("div",ct,[(v(!0),k(B,null,K(f(t).item.children,(l,p)=>(v(),k("div",{key:p},[x(_,{item:l,onEvent_callback:n},null,8,["item"])]))),128))])):I("",!0)],32)}}});var lt=D(at,[["__scopeId","data-v-69f3eeaa"]]);const rt=j({props:{mouse:null,items:null},emits:["event_callback"],setup(c,{emit:o}){const e=c,t=T({items:e.items,pos_x:-1,pos_y:-1,style:"display:none"});O(()=>e.mouse,(i,a)=>{console.log("props"),t.pos_x=e.mouse.clientX,t.pos_y=e.mouse.clientY,t.items=e.items,t.style="display:block"});const n=(i,a)=>{console.log(`[event_callback] cmd=${i}`),o("event_callback",i,a)},s=i=>{t.style=i?"display:block":"display:none"};return(i,a)=>(v(),k("div",{class:"menu",style:P(f(t).style),onMouseover:a[0]||(a[0]=r=>s(!0)),onMouseleave:a[1]||(a[1]=r=>s(!1))},[(v(!0),k(B,null,K(f(t).items,r=>(v(),k("div",{key:r.path},[x(lt,{item:r,onEvent_callback:n},null,8,["item"])]))),128))],36))}});var ge=D(rt,[["__scopeId","data-v-62ad7429"]]);const dt=j({props:{objMenu:null},emits:["event_callback"],setup(c,{emit:o}){const t=T({items:c.objMenu,event:void 0,style:"display:none"}),n=(a,r)=>{console.log(`[event_callback] cmd=${a}`),o("event_callback",a,r)},s=a=>{console.log("onClick"),t.event=a},i=a=>{t.style=a?"display:block":"display:none"};return(a,r)=>{const _=L("fa");return v(),k("div",{class:"dropdown",onClick:s,onMouseover:r[0]||(r[0]=l=>i(!0)),onMouseleave:r[1]||(r[1]=l=>i(!1))},[x(_,{icon:"bars"}),x(ge,{class:"menu",mouse:f(t).event,items:f(t).items,onEvent_callback:n,style:P(f(t).style)},null,8,["mouse","items","style"])],32)}}});var ut=D(dt,[["__scopeId","data-v-1a158634"]]);const _t={key:0,class:"dropdown"},mt=["onClick"],pt={class:"title_sub2"},gt={class:"title"},ht={class:"title_sub"},ft=j({props:{objMenuItem:null},emits:["event_callback"],setup(c,{emit:o}){const e=c,t=T({items:[],items2:[],isShowDlg:!1});O(()=>e.objMenuItem,(a,r)=>{t.items=n(a),t.items2=t.items.slice(0,5)});const n=a=>{console.log("[cnvLstRecent]");function r(l,p){const u=l.atime,d=p.atime;let m=0;return u>d?m=-1:u<d&&(m=1),m}const _=[...a];return _.sort(r),_.slice(0,15)},s=a=>{const r=t.items[a].path;o("event_callback","open_file",r),t.isShowDlg=!1},i=a=>{t.isShowDlg=a};return(a,r)=>{const _=L("fa");return v(),k("span",{onMouseover:r[0]||(r[0]=l=>i(!0)),onMouseleave:r[1]||(r[1]=l=>i(!1))},[x(_,{icon:"history"}),f(t).isShowDlg?(v(),k("ul",_t,[(v(!0),k(B,null,K(f(t).items,(l,p)=>(v(),k("li",{class:"item",key:p,onClick:u=>s(p)},[x(_,{class:"title_item",icon:"file-alt"}),E("span",pt,N(l.group)+"/",1),E("span",gt,N(l.title),1),E("span",ht,"["+N(l.atime)+"]",1)],8,mt))),128))])):I("",!0)],32)}}});var vt=D(ft,[["__scopeId","data-v-b83f6c68"]]);const bt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"backup(json)",cmd:"backupEx",icon:"cloud-upload-alt",children:[]},{title:"restore(json)",cmd:"restoreEx",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],yt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"copy",cmd:"dlg_copy",icon:"copy",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],kt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],wt={dlg_import:{init:(c,o)=>{c.title="Restore",c.isFileOpen=!0,c.isNoEdit=!0,c.edit=""},action:c=>["import"]},dlg_delete:{init:(c,o)=>{c.title="Delete",c.isReadOnly=!0,c.edit=o},action:c=>["delete",c.edit,""]},dlg_rename:{init:(c,o)=>{c.title="Rename",c.edit=o},action:c=>["rename",c.edit,c.edit_org]},dlg_new:{init:(c,o)=>{c.title="Create",c.edit=o.split("/").slice(0,-1).join("/")+"/*.md"},action:c=>["new",c.edit,""]},dlg_copy:{init:(c,o)=>{c.title="Copy",c.edit=o},action:c=>["copy",c.edit,c.edit_org]},dlg_path_rename:{init:(c,o)=>{c.title="Rename of Path",c.edit=o.split("/").slice(0,-1).join("/")+"/"},action:c=>["path_rename",c.edit,c.edit_org]},dlg_path_delete:{init:(c,o)=>{c.title="Delete of Path",c.isReadOnly=!0,c.edit=o.split("/").slice(0,-1).join("/")+"/"},action:c=>["path_delete",c.edit,""]},dlg_path_merge:{init:(c,o)=>{c.title="Merge of Path",c.isReadOnly=!0,c.edit=o.split("/").slice(0,-1).join("/")+"/"},action:c=>["path_merge",c.edit,""]},dlg_tweet:{init:(c,o)=>{c.title="Tweet",c.edit=""},action:c=>["tweet",c.edit,""]},dlg_bookmark:{init:(c,o)=>{c.title="Bookmark",c.edit="",c.isMulti=!0},action:c=>["bookmark",c.edit,""]},dlg_filter:{init:(c,o)=>{c.title="Filter",c.title2="target under folder",c.edit="",c.edit_org="@",c.isCheck=!0},action:c=>(console.log("dlg_filter"),["filter",c.filename,{filter:c.edit,isCheck:c.check}])}};const $t=c=>(ye("data-v-43a1c564"),c=c(),ke(),c),xt={class:"nav"},Et=["title"],Ct={class:"form"},St={class:"cmd"},Mt=$t(()=>E("span",{class:"item"},null,-1)),jt=j({emits:["event_callback"],setup(c,{emit:o}){const{store_data:e}=R();W();const t=F(null),n=F(null),s=T({filename:"@",objMenu:bt,dctMenu:[]}),i=(l,p)=>{if(console.log(`[event_callback] cmd=${l}`),l!="top")if(l=="cmd"){const u=n.value,d=u.getAttribute("url"),m=u.getAttribute("cmd");console.log(`url=${d}`),console.log(`cmd=${m}`),m=="add_bookmark"&&i("bookmark",d)}else o("event_callback",l,p)};H(()=>{console.log("[mounted]")});const a=l=>{console.log(`[doAction] cmd=${l}`),o("event_callback",l,!0)};O(()=>e.state.filename,(l,p)=>{console.log(`[watch:filename] ${l}`),_(l)}),O(()=>e.state.dictMenu,(l,p)=>{s.dctMenu=l}),O(()=>e.state.jump,(l,p)=>{window.setTimeout(()=>{r()},500)});const r=()=>{t.value.scrollIntoView({})},_=l=>{console.log(`[onChanged_filename] new=${l}`),s.filename=l,r()};return(l,p)=>{const u=L("fa");return v(),k("header",{class:"appbar",ref_key:"appbar",ref:t,_click:"event_callback('top', true)"},[E("nav",xt,[x(ut,{class:"item",objMenu:f(s).objMenu,onEvent_callback:i,title:"menu"},null,8,["objMenu"]),E("section",{class:"item logo",onClick:p[0]||(p[0]=d=>i("filelist",!0)),title:f(s).filename},"Oden",8,Et),x(vt,{class:"item",objMenuItem:f(s).dctMenu,onEvent_callback:i,title:"history"},null,8,["objMenuItem"]),f(s).filename!==""?(v(),k("span",{key:0,class:"item name",onClick:p[1]||(p[1]=d=>i("dlg_rename",null))},"["+N(f(s).filename)+"]",1)):I("",!0),E("span",{class:"item mark",onClick:p[2]||(p[2]=d=>a("toggle_editor")),title:"editor/viewer"},[x(u,{icon:"edit"})]),E("form",Ct,[E("span",{class:"item",id:"api_do",url:"",cmd:"",onClick:p[3]||(p[3]=d=>i("cmd")),ref_key:"api",ref:n,style:{visibility:"hidden"}},"cmd",512)])]),E("span",St,[E("span",{class:"item",onClick:p[4]||(p[4]=d=>a("dlg_filter")),title:"filter"},[x(u,{icon:"paw"})]),E("span",{class:"item",onClick:p[5]||(p[5]=d=>a("dlg_tweet")),title:"tweet"},[x(u,{icon:"grimace"})]),E("span",{class:"item",onClick:p[6]||(p[6]=d=>a("dlg_bookmark")),title:"bookmark"},[x(u,{icon:"bookmark"})]),Mt])],512)}}});var Ot=D(jt,[["__scopeId","data-v-43a1c564"]]);const Tt=["title","onContextmenu","onDblclick"],Lt={key:0},Dt=j({props:{item:null},emits:["event_callback"],setup(c,{emit:o}){const e=c,t=T({isOpen:!1,item:e.item,isFolder:e.item.children&&e.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:n}=R();O(()=>n.state.filename,(u,d)=>{_(u)});const s=(u,d)=>{console.log(`[event_callback] cmd=${u}`),o("event_callback",u,d)},i=(u,d)=>{console.log(`[event_callbackEx] cmd=${u}`),o("event_callback",u,t.item.path)};H(()=>{_(n.state.filename)});const a=u=>{if(t.isFolder)console.log("onClick-folder"),t.isOpen=!t.isOpen;else{const d=u.path;console.log(`onClick-filename=${d}`),n.do_cmd("open_file",d)}},r=u=>{console.log("onClickEx"),t.menu=t.isFolder?kt:yt,t.event=u},_=u=>{t.item.path==u,u.indexOf(t.item.name)!=-1&&(t.isOpen=!0),t.class_item=t.item.path==u?"item active":"item"},l=()=>t.isFolder?"folder":t.class_item,p=()=>t.isFolder?t.isOpen?"folder-open":"folder":t.item.file=="mm"?"pen":"file";return(u,d)=>{const m=L("fa"),y=L("tree-item",!0);return v(),k("div",{class:"file_tree",onContextmenu:d[1]||(d[1]=Z(()=>{},["prevent"]))},[x(ge,{mouse:f(t).event,items:f(t).menu,onEvent_callback:i},null,8,["mouse","items"]),E("div",{class:we(l()),title:f(t).item.time,onClick:d[0]||(d[0]=w=>a(f(t).item)),onContextmenu:Z(r,["prevent"]),onDblclick:Z(r,["prevent"])},[x(m,{icon:p(),onClick:r},null,8,["icon"]),q(" "+N(f(t).item.name),1)],42,Tt),f(t).isOpen?(v(),k("div",Lt,[(v(!0),k(B,null,K(f(t).item.children,(w,M)=>(v(),k("div",{key:M},[x(y,{item:w,onEvent_callback:s},null,8,["item"])]))),128))])):I("",!0)],32)}}});var Nt=D(Dt,[["__scopeId","data-v-21024690"]]);const At={class:"tree"},It=j({emits:["event_callback"],setup(c,{emit:o}){const e=T({items:void 0}),{store_data:t}=R();O(()=>t.state.dictMenu,(i,a)=>{s(i)});const n=(i,a)=>{console.log(`[event_callback] cmd=${i}`),o("event_callback",i,a)};H(()=>{console.log("[mounted]"),s(t.state.dictMenu)});const s=i=>{console.log("[onChanged_dictMenu]"),e.items=void 0;const a=i,r={name:"",children:[],path:"",file:"",time:""},_="/",l={[_]:r},p=u=>u.split(".").slice(1);a.forEach(function(u){u.key.split("/").reduce(function(d,m){if(d[m])return d[m];{const y={name:m,children:[],path:u.path,file:p(m),time:u.atime};return d[_].children.push(y),d[_].file="",d[m]={[_]:y}}},l)}),console.dir(r),setTimeout(()=>{e.items=r.children},250)};return(i,a)=>(v(),k("div",At,[x($e,{_appear:"",name:"flip-list",tag:"div"},{default:te(()=>[(v(!0),k(B,null,K(f(e).items,r=>(v(),k("div",{key:r.path},[x(Nt,{item:r,onEvent_callback:n},null,8,["item"])]))),128))]),_:1})]))}});var Bt=D(It,[["__scopeId","data-v-bb89d624"]]);const Rt=j({props:{level:null},setup(c){const o=c,e=G(()=>`h${o.level}`);return(t,n)=>(v(),U(xe(f(e)),{class:"h_tag"},{default:te(()=>[Ee(t.$slots,"default",{},void 0,!0)]),_:3}))}});var Vt=D(Rt,[["__scopeId","data-v-f257f458"]]);const Ft=j({emits:["event_callback"],components:{heading:Vt},setup(c,o){const{store_data:e}=R(),t=T({listTag:[]});O(()=>e.state.tags,(i,a)=>{t.listTag=i});function n(i){e.do_cmd("update_jump",i)}function s(i){return`${i.text}`}return{state:t,dispTitle:s,jumpSource:n}}}),Ht={class:"tag"},Pt=["onClick"];function Jt(c,o,e,t,n,s){const i=L("heading");return v(),k("div",Ht,[(v(!0),k(B,null,K(c.state.listTag,(a,r)=>(v(),k("div",{key:r,onClick:_=>c.jumpSource(r),class:"item"},[x(i,{level:a.tag},{default:te(()=>[q(N(c.dispTitle(a)),1)]),_:2},1032,["level"])],8,Pt))),128))])}var Ut=D(Ft,[["render",Jt],["__scopeId","data-v-39c9834e"]]);const Kt=j({emits:["event_callback"],setup(c,o){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(n,s)=>{console.log(`cmd=${n}, name=${s}`),o.emit("event_callback",n,s)}}}}),qt={class:"main",style:{_height:"100px"}},Yt=["onClick","title"];function Gt(c,o,e,t,n,s){const i=L("fa");return v(),k("div",qt,[(v(!0),k(B,null,K(c.objToolbar,(a,r)=>(v(),k("button",{class:"btn-item",key:r,onClick:_=>c.event_callback("action",a.cmd),title:a.cmd},[x(i,{icon:a.icon},null,8,["icon"])],8,Yt))),128))])}var Wt=D(Kt,[["render",Gt],["__scopeId","data-v-51a9c01b"]]);const ee={};class zt{constructor(o,e){X(this,"cmdid",0);X(this,"monaco",null);X(this,"editor",null);console.log("[constructer]"),this.monaco=o,this.editor=e}add(o,e,t,n,s=null){console.log("[add]");let i;switch(n.length){case 0:i=this.generateCommand(o,s);break;case 1:i=this.generateHeaderCommand(n[0]);break;case 2:i=this.generateWrapperCommand(n[0],n[1]);break}ee[o]=i,this.editor.addAction({id:"markdown-"+this.cmdid++,label:o,keybindings:t,contextMenuGroupId:e&&"navigation",contextMenuOrder:e&&1.5,run:ee[o]})}generateCommand(o,e){return(t,n)=>{e(t)}}generateWrapperCommand(o,e){const t=o.length+e.length,s=this.editor.getModel();return this.monaco,(i,a)=>{const r=i.getSelections();if(r==null)return;const _=[];return r.forEach(l=>{_.push(new a.Selection(l.startLineNumber,l.startColumn,l.endLineNumber,l.endColumn+t)),s.pushEditOperations([],[{range:{startLineNumber:l.startLineNumber,startColumn:l.startColumn,endLineNumber:l.startLineNumber,endColumn:l.startColumn},text:o},{range:{startLineNumber:l.endLineNumber,startColumn:l.endColumn,endLineNumber:l.endLineNumber,endColumn:l.endColumn},text:e}])}),i.setSelections(_),null}}generateHeaderCommand(o){return this.editor,this.editor.getModel(),(e,t)=>{const n=e.getModel();let s=e.getSelections();return s==null&&(s=[e.getSelection()]),s.forEach(i=>{const a=n.findNextMatch("^(#+ )",{lineNumber:i.startLineNumber,column:1},!0,!1,null,!0);if(a!=null&&a.range.startLineNumber==i.startLineNumber&&a.range.startColumn==1){if(a.matches[1]==o)return;n.pushEditOperations([],[{range:{startLineNumber:i.startLineNumber,startColumn:1,endLineNumber:i.startLineNumber,endColumn:a.matches[1].length+1},text:""}])}n.pushEditOperations([],[{range:{startLineNumber:i.startLineNumber,startColumn:1,endLineNumber:i.startLineNumber,endColumn:1},text:o}])}),null}}}function Xt(c,o){const e=n=>{const s=i=>`00${i}`.slice(-2);return`${n.getFullYear()}/${s(n.getMonth()+1)}/${s(n.getDate())} ${s(n.getHours())}:${s(n.getMinutes())}:${s(n.getSeconds())}`};console.log("[setupShortcutKeys]");const t=new zt(c,o);t.add("Bold","8_",[],["**","**"]),t.add("Italic","1_",[],["__","__"]),t.add("Underline","9_",[],["<u>","</u>"]),t.add("Strikethrough",!1,[c.KeyMod.CtrlCmd|c.KeyMod.Shift|c.KeyCode.KEY_S],["~~","~~"]),t.add("Code",!1,[],["`","`"]),t.add("Link",!1,[],["[","]()"]),t.add("Link-2",!1,[],["[](",")"]),t.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),t.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),t.add("Header 1",!1,[],["# ",""]),t.add("Header 2",!1,[],["## ",""]),t.add("Header 3",!1,[],["### ",""]),t.add("Header 4",!1,[],["#### ",""]),t.add("Header 5",!1,[],["##### ",""]),t.add("Header 6",!1,[],["###### ",""]),t.add("Check",!1,[],["- [ ] ",""]),t.add("Blockquotes",!1,[],["> ",""]),t.add("Today",!1,[],[`${e(new Date)}`,""]),t.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),t.add("Format","8_",[],[],n=>{console.log("format"),n.getAction("editor.action.formatDocument").run()})}const Qt={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},Zt=j({emits:["event_callback"],components:{ToolbarEditor:Wt},props:{isActive_preview:{type:Boolean,default:!1}},setup(c,o){const e=F(null),t={editor:void 0},{store_data:n}=R(),s=T({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});H(()=>{console.log("[mounted]"),a(),m(n.state.obj.content)}),O(()=>n.state.obj.content,(b,C)=>{console.log("[watch-body]"),s.filename!=""&&M(),m(b),A(n.state.obj.position,!0),s.filename=n.state.filename}),O(()=>n.state.ObjTag,(b,C)=>{console.log(`[watch](ObjTag)-${b}`),i(b)}),O(()=>c.isActive_preview,(b,C)=>{console.log(`[watch](editor_toggle)-${b}`),b==!0&&w()});const i=b=>{const C=h=>{u(h)};console.log(`[jump_cursor]ObjTag={${Object.values(b)}}`);const g=b.line;C(g),setTimeout(()=>{const h=t.editor;s.pos_scroll=h.getScrollTop()},500)},a=()=>{const b=()=>{const C=($,S)=>{Xt($,S)},g=document.getElementById("container");if(console.log(`root=${g}`),g==null)return;const h=Ce.create(g,Qt);return C(le,h),console.log(`editor=${h}`),h.onDidScrollChange($=>{s.scrollInfo.height=$.scrollHeight,s.scrollInfo.top=$.scrollTop}),h};t.editor=b(),r()},r=()=>{t.editor.onDidBlurEditorText(b=>{w()})},_=(b,C)=>{switch(console.log(`[event_callback] cmd=${b}`),b){case"action":l(C);break;case"save":w();break}},l=b=>{console.log("[action]"),ee[b]!=null&&ee[b](t.editor,le)},p=()=>t.editor.getValue(),u=b=>{const C=new Se(b+1,0,b+1,0);console.log(`Line=${b}`),t.editor.revealRangeAtTop(C)},d=()=>t.editor.getModel().getAlternativeVersionId(),m=b=>{t.editor.setValue(b),s.iVersion=d()},y=()=>{const b=d();return console.info(`iVersion=${s.iVersion}, iVersion_cur=${b}`),s.iVersion!=b},w=(b=!1)=>{if(!y())return;b||M();const C=p();n.do_cmd("save_file",C),s.iVersion=d(),console.info(`iVersion=${s.iVersion}`)},M=()=>{const b=t.editor,C={top:b.getScrollTop(),height:b.getScrollHeight(),contentHeight:b.getLayoutInfo().height,scrolled:s.pos_scroll!=b.getScrollTop()};return y()?(n.do_cmd("update_position",C,void 0),w(!0)):n.do_cmd("update_position",C,s.filename),C},A=(b,C=!1)=>{if(b==null)return;console.log(`[e-set]value=${JSON.stringify(b)}`);const g=t.editor;if(C?!0:b.scrolled){const $=b.top/b.height;console.log(`per=${$}`);const S=g.getScrollHeight();g.setScrollTop(S*$)}else i(n.state.ObjTag);setTimeout(()=>{s.pos_scroll=g.getScrollTop()},500)};G(()=>t.editor.getScrollTop());const J=G(()=>`${n.state.height-27}px`);return{editorEx:t,event_callback:_,HeightEx:J,md_editor_monaco:e,get_position:M,set_position:A}}}),eo={class:"editor"};function to(c,o,e,t,n,s){const i=L("ToolbarEditor");return v(),k("div",eo,[x(i,{class:"toolbar",onEvent_callback:c.event_callback},null,8,["onEvent_callback"]),E("div",{id:"container",ref:"md_editor_monaco",class:"core",style:P({height:c.HeightEx})},null,4)])}var oo=D(Zt,[["render",to],["__scopeId","data-v-7e52ad8b"]]);const no=j({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(c){const o=F(null),{store_data:e}=R(),t=T({pos_scroll:-1,filename:"",observer_scroll:null});H(()=>{function l(){const p=new se.Renderer;p.link=function(u,d,m){return console.log(`href=${u}, title=${d}, text=${m}`),u.indexOf("http")!=-1?`<a target="_blank" href="${u}">${m}</a>`:`<a target="_blank" href="#${u}">${m}</a>`},p.code=function(u,d,m){return u.match(/^sequenceDiagram/)||u.match(/^graph/)||u.match(/^gantt/)?'<div class="mermaid">'+u+`
</div>`:`<pre><code>
`+Me.highlightAuto(u).value+`
</code></pre>`},se.setOptions({renderer:p,langPrefix:"",breaks:!0}),window.setTimeout(()=>{je.init()},500)}console.log("[mounted]"),l(),t.observer_scroll=new n}),oe(()=>{}),O(()=>e.state.obj.content,(l,p)=>{console.log("[watch-body]"),t.filename!=""&&i(),setTimeout(()=>{t.observer_scroll.build(),a(e.state.obj.position,!0),t.filename=e.state.filename},0)});class n{constructor(){this.observer=null,this.tocMap=null,this.elm_target_before=null}destructor(){}build(){const p=()=>document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),u=()=>document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5"),d=(M,A)=>{const J=this.tocMap.get(M);A?(this.elm_target_before!=null&&this.elm_target_before.classList.remove("active"),J.classList.add("active"),this.elm_target_before=null):this.elm_target_before=J},m={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},y=this.set_callback(d,m),w=this.build_toc_map(y,p(),u());this.observer=y,this.tocMap=w}set_callback(p,u){const d=m=>{m.forEach(y=>{p(y.target,y.intersectionRatio)})};return new IntersectionObserver(d,u)}build_toc_map(p,u,d){const m=new Map;return console.log(`el_contents=${u.length}`),console.log(`el_tocs=${d.length}`),u.forEach((y,w)=>{p.observe(y),m.set(d.item(w),y),m.set(y,d.item(w))}),m}}O(()=>e.state.ObjTag,(l,p)=>{console.log(`[watch](ObjTag)-${l}`),s(l)});function s(l){const p=(m,y)=>{console.log(`tag=${m}, num=${y}`);const w=o.value,M=w.querySelectorAll(".md_core_viewer > h"+m);M.length!=0&&(w.scrollTop=M[y].getBoundingClientRect().top-w.getBoundingClientRect().top+w.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(l)}}`);const u=l.tag,d=l.num;p(u,d),setTimeout(()=>{const m=o.value;t.pos_scroll=m.scrollTop},0)}const i=()=>{const l=o.value,p={top:l.scrollTop,height:l.scrollHeight,contentHeight:0,scrolled:t.pos_scroll!=l.scrollTop};return e.do_cmd("update_position",p,t.filename),p},a=(l,p=!1)=>{if(console.log(`[v-set]value=${JSON.stringify(l)}`),o.value==null)return;const u=o.value;if(l==null){u.scrollTop=0;return}if(p?!0:l.scrolled){const m=l.top/l.height;console.log(`per=${m}`),console.log(`scrollTop=${u.scrollTop}, scrollHeight=${u.scrollHeight}`),u.scrollTop=u.scrollHeight*m}else s(e.state.ObjTag);setTimeout(()=>{t.pos_scroll=u.scrollTop},0)},r=G(()=>se.parse(e.state.obj.content)),_=G(()=>e.state.height+"px");return{status,Markdown:r,HeightEx:_,md_viewer:o,get_position:i,set_position:a}}}),so=["innerHTML"];function io(c,o,e,t,n,s){return v(),k("div",{class:"md_core_viewer note",innerHTML:c.Markdown,style:P({height:c.HeightEx}),ref:"md_viewer"},null,12,so)}var co=D(no,[["render",io],["__scopeId","data-v-bf27e4fa"]]);const ao=j({props:{editor_toggle:null},emits:["event_callback"],setup(c,{emit:o}){const e=c;R(),W();const t=T({isActive_preview:!0}),n=F(),s=F();H(()=>{console.log("[mounted]"),document.addEventListener("keydown",i)}),oe(()=>{console.log("unmounted!"),document.removeEventListener("keydown",i)}),O(()=>e.editor_toggle,(r,_)=>{console.log(`[watch](editor_toggle)-${r}`),a()});const i=r=>{if(r.keyCode===83&&r.ctrlKey){r.preventDefault(),console.log("save"),a();return}else if(r.keyCode===69&&r.ctrlKey){r.preventDefault(),console.log("toggle"),a();return}},a=()=>{var l;const r=t.isActive_preview?{now:n,next:s}:{now:s,next:n},_=(l=r.now.value)==null?void 0:l.get_position();console.log(`isActive_preview=${t.isActive_preview}, scrollIndo=${JSON.stringify(_)}`),t.isActive_preview=!t.isActive_preview,setTimeout(()=>{var p;(p=r.next.value)==null||p.set_position(_)},500)};return(r,_)=>(v(),k("div",null,[f(t).isActive_preview?(v(),U(co,{key:0,class:"md_viewer",ref_key:"MdViewer",ref:n,isActive_preview:f(t).isActive_preview},null,8,["isActive_preview"])):(v(),U(oo,{key:1,class:"md_editor",ref_key:"MdEditor",ref:s,isActive_preview:f(t).isActive_preview},null,8,["isActive_preview"]))]))}}),lo={class:"mindmap"},ro=j({emits:["event_callback"],setup(c,{emit:o}){const{store_data:e}=R();W();const t=F([{name:"start",children:[]}]),n=T({height:window.innerHeight,update:!1});H(()=>{console.log("[mounted]"),document.addEventListener("keydown",s)}),oe(()=>{console.log("unmounted!"),document.removeEventListener("keydown",s)});const s=_=>{if(_.keyCode===83&&_.ctrlKey){_.preventDefault(),console.log("save"),a(t.value);return}};O(()=>e.state.obj,(_,l)=>{console.log("[watch-body]"),i(_.content)});const i=_=>{try{t.value=JSON.parse(_)}catch(l){console.log(l),t.value=[{name:"@start",children:[]}]}console.log("onChanged_body"),n.update=!n.update},a=_=>{e.do_cmd("save_file",JSON.stringify(t.value))},r=async(_,l)=>{switch(console.log(`[event_callback] cmd=${_}, va0=${l}`),_){case"toggle_editor":a(t.value);break;case"blur":a(t.value);break;default:e.do_cmd(_,l);break}};return(_,l)=>{const p=L("Mindmap");return v(),k("div",lo,[x(p,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=u=>t.value=u),update:f(n).update,onEvent_callback:r},null,8,["modelValue","update"])])}}});const uo={class:"modal-mask"},_o={class:"modal-wrapper"},mo={class:"modal-container"},po={class:"header"},go={class:"form"},ho=["disabled"],fo=["disabled"],vo={class:"modal-actions"},bo=["disabled"],yo=j({emits:["event_callback"],setup(c,{emit:o}){const{store_dlg:e}=W(),{store_data:t}=R(),n=F(null),s=F(null),i=T({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});O(()=>e.state.objParam,d=>{a(d)});const a=d=>{const m=(y,w=!1)=>y!=null?y:w;console.log("[onChanged_objParam]"),i.title=d.title,i.title2=d.title2,i.edit=d.edit,i.edit_org=m(d.edit_org,d.edit),i.check=0,i.isShowDlg=!0,i.isNoEdit=m(d.isNoEdit),i.isFileOpen=m(d.isFileOpen),i.isReadOnly=m(d.isReadOnly),i.isCheck=m(d.isCheck),i.isMulti=m(d.isMulti),i.isDisabled=!0,i.action=d.action,p(!0),setTimeout(()=>{i.isMulti==!0?n.value.focus():s.value.focus()},500)},r=d=>{if(console.log(`[doAction] flg=${d}, edit=${i.edit}`),d){const m=i.action(i);t.do_cmd(m[0],m[1],m[2])}i.isShowDlg=!1,p(!1)},_=d=>{const y=(d.target.files||d.dataTransfer.files)[0],w=i.action(i);t.do_cmd(w[0],y),i.isShowDlg=!1,p(!1)},l=()=>{const d=i.edit_org,m=i.edit==d&&!i.isReadOnly;return console.log(`[isDisabled]=${m}`),m},p=d=>{d==!0?document.addEventListener("keydown",u):document.removeEventListener("keydown",u)},u=d=>{const m=d.key;switch(console.log(`key = ${m}`),m){case"Enter":d.preventDefault(),r(!0);break;case"Escape":d.preventDefault(),r(!1);break}};return(d,m)=>{const y=L("fa");return Q((v(),U(De,{persistent:""},{default:te(()=>[E("div",uo,[E("div",_o,[E("div",mo,[E("div",po,N(f(i).title)+"?",1),E("form",go,[f(i).isFileOpen==!0?(v(),k("input",{key:0,class:"input",type:"file",onChange:_},null,32)):I("",!0),f(i).isNoEdit==!1?(v(),k(B,{key:1},[f(i).isMulti==!0?Q((v(),k("textarea",{key:0,class:"input",autofocus:"","onUpdate:modelValue":m[0]||(m[0]=w=>f(i).edit=w),disabled:f(i).isReadOnly,ref_key:"edit",ref:n},null,8,ho)),[[re,f(i).edit]]):Q((v(),k("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":m[1]||(m[1]=w=>f(i).edit=w),disabled:f(i).isReadOnly,ref_key:"edit2",ref:s,placeholder:"type text.."},null,8,fo)),[[re,f(i).edit]])],64)):I("",!0),f(i).isCheck==!0?(v(),k(B,{key:2},[Q(E("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":m[2]||(m[2]=w=>f(i).check=w)},null,512),[[Te,f(i).check]]),q(" "+N(f(i).title2),1)],64)):I("",!0)]),E("div",vo,[E("button",{class:"btn btn-ok",ref:"ok",disabled:l(),onKeydown:m[3]||(m[3]=Le(w=>r(!0),["enter"])),onClick:m[4]||(m[4]=w=>r(!0))},[x(y,{icon:"check"}),q(" "+N(f(i).title),1)],40,bo),E("button",{class:"btn btn-can",onClick:m[5]||(m[5]=w=>r(!1))},"cancel")])])])])]),_:1},512)),[[Oe,f(i).isShowDlg]])}}});var ko=D(yo,[["__scopeId","data-v-54e808bd"]]);const wo={class:"container"},$o={class:"main"},xo=j({emits:["event_callback"],setup(c,{emit:o}){const{store_data:e}=R(),{store_dlg:t}=W();_e();const n=ce(),s=T({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1,mode:0});H(()=>{console.log("[mounted]"),i(),window.addEventListener("resize",a),document.body.style.overflow="hidden"}),oe(()=>{console.log("unmounted!"),window.removeEventListener("resize",a)});const i=()=>{const l=u=>{if(console.log(`filename=${u}`),u=="/")e.do_cmd("restore_file","");else{let d=u.indexOf("#");d=d!=-1?d+1:2,e.do_cmd("open_file",u.substring(d))}};console.log("init");const p=n.fullPath;console.log(`route.fullPath=${n.fullPath}`),l(p),e.do_cmd("filter_menu",null),a(),e.do_cmd("load_config",null)},a=()=>{const l=window.innerHeight-40;console.log(`height=${l}`),s.height=l,e.update_height(l)},r=async(l,p)=>{switch(console.log(`[event_callback] cmd=${l}, va0=${p}`),l){case"toggle_editor":s.editor_toggle=!s.editor_toggle;break;case"config":s.objDlgConf={cmd:l,filename:"",commit:""};break;case"filelist":document.querySelector(".col-3");const u=!s.toggle_list;s.toggle_list=u,console.log(s.toggle_list);break;default:if(l.indexOf("dlg_")!=-1){const d=Object.assign({},_(l,p));t.update_param(d)}else e.do_cmd(l,p);break}},_=(l,p)=>{const u=wt[l],d=p!=null?p:e.state.filename;return u.init(u,d),u};return O(()=>e.state.mode,(l,p)=>{console.log("[watch-mode]"),s.mode=l}),(l,p)=>(v(),k("div",wo,[x(Ot,{ref:"appbar",onEvent_callback:r},null,512),x(ko,{objParam:f(s).objDlgCmn,onEvent_callback:r},null,8,["objParam"]),E("div",$o,[f(s).toggle_list?(v(),U(Bt,{key:0,class:"col-3",onEvent_callback:r,style:P({height:f(s).height+"px"})},null,8,["style"])):I("",!0),f(s).mode==0?(v(),k(B,{key:1},[x(ao,{class:"col-2",ref:"pane",editor_toggle:f(s).editor_toggle,style:P({height:f(s).height+"px"})},null,8,["editor_toggle","style"]),x(Ut,{class:"col-1",onEvent_callback:r,style:P({height:f(s).height+"px"})},null,8,["style"])],64)):(v(),U(ro,{key:2,class:"col-4",ref:"pane",editor_toggle:f(s).editor_toggle,style:P({height:f(s).height+"px"})},null,8,["editor_toggle","style"]))])]))}});var Eo=D(xo,[["__scopeId","data-v-00589403"]]);const Co={_class:"container"},So=j({emits:["event_callback"],setup(c,{emit:o}){const e=ce(),t=T({filename:"",height:window.innerHeight,timer3:-1});H(()=>{console.log("[mounted]"),n(),document.body.style.overflow="hidden"});const n=()=>{console.log("init");const s=e.path.substring(1);console.log(`filename=${s}`),t.filename=s,t.timer3=window.setTimeout(()=>{clearTimeout(t.timer3),window.print()},500)};return(s,i)=>{const a=L("MarkdownViewer");return v(),k("div",Co,[q(N(f(t).filename)+" ",1),x(a,{class:"md_viewer",style:{"{\n          height":"initial"}})])}}}),Mo=[{name:"viewer_print",path:"/print/:pathMatch(.*)",component:So},{name:"viewer",path:"/:pathMatch(.*)*",component:Eo}],jo=Ne({history:Ae(),routes:Mo});function Oo(c={}){const{immediate:o=!1,onNeedRefresh:e,onOfflineReady:t,onRegistered:n,onRegisterError:s}=c;let i;const a=async(r=!0)=>{};return"serviceWorker"in navigator&&(i=new Ie("./sw.js",{scope:"./"}),i.addEventListener("activated",r=>{r.isUpdate?window.location.reload():t==null||t()}),i.register({immediate:o}).then(r=>{n==null||n(r)}).catch(r=>{s==null||s(r)})),a}Oo();Be.add(Re);Ve(nt).use(jo).component("fa",Fe).mount("#app");
