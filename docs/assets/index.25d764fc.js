var e=Object.defineProperty,t=(t,n,o)=>(((t,n,o)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o})(t,"symbol"!=typeof n?n+"":n,o),o);import{D as n,a as o,i as s,p as a,r as i,d as l,b as c,c as r,o as d,e as u,f as m,g,h,j as p,F as _,k as b,l as v,t as f,w,m as k,v as y,n as x,q as E,s as $,u as C,x as M,y as O,z as L,A as S,B as j,C as D,E as N,G as T,R as I,H as A,I as F,J as R,T as B,K as V,L as H,M as U,N as P,_ as J,O as q,P as K}from"./vendor.3fff2e31.js";class Y{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[]}set(e,t="",n=[],o=!1){""!=t&&(this.path=t),n!=[]&&(this.tags=n),this.content=e;const s=this.get_time();this.atime=s,1==o&&(this.ctime=s)}set_default(e){this.path=e,this.content="",this.tags=[];const t=this.get_time();this.atime=t,this.ctime=t}copy(e){Object.assign(this,e)}update_content(e){this.content=e,this.atime=this.get_time(),this.update_contentEx()}update_contentEx(){this.tags=this.build_tag(this.content)}get_time(){return this.cnv_time(new Date)}cnv_time(e){const t=e=>`00${e}`.slice(-2);return`${e.getFullYear()}/${t(e.getMonth()+1)}/${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`}cnv_time2(e){const t=e=>`00${e}`.slice(-2);return`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}_${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`}update_time(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}update_tag(){this.tags=this.build_tag(this.content)}build_tag(e){console.log("[build_tag]");const t=[],n=[0,0,0,0,0],o=e.split(/\r\n|\n|\r/);for(let s=0;s<o.length;s++){if(-1!=o[s].search(/^\s*#/)){const e=o[s].split(" "),a=e[0].length;e.shift();const i=e.join(" ");t.push({text:i,line:s,tag:a,num:n[a]}),n[a]++}}return t}}class W extends n{constructor(){super("OdenDB"),this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class z{constructor(e){this.db=new W,this.objData={},this.ctime="",this.atime="",this.getStrageEx=async()=>(await this.getAll(),this.objData),this.read=async e=>{const t=(await this.dbx.get(e)).data;return this.set_cache(e,t),t},this.readEx=e=>this.objData[e],this.write=(e,t)=>{const n=JSON.stringify(t);this.set_cache(e,n),this.dbx.put({key:e,data:n,ctime:this.set_time_DB()})},this.delete=e=>{delete this.objData[e],this.dbx.delete(e),this.set_time_DB()},this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e={};(await this.dbx.toArray()).forEach((t=>{e[t.key]=t.data})),this.objData=e,this.atime=this.get_time_DB()}async sync_DB(){0==this.check_async_DB()&&await this.getAll()}check_async_DB(){const e=this.get_time_DB();return this.atime==e}set_time_DB(){const e=new Date,t=JSON.stringify(e);return localStorage.setItem("update_DB_time",t),this.atime=t,t}get_time_DB(){var e;return null!=(e=localStorage.getItem("update_DB_time"))?e:""}set_cache(e,t){this.objData[e]=t}}class G{constructor(e){this.read=e=>this.storeLS.read(e),this.readEx=e=>this.storeLS.readEx(e),this.write=(e,t)=>this.storeLS.write(e,t),this.delete=e=>this.storeLS.delete(e),this.as=e=>Object.assign(new Y,e),this.sync_DB=()=>this.storeLS.sync_DB(),this._=e,this.storeLS=new z(this._)}async get(e){console.log(`[get] _key=${e}`);const t=null!=e?await this.read(e):null;return null!=t?JSON.parse(t):this.create(e)}getEx(e){console.log(`[getEx] _key=${e}`);const t=this.readEx(e);return null!=t?JSON.parse(t):this.create(e)}exist(e){console.log(`[exist] _key=${e}`);return null!=this.readEx(e)}set(e,t){console.log(`[set] _key=${e}`);const n=this.as(this.getEx(e));return""==n.path&&(n.path=e),n.update_content(t),this.write(e,n),n}create(e){console.log(`[create] _key=${e}`);const t=new Y;return null!=e&&(t.set_default(e),this.write(e,t)),t}rename(e,t){console.log(`[rename] _key_org=${e}, _key_new=${t}`);let n=this.getEx(e);return n=this.as(n),n.path=t,this.write(t,n),this.delete(e),n}}class Q{constructor(e){this._=e}async rebuildMenu(){console.log("[rebuildMenu]");const e=await this._.mgrCache.getLstContent(),t=this.buildMenu(e);return console.log(`${e.length}/${t.length}`),this._.contentEx.set("menu.json",JSON.stringify(t)),t}async getMenu(e){console.log(`[getMenu] _filter=${e}`);const t=await this._.mgrCache.getLstContent(null!=e?e:"");return this.buildMenu(t)}buildMenu(e){return function(e){console.log("storeEx_index:buildMenuEx");const t=function(e){const t=new Set;return e.forEach((e=>{t.add(e.group)})),[...t]}(e);return e.reduce(((e,n)=>{if("menu.json"==n.path)return e;let o=n.group,s=n.title,a=`${o}/${s}`;return t.includes(a)&&(o=a,s=".index",a=`${o}/${s}`),e.push({key:a,group:o,title:s,path:n.path,atime:n.atime}),e}),[])}(e).sort(this.compare_group)}compare_group(e,t){let n=e.group,o=t.group;n==o&&(n=`${e.group}/${e.title}`,o=`${t.group}/${t.title}`);const s=n.toUpperCase(),a=o.toUpperCase();let i=0;return s>a?i=1:s<a&&(i=-1),i}}class X{static async read(e){console.log(`[read] filename=${e}`);const t=new URLSearchParams;return t.append("filename",e),X.post_cmdEx("load_file_md",t)}static write(e,t){console.log(`[write] filename=${e}`);const n=new URLSearchParams;return n.append("filename",e),n.append("source",t),X.post_cmdEx("save_file_md",n)}static async get_cmdEx(e){const t="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:get_cmdEx] api=${t}`),o.get(t).then((e=>e.data)).catch((e=>{throw e.response.status}))}static async post_cmdEx(e,t){const n="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:post_cmdEx] api=${n}`),o.post(n,t).then((e=>e.data)).catch((e=>{throw e.response.status}))}}class Z{constructor(e){this._=e}async restore(e,t){function n(e){e.forEach((e=>{const t=new Y;t.copy(e),t.update_contentEx(),t.update_time(),o.write(t.path,t)}))}console.log("[importExport:restore]");const o=this._.contentEx;return new Promise((function(o,s){switch(e){case 0:!function(e,t){X.get_cmdEx("restore_contents").then((t=>{n(t),e(t)})).catch((e=>{console.log(e),t(null)}))}(o,s);break;case 1:!function(e,t,o){const s=new FileReader;s.onload=()=>{var e;console.log("onload");const o=null!=(e=s.result)?e:"",a=JSON.parse(o);n(a),t(a)},s.onerror=e=>{o("error")},s.readAsText(e)}(t,o,s)}}))}backup(e){console.log("[importExport:backup]");const t=new URLSearchParams;t.append("lstContent",JSON.stringify(e)),X.post_cmdEx("backup_contents",t).then((e=>console.log(e))).catch((e=>console.log(e)))}backupEx(e){console.log("[importExport:backupEx]");const t=new Blob([JSON.stringify(e)],{type:"text/plain"});console.log("createObjectURL");const n=document.createElement("a");n.download="lstData.json",n.href=URL.createObjectURL(t),n.click(),URL.revokeObjectURL(n.href)}}class ee{constructor(e){this._=e}rename_folder(e,t,n){function o(e){const t=e.split("/");return[t[t.length-1],t.slice(0,-1).join("/")]}console.log(`@02-01 _filename_from=${e}, _to=${t}`);const s=o(e),a=o(t);((e,t)=>{e.forEach((e=>{const n=`${e[1]}/${e[0]}`,o=`${t}${e[2]}/${e[0]}`;console.log(`from=${n}, to=${o}`),this._.contentEx.rename(n,o)}))})(function(e,t){console.log(`@03-01 _group=${e}`);const n=[],o=0!=e.length?1:0;return t.forEach(((t,s)=>{if(0==t.group.indexOf(e)){const s=t.group.substring(e.length+o);n.push([t.title,t.group,0!=s.length?`/${s}`:""])}})),console.log(`@03-03 lst=${n}`),n}(s[1],n),a[1])}}class te{constructor(e){this._=e}async getLstContent(e=""){console.log("[getLstContent]");const t=await this.buildLstContent();return""!=e?t.filter((t=>-1!=t.content.toLowerCase().indexOf(e))):t}async buildLstContent(e=!1){var t;console.log("[buildLstContent]");const n=e=>{var t,n;let o=e.path;""!=o&&null!=o||(o=`@test/${(new Date).toLocaleString()}`);const s=o.split("/");return e.title=null!=(t=s.pop())?t:".",e.group=null!=(n=s.join("/"))?n:"@test",e},o=await this._.contentEx.storeLS.getStrageEx(),s=[];for(const i of Object.keys(o))try{s.push(n(JSON.parse(null!=(t=o[i])?t:"")))}catch(a){console.log(`@ error key=${i},e=${a} - other error`)}return s}compare_group(e,t){const n=e.group.toUpperCase(),o=t.group.toUpperCase();let s=0;return n>o?s=1:n<o&&(s=-1),s}}class ne{constructor(){this.contentEx=new G(this),this.mgrExchange=new Z(this),this.mgrEtc=new ee(this),this.mgrMenu=new Q(this),this.mgrCache=new te(this),console.log("[constructor]")}async cmd_getMenu(e=""){return this.mgrMenu.getMenu(e)}async cmd_load(e){return await this.contentEx.get(e)}async cmd_save(e,t){return this.contentEx.set(e,t)}async cmd_rename(e,t){return this.contentEx.rename(e,t),await this.mgrMenu.rebuildMenu()}async cmd_create(e){return this.contentEx.getEx(e),await this.mgrMenu.rebuildMenu()}async cmd_delete(e){return this.contentEx.delete(e),await this.mgrMenu.rebuildMenu()}cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(){const e=await this.mgrCache.buildLstContent(!0);return this.mgrExchange.backup(e)}async cmd_backupEx(){const e=await this.mgrCache.buildLstContent(!0);return this.mgrExchange.backupEx(e)}async cmd_restore(e,t){return await this.mgrExchange.restore(e,t),await this.mgrMenu.rebuildMenu()}async cmd_rebuild(){return await this.mgrMenu.rebuildMenu()}async cmd_rename_folder(e,t){const n=await this.cmd_getMenu(void 0);return this.mgrEtc.rename_folder(e,t,n),await this.mgrMenu.rebuildMenu()}}class oe{constructor(e){this.KEY="",console.log(e),this.KEY=e}get(e){var t;if(null!=localStorage.getItem(this.KEY)){const n=JSON.parse(null!=(t=localStorage.getItem(this.KEY))?t:"");e(n),console.log(n)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const se=Symbol(),ae=()=>{a(se,(()=>{const e=i({storeEx:new ne,persisted:new oe("lifeLog-Viewer-params"),filename:"",obj:new Y,code:"",isViewer:!1,dictMenu:[],tags:[],ObjTag:[],jump:-1,height:500}),t=t=>{console.log(`[watch](filename) : new=${t}`),t!=e.filename&&(e.filename=t,n(t))},n=t=>{console.log(`[watch](filename) : new=${t}`),e.storeEx.cmd_load(t).then((n=>{const s=Object.assign(new Y,n);o(s),e.persisted.set({filename:t})})).catch((e=>{console.log("error")}))},o=t=>{t.update_tag(),s(t.content),e.tags=t.tags},s=t=>{e.code=t},a=t=>{e.dictMenu=t},l=e=>{const t=e.split("/"),n=t[t.length-1];return[t.slice(0,-1).join("/"),n]};return{store_data:{state:e,update_filename:t,query_menu:(t="")=>{console.log(`[getMenu] filter=${t}`),e.storeEx.cmd_getMenu(t).then((e=>{console.log("update dictMenu"),a(e)})).catch((e=>{console.log("error:{error}")}))},update_height:t=>{e.height=t},update_jump:t=>{e.jump=t,e.ObjTag=JSON.parse(JSON.stringify(e.tags[t]))},save_code:async t=>{""!=t&&o(await e.storeEx.cmd_save(e.filename,t))},do_cmd:async(n,o)=>{console.log(`mode=${n},value=${o}`);let s="";switch(n){case"backup":e.storeEx.cmd_backup();break;case"export":e.storeEx.cmd_backupEx();break;case"restore":a(await e.storeEx.cmd_restore(0,null));break;case"import":a(await e.storeEx.cmd_restore(1,o));break;case"rebuild_menu":a(await e.storeEx.cmd_rebuild());break;case"delete":if(s=e.filename,console.log(`[delete] filename=${s}`),0==await e.storeEx.cmd_exist(s))return void console.log("not exist");a(await e.storeEx.cmd_delete(s)),t("");break;case"filter_menu":a(await e.storeEx.cmd_getMenu(o));break;case"rename_path":s=`${l(e.filename)[0]}/@@_dummp_@@`,console.log(`[rename_path] filename=${s}`),a(await e.storeEx.cmd_rename_folder(s,o)),t("");break;case"rename":if(1==await e.storeEx.cmd_exist(o))return;a(await e.storeEx.cmd_rename(e.filename,o)),t(o);break;case"new":if(1==await e.storeEx.cmd_exist(o))return;a(await e.storeEx.cmd_create(o)),t(o)}}}}})())},ie=()=>s(se),le=Symbol(),ce=()=>{a(le,(()=>{const e=i({objParam:null});return{store_dlg:{state:e,update_param:t=>{e.objParam=t}}}})())},re=()=>s(le);var de=l({components:{},setup:()=>(ae(),ce(),{})});de.render=function(e,t,n,o,s,a){const i=c("routerView");return d(),r(i)};var ue=l({emits:["event_callback"],props:{objMenu:{type:Array,default:[]}},setup(e,t){console.log("setup");const n=i({isOpen:!1,isShowDlg:!1,items:e.objMenu});return{state:n,props:e,select_menu:function(e){console.info(e);const o=e.cmd;console.info(`[select_menu] cmd=${o}`),t.emit("event_callback",o,!0),n.isShowDlg=!1},mouse_hover:function(e){console.log(`[mouse_hover] isHover=${e}`),n.isShowDlg=e}}}});u("data-v-045ebdd6");const me={key:0,class:"dropdown"},ge=["onClick"],he={class:"title"};m(),ue.render=function(e,t,n,o,s,a){const i=c("fa");return d(),g("div",{class:"menu",onMouseover:t[0]||(t[0]=t=>e.mouse_hover(!0)),onMouseleave:t[1]||(t[1]=t=>e.mouse_hover(!1))},[h("span",null,[p(i,{icon:"bars"})]),e.state.isShowDlg?(d(),g("ul",me,[(d(!0),g(_,null,b(e.state.items,((t,n)=>(d(),g("li",{class:"item",key:n,onClick:n=>e.select_menu(t)},[p(i,{class:"title_item",icon:t.icon},null,8,["icon"]),h("span",he,f(t.title),1)],8,ge)))),128))])):v("",!0)],32)},ue.__scopeId="data-v-045ebdd6";var pe=l({emits:["event_callback"],setup(e,t){console.log("setup");const{store_data:n}=ie(),o=i({items:[],isShowDlg:!1});return w((()=>n.state.dictMenu),((e,t)=>{o.items=function(e){function t(e,t){const n=e.atime,o=t.atime;let s=0;return n>o?s=-1:n<o&&(s=1),s}console.log("[cnvLstRecent]");const n=[...e];return n.sort(t),n.slice(0,10)}(e)})),{state:o,mouse_hover:function(e){console.log(`[mouse_hover] isHover=${e}`),o.isShowDlg=e},select_file:function(e){const t=o.items[e].path;console.log(`[select_file]${t}`),n.update_filename(t),o.isShowDlg=!1}}}});u("data-v-5a040804");const _e={key:0,class:"dropdown"},be=["onClick"],ve={class:"title"},fe={class:"title_sub"},we={class:"title_sub"};m(),pe.render=function(e,t,n,o,s,a){const i=c("fa");return d(),g("div",{class:"menu",onMouseover:t[0]||(t[0]=t=>e.mouse_hover(!0)),onMouseleave:t[1]||(t[1]=t=>e.mouse_hover(!1))},[h("span",null,[p(i,{icon:"history"})]),e.state.isShowDlg?(d(),g("ul",_e,[(d(!0),g(_,null,b(e.state.items,((t,n)=>(d(),g("li",{class:"item",key:n,onClick:t=>e.select_file(n)},[p(i,{class:"title_item",icon:"file-alt"}),h("span",ve,f(t.title),1),h("span",fe," ("+f(t.group)+")",1),h("span",we," ["+f(t.atime)+"]",1)],8,be)))),128))])):v("",!0)],32)},pe.__scopeId="data-v-5a040804";var ke=l({emits:["event_callback"],setup(e,t){console.log("setup"),ie();const n=i({filter:"",items:[],isShowDlg:!1});return{state:n,doFilter:e=>{console.log("[doFilter]"),t.emit("event_callback","filter_menu",n.filter)}}}});u("data-v-13d43ebc");const ye={"no-gutters":""};m(),ke.render=function(e,t,n,o,s,a){return d(),g("div",ye,[k(h("input",{type:"text",class:"filter ",placeholder:"filter","onUpdate:modelValue":t[0]||(t[0]=t=>e.state.filter=t),clearable:"",onBlur:t[1]||(t[1]=(...t)=>e.doFilter&&e.doFilter(...t)),onKeyup:t[2]||(t[2]=x(((...t)=>e.doFilter&&e.doFilter(...t)),["enter"]))},null,544),[[y,e.state.filter]])])},ke.__scopeId="data-v-13d43ebc";const xe=[{title:"new",cmd:"dlg_new",icon:"file"},{title:"rename",cmd:"dlg_rename",icon:"pen"},{title:"backup",cmd:"backup",icon:"cloud-upload-alt"},{title:"restore",cmd:"restore",icon:"cloud-download-alt"},{title:"-----",cmd:"",icon:""},{title:"export",cmd:"export",icon:"file-export"},{title:"import",cmd:"dlg_import",icon:"file-import"},{title:"-----",cmd:"",icon:""},{title:"rename_path",cmd:"dlg_rename_path",icon:"sync"},{title:"-----",cmd:"",icon:""},{title:"delete",cmd:"dlg_delete",icon:"trash-alt"},{title:"-----",cmd:"",icon:""},{title:"config",cmd:"config",icon:"config"},{title:"print",cmd:"print",icon:"print"}],Ee={dlg_import:{filename:"",commit:"import",title:"Restore",isFileOpen:!0,isInput:!1,isReadOnly:!1},dlg_delete:{filename:"",commit:"delete",title:"delete",isFileOpen:!1,isInput:!0,isReadOnly:!0},dlg_rename_path:{filename:"",commit:"doRename_path",title:"Restore",isFileOpen:!1,isInput:!0,isReadOnly:!1},dlg_rename:{filename:"",commit:"rename",title:"Rename",isFileOpen:!1,isInput:!0,isReadOnly:!1},dlg_new:{filename:"",commit:"new",title:"Create",isFileOpen:!1,isInput:!0,isReadOnly:!1}};var $e=l({emits:["event_callback"],components:{MenuCmd:ue,MenuRecent:pe,MenuFile:ke},setup(e,t){console.log("setup");const{store_data:n}=ie(),{store_dlg:o}=re(),s=E(null),a=i({filename:n.filename,objMenu:xe});$((()=>{console.log("[mounted]")}));w((()=>n.state.filename),((e,t)=>{console.log(`[watch:filename] ${e}`),l(e)}));const l=e=>{console.log(`[watch-filename] new=${e}`);a.filename=((e,t)=>{const n=e.filter((function(e){return e.path==t}));return n.length>0?`${n[0].group}/${n[0].title}`:"no title"})(n.state.dictMenu,e);s.value.scrollIntoView({})};return{state:a,doAction:e=>{console.log(`[doAction] cmd=${e}`),t.emit("event_callback",e,!0)},event_callback:(e,t)=>{if(console.log(`[event_callback] cmd=${e}`),-1!=e.indexOf("dlg_")){const t=Object.assign({},function(e){const t=Ee[e];switch(e){case"dlg_import":t.filename="";break;case"dlg_new":t.filename=n.state.filename.split("/").slice(0,-1).join("/")+"/*.md";break;default:t.filename=n.state.filename}return t}(e));o.update_param(t)}else n.do_cmd(e,t)},appbar:s}}});u("data-v-44bfd9cf");const Ce={class:"appbar",ref:"appbar"},Me={class:"nav"},Oe=h("section",{class:"item logo"}," Oden ",-1),Le={class:"cmd flex justify-end space-x-8 pr-4 border-2 border-red-500"};m(),$e.render=function(e,t,n,o,s,a){const i=c("MenuCmd"),l=c("fa"),r=c("MenuFile"),u=c("MenuRecent");return d(),g("header",Ce,[h("nav",Me,[p(i,{class:"item",objMenu:e.state.objMenu,onEvent_callback:e.event_callback},null,8,["objMenu","onEvent_callback"]),Oe,""!==e.state.filename?(d(),g("span",{key:0,class:"item name",onClick:t[0]||(t[0]=t=>e.event_callback("dlg_rename",!0))}," ["+f(e.state.filename)+"] ",1)):v("",!0),h("span",{class:"item",onClick:t[1]||(t[1]=t=>e.doAction("toggle_editor"))},[p(l,{icon:"edit"})])]),h("div",Le,[p(r,{class:"item",onEvent_callback:e.event_callback},null,8,["onEvent_callback"]),p(u,{class:"item",onEvent_callback:e.event_callback},null,8,["onEvent_callback"])])],512)},$e.__scopeId="data-v-44bfd9cf";var Se=l({emits:["event_callback"],props:{item:{type:Object,default:{}}},setup(e,t){const n=i({isOpen:!1,item:e.item,isFolder:e.item.children&&e.item.children.length});return{state:n,onClick:function(e){if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const n=e.path;console.log(`onClick-filename=${n}`),t.emit("event_callback","open_file",n)}},event_callback:(e,n)=>{console.log(`[event_callback] cmd=${e}`),t.emit("event_callback",e,n)}}}});u("data-v-37c0f284");const je={class:"file_tree"},De={key:0},Ne={key:0};m(),Se.render=function(e,t,n,o,s,a){const i=c("fa"),l=c("tree-item",!0);return d(),g("li",je,[h("div",{class:M(e.state.isFolder?"folder":"item"),onClick:t[0]||(t[0]=t=>e.onClick(e.state.item))},[e.state.isFolder?(d(),g("span",De,[p(i,{icon:e.state.isOpen?"folder-open":"folder"},null,8,["icon"])])):v("",!0),C(" "+f(e.state.item.name),1)],2),e.state.isFolder?k((d(),g("ul",Ne,[(d(!0),g(_,null,b(e.state.item.children,((t,n)=>(d(),r(l,{_class:"item",key:n,item:t,"_make-folder":"$emit('make-folder', $event)","_add-item":"$emit('add-item', $event)",onEvent_callback:e.event_callback},null,8,["item","onEvent_callback"])))),128))],512)),[[O,e.state.isOpen]]):v("",!0)])},Se.__scopeId="data-v-37c0f284";var Te=l({emits:["event_callback"],components:{TreeItem:Se},setup(e,t){console.log("setup");const{store_data:n}=ie(),o=i({items:void 0,isShowDlg:!1});w((()=>n.state.dictMenu),((e,t)=>{!function(e){console.log("[onChanged_dictMenu]"),o.items=void 0;const t={name:"",children:[],path:"",file:""},n="/",s={[n]:t};e.forEach((function(e){e.key.split("/").reduce((function(t,o){if(!t[o]){const s={name:o,children:[],path:e.path,file:"md"};return t[n].children.push(s),t[n].file="",t[o]={[n]:s}}return t[o]}),s)})),console.log(t),o.items=t.children}(e)}));return{state:o,event_callback:(e,t)=>{switch(console.log(`[event_callback] cmd=${e}`),e){case"open_file":n.update_filename(t)}},mouse_hover:function(e){console.log(`[mouse_hover] isHover=${e}`),o.isShowDlg=e}}}});u("data-v-3bda73bb");const Ie={key:0};m(),Te.render=function(e,t,n,o,s,a){const i=c("tree-item");return d(),g("div",{class:"tree",onMouseover:t[0]||(t[0]=t=>e.mouse_hover(!0)),onMouseleave:t[1]||(t[1]=t=>e.mouse_hover(!1))},[e.state.isShowDlg?(d(),g("div",Ie,[(d(!0),g(_,null,b(e.state.items,(t=>(d(),g("div",{key:t.path},[p(i,{item:t,onEvent_callback:e.event_callback},null,8,["item","onEvent_callback"])])))),128))])):v("",!0)],32)},Te.__scopeId="data-v-3bda73bb";var Ae=l({props:{level:{type:Number,required:!0}},setup(e,t){console.log("setup");return{tag:L((()=>`h${e.level}`))}}});Ae.render=function(e,t,n,o,s,a){return d(),r(j(e.tag),{class:"h_tag"},{default:S((()=>[D(e.$slots,"default",{},void 0,!0)])),_:3})},Ae.__scopeId="data-v-d56b53de";var Fe=l({emits:["event_callback"],components:{heading:Ae},setup(e,t){console.log("setup");const{store_data:n}=ie(),o=i({listTag:[]});return w((()=>n.state.tags),((e,t)=>{console.log(e),o.listTag=e})),{state:o,dispTitle:function(e){return`${e.text}`},jumpSource:function(e){console.log("[jumpSource] index="+e),n.update_jump(e)}}}});u("data-v-6dbf6215");const Re={class:"tag"},Be=["onClick"];m(),Fe.render=function(e,t,n,o,s,a){const i=c("heading");return d(),g("div",Re,[(d(!0),g(_,null,b(e.state.listTag,((t,n)=>(d(),g("div",{key:n,onClick:t=>e.jumpSource(n),class:"item"},[p(i,{level:t.tag},{default:S((()=>[C(f(e.dispTitle(t)),1)])),_:2},1032,["level"])],8,Be)))),128))])},Fe.__scopeId="data-v-6dbf6215";var Ve=l({emits:["event_callback"],setup(e,t){console.log("setup");return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"quote-left",cmd:"Quote"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(e,n)=>{console.log(`cmd=${e}, name=${n}`),t.emit("event_callback",e,n)}}}});u("data-v-137a5555");const He={class:"main",style:{_height:"100px"}},Ue=["onClick"];m(),Ve.render=function(e,t,n,o,s,a){const i=c("fa");return d(),g("div",He,[(d(!0),g(_,null,b(e.objToolbar,((t,n)=>(d(),g("button",{class:"btn-item",key:n,onClick:n=>e.event_callback("action",t.cmd)},[p(i,{icon:t.icon},null,8,["icon"])],8,Ue)))),128))])},Ve.__scopeId="data-v-137a5555";const Pe={};class Je{constructor(e,n){t(this,"cmdid",0),t(this,"monaco",null),t(this,"editor",null),console.log("[constructer]"),this.monaco=e,this.editor=n}add(e,t,n,o,s=null){let a;switch(o.length){case 0:a=this.generateCommand(e,s);break;case 1:a=this.generateHeaderCommand(o[0]);break;case 2:a=this.generateWrapperCommand(o[0],o[1])}Pe[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:n,contextMenuGroupId:t&&"navigation",contextMenuOrder:t&&1.5,run:Pe[e]})}generateCommand(e,t){return(e,n)=>{t(e)}}generateWrapperCommand(e,t){const n=e.length+t.length;return this.editor,this.editor.getModel(),this.monaco,console.log(`startText=${e}, endText=${t}`),(o,s)=>{const a=o.getModel(),i=o.getSelections();if(null==i)return;const l=[];return i.forEach((o=>{l.push(new s.Selection(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn+n)),a.pushEditOperations([],[{range:{startLineNumber:o.startLineNumber,startColumn:o.startColumn,endLineNumber:o.startLineNumber,endColumn:o.startColumn},text:e},{range:{startLineNumber:o.endLineNumber,startColumn:o.endColumn,endLineNumber:o.endLineNumber,endColumn:o.endColumn},text:t}])})),o.setSelections(l),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(t,n)=>{const o=t.getModel();let s=t.getSelections();return null==s&&(s=[t.getSelection()]),s.forEach((t=>{const n=o.findNextMatch("^(#+ )",{lineNumber:t.startLineNumber,column:1},!0,!1,null,!0);if(null!=n&&n.range.startLineNumber==t.startLineNumber&&1==n.range.startColumn){if(n.matches[1]==e)return;o.pushEditOperations([],[{range:{startLineNumber:t.startLineNumber,startColumn:1,endLineNumber:t.startLineNumber,endColumn:n.matches[1].length+1},text:""}])}o.pushEditOperations([],[{range:{startLineNumber:t.startLineNumber,startColumn:1,endLineNumber:t.startLineNumber,endColumn:1},text:e}])})),null}}}const qe={autoIndent:!0,lineNumbersMinChars:4,minimap:{enabled:!1},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,scrollBeyondLastLine:!1,formatOnType:!0};var Ke=l({emits:["event_callback"],components:{ToolbarEditor:Ve},props:{isActive_preview:{type:Boolean,default:!1}},setup(e,t){console.log("setup");const n=E(null),o={editor:void 0},{store_data:s}=ie(),a=i({iVersion:-1});$((()=>{console.log("[mounted]"),c()})),w((()=>s.state.ObjTag),((e,t)=>{console.log(`[watch](ObjTag)-${e}`),l(e)}));const l=e=>{console.log(`[jump_cursor]ObjTag={${Object.values(e)}}`);const t=e.line;d(t)},c=()=>{o.editor=(()=>{const e=document.getElementById("container");if(console.log(`root=${e}`),null==e)return;const t=N.create(e,qe),n=N.createModel("");return t.setModel(n),function(e,t){console.log("[setupShortcutKeys]");const n=new Je(e,t);n.add("Bold","8_",[],["**","**"]),n.add("Italic","1_",[],["__","__"]),n.add("Underline","9_",[],["<u>","</u>"]),n.add("Strikethrough",!1,[],["~~","~~"]),n.add("Code",!1,[],["`","`"]),n.add("Link",!1,[],["[","]()"]),n.add("Link-2",!1,[],["[](",")"]),n.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),n.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join("\n")]),n.add("Header 1",!1,[],["# ",""]),n.add("Header 2",!1,[],["## ",""]),n.add("Header 3",!1,[],["### ",""]),n.add("Header 4",!1,[],["#### ",""]),n.add("Header 5",!1,[],["##### ",""]),n.add("Header 6",!1,[],["###### ",""]),n.add("Check",!1,[],["- [ ] ",""]),n.add("Blockquotes",!1,[],["> ",""]),n.add("Today",!1,[],[`${(new Date).toLocaleString()}`,""]),n.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join("\n"),""]),n.add("Format","8_",[],[],(e=>{console.log("format"),e.getAction("editor.action.formatDocument").run()}))}(T,t),console.log(`editor=${t}`),t})()};w((()=>e.isActive_preview),((e,t)=>{console.log(`[watch](editor_toggle)-${e}`),1==e&&g()}));const r=e=>{console.log("[action]"),null!=Pe[e]&&Pe[e](o.editor,T)},d=e=>{const t=new I(e+1,0,e+1,0);console.log(`Line=${e}`),o.editor.revealRangeAtTop(t)},u=()=>o.editor.getModel().getAlternativeVersionId();w((()=>s.state.code),((e,t)=>{console.log("[watch-body]"),m(e),d(0)}));const m=e=>{console.log("[watch-body]"),o.editor.setValue(e),a.iVersion=u()},g=()=>{console.info("[save_content]");const e=u();if(console.info(`iVersion=${a.iVersion}, iVersion_cur=${e}`),a.iVersion==e)return;const t=o.editor.getValue();s.save_code(t),a.iVersion=u(),console.info(`iVersion=${a.iVersion}`)},h=L((()=>s.state.height+"px"));return{editorEx:o,event_callback:(e,t)=>{switch(console.log(`[event_callback] cmd=${e}`),e){case"action":r(t);break;case"save":g()}},HeightEx:h,md_editor_monaco:n}}});u("data-v-35c9eb92");const Ye={class:"editor"};m(),Ke.render=function(e,t,n,o,s,a){const i=c("ToolbarEditor");return d(),g("div",Ye,[p(i,{class:"toolbar",onEvent_callback:e.event_callback},null,8,["onEvent_callback"]),h("div",{id:"container",ref:"md_editor_monaco",class:"core",style:A({height:e.HeightEx})},null,4)])},Ke.__scopeId="data-v-35c9eb92";var We=l({components:{},setup(e,t){console.log("setup");const n=E(null),{store_data:o}=ie();i({fScroll:!1}),$((()=>{console.log("[created]"),function(){const e=new F.Renderer;e.link=function(e,t,n){return`<a target="_blank" href="${e}">${n}</a>`},F.setOptions({renderer:e,langPrefix:"",breaks:!0})}()})),w((()=>o.state.code),((e,t)=>{console.log("[watch-body]");n.value.scrollTop=0})),w((()=>o.state.ObjTag),((e,t)=>{console.log(`[watch](ObjTag)-${e}`),function(e){const t=(e,t)=>{console.log(`tag=${e}, num=${t}`);n.value.querySelectorAll(".md_core_viewer > h"+e)[t].scrollIntoView({})};console.log(`[jump_cursor]ObjTag={${Object.values(e)}}`);const o=e.tag,s=e.num;e.line,t(o,s)}(e)}));const s=L((()=>F(o.state.code))),a=L((()=>o.state.height+"px"));return{status:status,Markdown:s,HeightEx:a,md_viewer:n}}});u("data-v-44bdcb54");const ze=["innerHTML"];m(),We.render=function(e,t,n,o,s,a){return d(),g("div",{class:"md_core_viewer",innerHTML:e.Markdown,style:A({height:e.HeightEx}),ref:"md_viewer"},null,12,ze)},We.__scopeId="data-v-44bdcb54";var Ge=l({components:{MarkdownEditor:Ke,MarkdownViewer:We},props:{editor_toggle:{type:Boolean,default:!0}},setup(e,t){console.log("setup");const n=E(),o=E(),s=i({isActive_preview:!0}),a={viewer:"",editor:"none"};w((()=>e.editor_toggle),((e,t)=>{console.log(`[watch](editor_toggle)-${e}`),r()})),$((()=>{console.log("[mounted]"),document.addEventListener("keydown",l),c()})),R((()=>{document.removeEventListener("keydown",l)}));const l=e=>83===e.keyCode&&e.ctrlKey?(e.preventDefault(),console.log("save"),void r()):69===e.keyCode&&e.ctrlKey?(e.preventDefault(),console.log("toggle"),void r()):void 0,c=()=>{n.value.$el,o.value.$el},r=()=>{let e=s.isActive_preview;var t;console.log(`(before)isActive_preview=${e}`),t=!e,a.viewer=t?"":"none",a.editor=t?"none":"",e=t,console.log(`(after)isActive_preview=${e}`),s.isActive_preview=e};return{state:s,MdViewer:n,MdEditor:o,visibleEx:a}}});Ge.render=function(e,t,n,o,s,a){const i=c("MarkdownEditor"),l=c("MarkdownViewer");return d(),g("div",null,[p(i,{class:"md_editor",ref:"MdEditor",style:A({display:e.visibleEx.editor}),isActive_preview:e.state.isActive_preview},null,8,["style","isActive_preview"]),p(l,{class:"md_viewer",ref:"MdViewer",style:A({display:e.visibleEx.viewer}),isActive_preview:e.state.isActive_preview},null,8,["style","isActive_preview"])])};var Qe=l({emits:["event_callback"],setup(e,t){console.log("setup");const{store_dlg:n}=re(),{store_data:o}=ie(),s=i({cmd:"",filename:"",filename_org:"",commit:"",title:"",isFileOpen:!1,isInput:!1,isReadOnly:!1,isShowDlg:!1,isDisabled:!0});w((()=>n.state.objParam),(e=>{a(e)}));const a=e=>{console.log("[watch-objParam]"),s.cmd=e.cmd,s.filename=e.filename,s.filename_org=e.filename,s.commit=e.commit,s.title=e.title,s.isFileOpen=e.isFileOpen,s.isInput=e.isInput,s.isReadOnly=e.isReadOnly,s.isShowDlg=!0,s.isDisabled=!0};return{state:s,props:e,doAction:e=>{console.log(`[doAction] flg=${e}, filename=${s.filename}, commit=${s.commit}`),e&&(t.emit("event_callback",s.commit,s.filename),o.do_cmd(s.commit,s.filename)),s.isShowDlg=!1},onFileChange:e=>{const t=(e.target.files||e.dataTransfer.files)[0];o.do_cmd(s.commit,t),s.isShowDlg=!1},isDisabled:()=>{const e=s.filename_org,t=s.filename==e&&!s.isReadOnly;return console.log(`[isDisabled]=${t}`),t}}}});u("data-v-270e9555");const Xe={class:"modal-mask"},Ze={class:"modal-wrapper"},et={class:"modal-container"},tt={class:"header"},nt={ref:"form",_model:"state.isForm",class:"form"},ot=["pattern"],st={class:"modal-actions"},at=["disabled"];m(),Qe.render=function(e,t,n,o,s,a){const i=c("fa");return k((d(),r(B,{persistent:""},{default:S((()=>[h("div",Xe,[h("div",Ze,[h("div",et,[h("div",tt,[h("span",null,f(e.state.title)+"filename?",1)]),h("form",nt,[1==e.state.isFileOpen?(d(),g("input",{key:0,class:"input p-2 m-2 bg-yellow-500",type:"file",onChange:t[0]||(t[0]=(...t)=>e.onFileChange&&e.onFileChange(...t))},null,32)):v("",!0),1==e.state.isInput?k((d(),g("input",{key:1,class:"input",type:"text","onUpdate:modelValue":t[1]||(t[1]=t=>e.state.filename=t),pattern:[()=>!!e.state.filename],required:""},null,8,ot)),[[y,e.state.filename]]):v("",!0)],512),h("div",st,[h("button",{class:"btn btn-can",onClick:t[2]||(t[2]=t=>e.doAction(!1))}," cancel "),h("button",{class:"btn btn-ok",ref:"ok",disabled:e.isDisabled(),onClick:t[3]||(t[3]=t=>e.doAction(!0))},[p(i,{icon:"check"}),C(" "+f(e.state.title),1)],8,at)])])])])])),_:1},512)),[[O,e.state.isShowDlg]])},Qe.__scopeId="data-v-270e9555";var it=l({components:{Appbar:$e,PreviewMd:Ge,ListFile:Te,ListTag:Fe,CmnDlg:Qe},setup(e,t){console.log("setup");const{store_data:n}=ie();re();const o={snackbar:!1,message:"",timeout:-1,color:"green",actions:()=>{console.log("sb_actions")}},s=i({editor_toggle:!1,height:window.innerHeight-50,objDlgCmn:void 0,objDlgConf:void 0,snackbar_ex:o});$((()=>{console.log("[mounted]"),a(),window.addEventListener("resize",l),document.body.style.overflow="hidden"})),R((()=>{console.log("unmounted!"),window.removeEventListener("resize",l)}));const a=()=>{console.log("init"),n.query_menu(),l()},l=()=>{const e=window.innerHeight-45;console.log(`height=${e}`),n.update_height(e)};return{state:s,event_callback:async(e,n)=>{switch(console.log(`[event_callback] cmd=${e}`),e){case"toggle_editor":s.editor_toggle=!s.editor_toggle;break;case"openSnackbar":case"onClick_snackbar":break;case"config":s.objDlgConf={cmd:e,filename:"",commit:""};break;case"print":break;default:t.emit("event_callback",e,!0)}}}}});u("data-v-5117a389");const lt={class:"container"},ct={class:"main"};m(),it.render=function(e,t,n,o,s,a){const i=c("Appbar"),l=c("CmnDlg"),r=c("ListTag"),u=c("PreviewMd"),m=c("ListFile");return d(),g("div",lt,[p(i,{ref:"appbar",onEvent_callback:e.event_callback},null,8,["onEvent_callback"]),p(l,{objParam:e.state.objDlgCmn,onEvent_callback:e.event_callback},null,8,["objParam","onEvent_callback"]),h("div",ct,[p(r,{class:"col-1",onEvent_callback:e.event_callback,style:A({height:e.state.height+"px"})},null,8,["onEvent_callback","style"]),p(u,{class:"col-2",ref:"pane",editor_toggle:e.state.editor_toggle,style:A({height:e.state.height+"px"})},null,8,["editor_toggle","style"]),p(m,{class:"col-3",onEvent_callback:e.event_callback,style:A({height:e.state.height+"px"})},null,8,["onEvent_callback","style"])])])},it.__scopeId="data-v-5117a389";const rt=[{name:"home",path:"/",component:it},{name:"viewer",path:"/viewer",component:it}],dt=V({history:H(),routes:rt});!function(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:s,onRegisterError:a}=e;let i;"serviceWorker"in navigator&&(i=new U("./sw.js",{scope:"./"}),i.addEventListener("activated",(e=>{e.isUpdate?window.location.reload():null==o||o()})),i.register({immediate:t}).then((e=>{null==s||s(e)})).catch((e=>{null==a||a(e)})))}(),P.add(J),q(de).use(dt).component("fa",K).mount("#app");
