var fn=Object.defineProperty;var _n=(n,e,t)=>e in n?fn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ee=(n,e,t)=>(_n(n,typeof e!="symbol"?e+"":e,t),t);import{D as vn,a as lt,i as Et,p as Ct,u as St,b as Ze,r as N,d as j,c as re,e as V,o as v,f as w,g as _,h as C,j as me,t as H,k as X,F as U,l as te,w as De,m as A,n as Q,q as x,s as S,v as Z,x as bn,y as yn,z as P,A as Le,T as wn,B as ne,C as kn,E as xn,G as $n,H as ct,R as En,I as je,J as Pe,K as Cn,L as Sn,M as Mn,N as Dn,O as se,P as Tn,Q as Bn,S as On,U as Ln,V as jn,W as Mt,X as be,Y as Nn,Z as An,_ as Dt,$ as Fn,a0 as Rn,a1 as In,a2 as Tt,a3 as Pn,a4 as zn,a5 as _e,a6 as Bt,a7 as Vn,a8 as rt,a9 as Hn,aa as Kn,ab as Jn,ac as Un,ad as Yn,ae as qn,af as Gn,ag as Wn,ah as Xn,ai as Zn}from"./vendor.b57efba5.js";var R=Object.freeze(Object.defineProperty({__proto__:null,get svg(){return It},get g(){return et},get asstSvg(){return Pt},get foreign(){return zt}},Symbol.toStringTag,{value:"Module"}));const Qn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};Qn();class ee{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(e,t="",o=[],s=!1){t!=""&&(this.path=t),o!=[]&&(this.tags=o),this.content=e;const i=this.get_time();this.atime=i,s==!0&&(this.ctime=i)}set_default(e){this.path=e,this.content="",this.tags=[];const t=this.get_time();this.atime=t,this.ctime=t}copy(e){Object.assign(this,e)}duplicate(e,t=""){const o=new ee;return o.copy(this),o.content=e,o.path=t,o.update_time(),o.update_tag(),o}update_content2(e){this.content=e}update_time(){console.log(`update_time path=${this.path}`),this.atime=this.get_time()}update_tag(){return this.tags=this.build_tag(this.content),this.tags}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const t=o=>`00${o}`.slice(-2);return`${e.getFullYear()}/${t(e.getMonth()+1)}/${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`}update_time_all(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){const t=[],o=[0,0,0,0,0],s=e.split(/\r\n|\n|\r/);for(let i=0;i<s.length;i++)if(s[i].search(/^\s*#/)!=-1){const l=s[i].split(" "),c=l[0].length;l.shift();const d=l.join(" ");t.push({text:d,line:i,tag:c,num:o[c]}),o[c]++}return t}split(e){const t=[],o=this.content.split(/\r\n|\n|\r/),s=this.tags.filter(function(d){return d.tag==e}),i=[],a=o.length;for(var l=0;l<s.length;l++){const d=s[l].line;i.push({start:d,end:a,title:s[l].text}),l!=0&&(i[l-1].end=d-1)}const c=this.path.replace(".","_");return i.reverse(),i.forEach(d=>{const p=o.splice(d.start,d.end).join(`\r
`),h=this.duplicate(p,`${c}/${d.title}`);t.push(h)}),t.reverse(),t}}class eo extends vn{constructor(){super("OdenDB");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class to{constructor(e){this.db=new eo,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async t=>{const o=await this.dbx.get(t);return o!=null?o.data:null},this.write=async(t,o)=>{const s=JSON.stringify(o);await this.dbx.put({key:t,data:s,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async t=>{console.log(`delete key=${t}`),await this.dbx.delete(t),this.set_time_DB()},this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(o=>{e[o.key]=o.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class no{constructor(e){this.ctime="",this.atime="",this.read=async t=>{const o=new URLSearchParams;o.append("filename",t);const s=await this.post_cmdEx("load_file_md",o);return s!=null?s.data:null},this.write=async(t,o)=>{const s=new URLSearchParams;return s.append("filename",t),s.append("source",JSON.stringify(o)),console.dir(s),this.post_cmdEx("save",s)},this.get_cmdEx=async t=>{const o="http://localhost:5000/api_oden/"+t;return console.log(`[store_RST:get_cmdEx] api=${o}`),lt.get(o).then(s=>s.data).catch(s=>{throw s.response.status})},this.post_cmdEx=async(t,o)=>{const s="http://localhost:5000/api_oden/"+t;return console.log(`[store_RST:post_cmdEx] api=${s}`),console.dir(o),lt.post(s,o).then(i=>(console.log("response.data = ",i.data),i.data)).catch(i=>(console.log("Error = ",i.response),i.response))},this.caller=e}}class oo{constructor(e){this.write=(t,o,s=!0)=>{this.storeDB.write(t,o),s&&this.storeRST.write(t,o)},this.delete=t=>{this.storeDB.delete(t)},this.rename=async(t,o,s)=>{console.log(`[rename] _key_org=${t}, _key_new=${o}`);const i=this.as(await this.get(t));return i.path=o,await this.write(o,i),s&&await this.delete(t),i},this.split=async t=>{console.log(`[split] _key_org=${t}`);const s=this.as(await this.get(t)).split(1);return s.forEach(i=>{this.write(i.path,i)}),s},this.merge=(t,o)=>{console.log(`[merge] _path=${t}`);const s=new ee;return s.set_default(t),s.update_content2(o),s.update_time(),s.update_tag(),this.write(t,s),s},this.as=t=>Object.assign(new ee,t),this.sync_DB=()=>this.storeDB.sync_DB(),this._=e,this.storeDB=new to(this._),this.storeRST=new no(this._)}async get(e){console.log(`[get] _key=${e}`);const t=await this.read(e);return t!=null?JSON.parse(t):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,t){console.log(`[set] _key=${e}`);const o=this.as(await this.get(e));return o.path==""&&(o.path=e),o.update_content2(t),o.update_time(),o.update_tag(),this.write(e,o),o}async set_ex(e,t,o){console.log(`[set_ex] _key=${e}`);const s=this.as(t);return t.path==""&&(t.path=e),o!=null&&o.hasOwnProperty("no_upate_time")||s.update_time(),s.update_tag(),this.write(e,s),s}async read(e){return await this.storeDB.read(e)}create(e){console.log(`[create] _key=${e}`);const t=new ee;return e!=null&&(t.set_default(e),this.write(e,t)),t}}const ze="menu.json";class so{constructor(e){this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const t=await this._.mgrCache.getLstContent(e),o=this.buildMenu(t);return console.log(`${t.length}/${o.length}`),this._.contentEx.set(ze,JSON.stringify(o)),o}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const t=await this._.contentEx.get(ze);return JSON.parse(t.content)}}buildMenu(e){function t(s){const i=new Set;return s.forEach(a=>{i.add(a.group)}),[...i]}function o(s){console.log("storeEx_index:buildMenuEx");const i=t(s);return s.reduce((a,l)=>{if(l.path==ze)return a;let c=l.group,d=l.title,r=`${c}/${d}`;return i.includes(r)&&(c=r,d=".index",r=`${c}/${d}`),a.push({key:r,group:c,title:d,path:l.path,atime:l.atime}),a},[])}return o(e).sort(this.compare_group)}compare_group(e,t){let o=e.group,s=t.group;o==s&&(o=`${e.group}/${e.title}`,s=`${t.group}/${t.title}`);const i=o.toUpperCase(),a=s.toUpperCase();let l=0;return i>a?l=1:i<a&&(l=-1),l}}class io{constructor(e){this.backupEx=(t,o,s)=>{const i=(l=!0)=>{const c=new URLSearchParams;c.append("lstContent",JSON.stringify(t)),c.append("is_divide",JSON.stringify(l)),this.storeRST.post_cmdEx("backup",c).then(d=>console.log(d)).catch(d=>console.log(d))},a=()=>{const l=new Blob([JSON.stringify(t)],{type:"text/plain"}),c=(r,p)=>{const h=new Date,u=m=>`00${m}`.slice(-2);return`${r}_${h.getFullYear()}${u(h.getMonth()+1)}${u(h.getDate())}_${u(h.getHours())}.${p}`},d=document.createElement("a");d.download=c("lstData","json"),d.href=URL.createObjectURL(l),d.click(),URL.revokeObjectURL(d.href)};switch(console.log(`[backup] mode=${o}`),o){case"backup":i();break;case"backupEx":i(!1);break;case"export":a();break}},this.restoreEx=async(t,o,s)=>{const i=d=>{d.forEach(r=>{const p=new ee;p.copy(r),p.update_tag(),c.write(p.path,p,!1)})},a=async(d,r,p=!0)=>{this.storeRST.get_cmdEx(p?"restore":"restore_ex").then(h=>{i(h),d(h)}).catch(h=>{console.log(h),r(null)})},l=async(d,r,p)=>{const h=new FileReader;h.onload=()=>{var y;console.log("onload");const u=(y=h.result)!=null?y:"",m=JSON.parse(u);i(m),r(m)},h.onerror=u=>{p("error")},h.readAsText(d)};console.log("[importExport:restore]");const c=this._.contentEx;return new Promise(function(d,r){switch(t){case"restore":a(d,r);break;case"restoreEx":a(d,r,!1);break;case"import":l(o,d,r);break}})},this._=e,this.storeRST=e.contentEx.storeRST}}class ao{constructor(e){this.journal2=async(t,o)=>{const s=(a,l)=>`
## ${this._.contentEx.as(a).cnv_time(o)}
${l}
`;console.log("[journal]");const i=await this.geolocation();return t.content+=s(t,i),t},this.geolocation=()=>new Promise(t=>{let o="";navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{o=`(Latitude,longitude)=(${s.coords.latitude},${s.coords.longitude})
`,t(o)},s=>{switch(s.code){case 1:o="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:o="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:o="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}t(o)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),t(o))}),this.chat=async(t,o,s)=>{const i=m=>["sun","mon","tue","wed","thu","fri","sat"][m],a=m=>{const y=G=>`00${G}`.slice(-2),$=`${m.getFullYear()}/${y(m.getMonth()+1)}/${y(m.getDate())}(${i(m.getDay())})`,T=`${y(m.getHours())}:${y(m.getMinutes())}`;return[$,T]},l=(m,y)=>m!==y?`
## ${y}
`:"",c=m=>{const y=s.isNoList?"":"- ",$=s.isAddTime?`${m} : `:"";return`${y}${$}${o}
${h}`};console.log("[chat]");const d=t.content.indexOf(`
`),[r,p]=a(new Date),h=s.isAddGeo?await this.geolocation()+`
`:"",u=l(t.content.substring(0,d),r)+c(p);return t.content=`${r}${t.content.substring(d)}${u}`,t},this._=e}async path_rename(e,t,o){console.log(`_from=${e}, _to=${t}`);const s=this.collect_filename_by_group(e,o);for(let i=0;i<s.length;i++){const a=s[i],l=`${a[1]}/${a[0]}`,c=`${t}${a[2]}/${a[0]}`;await this._.contentEx.rename(l,c)}}async path_delete(e,t){console.log(`_path=${e}`);const o=this.collect_filename_by_group(e,t);for(let s=0;s<o.length;s++){const i=o[s],a=`${i[1]}/${i[0]}`;await this._.contentEx.delete(a)}}async path_merge(e,t,o){console.log(`_path=${e}`);const s=[],i=this.collect_filename_by_group(e,o);for(let l=0;l<i.length;l++){const c=i[l],d=`${c[1]}/${c[0]}`,r=await this._.contentEx.get(d);s.push(r.content)}const a=s.join(`\r
`);return this._.contentEx.merge(t,a)}collect_filename_by_group(e,t){console.log(`[collect_filename_by_group] pat=${e}`);const o=[],s=e.length!=0?1:0;return t.forEach((i,a)=>{if(i.group==e){const l=i.group.substring(e.length+s);o.push([i.title,i.group,l.length!=0?`/${l}`:""])}}),o}}class lo{constructor(e){this._=e}async getLstContent(e){console.log("[getLstContent]");const t=i=>{const a=e.path==""?!0:i.path.indexOf(e.path)!=-1,l=e.keyword==""?!0:i.content.toLowerCase().indexOf(e.keyword)!=-1;return a&&l},o=await this.buildLstContent();return e!=null?o.filter(t):o}async buildLstContent(){var i;console.log("[buildLstContent]");const e=a=>{var d,r;let l=a.path;(l==""||l==null)&&(l=`@test/${new Date().toLocaleString()}`,a.path=l);const c=l.split("/");return a.title=(d=c.pop())!=null?d:".",a.group=(r=c.join("/"))!=null?r:"@test",a.tags=[],a.htags=[],a},t=await this._.contentEx.storeDB.getStrageEx(),o=[],s=a=>t[a];for(const a of Object.keys(t))try{o.push(e(JSON.parse((i=s(a))!=null?i:"")))}catch(l){console.log(`@ error key=${a},e=${l} - other error`)}return o}}class co{constructor(){this.contentEx=new oo(this),this.mgrExchange=new io(this),this.mgrEtc=new ao(this),this.mgrMenu=new so(this),this.mgrCache=new lo(this),console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,t){return this.contentEx.set(e,t)}async cmd_save_ex(e,t,o){return this.contentEx.set_ex(e,t,o)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_copy(e,t){await this.contentEx.rename(e,t,!1)}async cmd_rename(e,t,o){await this.contentEx.rename(e,t,o)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,t="",o=null){const s=await this.mgrCache.getLstContent(o);this.mgrExchange.backupEx(s,e,t)}async cmd_restoreEx(e,t,o=""){await this.mgrExchange.restoreEx(e,t,o)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,t,o)}async cmd_path_delete(e){const t=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,t)}async cmd_path_merge(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,t,o)}async cmd_chat(e,t,o){const i=(()=>{const c=new Date;return`${e}${o.mode}_${c.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${i}`);const a=await this.contentEx.get(i),l=await this.mgrEtc.chat(a,t,o);return await this.contentEx.set(i,l.content),[l,i]}}class ro{constructor(e){this.KEY="",console.log(e),this.KEY=e}get(e){var t;if(localStorage.getItem(this.KEY)!=null){const o=JSON.parse((t=localStorage.getItem(this.KEY))!=null?t:"");e(o),console.log(o)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const uo=1e3*60*10,Ot=Symbol(),po=()=>{const n=St(),e=Ze(),t=N({storeEx:new co,persisted:new ro("lifeLog-Viewer-params"),filename:"",obj:new ee,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null,mode:0,config:{}}),o=async()=>{const g="_sys_/config.md",f=await t.storeEx.cmd_load(g);t.config=JSON.parse(f.content)},s=g=>{console.log(`[update_filename] : new=${g}`),i(g)},i=async g=>{const f=E=>{const O=`/?${E}`;console.log(`route.path:${e.path}`),e.path!=O&&(console.log(`set route:${O}`),n.push(O))};if(console.log(`[load_obj] : new=${g}`),g!=""){t.mode=g.indexOf(".mm")!=-1?1:0;const E=await t.storeEx.cmd_load(g);d(E)}else d(r(""));t.filename=g,t.persisted.set({filename:g}),f(g)},a=()=>{console.log("restore_filename"),t.persisted.get(g=>{s(g.filename)})},l=async g=>{if(g==""){console.log("skip save - empty data");return}r(g,{update_time:!0,update:!0}),await t.storeEx.cmd_save_ex(t.filename,t.obj),u()},c=()=>{console.log("[auto_save] start"),t.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(t.intervalId_autoSave)),t.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await k("backupEx",null,null),t.intervalId_autoSave=null},uo)},d=(g,f)=>{const E=g instanceof ee?g:Object.assign(new ee,g);f!=null&&f.hasOwnProperty("update_time")&&E.update_time(),t.tags=E.update_tag(),t.obj=E},r=(g,f)=>(t.obj.content=g,f!=null&&f.hasOwnProperty("update_time")&&t.obj.update_time(),t.tags=t.obj.update_tag(),t.obj),p=async(g,f)=>{if(console.log(g),f!=null){const E=await t.storeEx.cmd_load(f);E.position=g,await t.storeEx.cmd_save_ex(f,E,{no_upate_time:!0})}else t.obj.position=g},h=g=>{t.dictMenu=g},u=()=>{setTimeout(async()=>{h(await t.storeEx.cmd_rebuild()),c()},250)},m=g=>{t.jump=g,g!=-1&&(console.log(`jump=${g}`),t.ObjTag=JSON.parse(JSON.stringify(t.tags[g])),console.log(JSON.stringify(t.ObjTag)))},y=g=>{t.height=g},$=async(g,f)=>{const[E,O]=await t.storeEx.cmd_chat(t.path_expand,g,f);d(E,{update_time:!0}),s(O),u()},T=async(g,f)=>{const E=await t.storeEx.cmd_exist(g);if(f==E)return!0;{const O=f?`error : ${g} is not exist. please enter exist filename.`:`error : ${g} is already exist. please enter other filename.`;return console.log(O),!1}},G=async(g,f,E=!0)=>{await T(g,!1)&&(s(""),await t.storeEx.cmd_rename(f,g,E),s(g),u())},ae=async(g,f)=>{const E=B(f)[0],O=B(g)[0];s(""),await t.storeEx.cmd_path_rename(E,O),u()},k=async(g,f,E)=>{console.log(`[do_cmd] mode=${g}`);let O=f!=""?f:t.filename,fe="",$e;switch(g){case"update_jump":m(f);break;case"rebuild_menu":u();break;case"filter_menu":const Ie=f;f!=null&&(Ie.path=Ie.isUnderFolder?B(t.filename)[0]:""),h(await t.storeEx.cmd_getMenu(Ie));break;case"open_file":s(f);break;case"restore_file":a();break;case"save_file":await l(f);break;case"new":await T(f,!1)&&(await t.storeEx.cmd_create(f),s(f),u());break;case"delete":await T(O,!0)&&(s(""),await t.storeEx.cmd_delete(O),u());break;case"rename":G(f,E);break;case"copy":G(f,E,!1);break;case"backup":t.storeEx.cmd_backup("backup");break;case"backupEx":t.storeEx.cmd_backup("backupEx");break;case"export":t.storeEx.cmd_backup("export");break;case"restore":await t.storeEx.cmd_restoreEx("restore",null),u();break;case"restoreEx":await t.storeEx.cmd_restoreEx("restoreEx",null),u();break;case"import":await t.storeEx.cmd_restoreEx("import",f),u();break;case"split":await T(O,!0)&&(await t.storeEx.cmd_split(O),u());break;case"path_rename":ae(f,E);break;case"path_delete":fe=B(f)[0],await t.storeEx.cmd_path_delete(fe),s(""),u();break;case"path_merge":fe=B(f)[0],O=`${fe}.md`,await T(O,!1)&&(await t.storeEx.cmd_path_merge(fe,O),s(O),u());break;case"print":const gn=n.resolve({path:`/print/${t.filename}`});window.open(gn.href,"_blank");break;case"journal":$("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":$(f,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":$(f,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":$e={keyword:E.filter.toLowerCase(),isUnderFolder:E.isCheck,path:""},h(await t.storeEx.cmd_getMenu($e));break;case"update_position":await p(f,E);break;case"move_archive":G(`@archive/${f}`,f);break;case"move_path_archive":ae(`@archive/${f}`,f);break;case"export_archive":$e={keyword:"",isUnderFolder:!0,path:"@archive/"},t.storeEx.cmd_backup("export","",$e);break;case"load_config":console.log("@"),o();break}},B=g=>{const f=g.split("/"),E=f[f.length-1];return[f.slice(0,-1).join("/"),E]};return{store_data:{state:t,update_height:y,do_cmd:k}}},ho=()=>{Ct(Ot,po())},q=()=>Et(Ot),mo=()=>{const n=N({objParam:null});return{store_dlg:{state:n,update_param:t=>{n.objParam=t}}}},Lt=Symbol(),go=()=>{Ct(Lt,mo())},Ne=()=>Et(Lt);const fo=j({setup(n){return ho(),go(),(e,t)=>{const o=V("routerView");return v(),re(o)}}});var F=(n,e)=>{const t=n.__vccOpts||n;for(const[o,s]of e)t[o]=s;return t};const _o={key:0},vo={key:1,class:"line"},bo={key:2,class:"dropdown"},yo=j({props:{item:null},emits:["event_callback"],setup(n,{emit:e}){const t=n,o=N({isOpen:!1,item:t.item,isFolder:t.item.children&&t.item.children.length,isActive:!0}),s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const l=a.cmd;s(l,null)}};return(a,l)=>{const c=V("fa"),d=V("MenuTreeItem",!0);return v(),w("div",{class:"menu_tree",onClick:l[0]||(l[0]=r=>i(_(o).item)),onContextmenu:l[1]||(l[1]=De(()=>{},["right","prevent"]))},[_(o).item.title!=""?(v(),w("div",_o,[C(c,{icon:_(o).item.icon},null,8,["icon"]),me(" "+H(_(o).item.title),1)])):X("",!0),_(o).item.title==""?(v(),w("div",vo)):X("",!0),_(o).isFolder?(v(),w("div",bo,[(v(!0),w(U,null,te(_(o).item.children,(r,p)=>(v(),w("div",{key:p},[C(d,{item:r,onEvent_callback:s},null,8,["item"])]))),128))])):X("",!0)],32)}}});var wo=F(yo,[["__scopeId","data-v-69f3eeaa"]]);const ko=j({props:{mouse:null,items:null},emits:["event_callback"],setup(n,{emit:e}){const t=n,o=N({items:t.items,pos_x:-1,pos_y:-1,style:"display:none"});A(()=>t.mouse,(a,l)=>{console.log("props"),o.pos_x=t.mouse.clientX,o.pos_y=t.mouse.clientY,o.items=t.items,o.style="display:block"});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{o.style=a?"display:block":"display:none"};return(a,l)=>(v(),w("div",{class:"menu",style:Q(_(o).style),onMouseover:l[0]||(l[0]=c=>i(!0)),onMouseleave:l[1]||(l[1]=c=>i(!1))},[(v(!0),w(U,null,te(_(o).items,c=>(v(),w("div",{key:c.path},[C(wo,{item:c,onEvent_callback:s},null,8,["item"])]))),128))],36))}});var jt=F(ko,[["__scopeId","data-v-62ad7429"]]);const xo=j({props:{objMenu:null},emits:["event_callback"],setup(n,{emit:e}){const o=N({items:n.objMenu,event:void 0,style:"display:none"}),s=(l,c)=>{console.log(`[event_callback] cmd=${l}`),e("event_callback",l,c)},i=l=>{console.log("onClick"),o.event=l},a=l=>{o.style=l?"display:block":"display:none"};return(l,c)=>{const d=V("fa");return v(),w("div",{class:"dropdown",onClick:i,onMouseover:c[0]||(c[0]=r=>a(!0)),onMouseleave:c[1]||(c[1]=r=>a(!1))},[C(d,{icon:"bars"}),C(jt,{class:"menu",mouse:_(o).event,items:_(o).items,onEvent_callback:s,style:Q(_(o).style)},null,8,["mouse","items","style"])],32)}}});var $o=F(xo,[["__scopeId","data-v-1a158634"]]);const Eo={key:0,class:"dropdown"},Co=["onClick"],So={class:"title_sub2"},Mo={class:"title"},Do={class:"title_sub"},To=j({props:{objMenuItem:null},emits:["event_callback"],setup(n,{emit:e}){const t=n,o=N({items:[],items2:[],isShowDlg:!1});A(()=>t.objMenuItem,(l,c)=>{o.items=s(l),o.items2=o.items.slice(0,5)});const s=l=>{console.log("[cnvLstRecent]");function c(r,p){const h=r.atime,u=p.atime;let m=0;return h>u?m=-1:h<u&&(m=1),m}const d=[...l];return d.sort(c),d.slice(0,15)},i=l=>{const c=o.items[l].path;e("event_callback","open_file",c),o.isShowDlg=!1},a=l=>{o.isShowDlg=l};return(l,c)=>{const d=V("fa");return v(),w("span",{onMouseover:c[0]||(c[0]=r=>a(!0)),onMouseleave:c[1]||(c[1]=r=>a(!1))},[C(d,{icon:"history"}),_(o).isShowDlg?(v(),w("ul",Eo,[(v(!0),w(U,null,te(_(o).items,(r,p)=>(v(),w("li",{class:"item",key:p,onClick:h=>i(p)},[C(d,{class:"title_item",icon:"file-alt"}),x("span",So,H(r.group)+"/",1),x("span",Mo,H(r.title),1),x("span",Do,"["+H(r.atime)+"]",1)],8,Co))),128))])):X("",!0)],32)}}});var Bo=F(To,[["__scopeId","data-v-b83f6c68"]]);const Oo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"backup(json)",cmd:"backupEx",icon:"cloud-upload-alt",children:[]},{title:"restore(json)",cmd:"restoreEx",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],Lo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"copy",cmd:"dlg_copy",icon:"copy",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],jo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],No={dlg_import:{init:(n,e)=>{n.title="Restore",n.isFileOpen=!0,n.isNoEdit=!0,n.edit=""},action:n=>["import"]},dlg_delete:{init:(n,e)=>{n.title="Delete",n.isReadOnly=!0,n.edit=e},action:n=>["delete",n.edit,""]},dlg_rename:{init:(n,e)=>{n.title="Rename",n.edit=e},action:n=>["rename",n.edit,n.edit_org]},dlg_new:{init:(n,e)=>{n.title="Create",n.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:n=>["new",n.edit,""]},dlg_copy:{init:(n,e)=>{n.title="Copy",n.edit=e},action:n=>["copy",n.edit,n.edit_org]},dlg_path_rename:{init:(n,e)=>{n.title="Rename of Path",n.edit=e.split("/").slice(0,-1).join("/")+"/"},action:n=>["path_rename",n.edit,n.edit_org]},dlg_path_delete:{init:(n,e)=>{n.title="Delete of Path",n.isReadOnly=!0,n.edit=e.split("/").slice(0,-1).join("/")+"/"},action:n=>["path_delete",n.edit,""]},dlg_path_merge:{init:(n,e)=>{n.title="Merge of Path",n.isReadOnly=!0,n.edit=e.split("/").slice(0,-1).join("/")+"/"},action:n=>["path_merge",n.edit,""]},dlg_tweet:{init:(n,e)=>{n.title="Tweet",n.edit=""},action:n=>["tweet",n.edit,""]},dlg_bookmark:{init:(n,e)=>{n.title="Bookmark",n.edit="",n.isMulti=!0},action:n=>["bookmark",n.edit,""]},dlg_filter:{init:(n,e)=>{n.title="Filter",n.title2="target under folder",n.edit="",n.edit_org="@",n.isCheck=!0},action:n=>(console.log("dlg_filter"),["filter",n.filename,{filter:n.edit,isCheck:n.check}])}};const Ao=n=>(bn("data-v-43a1c564"),n=n(),yn(),n),Fo={class:"nav"},Ro=["title"],Io={class:"form"},Po={class:"cmd"},zo=Ao(()=>x("span",{class:"item"},null,-1)),Vo=j({emits:["event_callback"],setup(n,{emit:e}){const{store_data:t}=q();Ne();const o=S(null),s=S(null),i=N({filename:"@",objMenu:Oo,dctMenu:[]}),a=(r,p)=>{if(console.log(`[event_callback] cmd=${r}`),r!="top")if(r=="cmd"){const h=s.value,u=h.getAttribute("url"),m=h.getAttribute("cmd");console.log(`url=${u}`),console.log(`cmd=${m}`),m=="add_bookmark"&&a("bookmark",u)}else e("event_callback",r,p)};Z(()=>{console.log("[mounted]")});const l=r=>{console.log(`[doAction] cmd=${r}`),e("event_callback",r,!0)};A(()=>t.state.filename,(r,p)=>{console.log(`[watch:filename] ${r}`),d(r)}),A(()=>t.state.dictMenu,(r,p)=>{i.dctMenu=r}),A(()=>t.state.jump,(r,p)=>{window.setTimeout(()=>{c()},500)});const c=()=>{o.value.scrollIntoView({})},d=r=>{console.log(`[onChanged_filename] new=${r}`),i.filename=r,c()};return(r,p)=>{const h=V("fa");return v(),w("header",{class:"appbar",ref_key:"appbar",ref:o,_click:"event_callback('top', true)"},[x("nav",Fo,[C($o,{class:"item",objMenu:_(i).objMenu,onEvent_callback:a,title:"menu"},null,8,["objMenu"]),x("section",{class:"item logo",onClick:p[0]||(p[0]=u=>a("filelist",!0)),title:_(i).filename},"Oden",8,Ro),C(Bo,{class:"item",objMenuItem:_(i).dctMenu,onEvent_callback:a,title:"history"},null,8,["objMenuItem"]),_(i).filename!==""?(v(),w("span",{key:0,class:"item name",onClick:p[1]||(p[1]=u=>a("dlg_rename",null))},"["+H(_(i).filename)+"]",1)):X("",!0),x("span",{class:"item mark",onClick:p[2]||(p[2]=u=>l("toggle_editor")),title:"editor/viewer"},[C(h,{icon:"edit"})]),x("form",Io,[x("span",{class:"item",id:"api_do",url:"",cmd:"",onClick:p[3]||(p[3]=u=>a("cmd")),ref_key:"api",ref:s,style:{visibility:"hidden"}},"cmd",512)])]),x("span",Po,[x("span",{class:"item",onClick:p[4]||(p[4]=u=>l("dlg_filter")),title:"filter"},[C(h,{icon:"paw"})]),x("span",{class:"item",onClick:p[5]||(p[5]=u=>l("dlg_tweet")),title:"tweet"},[C(h,{icon:"grimace"})]),x("span",{class:"item",onClick:p[6]||(p[6]=u=>l("dlg_bookmark")),title:"bookmark"},[C(h,{icon:"bookmark"})]),zo])],512)}}});var Ho=F(Vo,[["__scopeId","data-v-43a1c564"]]);const Ko=["title","onContextmenu","onDblclick"],Jo={key:0},Uo=j({props:{item:null},emits:["event_callback"],setup(n,{emit:e}){const t=n,o=N({isOpen:!1,item:t.item,isFolder:t.item.children&&t.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:s}=q();A(()=>s.state.filename,(h,u)=>{d(h)});const i=(h,u)=>{console.log(`[event_callback] cmd=${h}`),e("event_callback",h,u)},a=(h,u)=>{console.log(`[event_callbackEx] cmd=${h}`),e("event_callback",h,o.item.path)};Z(()=>{d(s.state.filename)});const l=h=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const u=h.path;console.log(`onClick-filename=${u}`),s.do_cmd("open_file",u)}},c=h=>{console.log("onClickEx"),o.menu=o.isFolder?jo:Lo,o.event=h},d=h=>{o.item.path==h,h.indexOf(o.item.name)!=-1&&(o.isOpen=!0),o.class_item=o.item.path==h?"item active":"item"},r=()=>o.isFolder?"folder":o.class_item,p=()=>o.isFolder?o.isOpen?"folder-open":"folder":o.item.file=="mm"?"pen":"file";return(h,u)=>{const m=V("fa"),y=V("tree-item",!0);return v(),w("div",{class:"file_tree",onContextmenu:u[1]||(u[1]=De(()=>{},["prevent"]))},[C(jt,{mouse:_(o).event,items:_(o).menu,onEvent_callback:a},null,8,["mouse","items"]),x("div",{class:P(r()),title:_(o).item.time,onClick:u[0]||(u[0]=$=>l(_(o).item)),onContextmenu:De(c,["prevent"]),onDblclick:De(c,["prevent"])},[C(m,{icon:p(),onClick:c},null,8,["icon"]),me(" "+H(_(o).item.name),1)],42,Ko),_(o).isOpen?(v(),w("div",Jo,[(v(!0),w(U,null,te(_(o).item.children,($,T)=>(v(),w("div",{key:T},[C(y,{item:$,onEvent_callback:i},null,8,["item"])]))),128))])):X("",!0)],32)}}});var Yo=F(Uo,[["__scopeId","data-v-21024690"]]);const qo={class:"tree"},Go=j({emits:["event_callback"],setup(n,{emit:e}){const t=N({items:void 0}),{store_data:o}=q();A(()=>o.state.dictMenu,(a,l)=>{i(a)});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)};Z(()=>{console.log("[mounted]"),i(o.state.dictMenu)});const i=a=>{console.log("[onChanged_dictMenu]"),t.items=void 0;const l=a,c={name:"",children:[],path:"",file:"",time:""},d="/",r={[d]:c},p=h=>h.split(".").slice(1);l.forEach(function(h){h.key.split("/").reduce(function(u,m){if(u[m])return u[m];{const y={name:m,children:[],path:h.path,file:p(m),time:h.atime};return u[d].children.push(y),u[d].file="",u[m]={[d]:y}}},r)}),console.dir(c),setTimeout(()=>{t.items=c.children},250)};return(a,l)=>(v(),w("div",qo,[C(wn,{_appear:"",name:"flip-list",tag:"div"},{default:Le(()=>[(v(!0),w(U,null,te(_(t).items,c=>(v(),w("div",{key:c.path},[C(Yo,{item:c,onEvent_callback:s},null,8,["item"])]))),128))]),_:1})]))}});var Wo=F(Go,[["__scopeId","data-v-bb89d624"]]);const Xo=j({props:{level:null},setup(n){const e=n,t=ne(()=>`h${e.level}`);return(o,s)=>(v(),re(kn(_(t)),{class:"h_tag"},{default:Le(()=>[xn(o.$slots,"default",{},void 0,!0)]),_:3}))}});var Zo=F(Xo,[["__scopeId","data-v-f257f458"]]);const Qo=j({emits:["event_callback"],components:{heading:Zo},setup(n,e){const{store_data:t}=q(),o=N({listTag:[]});A(()=>t.state.tags,(a,l)=>{o.listTag=a});function s(a){t.do_cmd("update_jump",a)}function i(a){return`${a.text}`}return{state:o,dispTitle:i,jumpSource:s}}}),es={class:"tag"},ts=["onClick"];function ns(n,e,t,o,s,i){const a=V("heading");return v(),w("div",es,[(v(!0),w(U,null,te(n.state.listTag,(l,c)=>(v(),w("div",{key:c,onClick:d=>n.jumpSource(c),class:"item"},[C(a,{level:l.tag},{default:Le(()=>[me(H(n.dispTitle(l)),1)]),_:2},1032,["level"])],8,ts))),128))])}var os=F(Qo,[["render",ns],["__scopeId","data-v-39c9834e"]]);const ss=j({emits:["event_callback"],setup(n,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(s,i)=>{console.log(`cmd=${s}, name=${i}`),e.emit("event_callback",s,i)}}}}),is={class:"main",style:{_height:"100px"}},as=["onClick","title"];function ls(n,e,t,o,s,i){const a=V("fa");return v(),w("div",is,[(v(!0),w(U,null,te(n.objToolbar,(l,c)=>(v(),w("button",{class:"btn-item",key:c,onClick:d=>n.event_callback("action",l.cmd),title:l.cmd},[C(a,{icon:l.icon},null,8,["icon"])],8,as))),128))])}var cs=F(ss,[["render",ls],["__scopeId","data-v-51a9c01b"]]);const Be={};class rs{constructor(e,t){Ee(this,"cmdid",0);Ee(this,"monaco",null);Ee(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=t}add(e,t,o,s,i=null){console.log("[add]");let a;switch(s.length){case 0:a=this.generateCommand(e,i);break;case 1:a=this.generateHeaderCommand(s[0]);break;case 2:a=this.generateWrapperCommand(s[0],s[1]);break}Be[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:o,contextMenuGroupId:t&&"navigation",contextMenuOrder:t&&1.5,run:Be[e]})}generateCommand(e,t){return(o,s)=>{t(o)}}generateWrapperCommand(e,t){const o=e.length+t.length,i=this.editor.getModel();return this.monaco,(a,l)=>{const c=a.getSelections();if(c==null)return;const d=[];return c.forEach(r=>{d.push(new l.Selection(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn+o)),i.pushEditOperations([],[{range:{startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.startLineNumber,endColumn:r.startColumn},text:e},{range:{startLineNumber:r.endLineNumber,startColumn:r.endColumn,endLineNumber:r.endLineNumber,endColumn:r.endColumn},text:t}])}),a.setSelections(d),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(t,o)=>{const s=t.getModel();let i=t.getSelections();return i==null&&(i=[t.getSelection()]),i.forEach(a=>{const l=s.findNextMatch("^(#+ )",{lineNumber:a.startLineNumber,column:1},!0,!1,null,!0);if(l!=null&&l.range.startLineNumber==a.startLineNumber&&l.range.startColumn==1){if(l.matches[1]==e)return;s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:l.matches[1].length+1},text:""}])}s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:1},text:e}])}),null}}}function ds(n,e){const t=s=>{const i=a=>`00${a}`.slice(-2);return`${s.getFullYear()}/${i(s.getMonth()+1)}/${i(s.getDate())} ${i(s.getHours())}:${i(s.getMinutes())}:${i(s.getSeconds())}`};console.log("[setupShortcutKeys]");const o=new rs(n,e);o.add("Bold","8_",[],["**","**"]),o.add("Italic","1_",[],["__","__"]),o.add("Underline","9_",[],["<u>","</u>"]),o.add("Strikethrough",!1,[n.KeyMod.CtrlCmd|n.KeyMod.Shift|n.KeyCode.KEY_S],["~~","~~"]),o.add("Code",!1,[],["`","`"]),o.add("Link",!1,[],["[","]()"]),o.add("Link-2",!1,[],["[](",")"]),o.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),o.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),o.add("Header 1",!1,[],["# ",""]),o.add("Header 2",!1,[],["## ",""]),o.add("Header 3",!1,[],["### ",""]),o.add("Header 4",!1,[],["#### ",""]),o.add("Header 5",!1,[],["##### ",""]),o.add("Header 6",!1,[],["###### ",""]),o.add("Check",!1,[],["- [ ] ",""]),o.add("Blockquotes",!1,[],["> ",""]),o.add("Today",!1,[],[`${t(new Date)}`,""]),o.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),o.add("Format","8_",[],[],s=>{console.log("format"),s.getAction("editor.action.formatDocument").run()})}const us={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},ps=j({emits:["event_callback"],components:{ToolbarEditor:cs},props:{isActive_preview:{type:Boolean,default:!1}},setup(n,e){const t=S(null),o={editor:void 0},{store_data:s}=q(),i=N({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});Z(()=>{console.log("[mounted]"),l(),m(s.state.obj.content)}),A(()=>s.state.obj.content,(k,B)=>{console.log("[watch-body]"),i.filename!=""&&T(),m(k),G(s.state.obj.position,!0),i.filename=s.state.filename}),A(()=>s.state.ObjTag,(k,B)=>{console.log(`[watch](ObjTag)-${k}`),a(k)}),A(()=>n.isActive_preview,(k,B)=>{console.log(`[watch](editor_toggle)-${k}`),k==!0&&$()});const a=k=>{const B=f=>{h(f)};console.log(`[jump_cursor]ObjTag={${Object.values(k)}}`);const g=k.line;B(g),setTimeout(()=>{const f=o.editor;i.pos_scroll=f.getScrollTop()},500)},l=()=>{const k=()=>{const B=(E,O)=>{ds(E,O)},g=document.getElementById("container");if(console.log(`root=${g}`),g==null)return;const f=$n.create(g,us);return B(ct,f),console.log(`editor=${f}`),f.onDidScrollChange(E=>{i.scrollInfo.height=E.scrollHeight,i.scrollInfo.top=E.scrollTop}),f};o.editor=k(),c()},c=()=>{o.editor.onDidBlurEditorText(k=>{$()})},d=(k,B)=>{switch(console.log(`[event_callback] cmd=${k}`),k){case"action":r(B);break;case"save":$();break}},r=k=>{console.log("[action]"),Be[k]!=null&&Be[k](o.editor,ct)},p=()=>o.editor.getValue(),h=k=>{const B=new En(k+1,0,k+1,0);console.log(`Line=${k}`),o.editor.revealRangeAtTop(B)},u=()=>o.editor.getModel().getAlternativeVersionId(),m=k=>{o.editor.setValue(k),i.iVersion=u()},y=()=>{const k=u();return console.info(`iVersion=${i.iVersion}, iVersion_cur=${k}`),i.iVersion!=k},$=(k=!1)=>{if(!y())return;k||T();const B=p();s.do_cmd("save_file",B),i.iVersion=u(),console.info(`iVersion=${i.iVersion}`)},T=()=>{const k=o.editor,B={top:k.getScrollTop(),height:k.getScrollHeight(),contentHeight:k.getLayoutInfo().height,scrolled:i.pos_scroll!=k.getScrollTop()};return y()?(s.do_cmd("update_position",B,void 0),$(!0)):s.do_cmd("update_position",B,i.filename),B},G=(k,B=!1)=>{if(k==null)return;console.log(`[e-set]value=${JSON.stringify(k)}`);const g=o.editor;if(B?!0:k.scrolled){const E=k.top/k.height;console.log(`per=${E}`);const O=g.getScrollHeight();g.setScrollTop(O*E)}else a(s.state.ObjTag);setTimeout(()=>{i.pos_scroll=g.getScrollTop()},500)};ne(()=>o.editor.getScrollTop());const ae=ne(()=>`${s.state.height-27}px`);return{editorEx:o,event_callback:d,HeightEx:ae,md_editor_monaco:t,get_position:T,set_position:G}}}),hs={class:"editor"};function ms(n,e,t,o,s,i){const a=V("ToolbarEditor");return v(),w("div",hs,[C(a,{class:"toolbar",onEvent_callback:n.event_callback},null,8,["onEvent_callback"]),x("div",{id:"container",ref:"md_editor_monaco",class:"core",style:Q({height:n.HeightEx})},null,4)])}var gs=F(ps,[["render",ms],["__scopeId","data-v-7e52ad8b"]]);const fs=j({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(n){const e=S(null),{store_data:t}=q(),o=N({pos_scroll:-1,filename:"",observer_scroll:null});Z(()=>{function r(){const p=new Pe.Renderer;p.link=function(h,u,m){return console.log(`href=${h}, title=${u}, text=${m}`),h.indexOf("http")!=-1||h.indexOf("file")!=-1?`<a target="_blank" href="${h}">${m}</a>`:`<a target="_blank" href="?${h}">${m}</a>`},p.code=function(h,u,m){return h.match(/^sequenceDiagram/)||h.match(/^graph/)||h.match(/^gantt/)?'<div class="mermaid">'+h+`
</div>`:`<pre><code>
`+Cn.highlightAuto(h).value+`
</code></pre>`},Pe.setOptions({renderer:p,langPrefix:"",breaks:!0}),window.setTimeout(()=>{Sn.init()},500)}console.log("[mounted]"),r(),o.observer_scroll=new s}),je(()=>{}),A(()=>t.state.obj.content,(r,p)=>{console.log("[watch-body]"),o.filename!=""&&a(),setTimeout(()=>{o.observer_scroll.build(),l(t.state.obj.position,!0),o.filename=t.state.filename},0)});class s{constructor(){this.observer=null,this.tocMap=null,this.elm_target_before=null}destructor(){}build(){const p=()=>document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),h=()=>document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5"),u=(T,G)=>{const ae=this.tocMap.get(T);G?(this.elm_target_before!=null&&this.elm_target_before.classList.remove("active"),ae.classList.add("active"),this.elm_target_before=null):this.elm_target_before=ae},m={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},y=this.set_callback(u,m),$=this.build_toc_map(y,p(),h());this.observer=y,this.tocMap=$}set_callback(p,h){const u=m=>{m.forEach(y=>{p(y.target,y.intersectionRatio)})};return new IntersectionObserver(u,h)}build_toc_map(p,h,u){const m=new Map;return console.log(`el_contents=${h.length}`),console.log(`el_tocs=${u.length}`),h.forEach((y,$)=>{p.observe(y),m.set(u.item($),y),m.set(y,u.item($))}),m}}A(()=>t.state.ObjTag,(r,p)=>{console.log(`[watch](ObjTag)-${r}`),i(r)});function i(r){const p=(m,y)=>{console.log(`tag=${m}, num=${y}`);const $=e.value,T=$.querySelectorAll(".md_core_viewer > h"+m);T.length!=0&&($.scrollTop=T[y].getBoundingClientRect().top-$.getBoundingClientRect().top+$.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(r)}}`);const h=r.tag,u=r.num;p(h,u),setTimeout(()=>{const m=e.value;o.pos_scroll=m.scrollTop},0)}const a=()=>{const r=e.value,p={top:r.scrollTop,height:r.scrollHeight,contentHeight:0,scrolled:o.pos_scroll!=r.scrollTop};return t.do_cmd("update_position",p,o.filename),p},l=(r,p=!1)=>{if(console.log(`[v-set]value=${JSON.stringify(r)}`),e.value==null)return;const h=e.value;if(r==null){h.scrollTop=0;return}if(p?!0:r.scrolled){const m=r.top/r.height;console.log(`per=${m}`),console.log(`scrollTop=${h.scrollTop}, scrollHeight=${h.scrollHeight}`),h.scrollTop=h.scrollHeight*m}else i(t.state.ObjTag);setTimeout(()=>{o.pos_scroll=h.scrollTop},0)},c=ne(()=>Pe.parse(t.state.obj.content)),d=ne(()=>t.state.height+"px");return{status,Markdown:c,HeightEx:d,md_viewer:e,get_position:a,set_position:l}}}),_s=["innerHTML"];function vs(n,e,t,o,s,i){return v(),w("div",{class:"md_core_viewer note",innerHTML:n.Markdown,style:Q({height:n.HeightEx}),ref:"md_viewer"},null,12,_s)}var bs=F(fs,[["render",vs],["__scopeId","data-v-599d8138"]]);const ys=j({props:{editor_toggle:null},emits:["event_callback"],setup(n,{emit:e}){const t=n;q(),Ne();const o=N({isActive_preview:!0}),s=S(),i=S();Z(()=>{console.log("[mounted]"),document.addEventListener("keydown",a)}),je(()=>{console.log("unmounted!"),document.removeEventListener("keydown",a)}),A(()=>t.editor_toggle,(c,d)=>{console.log(`[watch](editor_toggle)-${c}`),l()});const a=c=>{if(c.keyCode===83&&c.ctrlKey){c.preventDefault(),console.log("save"),l();return}else if(c.keyCode===69&&c.ctrlKey){c.preventDefault(),console.log("toggle"),l();return}},l=()=>{var r;const c=o.isActive_preview?{now:s,next:i}:{now:i,next:s},d=(r=c.now.value)==null?void 0:r.get_position();console.log(`isActive_preview=${o.isActive_preview}, scrollIndo=${JSON.stringify(d)}`),o.isActive_preview=!o.isActive_preview,setTimeout(()=>{var p;(p=c.next.value)==null||p.set_position(d)},500)};return(c,d)=>(v(),w("div",null,[_(o).isActive_preview?(v(),re(bs,{key:0,class:"md_viewer",ref_key:"MdViewer",ref:s,isActive_preview:_(o).isActive_preview},null,8,["isActive_preview"])):(v(),re(gs,{key:1,class:"md_editor",ref_key:"MdEditor",ref:i,isActive_preview:_(o).isActive_preview},null,8,["isActive_preview"]))]))}}),L=Mn(),ws="_container_evb0m_1",ks="_svg_evb0m_18",xs="_trigger_evb0m_44",$s="_dragging_evb0m_47",Es="_hidden_evb0m_53",Cs="_text_evb0m_73",Ss="_selected_evb0m_79",Ms="_content_evb0m_79",Ds="_root_evb0m_82",Ts="_edited_evb0m_86",Bs="_outline_evb0m_89",Os="_collapse_evb0m_99",Ls="_disabled_evb0m_145",js="_gps_evb0m_156",Ns="_fit_evb0m_159",As="_download_evb0m_162",Fs="_prev_evb0m_165",Rs="_next_evb0m_168",Is="_close_evb0m_171";var b={container:ws,"svg-wrapper":"_svg-wrapper_evb0m_1","asst-svg":"_asst-svg_evb0m_12",svg:ks,trigger:xs,dragging:$s,"add-btn":"_add-btn_evb0m_47",hidden:Es,"expand-btn":"_expand-btn_evb0m_64",text:Cs,selected:Ss,content:Ms,root:Ds,edited:Ts,outline:Bs,collapse:Os,"button-list":"_button-list_evb0m_103","right-bottom":"_right-bottom_evb0m_106","right-top":"_right-top_evb0m_110",disabled:Ls,gps:js,fit:Ns,download:As,prev:Fs,next:Rs,close:Is};const W=S(),z=S(),he=S(),Ve=S(),oe=S(),K=S();function Ps(){const n=this.querySelector(`g.${b["add-btn"]}`);n&&(n.style.opacity="1");const e=this.querySelector(`g.${b["expand-btn"]}`);e&&(e.style.opacity="1")}function zs(){const n=this.querySelector(`g.${b["add-btn"]}`);n&&(n.style.opacity="0");const e=this.querySelector(`g.${b["expand-btn"]}`);e&&(e.style.opacity="0.5")}const Vs=n=>{const{g:e}=R;!e||(ce.value=n.transform,e.attr("transform",n.transform.toString()))};function Nt(n,e){console.log("[onSelect]"),n.stopPropagation();const t=Y(e);console.dir(t)}function Qe(n,e){var l,c;console.log("[onEdit]");const{foreign:t}=R;if(!Kt||!t||!K.value)return;const o=(l=this.parentNode)==null?void 0:l.parentNode;o.classList.add(b.edited),L.emit("edit-flag",!1),console.log(`name/id=${e.name}/${e.id}`),t.attr("x",e.x-2-(e.left?e.width:0)).attr("y",e.y-M.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const s=K.value;s.textContent=e.name,s.focus(),(c=getSelection())==null||c.selectAllChildren(s);const i=o.querySelector(`:scope > .${b.content}`);i&&Ae(i);const a=d=>{const r=d.key;switch(console.log(`[onEdit] keydown=${r}`),r){case"Enter":if(d.shiftKey)return;d.stopPropagation(),Je(new FocusEvent("")),setTimeout(()=>{Y(e),z.value.focus()},250);break;case"Escape":d.stopPropagation(),Je(new FocusEvent(""),!0),z.value.focus();break}};s.addEventListener("keydown",a)}const Je=(n,e=!1)=>{var i;if(console.log("[onEditBlur]"),(i=document.getElementsByClassName(b.edited)[0])==null||i.classList.remove(b.edited),oe.value==null||K.value==null){console.log("skip not active foreign");return}if(oe.value.style.display=="none"){console.log("skip display=none");return}oe.value.style.display="none";const t=oe.value.getAttribute("data-id"),o=oe.value.getAttribute("data-name"),s=K.value.textContent;e||t&&s!==null&&s!==o&&dn(t,s)},Ce=n=>{if(n.preventDefault(),!W.value)return;console.log("onContextmenu"),console.log(JSON.stringify(n));const e=mi(W.value,n);Vt.value=e;const t=n.composedPath(),o=t.find(a=>{var l;return(l=a.classList)==null?void 0:l.contains("node")}),s=t.find(a=>a.tagName=="foreignObject");let i=o?1:s?2:0;if(console.log(i),i==1){const{classList:a}=o;a.contains(b.selected)||Y(o),nt.value=a}tt.value=i,L.emit("showContextmenu",!0)},At=["#000000","#C0C0C0","#808080","#FFFFFF","#800000","#FF0000","#800080","#FF00FF","#008000","#00FF00","#808000","#FFFF00","#000080","#0000FF","#008080","#00FFFF"];let Se=0;const Hs=At.length-1,D=(n,e)=>{var s,i,a;if(console.log(`[onClickMenu] name=${n},param=${e}`),n.indexOf("icon_")!=-1){const l=pe(),c=(s=M.find(l.id))==null?void 0:s.rawData;c&&(console.log(c),dn(l.id,`${n.slice(5)}${c.name}`));return}let t=pe();const o=t==null?void 0:t.id;switch(n){case"zoomfit":Te();break;case"zoomin":ut(!1);break;case"zoomout":ut(!0);break;case"add":Ft(new MouseEvent("click"),pe());break;case"delete":t=t.parent,xt(o);break;case"delete-one":t=t.parent,Zi(o);break;case"collapse":hn(o);break;case"expand":pn(o);break;case"add-sibling":{const l=$t(o,"");l&&(Y(l),ve(l))}break;case"add-sibling-before":{const l=$t(o,"",!0);l&&(Y(l),ve(l))}break;case"add-parent":{const l=Qi(o,"");l&&(Y(l),ve(l))}break;case"cut":{const l=(i=M.find(o))==null?void 0:i.rawData;l&&navigator.clipboard.writeText(JSON.stringify(l)),t=t.parent,xt(o)}break;case"copy":{const l=(a=M.find(o))==null?void 0:a.rawData;l&&navigator.clipboard.writeText(JSON.stringify(l))}break;case"paste":navigator.clipboard.readText().then(l=>{const c=bi(l)||{name:l},d=un(o,c);Y(d)});break;case"edit":ve(pe());break;case"undo":qe();break;case"redo":Ye();break;case"move_focus_x":Ks(e==null?void 0:e.direct),t=null;break;case"move_focus_y":Js(e==null?void 0:e.direct),t=null;break;case"text-bold":Ke(o,{"font-weight":"bold"});break;case"text-line":Ke(o,{"text-decoration":"line-through"});break;case"change_color":Se=Se>Hs?0:Se+1,Ke(o,{color:At[Se]},!0);break;case"change_color_bk":tt.value=2,L.emit("showContextmenu",!0);break;case"next":Ye();break;case"prev":qe();break}t&&Y(t)},Ks=n=>{let e=null;const t=pe();if(console.log(`seleData.left=${t.left}`),!!(t.left&&n==!1||t.left==!1&&n))if(console.log("to child"),t.children.length!=0)e=t.children[0];else return;else if(console.log("to parent"),t.parent!=null)e=t.parent;else return;const s=Y(e);Ae(s),console.log("@")},Js=n=>{let e=null;const t=pe();if(t==null||t.parent==null)return;let o=+t.id.split("-").pop(),s=t.parent.children.length,i=o+(n?1:-1);if(0<=i&&i<s){e=t.parent.children[i];const a=Y(e);Ae(a)}},Ft=(n,e)=>{const t=un(e.id,"");t&&(ve(t,n),Y(e))};function ve(n,e=new MouseEvent("click")){const{g:t}=R;if(!t)return;const s=t.selectAll(`g[data-id='${Fe(n)}'] > g.${b.content} > g.${b.text}`).node();s&&(L.emit("edit-flag",!0),Qe.call(s,e,n))}const Rt=(n,e)=>{e.collapse?pn(e.id):hn(e.id)};function Us(n,e){var c;const t=(c=this.parentNode)==null?void 0:c.parentNode;z.value&&z.value.classList.add(b.dragging);const{g:o}=R;if(!o)return;Zt(t,e,[n.x-e.x,n.y-e.y]);const s=Dn(n,he.value);s[1]+=M.data.y;const i=o.selectAll("g.node").filter(d=>{if(d!==e&&d!==e.parent&&!d.id.startsWith(e.id)){let r=J,p=d.width+J;d.left&&d.depth!==0&&([r,p]=[p,r]);const h={x0:d.x-r,x1:d.x+p,y0:d.y-J,y1:d.y+d.height+J};return s[0]>h.x0&&s[1]>h.y0&&s[0]<h.x1&&s[1]<h.y1}return!1}),a=Array.from(document.getElementsByClassName(b.outline)),l=i.node();a.forEach(d=>{d!==l&&d.classList.remove(b.outline)}),l==null||l.classList.add(b.outline)}function Ys(n,e){var h;const t=(h=this.parentNode)==null?void 0:h.parentNode;z.value&&z.value.classList.remove(b.dragging);const o=document.getElementsByClassName(b.outline)[0];if(o){o.classList.remove(b.outline);const u=o.getAttribute("data-id");if(u)e.px=0,e.py=0,Xi(u,e.id);else throw new Error("outline data-id null");return}const s=e.x-M.getRootWidth()/2,i=e.depth===1&&s*(s+e.px)<0,a=i?u=>u.left!==e.left:u=>u.left===e.left,l=t.parentNode;let c=i?{y:1/0,id:e.id}:e,d=i?{y:-1/0,id:e.id}:e;const r=se(l).selectAll(`g.${it(e).join(".")}`).filter(u=>u!==e&&a(u)),p=e.y+e.py;r.each(u=>{(i||u.y>e.y)&&u.y<p&&u.y>d.y&&(d=u),(i||u.y<e.y)&&u.y>p&&u.y<c.y&&(c=u)}),i?(e.px=0,e.py=0,ea(e.id)):c.id!==e.id?(e.px=0,e.py=0,kt(e.id,c.id)):d.id!==e.id?(e.px=0,e.py=0,kt(e.id,d.id,1)):Zt(t,e,[0,0],500)}const qs=n=>{const{svg:e}=R;!e||(n?(xe(e),e.on("dblclick.zoom",null)):e.on(".zoom",null))},Gs=n=>{const{g:e}=R;if(!K.value||!e)return;const t=e.selectAll(`g.${b.text}`);n?t.on("click",Qe):t.on("click",null)},Ws=n=>{const{g:e}=R;if(!e)return;const t=e.selectAll(`g.${b.text}`);n?t.on("mousedown",Nt):t.on("mousedown",null)},Xs=n=>{!W.value||(n?(console.log("@switchContextmenu"),W.value.addEventListener("contextmenu",Ce),W.value.addEventListener("dblclick",Ce)):(W.value.removeEventListener("contextmenu",Ce),W.value.removeEventListener("dblclick",Ce)))},Zs=n=>{const{g:e}=R;if(!e)return;const t=e.selectAll(`g.node:not(.${b.root}) > g > g.${b.text}`);n?Ut(t):t.on(".drag",null)};let It,et,Pt,zt;L.on("selection-svg",n=>It=n);L.on("selection-g",n=>et=n);L.on("selection-asstSvg",n=>Pt=n);L.on("selection-foreign",n=>zt=n);const tt=S(0),Vt=S({left:0,top:0}),nt=S(),Ht=N({delete:{name:"delete",disabled:!1,note:"Del",check:1},deleteOne:{name:"delete-one",disabled:!1,note:"ctrl+ del",check:1},zoomin:{name:"zoomin",disabled:!0,note:"]",check:4},zoomout:{name:"zoomout",disabled:!1,note:"[",check:4},zoomfit:{name:"zoomfit",disabled:!1,note:"@"},text_bold:{name:"text-bold",disabled:!1,note:"ctrl+ b"},text_line:{name:"text-line",disabled:!1,note:"ctrl+ l"},change_color:{name:"change_color",disabled:!1,note:"ctrl+ h"},change_color_bk:{name:"change_color_bk",disabled:!1,note:"ctrl+ h"},collapse:{name:"collapse",disabled:!0,note:"ctrl+ o",check:3},expand:{name:"expand",disabled:!0,note:"ctrl+ e",check:2},add:{name:"add",disabled:!1,note:"shift+ enter"},addParent:{name:"add-parent",disabled:!1,note:"",check:1},addSibling:{name:"add-sibling",disabled:!1,note:"ctrl+ enter",check:1},addSiblingBefore:{name:"add-sibling-before",disabled:!0,note:"",check:1},cut:{name:"cut",disabled:!1,note:"ctrl+ x",check:1},copy:{name:"copy",disabled:!1,note:"ctrl+ c"},paste:{name:"paste",disabled:!1,note:"ctrl+ v"}}),Qs=[["add","addParent","addSibling","addSiblingBefore"],["cut","copy","paste"],["delete","deleteOne"],["text_bold","text_line"],["collapse","expand"],["zoomin","zoomout","zoomfit"]],ei=ne(()=>{const n=nt.value;console.log(`classList=${JSON.stringify(n)}`);const e=o=>{let s=!1;switch(o){case 1:s=n.contains(b.root);break;case 2:s=!n.contains(b.collapse),console.log(b.collapse);break;case 3:s=n.contains(b.collapse)||n.contains("leaf"),console.log(b.collapse);break;case 4:s=ce.value.k>=ie[1];break;case 5:s=ce.value.k<=ie[0];break}return s};return ot(Qs,o=>{const s=Ht[o],i=s.hasOwnProperty("check")?s.check:0;return{name:s.name,disabled:e(i),note:s.note}})}),ti=[["zoomin","zoomout","zoomfit"]],ni=ne(()=>{nt.value;const n=t=>{let o=!1;switch(t){case 4:o=ce.value.k>=ie[1];break;case 5:o=ce.value.k<=ie[0];break}return console.log(`zoom=${ce.value.k}, scale=${JSON.stringify(ie)}`),o};return ot(ti,t=>{const o=Ht[t],s=o.hasOwnProperty("check")?o.check:0;return{name:o.name,disabled:n(s),note:o.note}})}),ot=(n,e)=>{let t=[];return n.forEach(o=>{let s=[];o.forEach(i=>{s.push(e(i))}),t.push(s)}),t},oi=ne(()=>{const n=s=>({name:s}),{store_data:e}=q();console.log("@@@");const t=e.state.config;console.dir(t);const o=t.mindmap.icon;return ot(o,n)}),si=ne(()=>{let n;switch(tt.value){case 0:n=ni.value;break;case 1:n=ei.value;break;case 2:n=oi.value;break}return console.dir(n),n}),ii=Tn().source(n=>n.source).target(n=>n.target);Bn().curve(On);let ai=ii;const li=S(!1);let Ue=4;L.on("branch",n=>Ue=n||Ue);let ie=[.1,8];L.on("scale-extent",n=>ie=n||ie);let Kt=!1;L.on("edit-flag",n=>Kt=!!n);const ci=6,ue=10;let we=16,Oe=64,J=Math.min(we/2-1,ue);L.on("gap",n=>{!n||(Oe=n.xGap,we=n.yGap,J=Math.min(we/2-1,ue),J=Math.min(Oe/2-1,J))});const ri=new ResizeObserver(n=>{const{foreign:e}=R;if(!e)return;const t=n[0],o=t.target,{width:s,height:i}=t.contentRect,a=parseInt(getComputedStyle(o).paddingLeft||"0",10),l=parseInt(getComputedStyle(o.parentNode).borderTopWidth||"0",10),c=(a+l)*2;e.attr("width",s+c).attr("height",i+c),e.style("display")!=="none"&&Ae(o),console.log("observer")}),ge={side:12,padding:2,margin:8},Jt=ge.side+ge.padding*2,de={width:16,height:8,radius:4},ce=S(Mt),xe=Ln().on("zoom",Vs).scaleExtent(ie),Ut=jn().container(gi).on("drag",Us).on("end",Ys),st=S(!0);let Yt;L.on("mindmap-context",n=>n?Yt=n:null);const Me=S({drag:!0,edit:!0});class di{constructor(e=20){this.length=e,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(e){const t=be.exports.cloneDeep(e);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(t),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,be.exports.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,be.exports.cloneDeep(this.snapshots[this.cursor])):null}}const ke=new di,qt=S(!1),Gt=S(!1),ui=()=>{qt.value=ke.hasPrev,Gt.value=ke.hasNext},pi=(n,e)=>{const t=-e/2,o=-n/2,s=n/2,i=e/2;return`M${i},${s}H${s}V${i}H${o}V${s}H${t}V${o}H${o}V${t}H${s}V${o}H${i}V${s}Z`},Wt=n=>{const e=n.split(`
`);return e.length>1&&e[e.length-1]===""&&e.pop(),e},hi=(n,e)=>{An(n).then(t=>{const o=t.toDataURL(),s=open();s&&(s.document.write(`<img src='${o}'>`),s.document.title=e,s.document.close())})},Xt=(n,e)=>Nn().duration(n).ease(e),mi=(n,e)=>{const{pageX:t,pageY:o}=e,s=n.getBoundingClientRect(),i=s.left+window.pageXOffset,a=s.top+window.pageYOffset;return{left:t-i,top:o-a}};function gi(){var n,e;return(e=(n=this.parentNode)==null?void 0:n.parentNode)==null?void 0:e.parentNode}function Y(n){const e=n instanceof SVGGElement?n:document.querySelector(`g[data-id='${Fe(n)}']`),t=document.getElementsByClassName(b.selected)[0];if(e)t?t!==e?(console.log("remove & add selected"),t.classList.remove(b.selected),e.classList.add(b.selected)):(console.log("edit-flag - same"),L.emit("edit-flag",!0)):(console.log("add selected"),e.classList.add(b.selected));else throw new Error("selectGNode failed");return e}function pe(){console.log("getSelectedGData");const n=se(`.${b.selected}`),e=n==null?void 0:n.data();if((e==null?void 0:e.length)==0)return console.log("data null"),null;const t=e[0];return console.log(`id/name=${t.id}/${t.name}`),t}const dt=n=>{const{asstSvg:e}=R;if(!e)throw new Error("asstSvg undefined");const t=Wt(n),o=e.append("text");o.selectAll("tspan").data(t).enter().append("tspan").text(i=>i).attr("x",0);const s=o.node().getBBox();return o.remove(),{width:Math.max(s.width,22),height:Math.max(s.height,22)*t.length}},Zt=(n,e,t,o=0)=>{const s=Xt(o,Dt);e.px=t[0],e.py=t[1],se(n).transition(s).attr("transform",en),se(`g[data-id='${Fe(e)}'] > path`).transition(s).attr("d",i=>Ge(i))},fi=()=>{const{svg:n}=R;if(!n)return;const e=M.data;xe.translateTo(n,0+e.width/2,0+e.height/2)},Te=()=>{const{svg:n}=R;if(!n||!he.value||!z.value)return;const e=he.value.getBBox(),t=z.value.getBoundingClientRect(),o=Math.min(t.width/e.width,t.height/e.height),s={x:t.width/2,y:t.height/2},i={x:e.width*o/2,y:e.height*o/2},a=Mt.translate(-e.x*o+s.x-i.x,-e.y*o+s.y-i.y).scale(o);xe.transform(n,a)},Ae=n=>{const{svg:e}=R;if(e&&z.value){const{k:t}=ce.value,o=n.getBoundingClientRect(),{x:s,y:i,width:a,height:l}=z.value.getBoundingClientRect(),c=o.x-s,d=c+o.width,r=o.y-i,p=r+o.height,h=2;let u=0,m=0;c<0&&(u=-c/t+h),(o.width>a||d>a)&&(u=-(d-a)/t-h),r<0&&(m=-r/t+h),(o.height>l||p>l)&&(m=-(p-l)/t-h),xe.translateBy(e,u,m)}},ut=n=>{const{svg:e}=R;!e||xe.scaleBy(e,n?1.1:.9)},_i=()=>{!W.value||hi(W.value,M.data.name)},Ye=()=>{const n=ke.next();n&&(M.data=n,I(!1))},qe=()=>{const n=ke.prev();n&&(M.data=n,I(!1))},vi=()=>{K.value&&(console.log("bindForeignDiv:enter"),ri.observe(K.value),K.value.addEventListener("blur",Je),K.value.addEventListener("mousedown",n=>{n.stopPropagation()}),K.value.addEventListener("keydown",n=>{n.stopPropagation(),n.key}),z.value.addEventListener("keydown",n=>{const e=n.key;if(console.log(`svgEle@keydown=${e}`),n.preventDefault(),n.ctrlKey)switch(e){case"Delete":case"d":D("delete-one");break;case"Enter":D("add-sibling");break;case"Insert":case"i":D("add-sibling");break;case"b":D("text-bold");break;case"l":D("text-line");break;case"c":D("copy");break;case"v":D("paste");break;case"z":D("prev");break;case"y":D("next");break}else if(n.shiftKey)switch(e){case"Enter":D("add");break}else switch(e){case"ArrowRight":D("move_focus_x",{direct:!0});break;case"ArrowLeft":D("move_focus_x",{direct:!1});break;case"ArrowDown":D("move_focus_y",{direct:!0});break;case"ArrowUp":D("move_focus_y",{direct:!1});break;case"Insert":case"i":D("add");break;case"Delete":case"d":D("delete");break;case"F2":D("edit");break;case"@":D("zoomfit");break;case"[":D("zoomout");break;case"]":D("zoomin");break;case"o":D("collapse");break;case"e":D("expand");break;case"t":D("change_color");break;case"h":D("change_color_bk");break}}))},bi=n=>{let e;try{return e=JSON.parse(n),"name"in e?e:!1}catch{return!1}},Qt=()=>3,it=n=>{const e=["node"];return n&&e.push(`depth-${n.depth}`),e},yi=n=>{const e=it(n);return n&&(n.depth===0&&e.push(b.root),n.collapse?e.push(b.collapse):n.children||e.push(b.collapse)),e},wi=n=>[b["add-btn"]],en=n=>`translate(${n.dx+n.px},${n.dy+n.py})`,Fe=n=>n.id,tn=n=>{const e=Wt(n.name),t=n.height/e.length,o=n.attr;return e.map(s=>({name:s,height:t,attr:o}))},Ge=n=>{let e=0,t=0;const o=Math.max(J-3,0);let s=n.width+o;const i=Qt();let a=i;const{parent:l}=n;l&&(e=l.width,t=l.height,l.depth===0&&(e/=2,t/=2,a=0)),n.left&&(l&&l.depth!==0&&(e=-e),s=-s);const c=[-n.dx+e-n.px,-n.dy+t+a-n.py],d=[0,n.height+i];return`${ai({source:c,target:d})}L${s},${d[1]}`},ki=(n,e)=>{const t=n.height/2;let o=n.width+e+Jt/2+ge.margin;return n.left&&(o=-o),`translate(${o},${t})`},xi=(n,e)=>{const o=n.height+Qt();let s=n.width+e+4;return n.left&&(s=-s),`translate(${s},${o})`},nn=(n,e,t,o,s)=>{n?(gt(e,ue),pt(t,ue,ci),o&&ht(o,ue),s&&mt(s,ue)):(gt(e,J),pt(t,J),o&&ht(o,J),s&&mt(s,J))},on=(n,e)=>{const t=n.attr("class",s=>yi(s).join(" ")).attr("data-id",Fe);(e?t.transition(e):t).attr("transform",en)},sn=(n,e)=>{(e?n.transition(e):n).attr("transform",o=>`translate(${o.left?-o.width:0},0)`)},at=n=>{n.attr("alignment-baseline","text-before-edge").attr("font-weight",e=>{var t;return(t=e.attr)!=null&&t.hasOwnProperty("font-weight")?e.attr["font-weight"]:""}).attr("text-decoration",e=>{var t;return(t=e.attr)!=null&&t.hasOwnProperty("text-decoration")?e.attr["text-decoration"]:""}).attr("fill",e=>{var t;return(t=e.attr)!=null&&t.hasOwnProperty("color")?e.attr.color:""}).text(e=>e.name||" ").attr("x",0).attr("dy",(e,t)=>t?e.height:0)},$i=n=>{const{side:e,padding:t}=ge,o=4,s=-t-e/2,i=e+t*2;n.attr("x",s).attr("y",s).attr("rx",o).attr("ry",o).attr("width",i).attr("height",i)},Ei=n=>{n.attr("x",-de.width/2).attr("y",-de.height/2).attr("width",de.width).attr("height",de.height).attr("rx",de.radius).attr("ry",de.radius).attr("stroke",e=>e.color||"grey").attr("fill",e=>e.color||"grey")},He=(n,e)=>{n.attr("cx",e).attr("cy",0).attr("r",1.2)},pt=(n,e,t=4)=>{n.attr("x",o=>-e-(o.left?o.width:0)).attr("y",-e).attr("rx",t).attr("ry",t).attr("width",o=>o.width+e*2).attr("height",o=>o.height+e*2)},ht=(n,e)=>{n.attr("class",b["expand-btn"]).attr("transform",t=>xi(t,e)).style("color",t=>t.color)},mt=(n,e)=>{n.attr("class",t=>wi().join(" ")).attr("transform",t=>ki(t,e))},gt=(n,e)=>{const t=Jt+ge.margin,o=e*2;n.attr("class",b.trigger).attr("x",s=>-e-(s.left?s.width+t:0)).attr("y",-e).attr("width",s=>s.width+o+t).attr("height",s=>s.height+o)},an=(n,e)=>{const t=n.attr("stroke",o=>o.color).attr("stroke-width",Ue);e?t.transition(e).attr("d",Ge):t.attr("d",Ge)},Ci=n=>{const e=n.append("tspan");return at(e),e},Si=n=>(at(n),n),Mi=n=>{const e=n.append("g");return $i(e.append("rect")),e.append("path").attr("d",pi(2,ge.side)),e},Di=n=>{const e=n.append("g");return Ei(e.append("rect")),He(e.append("circle"),-5),He(e.append("circle"),0),He(e.append("circle"),5),e},ln=n=>{const e=Mi(n);return e.on("click",Ft),e},cn=n=>{const e=Di(n);return e.on("click",Rt),e},Ti=(n,e)=>{if(n.select(`:scope > g.${b.content} > g.${b["expand-btn"]}`).on("click",Rt),Me.value.drag||Me.value.edit){const o=n.select(`:scope > g.${b.content} > g.${b.text}`);o.on("mousedown",Nt),Me.value.drag&&!e&&Ut(o),Me.value.edit&&o.on("click",Qe)}st.value&&n.select(`:scope > g.${b.content}`).on("mouseenter",Ps).on("mouseleave",zs)},Bi=n=>{var h;const e=!((h=n.data()[0])!=null&&h.depth),t=n.append("g");on(t),an(t.append("path"));const o=t.append("g").attr("class",b.content),s=o.append("rect"),i=o.append("g").attr("class",b.text),a=i.append("rect"),l=i.append("text");sn(l);const c=l.selectAll("tspan").data(tn).enter().append("tspan");at(c);const d=st.value?ln(o):void 0;let r;const p=n.data();return p.length!=0&&p[0].children.length!=0&&(r=cn(o)),nn(e,s,a,r,d),Ti(t,e),t.each((u,m)=>{!u.children||Re(u.children,t.filter((y,$)=>m===$))}),o.raise(),t},Oi=n=>{var r;const e=!((r=n.data()[0])!=null&&r.depth),t=Xt(500,Dt);on(n,t),an(n.select(":scope > path"),t);const o=n.select(`:scope > g.${b.content}`),s=o.select(":scope > rect"),i=o.select(`g.${b.text}`),a=i.select("rect"),l=i.select("text");sn(l,t),l.selectAll("tspan").data(tn).join(Ci,Si,p=>p.remove());let c=o.select(`g.${b["add-btn"]}`),d=o.select(`g.${b["expand-btn"]}`);if(st.value?c.node()||(c=ln(o)):c.remove(),!d.node()){const p=n.data();p.length!=0&&p[0].children.length!=0&&(d=cn(o))}return nn(e,s,a,d,c),n.each((p,h)=>{!p.children||Re(p.children,n.filter((u,m)=>h===m))}),o.raise(),n},Re=(n=[M.data],e=et)=>{e.selectAll(`g.${it(n[0]).join(".")}`).data(n,o=>o.gKey).join(Bi,Oi)};class Li{constructor(e,t,o,s){this.w=e,this.h=t,this.y=o,this.c=s,this.cs=s.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function ft(n){n.cs===0?(n.el=n,n.er=n,n.msel=n.mser=0):(n.el=n.c[0].el,n.msel=n.c[0].msel,n.er=n.c[n.cs-1].er,n.mser=n.c[n.cs-1].mser)}function ye(n){return n.y+n.h}class ji{constructor(e,t,o){this.lowY=e,this.index=t,this.next=o}}function _t(n,e,t){for(;t!==null&&n>=t.lowY;)t=t.next;return new ji(n,e,t)}function Ni(n,e,t,o){if(t!==e-1){const s=e-t;n.c[t+1].shift+=o/s,n.c[e].shift-=o/s,n.c[e].change-=o-o/s}}function Ai(n,e,t,o){n.c[e].mod+=o,n.c[e].msel+=o,n.c[e].mser+=o,Ni(n,e,t,o)}function Fi(n){return n.cs===0?n.tl:n.c[0]}function Ri(n){return n.cs===0?n.tr:n.c[n.cs-1]}function Ii(n,e,t,o){const s=n.c[0].el;s.tl=t;const i=o-t.mod-n.c[0].msel;s.mod+=i,s.prelim-=i,n.c[0].el=n.c[e].el,n.c[0].msel=n.c[e].msel}function Pi(n,e,t,o){const s=n.c[e].er;s.tr=t;const i=o-t.mod-n.c[e].mser;s.mod+=i,s.prelim-=i,n.c[e].er=n.c[e-1].er,n.c[e].mser=n.c[e-1].mser}function zi(n,e,t){let o=n.c[e-1],s=o.mod,i=n.c[e],a=i.mod;for(;o!==null&&i!==null;){ye(o)>t.lowY&&(t=t.next);const l=s+o.prelim+o.w-(a+i.prelim);l>0&&(a+=l,Ai(n,e,t.index,l));const c=ye(o),d=ye(i);c<=d&&(o=Ri(o),o!==null&&(s+=o.mod)),c>=d&&(i=Fi(i),i!==null&&(a+=i.mod))}o===null&&i!==null?Ii(n,e,i,a):o!==null&&i===null&&Pi(n,e,o,s)}function Vi(n){n.prelim=(n.c[0].prelim+n.c[0].mod+n.c[n.cs-1].mod+n.c[n.cs-1].prelim+n.c[n.cs-1].w)/2-n.w/2}function We(n){if(n.cs===0){ft(n);return}We(n.c[0]);let e=_t(ye(n.c[0].el),0,null);for(let t=1;t<n.cs;t++){We(n.c[t]);const o=ye(n.c[t].er);zi(n,t,e),e=_t(o,t,e)}Vi(n),ft(n)}function Hi(n){let e=0,t=0;for(let o=0;o<n.cs;o++)e+=n.c[o].shift,t+=e+n.c[o].change,n.c[o].mod+=t}function rn(n,e){e+=n.mod,n.x=n.prelim+e,Hi(n);for(let t=0;t<n.cs;t++)rn(n.c[t],e)}function Ki(n){We(n),rn(n,0)}class Ji{constructor(e,t){this.gap=e,this.bottomPadding=t}addBoundingBox(e,t){return{width:e+this.gap,height:t+this.bottomPadding}}removeBoundingBox(e,t){return{x:e+this.gap/2,y:t}}}class Ui{constructor(e){this.bb=e}layout(e){const t=this.convert(e);Ki(t);const{boundingBox:o,result:s}=this.assignLayout(t,e);return{result:s,boundingBox:o}}convert(e,t=0){const{width:o,height:s}=this.bb.addBoundingBox(e.width,e.height),i=[];if(e.children&&e.children.length)for(let a=0;a<e.children.length;a++)i[a]=this.convert(e.children[a],t+s);return new Li(o,s,t,i)}assignCoordinates(e,t){const{x:o,y:s}=this.bb.removeBoundingBox(e.x,e.y);t.x=o,t.y=s;for(let i=0;i<e.c.length;i++)this.assignCoordinates(e.c[i],t.children[i])}getSize(e,t){const{x:o,y:s,width:i,height:a}=e;if(t||(t={left:o,right:o+i,top:s,bottom:s+a}),t.left=Math.min(t.left,o),t.right=Math.max(t.right,o+i),t.top=Math.min(t.top,s),t.bottom=Math.max(t.bottom,s+a),e.children)for(const l of e.children)this.getSize(l,t);return t}assignLayout(e,t,o){const{x:s,y:i}=this.bb.removeBoundingBox(e.x,e.y);t.x=s,t.y=i;const{width:a,height:l}=t;o||(o={left:s,right:s+a,top:i,bottom:i+l}),o.left=Math.min(o.left,s),o.right=Math.max(o.right,s+a),o.top=Math.min(o.top,i),o.bottom=Math.max(o.bottom,i+l);for(let c=0;c<e.c.length;c++)this.assignLayout(e.c[c],t.children[c],o);return{result:t,boundingBox:o}}}const vt=n=>[n.width,n.height]=[n.height,n.width],Yi=n=>{n.parent?(n.dx=n.x-n.parent.x,n.dy=n.y-n.parent.y):(n.dx=0,n.dy=0)},le=(n,e)=>n.id=e,qi=n=>{n.parent?n.depth=n.parent.depth+1:n.depth=0},bt=n=>{n.parent&&n.parent.color&&(n.color=n.parent.color)},Gi=n=>{n.depth>1&&n.parent&&(n.left=n.parent.left)},Wi=n=>{const e=Object.assign({},n),t=Object.assign({},n);if(!n.collapse){const{children:o}=n;e.children=[],t.children=[],o.forEach(s=>{s.left?e.children.push(s):t.children.push(s),s.parent&&(s.parent=t)})}return{left:e,right:t}},Xe=(n,e,t="0")=>{var s;e.forEach(i=>{i(n,t)});const{children:o}=n;if(o)for(let i=0;i<o.length;){const a=o[i];a.id==="del"?(o.splice(i,1),(s=n.rawData.children)==null||s.splice(i,1)):(Xe(a,e,`${t}-${i}`),i+=1)}},yt=(n,e)=>{const t=new Ji(e,n);return new Ui(t)};class wt{constructor(e,t,o,s,i=Fn(Rn)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.update=!1,this.colorScale=i,this.getSize=s,this.layout=yt(t,o),this.data=this.createMdataFromData(e,"0"),this.renew(),this.update=!1}createMdataFromData(e,t,o=null){const{name:s,collapse:i,children:a,attr:l}=e,{width:c,height:d}=this.getSize(s),r=o?o.depth+1:0;let p=!1,h=o?o.color:"";r===1?(p=!!e.left,h=this.colorScale(`${this.colorNumber+=1}`)):r!==0&&o&&(p=o.left);const u={id:t,name:s,rawData:e,parent:o,left:p,color:h,depth:r,x:0,y:0,dx:0,dy:0,px:0,py:0,width:c,height:d,children:[],_children:[],collapse:!!i,gKey:this.gKey+=1,attr:l};return a&&(u.collapse?a.forEach((m,y)=>{u._children.push(this.createMdataFromData(m,`${t}-${y}`,u))}):a.forEach((m,y)=>{u.children.push(this.createMdataFromData(m,`${t}-${y}`,u))})),this.update=!1,u}renew(...e){Xe(this.data,[vt,qi,Gi]),this.data=this.l(this.data);const t=[vt,this.renewXY.bind(this),Yi];Xe(this.data,t.concat(e)),this.update=!0}l(e){const{left:t,right:o}=Wi(e);return this.layout.layout(t),this.layout.layout(o),this.diffY=o.x-t.x,this.rootWidth=t.height,o.children=e.children,o}renewXY(e){[e.x,e.y]=[e.y,e.x],e.left&&(e.x=-e.x+this.rootWidth,e.y+=this.diffY)}isUpdate(){return this.update}getRootWidth(){return this.rootWidth}setBoundingBox(e,t){this.layout=yt(e,t),this.renew()}find(e){const t=e.split("-").map(s=>~~s);let o=this.data;for(let s=1;s<t.length;s++){const i=t[s],{children:a}=o;if(i<a.length)o=a[i];else return null}return o.id===e?o:null}rename(e,t){if(e.length>0){const o=this.find(e);if(o&&o.name!==t){o.name=t,o.rawData.name=t;const s=this.getSize(o.name);o.width=s.width,o.height=s.height,this.renew()}return o}else return null}moveChild(e,t){var a,l;if(e===t)return null;const o=this.find(e),s=this.find(t),i=t.split("-").pop();if(i&&o&&s){const c=s.parent;(a=c==null?void 0:c.children)==null||a.splice(~~i,1),(l=c==null?void 0:c.rawData.children)==null||l.splice(~~i,1),s.parent=o,s.gKey=this.gKey+=1,s.depth=s.parent.depth+1,s.depth===1?s.color=this.colorScale(`${this.colorNumber+=1}`):s.left=s.parent.left,o.collapse?o._children.push(s):o.children.push(s),o.rawData.children?o.rawData.children.push(s.rawData):o.rawData.children=[s.rawData],this.renew(le,bt)}return s}moveSibling(e,t,o=0){const s=e.split("-"),i=t.split("-");let a=s.pop(),l=i.pop();if(e===t||s.length!==i.length||!a||!l)return null;const c=this.find(e),d=this.find(t);if(d&&c&&c.parent){a=parseInt(a,10),l=parseInt(l,10),a<l&&(l-=1);const{children:r}=c.parent,{children:p}=c.parent.rawData;if(r&&p)return r.splice(a,1),r.splice(l+o,0,c),p.splice(a,1),p.splice(l+o,0,c.rawData),c.depth===1&&(c.left=d.left),this.renew(le),c}return null}add(e,t){const o=this.find(e);if(o)if(o.collapse&&this.expand(e),o.rawData.children||(o.rawData.children=[]),typeof t=="string"){const s=t,i=this.getSize(s),a={name:s},l=o.color?o.color:this.colorScale(`${this.colorNumber+=1}`),c={id:`${o.id}-${o.children.length}`,name:s,rawData:a,parent:o,left:o.left,collapse:!1,color:l,gKey:this.gKey+=1,width:i.width,height:i.height,depth:o.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return o.children.push(c),o.rawData.children.push(a),this.renew(),c}else{const s=t,i=this.createMdataFromData(s,`${o.id}-${o.children.length}`,o);return o.children.push(i),o.rawData.children.push(s),this.renew(),i}return null}expand(e){return this.eoc(e,!1,[bt,le])}collapse(e){return this.eoc(e,!0)}eoc(e,t,o=[]){const s=this.find(e);return s&&(s.collapse=t,s.rawData.collapse=t,[s._children,s.children]=[s.children,s._children],this.renew(...o)),s}delete(e){const t=this.find(e);if(t&&t.parent)t.id="del",this.renew(le);else throw new Error(t?"\u6682\u4E0D\u652F\u6301\u5220\u9664\u6839\u8282\u70B9":"\u672A\u627E\u5230\u9700\u8981\u5220\u9664\u7684\u8282\u70B9")}deleteOne(e){var o;const t=this.find(e);if(t&&t.parent){const{parent:s,children:i,_children:a,collapse:l,rawData:c}=t,d=parseInt(e.split("-").pop(),10);s.children.splice(d,1,...l?a:i),(o=s.rawData.children)==null||o.splice(d,1,...c.children||[]),i.forEach(r=>{r.parent=s,r.depth===1&&(r.rawData.left=r.left)}),this.renew(le)}}addSibling(e,t,o=!1){var i;console.log(`[addSibling] id=${e},name=${t}`);const s=this.find(e);if(s&&s.parent){const a=parseInt(e.split("-").pop(),10),{parent:l,left:c}=s,d={name:t,left:c},r=this.getSize(t),p=o?a:a+1,h=l.color?l.color:this.colorScale(`${this.colorNumber+=1}`),u={name:t,parent:l,children:[],_children:[],color:h,collapse:!1,rawData:d,id:`${l.id}-${p}`,left:c,gKey:this.gKey+=1,depth:s.depth,width:r.width,height:r.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return l.children.splice(p,0,u),(i=l.rawData.children)==null||i.splice(p,0,d),console.log(`index=${a},start=${p},sibling.id=${u.id}`),this.renew(le),u}return null}addParent(e,t){var s;const o=this.find(e);if(o&&o.parent){const{parent:i,left:a,color:l}=o,c=this.getSize(t),d=parseInt(o.id.split("-").pop(),10),r={name:t,children:[o.rawData],left:a};(s=i.rawData.children)==null||s.splice(d,1,r);const p={rawData:r,left:a,name:t,color:l,collapse:!1,parent:i,id:o.id,depth:o.depth,width:c.width,height:c.height,gKey:this.gKey+=1,children:[o],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return o.parent=p,i.children.splice(d,1,p),this.renew(le),p}return null}changeLeft(e){console.log("changeLeft");const t=this.find(e);return t&&(t.left=!t.left,t.rawData.left=t.left,this.renew()),t}applayAttr(e,t,o){console.log("applayAttr");const s=this.find(e);if(s){let i=s.attr?s.attr:{},a=Object.keys(t)[0];i.hasOwnProperty(a)&&!o?delete i[a]:Object.assign(i,t),console.log(JSON.stringify(i)),s.attr=i,s.rawData.attr=i,this.renew()}return s}}let M;L.on("mmdata",n=>n?M=n:null);const I=(n=!0)=>{n&&ke.snap(M.data),Yt.emit("update:modelValue",In([M.data.rawData])),ui(),Re()},dn=(n,e,t=!1)=>{console.log(`rename: id/name=${n}/${e}`),M.rename(n,e),t||I()},Xi=(n,e)=>{M.moveChild(n,e),I()},kt=(n,e,t=0)=>{M.moveSibling(n,e,t),I()},un=(n,e)=>{const t=M.add(n,e);return I(),t},xt=n=>{M.delete(n),I()},Zi=n=>{M.deleteOne(n),I()},pn=n=>{M.expand(n),I()},hn=n=>{M.collapse(n),I()},$t=(n,e,t=!1)=>{const o=M.addSibling(n,e,t);return I(),o},Qi=(n,e)=>{const t=M.addParent(n,e);return I(),t},ea=n=>{M.changeLeft(n),I()},Ke=(n,e,t=!1)=>{M.applayAttr(n,e,t),I()};var ta={translation:{contextmenu:{collapse:"\u6298\u53E0\u8282\u70B9",expand:"\u5C55\u5F00\u8282\u70B9",delete:"\u5220\u9664\u8282\u70B9","delete-one":"\u5220\u9664\u5355\u4E2A\u8282\u70B9",add:"\u65B0\u5EFA\u5B50\u8282\u70B9","add-parent":"\u65B0\u5EFA\u7236\u8282\u70B9","add-sibling":"\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9","add-sibling-before":"\u5728\u6B64\u4E4B\u524D\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9",cut:"\u526A\u5207",copy:"\u62F7\u8D1D",paste:"\u7C98\u8D34",selectall:"\u5168\u9009",zoomin:"\u653E\u5927",zoomout:"\u7F29\u5C0F",zoomfit:"\u7F29\u653E\u81F3\u5408\u9002\u5927\u5C0F"}}},na={translation:{contextmenu:{collapse:"collapse",expand:"expand",delete:"delete","delete-one":"delete a single node",add:"add child node","add-parent":"add parent node","add-sibling":"add sibling node","add-sibling-before":"add sibling node before",cut:"cut",copy:"copy",paste:"paste",selectall:"select all",zoomin:"zoom in",zoomout:"zoom out",zoomfit:"zoom fit"}}};Tt.init({fallbackLng:"zh",lng:"zh",resources:{zh:ta,en:na}});const oa="_container_cqgs9_1",sa="_menu_cqgs9_1",ia="_disabled_cqgs9_47";var aa={container:oa,menu:sa,disabled:ia};const la=j({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(n,e){const t=S(!1),o=Pn(),s=S(),i=S(),a=N({top:0,left:0}),l=8;L.on("showContextmenu",async p=>{if(!s.value||!i.value)return;console.log("showContextmenu"),t.value=!!p,await zn();const{offsetWidth:h,offsetHeight:u}=s.value,{offsetWidth:m,offsetHeight:y}=i.value,{top:$,left:T}=n.position;a.top=$+y>u?u-y-l:$,a.left=T+m>h?T-m:T});const c=()=>t.value=!1;return{style:o,show:t,close:c,onClick:p=>{const h=u=>u.disabled==null?`icon_${u.name}`:u.name;c(),e.emit("click-item",h(p))},menuEle:i,containerEle:s,pos:a,i18n:Tt,note:p=>p?`( ${p} )`:""}}}),ca=["id"],ra=["onClick"];function da(n,e,t,o,s,i){return _e((v(),w("div",{class:P(n.style.container),ref:"containerEle"},[x("div",{onMousedown:e[0]||(e[0]=(...a)=>n.close&&n.close(...a))},null,32),x("div",{ref:"menuEle",id:n.style.menu,style:Q({top:n.pos.top+"px",left:n.pos.left+"px"})},[x("table",null,[(v(!0),w(U,null,te(n.groups,(a,l)=>(v(),w("tr",{key:l},[(v(!0),w(U,null,te(a,c=>(v(),w("td",{key:c.name},[x("div",{class:P(c.disabled?n.style.disabled:""),onClick:d=>n.onClick(c)},[x("div",null,H(c.name),1),x("div",null,H(n.note(c.note)),1)],10,ra)]))),128))]))),128))])],12,ca)],2)),[[Bt,n.show]])}const mn={};mn.$style=aa;var ua=F(la,[["render",da],["__cssModules",mn]]);const pa=j({name:"Mindmap",emits:["event_callback"],components:{Contextmenu:ua},props:{update:Boolean,modelValue:{type:Array,required:!0}},setup(n,e){Vn(()=>L.emit("mindmap-context",e)),Z(()=>{if(!z.value||!he.value||!Ve.value||!oe.value||!K.value)return;L.emit("selection-svg",se(z.value)),L.emit("selection-g",se(he.value)),L.emit("selection-asstSvg",se(Ve.value)),L.emit("selection-foreign",se(oe.value)),L.emit("mmdata",new wt(be.exports.cloneDeep(n.modelValue[0]),Oe,we,dt)),li.value=!1,I();const{svg:o,foreign:s}=R;s==null||s.raise(),vi(),o==null||o.on("mousedown",()=>{console.log("svg@mousedown"),document.getElementsByClassName(b.selected)[0]}),o==null||o.on("blur",()=>{console.log("svg@blur"),M.isUpdate()&&t("blur","")}),qs(!0),Xs(!0),Ws(!0),Zs(!0),Gs(!0),Te()}),A(()=>[n.update],o=>{console.log("props.update"),L.emit("mmdata",new wt(be.exports.cloneDeep(n.modelValue[0]),Oe,we,dt)),Re(),setTimeout(async()=>{Te()},500)});const t=(o,s)=>{console.log(`cmd=${o}, name=${s}`),e.emit("event_callback",o,s)};return{wrapperEle:W,svgEle:z,gEle:he,style:b,asstSvgEle:Ve,foreignEle:oe,foreignDivEle:K,centerView:fi,fitView:Te,download:_i,menu:si,contextmenuPos:Vt,onClickMenu:D,next:Ye,prev:qe,hasPrev:qt,hasNext:Gt}}}),ha=["id"],ma={ref:"gEle"},ga={ref:"foreignEle",style:{display:"none"}},fa={ref:"foreignDivEle",contenteditable:""};function _a(n,e,t,o,s,i){const a=V("contextmenu");return v(),w("div",{class:P(n.style.container)},[x("div",{id:n.style["svg-wrapper"],ref:"wrapperEle"},[(v(),w("svg",{class:P(n.style.svg),ref:"svgEle"},[x("g",ma,[(v(),w("foreignObject",ga,[x("div",fa,null,512)],512))],512)],2))],8,ha),(v(),w("svg",{ref:"asstSvgEle",class:P(n.style["asst-svg"])},null,2)),x("div",{class:P([n.style["button-list"],n.style["right-bottom"]])},[x("button",{onClick:e[0]||(e[0]=l=>n.fitView())},[x("i",{class:P(n.style.fit)},null,2)]),x("button",{onClick:e[1]||(e[1]=l=>n.download())},[x("i",{class:P(n.style.download)},null,2)])],2),x("div",{class:P([n.style["button-list"],n.style["right-top"]])},[x("button",{onClick:e[2]||(e[2]=(...l)=>n.prev&&n.prev(...l)),class:P({[n.style.disabled]:!n.hasPrev})},[x("i",{class:P(n.style.prev)},null,2)],2),x("button",{onClick:e[3]||(e[3]=(...l)=>n.next&&n.next(...l)),class:P({[n.style.disabled]:!n.hasNext})},[x("i",{class:P(n.style.next)},null,2)],2)],2),C(a,{position:n.contextmenuPos,groups:n.menu,onClickItem:n.onClickMenu},null,8,["position","groups","onClickItem"])],2)}var va=F(pa,[["render",_a]]);const ba={class:"mindmap"},ya=j({emits:["event_callback"],setup(n,{emit:e}){const{store_data:t}=q(),o=S([{name:"start",children:[]}]),s=N({height:window.innerHeight,update:!1});Z(()=>{console.log("[mounted]"),document.addEventListener("keydown",i)}),je(()=>{console.log("unmounted!"),document.removeEventListener("keydown",i)});const i=d=>{if(d.keyCode===83&&d.ctrlKey){d.preventDefault(),console.log("save"),l(o.value);return}};A(()=>t.state.obj,(d,r)=>{console.log("[watch-body]"),a(d.content)});const a=d=>{try{o.value=JSON.parse(d)}catch(r){console.log(r),o.value=[{name:"@start",children:[]}]}console.log("onChanged_body"),s.update=!s.update},l=d=>{t.do_cmd("save_file",JSON.stringify(o.value))},c=async(d,r)=>{switch(console.log(`[event_callback] cmd=${d}, va0=${r}`),d){case"toggle_editor":l(o.value);break;case"blur":l(o.value);break;default:t.do_cmd(d,r);break}};return(d,r)=>(v(),w("div",ba,[C(va,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=p=>o.value=p),update:_(s).update,onEvent_callback:c},null,8,["modelValue","update"])]))}});const wa={class:"modal-mask"},ka={class:"modal-wrapper"},xa={class:"modal-container"},$a={class:"header"},Ea={class:"form"},Ca=["disabled"],Sa=["disabled"],Ma={class:"modal-actions"},Da=["disabled"],Ta=j({emits:["event_callback"],setup(n,{emit:e}){const{store_dlg:t}=Ne(),{store_data:o}=q(),s=S(null),i=S(null),a=N({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});A(()=>t.state.objParam,u=>{l(u)});const l=u=>{const m=(y,$=!1)=>y!=null?y:$;console.log("[onChanged_objParam]"),a.title=u.title,a.title2=u.title2,a.edit=u.edit,a.edit_org=m(u.edit_org,u.edit),a.check=0,a.isShowDlg=!0,a.isNoEdit=m(u.isNoEdit),a.isFileOpen=m(u.isFileOpen),a.isReadOnly=m(u.isReadOnly),a.isCheck=m(u.isCheck),a.isMulti=m(u.isMulti),a.isDisabled=!0,a.action=u.action,p(!0),setTimeout(()=>{a.isMulti==!0?s.value.focus():i.value.focus()},500)},c=u=>{if(console.log(`[doAction] flg=${u}, edit=${a.edit}`),u){const m=a.action(a);o.do_cmd(m[0],m[1],m[2])}a.isShowDlg=!1,p(!1)},d=u=>{const y=(u.target.files||u.dataTransfer.files)[0],$=a.action(a);o.do_cmd($[0],y),a.isShowDlg=!1,p(!1)},r=()=>{const u=a.edit_org,m=a.edit==u&&!a.isReadOnly;return console.log(`[isDisabled]=${m}`),m},p=u=>{u==!0?document.addEventListener("keydown",h):document.removeEventListener("keydown",h)},h=u=>{const m=u.key;switch(console.log(`key = ${m}`),m){case"Enter":u.preventDefault(),c(!0);break;case"Escape":u.preventDefault(),c(!1);break}};return(u,m)=>{const y=V("fa");return _e((v(),re(Jn,{persistent:""},{default:Le(()=>[x("div",wa,[x("div",ka,[x("div",xa,[x("div",$a,H(_(a).title)+"?",1),x("form",Ea,[_(a).isFileOpen==!0?(v(),w("input",{key:0,class:"input",type:"file",onChange:d},null,32)):X("",!0),_(a).isNoEdit==!1?(v(),w(U,{key:1},[_(a).isMulti==!0?_e((v(),w("textarea",{key:0,class:"input",autofocus:"","onUpdate:modelValue":m[0]||(m[0]=$=>_(a).edit=$),disabled:_(a).isReadOnly,ref_key:"edit",ref:s},null,8,Ca)),[[rt,_(a).edit]]):_e((v(),w("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":m[1]||(m[1]=$=>_(a).edit=$),disabled:_(a).isReadOnly,ref_key:"edit2",ref:i,placeholder:"type text.."},null,8,Sa)),[[rt,_(a).edit]])],64)):X("",!0),_(a).isCheck==!0?(v(),w(U,{key:2},[_e(x("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":m[2]||(m[2]=$=>_(a).check=$)},null,512),[[Hn,_(a).check]]),me(" "+H(_(a).title2),1)],64)):X("",!0)]),x("div",Ma,[x("button",{class:"btn btn-ok",ref:"ok",disabled:r(),onKeydown:m[3]||(m[3]=Kn($=>c(!0),["enter"])),onClick:m[4]||(m[4]=$=>c(!0))},[C(y,{icon:"check"}),me(" "+H(_(a).title),1)],40,Da),x("button",{class:"btn btn-can",onClick:m[5]||(m[5]=$=>c(!1))},"cancel")])])])])]),_:1},512)),[[Bt,_(a).isShowDlg]])}}});var Ba=F(Ta,[["__scopeId","data-v-54e808bd"]]);const Oa={class:"container"},La={class:"main"},ja=j({emits:["event_callback"],setup(n,{emit:e}){const{store_data:t}=q(),{store_dlg:o}=Ne();St();const s=Ze(),i=N({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1,mode:0});Z(()=>{console.log("[mounted]"),a(),window.addEventListener("resize",l),document.body.style.overflow="hidden"}),je(()=>{console.log("unmounted!"),window.removeEventListener("resize",l)});const a=()=>{const r=h=>{if(console.log(`filename=${h}`),h=="/")t.do_cmd("restore_file","");else{let u=h.indexOf("#");u=u!=-1?u+1:2,t.do_cmd("open_file",h.substring(u))}};console.log("init");const p=s.fullPath;console.log(`route.fullPath=${s.fullPath}`),r(p),t.do_cmd("filter_menu",null),l(),t.do_cmd("load_config",null)},l=()=>{const r=window.innerHeight-40;console.log(`height=${r}`),i.height=r,t.update_height(r)},c=async(r,p)=>{switch(console.log(`[event_callback] cmd=${r}, va0=${p}`),r){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"config":i.objDlgConf={cmd:r,filename:"",commit:""};break;case"filelist":document.querySelector(".col-3");const h=!i.toggle_list;i.toggle_list=h,console.log(i.toggle_list);break;default:if(r.indexOf("dlg_")!=-1){const u=Object.assign({},d(r,p));o.update_param(u)}else t.do_cmd(r,p);break}},d=(r,p)=>{const h=No[r],u=p!=null?p:t.state.filename;return h.init(h,u),h};return A(()=>t.state.mode,(r,p)=>{console.log("[watch-mode]"),i.mode=r}),(r,p)=>(v(),w("div",Oa,[C(Ho,{ref:"appbar",onEvent_callback:c},null,512),C(Ba,{objParam:_(i).objDlgCmn,onEvent_callback:c},null,8,["objParam"]),x("div",La,[_(i).toggle_list?(v(),re(Wo,{key:0,class:"col-3",onEvent_callback:c,style:Q({height:_(i).height+"px"})},null,8,["style"])):X("",!0),_(i).mode==0?(v(),w(U,{key:1},[C(ys,{class:"col-2",ref:"pane",editor_toggle:_(i).editor_toggle,style:Q({height:_(i).height+"px"})},null,8,["editor_toggle","style"]),C(os,{class:"col-1",onEvent_callback:c,style:Q({height:_(i).height+"px"})},null,8,["style"])],64)):(v(),re(ya,{key:2,class:"col-4",ref:"pane",style:Q({height:_(i).height+"px"})},null,8,["style"]))])]))}});var Na=F(ja,[["__scopeId","data-v-5328903f"]]);const Aa={_class:"container"},Fa=j({emits:["event_callback"],setup(n,{emit:e}){const t=Ze(),o=N({filename:"",height:window.innerHeight,timer3:-1});Z(()=>{console.log("[mounted]"),s(),document.body.style.overflow="hidden"});const s=()=>{console.log("init");const i=t.path.substring(1);console.log(`filename=${i}`),o.filename=i,o.timer3=window.setTimeout(()=>{clearTimeout(o.timer3),window.print()},500)};return(i,a)=>{const l=V("MarkdownViewer");return v(),w("div",Aa,[me(H(_(o).filename)+" ",1),C(l,{class:"md_viewer",style:{"{\n          height":"initial"}})])}}}),Ra=[{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Fa},{name:"viewer",path:"/:pathMatch(.*)*",component:Na}],Ia=Un({history:Yn(),routes:Ra});function Pa(n={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:s,onRegisterError:i}=n;let a;const l=async(c=!0)=>{};return"serviceWorker"in navigator&&(a=new qn("./sw.js",{scope:"./"}),a.addEventListener("activated",c=>{c.isUpdate?window.location.reload():o==null||o()}),a.register({immediate:e}).then(c=>{s==null||s(c)}).catch(c=>{i==null||i(c)})),l}Pa();Gn.add(Wn);Xn(fo).use(Ia).component("fa",Zn).mount("#app");
