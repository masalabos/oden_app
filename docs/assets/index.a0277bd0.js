var ke=Object.defineProperty;var we=(s,e,t)=>e in s?ke(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>(we(s,typeof e!="symbol"?e+"":e,t),t);import{D as ye,a as ce,i as de,p as ue,u as _e,b as ie,r as A,d as L,c as z,e as j,o as f,f as k,g as w,F as B,h as $,j as U,t as N,k as D,l as q,w as me,m as O,n as K,q as C,s as te,v as P,x as V,y as $e,z as xe,A as G,B as Ee,C as Ce,E as Se,G as Me,H as re,R as je,I as ne,J as pe,K as Q,L as Le,M as le,N as Oe,T as Ae,O as Te,P as Ne,Q as De,S as Ie,_ as Fe,U as Be,V as Pe}from"./vendor.627b5464.js";const Re=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=t(n);fetch(n.href,c)}};Re();class R{constructor(){h(this,"id",-1);h(this,"content","");h(this,"path","");h(this,"title","");h(this,"group","");h(this,"atime",Date());h(this,"ctime",Date());h(this,"tags",[]);h(this,"htags",[]);h(this,"position")}set(e,t="",o=[],n=!1){t!=""&&(this.path=t),o!=[]&&(this.tags=o),this.content=e;const c=this.get_time();this.atime=c,n==!0&&(this.ctime=c)}set_default(e){this.path=e,this.content="",this.tags=[];const t=this.get_time();this.atime=t,this.ctime=t}copy(e){Object.assign(this,e)}duplicate(e,t=""){const o=new R;return o.copy(this),o.content=e,o.path=t,o.update_contentEx(),o.update_time(),o}update_content(e){e!=null&&(this.content=e),this.update_contentEx()}update_contentEx(){this.atime=this.get_time(),this.tags=this.build_tag(this.content)}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const t=o=>`00${o}`.slice(-2);return`${e.getFullYear()}/${t(e.getMonth()+1)}/${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`}update_time(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){console.log("[build_tag]");const t=[],o=[0,0,0,0,0],n=e.split(/\r\n|\n|\r/);for(let c=0;c<n.length;c++)if(n[c].search(/^\s*#/)!=-1){const i=n[c].split(" "),l=i[0].length;i.shift();const r=i.join(" ");t.push({text:r,line:c,tag:l,num:o[l]}),o[l]++}return t}split(e){const t=[],o=this.content.split(/\r\n|\n|\r/),n=this.tags.filter(function(r){return r.tag==e}),c=[],a=o.length;for(var i=0;i<n.length;i++){const r=n[i].line;c.push({start:r,end:a,title:n[i].text}),i!=0&&(c[i-1].end=r-1)}const l=this.path.replace(".","_");return c.reverse(),c.forEach(r=>{const d=o.splice(r.start,r.end).join(`\r
`),_=this.duplicate(d,`${l}/${r.title}`);t.push(_)}),t.reverse(),t}}class Ve extends ye{constructor(){super("OdenDB");h(this,"viewer");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class He{constructor(e){h(this,"caller");h(this,"db",new Ve);h(this,"dbx");h(this,"ctime","");h(this,"atime","");h(this,"getStrageEx",async()=>await this.getAll());h(this,"read",async e=>{const t=await this.dbx.get(e);return t!=null?t.data:null});h(this,"write",async(e,t)=>{const o=JSON.stringify(t);await this.dbx.put({key:e,data:o,ctime:this.set_time_DB()}),this.set_time_DB()});h(this,"delete",async e=>{await this.dbx.delete(e),this.set_time_DB()});this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(o=>{e[o.key]=o.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class Je{constructor(e){h(this,"_");h(this,"storeLS");h(this,"write",(e,t)=>this.storeLS.write(e,t));h(this,"delete",e=>this.storeLS.delete(e));h(this,"rename",async(e,t)=>{console.log(`[rename] _key_org=${e}, _key_new=${t}`);const o=this.as(await this.get(e));return o.path=t,await this.write(t,o),await this.delete(e),o});h(this,"split",async e=>{console.log(`[split] _key_org=${e}`);const o=this.as(await this.get(e)).split(1);return o.forEach(n=>{this.write(n.path,n)}),o});h(this,"merge",(e,t)=>{console.log(`[merge] _path=${e}`);const o=new R;return o.set_default(e),o.update_content(t),this.write(e,o),o});h(this,"as",e=>Object.assign(new R,e));h(this,"sync_DB",()=>this.storeLS.sync_DB());this._=e,this.storeLS=new He(this._)}async get(e){console.log(`[get] _key=${e}`);const t=await this.read(e);return t!=null?JSON.parse(t):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,t){console.log(`[set] _key=${e}`);const o=this.as(await this.get(e));return o.path==""&&(o.path=e),o.update_content(t),this.write(e,o),o}async set_ex(e,t){console.log(`[set_ex] _key=${e}`);const o=this.as(t);return t.path==""&&(t.path=e),o.update_content(void 0),this.write(e,o),o}async read(e){return await this.storeLS.read(e)}create(e){console.log(`[create] _key=${e}`);const t=new R;return e!=null&&(t.set_default(e),this.write(e,t)),t}}const se="menu.json";class Ke{constructor(e){h(this,"_");this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const t=await this._.mgrCache.getLstContent(e),o=this.buildMenu(t);return console.log(`${t.length}/${o.length}`),this._.contentEx.set(se,JSON.stringify(o)),o}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const t=await this._.contentEx.get(se);return JSON.parse(t.content)}}buildMenu(e){function t(n){const c=new Set;return n.forEach(a=>{c.add(a.group)}),[...c]}function o(n){console.log("storeEx_index:buildMenuEx");const c=t(n);return n.reduce((a,i)=>{if(i.path==se)return a;let l=i.group,r=i.title,u=`${l}/${r}`;return c.includes(u)&&(l=u,r=".index",u=`${l}/${r}`),a.push({key:u,group:l,title:r,path:i.path,atime:i.atime}),a},[])}return o(e).sort(this.compare_group)}compare_group(e,t){let o=e.group,n=t.group;o==n&&(o=`${e.group}/${e.title}`,n=`${t.group}/${t.title}`);const c=o.toUpperCase(),a=n.toUpperCase();let i=0;return c>a?i=1:c<a&&(i=-1),i}}class W{static async read(e){console.log(`[read] filename=${e}`);const t=new URLSearchParams;return t.append("filename",e),W.post_cmdEx("load_file_md",t)}static write(e,t){console.log(`[write] filename=${e}`);const o=new URLSearchParams;return o.append("filename",e),o.append("source",t),W.post_cmdEx("save_file_md",o)}static async get_cmdEx(e){const t="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:get_cmdEx] api=${t}`),ce.get(t).then(o=>o.data).catch(o=>{throw o.response.status})}static async post_cmdEx(e,t){const o="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:post_cmdEx] api=${o}`),ce.post(o,t).then(n=>n.data).catch(n=>{throw n.response.status})}}class Ue{constructor(e){h(this,"_");h(this,"backupEx",(e,t,o)=>{const n=()=>{const a=new URLSearchParams;a.append("lstContent",JSON.stringify(e)),W.post_cmdEx("backup_contents",a).then(i=>console.log(i)).catch(i=>console.log(i))},c=()=>{const a=new Blob([JSON.stringify(e)],{type:"text/plain"}),i=(r,u)=>{const d=new Date,_=m=>`00${m}`.slice(-2);return`${r}_${d.getFullYear()}${_(d.getMonth()+1)}${_(d.getDate())}_${_(d.getHours())}.${u}`},l=document.createElement("a");l.download=i("lstData","json"),l.href=URL.createObjectURL(a),l.click(),URL.revokeObjectURL(l.href)};switch(console.log(`[backup] mode=${t}`),t){case"backup":n();break;case"export":c();break}});this._=e}async restoreEx(e,t,o){function n(l){l.forEach(r=>{const u=new R;u.copy(r),u.update_contentEx(),u.update_time(),i.write(u.path,u)})}async function c(l,r){W.get_cmdEx("restore_contents").then(u=>{n(u),l(u)}).catch(u=>{console.log(u),r(null)})}async function a(l,r,u){const d=new FileReader;d.onload=()=>{var v;console.log("onload");const _=(v=d.result)!=null?v:"",m=JSON.parse(_);n(m),r(m)},d.onerror=_=>{u("error")},d.readAsText(l)}console.log("[importExport:restore]");const i=this._.contentEx;return new Promise(function(l,r){switch(e){case"restore":c(l,r);break;case"import":a(t,l,r);break}})}}class qe{constructor(e){h(this,"_");h(this,"journal2",async(e,t)=>{const o=(c,a)=>`
## ${this._.contentEx.as(c).cnv_time(t)}
${a}
`;console.log("[journal]");const n=await this.geolocation();return e.content+=o(e,n),e});h(this,"geolocation",()=>new Promise(e=>{let t="";navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{t=`(Latitude,longitude)=(${o.coords.latitude},${o.coords.longitude})
`,e(t)},o=>{switch(o.code){case 1:t="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:t="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:t="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}e(t)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),e(t))}));h(this,"chat",async(e,t,o)=>{const n=m=>["sun","mon","tue","wed","thu","fri","sat"][m],c=m=>{const v=I=>`00${I}`.slice(-2),E=`${m.getFullYear()}/${v(m.getMonth()+1)}/${v(m.getDate())}(${n(m.getDay())})`,S=`${v(m.getHours())}:${v(m.getMinutes())}`;return[E,S]},a=(m,v)=>m!==v?`
## ${v}
`:"",i=m=>{const v=o.isNoList?"":"- ",E=o.isAddTime?`${m} : `:"";return`${v}${E}${t}
${d}`};console.log("[chat]");const l=e.content.indexOf(`
`),[r,u]=c(new Date),d=o.isAddGeo?await this.geolocation()+`
`:"",_=a(e.content.substring(0,l),r)+i(u);return e.content=`${r}${e.content.substring(l)}${_}`,e});this._=e}async path_rename(e,t,o){console.log(`_from=${e}, _to=${t}`);const n=this.collect_filename_by_group(e,o);for(let c=0;c<n.length;c++){const a=n[c],i=`${a[1]}/${a[0]}`,l=`${t}${a[2]}/${a[0]}`;await this._.contentEx.rename(i,l)}}async path_delete(e,t){console.log(`_path=${e}`);const o=this.collect_filename_by_group(e,t);for(let n=0;n<o.length;n++){const c=o[n],a=`${c[1]}/${c[0]}`;await this._.contentEx.delete(a)}}async path_merge(e,t,o){console.log(`_path=${e}`);const n=[],c=this.collect_filename_by_group(e,o);for(let i=0;i<c.length;i++){const l=c[i],r=`${l[1]}/${l[0]}`,u=await this._.contentEx.get(r);n.push(u.content)}const a=n.join(`\r
`);return this._.contentEx.merge(t,a)}collect_filename_by_group(e,t){console.log(`[collect_filename_by_group] group=${e}`);const o=[],n=e.length!=0?1:0;return t.forEach((c,a)=>{if(c.group==e){const i=c.group.substring(e.length+n);o.push([c.title,c.group,i.length!=0?`/${i}`:""])}}),o}}class ze{constructor(e){h(this,"_");this._=e}async getLstContent(e){console.log("[getLstContent]");const t=c=>{const a=e.path==""?!0:c.path.indexOf(e.path)!=-1,i=e.keyword==""?!0:c.content.toLowerCase().indexOf(e.keyword)!=-1;return a&&i},o=await this.buildLstContent();return e!=null?o.filter(t):o}async buildLstContent(){var c;console.log("[buildLstContent]");const e=a=>{var r,u;let i=a.path;(i==""||i==null)&&(i=`@test/${new Date().toLocaleString()}`);const l=i.split("/");return a.title=(r=l.pop())!=null?r:".",a.group=(u=l.join("/"))!=null?u:"@test",a.tags=[],a.htags=[],a},t=await this._.contentEx.storeLS.getStrageEx(),o=[],n=a=>t[a];for(const a of Object.keys(t))try{o.push(e(JSON.parse((c=n(a))!=null?c:"")))}catch(i){console.log(`@ error key=${a},e=${i} - other error`)}return o}}class Ye{constructor(){h(this,"contentEx",new Je(this));h(this,"mgrExchange",new Ue(this));h(this,"mgrEtc",new qe(this));h(this,"mgrMenu",new Ke(this));h(this,"mgrCache",new ze(this));console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,t){return this.contentEx.set(e,t)}async cmd_save_ex(e,t){return this.contentEx.set_ex(e,t)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_rename(e,t){await this.contentEx.rename(e,t)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,t="",o=null){const n=await this.mgrCache.getLstContent(o);this.mgrExchange.backupEx(n,e,t)}async cmd_restoreEx(e,t,o=""){await this.mgrExchange.restoreEx(e,t,o)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,t,o)}async cmd_path_delete(e){const t=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,t)}async cmd_path_merge(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,t,o)}async cmd_chat(e,t,o){const c=(()=>{const l=new Date;return`${e}${o.mode}_${l.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${c}`);const a=await this.contentEx.get(c),i=await this.mgrEtc.chat(a,t,o);return await this.contentEx.set(c,i.content),[i,c]}}class Ge{constructor(e){h(this,"KEY","");console.log(e),this.KEY=e}get(e){var t;if(localStorage.getItem(this.KEY)!=null){const o=JSON.parse((t=localStorage.getItem(this.KEY))!=null?t:"");e(o),console.log(o)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const We=1e3*60*10,ge=Symbol(),Ze=()=>{const s=_e(),e=ie(),t=A({storeEx:new Ye,persisted:new Ge("lifeLog-Viewer-params"),filename:"",obj:new R,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),o=p=>{console.log(`[update_filename] : new=${p}`),p!=t.filename&&n(p)},n=async p=>{const g=y=>{e.path.indexOf(y)==-1&&(console.log(`_value=${y}`),s.push(`/${y}`)),t.persisted.set({filename:y}),t.filename=y};if(console.log(`[load_obj] : new=${p}`),p!=""){const y=await t.storeEx.cmd_load(p);l(y)}else r("");g(p)},c=()=>{console.log("restore_filename"),t.persisted.get(p=>{o(p.filename)})},a=async p=>{if(p==""){console.log("skip save - empty data");return}r(p),l(t.obj),await t.storeEx.cmd_save_ex(t.filename,t.obj),_()},i=()=>{console.log("[auto_save] start"),t.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(t.intervalId_autoSave)),t.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await b("export",null,null),t.intervalId_autoSave=null},We)},l=p=>{const g=p instanceof R?p:Object.assign(new R,p);g.update_contentEx(),t.tags=g.tags,t.obj=g},r=p=>{t.obj.content=p},u=async(p,g)=>{if(console.log(p),g!=null){const y=await t.storeEx.cmd_load(g);y.position=p,await t.storeEx.cmd_save_ex(g,y)}else t.obj.position=p},d=p=>{t.dictMenu=p},_=()=>{setTimeout(async()=>{d(await t.storeEx.cmd_rebuild()),i()},250)},m=p=>{t.jump=p,p!=-1&&(console.log(`jump=${p}`),t.ObjTag=JSON.parse(JSON.stringify(t.tags[p])),console.log(JSON.stringify(t.ObjTag)))},v=p=>{t.height=p},E=async(p,g)=>{const[y,M]=await t.storeEx.cmd_chat(t.path_expand,p,g);l(y),o(M),_()},S=async(p,g)=>{const y=await t.storeEx.cmd_exist(p);if(g==y)return!0;{const M=g?`error : ${p} is not exist. please enter exist filename.`:`error : ${p} is already exist. please enter other filename.`;return console.log(M),!1}},I=async(p,g)=>{await S(p,!1)&&(await t.storeEx.cmd_rename(g,p),o(p),_())},F=async(p,g)=>{const y=x(g)[0],M=x(p)[0];await t.storeEx.cmd_path_rename(y,M),o(""),_()},b=async(p,g,y)=>{console.log(`[do_cmd] mode=${p}`);let M=g!=""?g:t.filename,Y="",Z;switch(p){case"update_jump":m(g);break;case"rebuild_menu":_();break;case"filter_menu":const oe=g;g!=null&&(oe.path=oe.isUnderFolder?x(t.filename)[0]:""),d(await t.storeEx.cmd_getMenu(oe));break;case"open_file":o(g);break;case"restore_file":c();break;case"save_file":await a(g);break;case"new":await S(g,!1)&&(await t.storeEx.cmd_create(g),o(g),_());break;case"delete":await S(M,!0)&&(await t.storeEx.cmd_delete(M),o(""),_());break;case"rename":I(g,y);break;case"backup":t.storeEx.cmd_backup("backup");break;case"export":t.storeEx.cmd_backup("export");break;case"restore":await t.storeEx.cmd_restoreEx("restore",null),_();break;case"import":await t.storeEx.cmd_restoreEx("import",g),_();break;case"split":await S(M,!0)&&(await t.storeEx.cmd_split(M),_());break;case"path_rename":F(g,y);break;case"path_delete":Y=x(g)[0],await t.storeEx.cmd_path_delete(Y),o(""),_();break;case"path_merge":Y=x(g)[0],M=`${Y}.md`,await S(M,!1)&&(await t.storeEx.cmd_path_merge(Y,M),o(M),_());break;case"print":const ve=s.resolve({path:`/print/${t.filename}`});window.open(ve.href,"_blank");break;case"journal":E("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":E(g,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":E(g,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":Z={keyword:y.filter,isUnderFolder:y.isCheck,path:""},d(await t.storeEx.cmd_getMenu(Z));break;case"update_position":await u(g,y);break;case"move_archive":I(`@archive/${g}`,g);break;case"move_path_archive":F(`@archive/${g}`,g);break;case"export_archive":Z={keyword:"",isUnderFolder:!0,path:"@archive/"},t.storeEx.cmd_backup("export","",Z);break}},x=p=>{const g=p.split("/"),y=g[g.length-1];return[g.slice(0,-1).join("/"),y]};return{store_data:{state:t,update_height:v,do_cmd:b}}},Qe=()=>{ue(ge,Ze())},H=()=>de(ge),Xe=()=>{const s=A({objParam:null});return{store_dlg:{state:s,update_param:t=>{s.objParam=t}}}},he=Symbol(),et=()=>{ue(he,Xe())},ae=()=>de(he);const tt=L({setup(s){return Qe(),et(),(e,t)=>{const o=j("routerView");return f(),z(o)}}});var T=(s,e)=>{const t=s.__vccOpts||s;for(const[o,n]of e)t[o]=n;return t};const ot={key:0,class:"item"},nt={key:1,class:"line"},st={key:1,class:"folder"},it={key:2,class:"dropdown"},at=L({props:{item:{type:null,required:!0}},emits:["event_callback"],setup(s,{emit:e}){const t=s,o=A({isOpen:!1,item:t.item,isFolder:t.item.children&&t.item.children.length,isActive:!0}),n=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},c=a=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const i=a.cmd;n(i,null)}};return(a,i)=>{const l=j("fa"),r=j("MenuTreeItem",!0);return f(),k("div",{class:"menu_tree",onClick:i[0]||(i[0]=u=>c(w(o).item)),onContextmenu:i[1]||(i[1]=me(()=>{},["right","prevent"]))},[w(o).isFolder?D("",!0):(f(),k(B,{key:0},[w(o).item.title!=""?(f(),k("span",ot,[$(l,{icon:w(o).item.icon},null,8,["icon"]),U(" "+N(w(o).item.title),1)])):D("",!0),w(o).item.title==""?(f(),k("div",nt)):D("",!0)],64)),w(o).isFolder?(f(),k("span",st,[$(l,{icon:w(o).item.icon},null,8,["icon"]),U(" "+N(w(o).item.title),1)])):D("",!0),w(o).isFolder?(f(),k("div",it,[(f(!0),k(B,null,q(w(o).item.children,(u,d)=>(f(),k("div",{key:d},[$(r,{item:u,onEvent_callback:n},null,8,["item"])]))),128))])):D("",!0)],32)}}});var ct=T(at,[["__scopeId","data-v-af6b6e1a"]]);const rt=L({props:{mouse:{type:null,required:!0},items:{type:Array,required:!0}},emits:["event_callback"],setup(s,{emit:e}){const t=s;console.log(`[props]=${JSON.stringify(t)}`);const o=A({items:t.items,pos_x:-1,pos_y:-1,isShow:!1,style:"display:none"});console.log(`[state]=${JSON.stringify(o)}`),O(()=>t.mouse,(a,i)=>{console.log("props"),o.isShow=!0,o.pos_x=t.mouse.clientX,o.pos_y=t.mouse.clientY,o.items=t.items,o.style="display:block"});const n=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},c=a=>{o.style=a?"display:block":"display:none"};return(a,i)=>(f(),k("div",{class:"menu",style:K(w(o).style),onMouseover:i[0]||(i[0]=l=>c(!0)),onMouseleave:i[1]||(i[1]=l=>c(!1))},[(f(!0),k(B,null,q(w(o).items,l=>(f(),k("div",{key:l.path},[$(ct,{item:l,onEvent_callback:n},null,8,["item"])]))),128))],36))}});var fe=T(rt,[["__scopeId","data-v-680ebf40"]]);const lt=L({props:{objMenu:{type:Array,required:!0}},emits:["event_callback"],setup(s,{emit:e}){const o=A({items:s.objMenu,event:void 0}),n=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},c=a=>{console.log("onClick"),o.event=a};return(a,i)=>{const l=j("fa");return f(),k("div",{class:"dropdown",onClick:c},[$(l,{icon:"bars"}),$(fe,{mouse:w(o).event,items:w(o).items,onEvent_callback:n},null,8,["mouse","items"])])}}});var dt=T(lt,[["__scopeId","data-v-3a47341c"]]);const ut=L({emits:["event_callback"],props:{objMenuItem:{type:Array,default:[]}},setup(s,e){const t=A({items:[],items2:[],isShowDlg:!1});O(()=>s.objMenuItem,(i,l)=>{t.items=o(i),t.items2=t.items.slice(0,5)});function o(i){console.log("[cnvLstRecent]");function l(u,d){const _=u.atime,m=d.atime;let v=0;return _>m?v=-1:_<m&&(v=1),v}const r=[...i];return r.sort(l),r.slice(0,15)}function n(i){const l=t.items[i].path;e.emit("event_callback","open_file",l),t.isShowDlg=!1}function c(i){t.isShowDlg=i}return{state:t,mouse_hover:c,select_file:n,tooltip:i=>`${i.title}/${i.group}`}}}),_t={class:"base"},mt={key:0,class:"dropdown"},pt=["onClick"],gt={class:"title_sub2"},ht={class:"title"},ft={class:"title_sub"},bt={class:"base2"};function vt(s,e,t,o,n,c){const a=j("fa"),i=j("button2");return f(),k("div",_t,[C("span",{class:"_base",onMouseover:e[0]||(e[0]=l=>s.mouse_hover(!0)),onMouseleave:e[1]||(e[1]=l=>s.mouse_hover(!1))},[$(a,{icon:"history",class:"_item"}),s.state.isShowDlg?(f(),k("ul",mt,[(f(!0),k(B,null,q(s.state.items,(l,r)=>(f(),k("li",{class:"item",key:r,onClick:u=>s.select_file(r)},[$(a,{class:"title_item",icon:"file-alt"}),C("span",gt,N(l.group)+"/ ",1),C("span",ht,N(l.title),1),C("span",ft," ["+N(l.atime)+"]",1)],8,pt))),128))])):D("",!0)],32),C("div",bt,[(f(!0),k(B,null,q(s.state.items2,(l,r)=>(f(),z(i,{class:"btn",key:r,onClick:u=>s.select_file(r)},{default:te(()=>[U(N(l.title),1)]),_:2},1032,["onClick"]))),128))])])}var kt=T(ut,[["render",vt],["__scopeId","data-v-4be6d922"]]);const wt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],yt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],$t=[{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],xt={dlg_import:{init:(s,e)=>{s.title="Restore",s.isFileOpen=!0,s.isNoEdit=!0,s.edit=""},action:s=>["import"]},dlg_delete:{init:(s,e)=>{s.title="Delete",s.isReadOnly=!0,s.edit=e},action:s=>["delete",s.edit,""]},dlg_rename:{init:(s,e)=>{s.title="Rename",s.edit=e},action:s=>["rename",s.edit,s.edit_org]},dlg_new:{init:(s,e)=>{s.title="Create",s.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:s=>["new",s.edit,""]},dlg_path_rename:{init:(s,e)=>{s.title="Rename of Path",s.edit=e.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_rename",s.edit,s.edit_org]},dlg_path_delete:{init:(s,e)=>{s.title="Delete of Path",s.isReadOnly=!0,s.edit=e.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_delete",s.edit,""]},dlg_path_merge:{init:(s,e)=>{s.title="Merge of Path",s.isReadOnly=!0,s.edit=e.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_merge",s.edit,""]},dlg_tweet:{init:(s,e)=>{s.title="Tweet",s.edit=""},action:s=>["tweet",s.edit,""]},dlg_bookmark:{init:(s,e)=>{s.title="Bookmark",s.edit="",s.isMulti=!0},action:s=>["bookmark",s.edit,""]},dlg_filter:{init:(s,e)=>{s.title="Filter",s.title2="target under folder",s.edit="",s.edit_org="@",s.isCheck=!0},action:s=>(console.log("dlg_filter"),["filter",s.filename,{filter:s.edit,isCheck:s.check}])}},J={FCS:1500,BKS:300,BKL:900,FCS2:300,BKS2:60,BKL2:180,SNZ:300},X=[{id:0,name:"none",color:"#2196F3",time:[J.FCS,0],cmd_next:"do_focus"},{id:1,name:"focus",color:"#03A9F4",time:[J.FCS,J.FCS2],cmd_next:"do_pause"},{id:2,name:"break-short",color:"#4CAF50",time:[J.BKS,J.BKS2],cmd_next:"do_focus"},{id:3,name:"break-long",color:"#FF9800",time:[J.BKL,J.BKL2],cmd_next:"do_focus"},{id:4,name:"pause",color:"#9E9E9E",time:[0,0],cmd_next:"do_pause"},{id:5,name:"expire",color:"#FFEB3B",time:[0,0],cmd_next:"do_focus"},{id:6,name:"snooz",color:"#2196F3",time:[J.SNZ,0],cmd_next:"do_stop"}];class Et{constructor(e){h(this,"timer");h(this,"state");h(this,"timer3");h(this,"callback_timer");h(this,"dct_param_popup",{to_break:{_message:"Let's have a [coffee break]?",_btn:"do_break",_action:e=>{const t=e==0?"do_break":"do_snooz";this.doAction(t)},_icon:"../icon/break.png"},to_focus:{_message:"Let's get back to [focus]!",_btn:"do_focus",_action:e=>{const t=e==0?"do_focus":"do_snooz";this.doAction(t)},_icon:"../icon/focus.png"}});this.callback_timer=e,this.state={time_all:1,time_total:1,mode:-1,cnt:{focus:1,sleep:0,snooz:0,add:0},mode_before:-1,isPause:!1,btn_enable:0,color_bk:""},this.timer3=-1,this.mounted()}mounted(){console.log("mounted"),this.doAction("do_stop")}display(){const e=n=>(n<10?"0":"")+n,t=e(Math.floor(this.state.time_total/60)),o=e(this.state.time_total-Number(t)*60);return`${t}:${o}`}get_status_info(e){return X[e]}get_state(){return this.state}func_update(e){e.state.time_total--,e.watch_time_total(e.state.time_total),e.callback_timer(e.state),console.log(e.state.time_total)}doAction(e,t=0){const o=()=>{this.timer=setInterval(this.func_update,1e3,this),this.state.isPause=!1},n=()=>{clearInterval(this.timer),this.state.isPause=!1},c=l=>(console.log(`cnt_pomodoro=${l}`),l%3==0?3:2),a=(l,r=0)=>{this.state.mode_before=this.state.mode,this.state.mode=l,this.set_color_bk(l),i(r)},i=(l=0)=>{const r=X[this.state.mode].time[l];this.state.time_total=r,this.state.time_all=r};switch(console.log(`[doAction] cmd=${e},type=${t},mode=${this.state.mode}`),e){case"do_focus":n(),a(1),o(),this.state.cnt.focus+=1;break;case"do_break":n(),a(c(this.state.cnt.focus)),this.state.cnt.sleep+=1,o();break;case"do_snooz":n(),i(1),this.state.cnt.snooz+=1,o();break;case"do_stop":n(),a(0);break;case"do_add":const l=300;this.state.time_total+=l,this.state.cnt.add+=1;break;case"do_pause":this.state.isPause?(this.set_color_bk(this.state.mode),o(),this.state.isPause=!1):(this.set_color_bk(4),n(),this.state.isPause=!0);break;case"do_reset":this.doAction(this.state.mode==1?"do_focus":"do_break");break;case"do_next":this.doAction(this.state.mode!=1?"do_focus":"do_break");break;case"goto":this.doAction(X[this.state.mode].cmd_next);break}console.log(`#0 state=${JSON.stringify(this.state)}`)}set_color_bk(e){this.state.color_bk=X[e].color}watch_time_total(e){const t=()=>{clearInterval(this.timer)};if(!(e>0))switch(this.state.mode){case 1:t(),this.openSnackbar(this.dct_param_popup.to_break);break;case 2:case 3:t(),this.openSnackbar(this.dct_param_popup.to_focus);break}}openSnackbar(e){e._message,e._icon,e._btn}pre_doAction(e){console.log(`[pre_doAction] cmd=${e}`)}}const Ct=L({emits:["event_callback"],setup(s,e){const t=r=>{n.core=r,n.time_total=r.time_total,n.time_all=r.time_all,n.color_bk=r.color_bk},o=new Et(t),n=A({core:void 0,time_total:-1,time_all:-1,color_bk:"",totalTime:1,displayed:0,tbl_timer:[1500,1500,300,900],btn_enable:0,state_status:-1,state:{times:1,color_bk:"blue",status_before:-1}}),c=P(()=>`--color-bk : ${n.color_bk};`),a=P(()=>{const r=n.time_total/n.time_all*100;return`--per-now : ${100-r}%; --color-bk : ${n.color_bk};`}),i=P(()=>{const r=m=>(m<10?"0":"")+m,u=n.time_total,d=r(Math.floor(u/60)),_=r(u-Number(d)*60);return`${d}:${_}`}),l=(r,u=0)=>{o.doAction(r,u)};return O(()=>n.state_status,(r,u)=>{}),V(()=>{console.log("[mounted]"),o.doAction("do_focus")}),{state:n,display:i,doAction:l,disp_circle:a,disp_color_bk:c}}}),St=s=>($e("data-v-f35a5f26"),s=s(),xe(),s),Mt=St(()=>C("div",{class:"title"},"Pomodoro",-1));function jt(s,e,t,o,n,c){const a=j("fa");return f(),k("div",{id:"popup",class:"panel",style:K({background:s.state.color_bk})},[C("div",{class:"circle",style:K(s.disp_circle)},null,4),Mt,C("div",{class:"time button",onClick:e[0]||(e[0]=i=>s.doAction("do_pause"))},N(s.display),1),$(a,{icon:"play",class:"do_focus button",onClick:e[1]||(e[1]=i=>s.doAction("do_focus"))}),$(a,{icon:"stop",class:"do_stop button",onClick:e[2]||(e[2]=i=>s.doAction("do_stop"))}),$(a,{icon:"plus",class:"do_add button",onClick:e[3]||(e[3]=i=>s.doAction("do_add"))}),$(a,{icon:"forward",class:"do_next button",onClick:e[4]||(e[4]=i=>s.doAction("do_next"))})],4)}var Lt=T(Ct,[["render",jt],["__scopeId","data-v-f35a5f26"]]);const Ot=L({emits:["event_callback"],components:{MenuCmd:dt,MenuRecent2:kt,PomodoroPuchi:Lt},setup(s,e){const{store_data:t}=H();ae();const o=G(null),n=A({filename:"@",objMenu:wt,dctMenu:[]});V(()=>{console.log("[mounted]")});const c=r=>{console.log(`[doAction] cmd=${r}`),e.emit("event_callback",r,!0)};O(()=>t.state.filename,(r,u)=>{console.log(`[watch:filename] ${r}`),i(r)}),O(()=>t.state.dictMenu,(r,u)=>{n.dctMenu=r}),O(()=>t.state.jump,(r,u)=>{window.setTimeout(()=>{a()},500)});const a=()=>{o.value.scrollIntoView({})},i=r=>{console.log(`[onChanged_filename] new=${r}`),n.filename=r,a()};return{state:n,doAction:c,event_callback:(r,u)=>{console.log(`[event_callback] cmd=${r}`),r=="top"?o.value.scrollIntoView({}):e.emit("event_callback",r,u)},appbar:o}}}),At={class:"nav"},Tt=["title"],Nt={class:"cmd"};function Dt(s,e,t,o,n,c){const a=j("MenuCmd"),i=j("MenuRecent2"),l=j("fa"),r=j("PomodoroPuchi");return f(),k("header",{class:"appbar",ref:"appbar",onClick:e[6]||(e[6]=u=>s.event_callback("top",!0))},[C("nav",At,[$(a,{class:"item",objMenu:s.state.objMenu,onEvent_callback:s.event_callback,title:"menu"},null,8,["objMenu","onEvent_callback"]),C("section",{class:"item logo",onClick:e[0]||(e[0]=u=>s.event_callback("filelist",!0)),title:s.state.filename},"Oden",8,Tt),$(i,{class:"item",objMenuItem:s.state.dctMenu,onEvent_callback:s.event_callback,title:"history"},null,8,["objMenuItem","onEvent_callback"]),s.state.filename!==""?(f(),k("span",{key:0,class:"item name",onClick:e[1]||(e[1]=u=>s.event_callback("dlg_rename",null))}," ["+N(s.state.filename)+"] ",1)):D("",!0),C("span",{class:"item mark",onClick:e[2]||(e[2]=u=>s.doAction("toggle_editor")),title:"editor/viewer"},[$(l,{icon:"edit"})])]),C("span",Nt,[C("span",{class:"item",onClick:e[3]||(e[3]=u=>s.doAction("dlg_filter")),title:"filter"},[$(l,{icon:"paw"})]),C("span",{class:"item",onClick:e[4]||(e[4]=u=>s.doAction("dlg_tweet")),title:"tweet"},[$(l,{icon:"grimace"})]),C("span",{class:"item",onClick:e[5]||(e[5]=u=>s.doAction("dlg_bookmark")),title:"bookmark"},[$(l,{icon:"bookmark"})]),$(r,{onEvent_callback:s.event_callback,_class:"ma-1 pa-0 text-right"},null,8,["onEvent_callback"])])],512)}var It=T(Ot,[["render",Dt],["__scopeId","data-v-6bf5fa8b"]]);const Ft={class:"file_tree"},Bt=["onContextmenu"],Pt=["title"],Rt={key:1,class:"folder"},Vt={key:0},Ht=L({props:{item:{type:Object,required:!0}},emits:["event_callback"],setup(s,{emit:e}){const t=s,o=A({isOpen:!1,item:t.item,isFolder:t.item.children&&t.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:n}=H();O(()=>n.state.filename,(u,d)=>{r(u)});const c=(u,d)=>{console.log(`[event_callback] cmd=${u}`),e("event_callback",u,d)},a=(u,d)=>{console.log(`[event_callbackEx] cmd=${u}`),e("event_callback",u,o.item.path)};V(()=>{r(n.state.filename)});const i=u=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const d=u.path;console.log(`onClick-filename=${d}`),n.do_cmd("open_file",d)}},l=u=>{console.log("onClickEx"),o.menu=o.isFolder?$t:yt,o.event=u},r=u=>{o.item.path==u,u.indexOf(o.item.name)!=-1&&(o.isOpen=!0),o.class_item=o.item.path==u?"item active":"item"};return(u,d)=>{const _=j("fa"),m=j("tree-item",!0);return f(),k("div",Ft,[$(fe,{mouse:w(o).event,items:w(o).menu,onEvent_callback:a},null,8,["mouse","items"]),C("div",{onContextmenu:me(l,["prevent"]),onClick:d[0]||(d[0]=v=>i(w(o).item))},[w(o).isFolder?D("",!0):(f(),k("div",{key:0,class:Ee(w(o).class_item),title:w(o).item.time},N(w(o).item.name),11,Pt)),w(o).isFolder?(f(),k("div",Rt,[$(_,{icon:w(o).isOpen?"folder-open":"folder"},null,8,["icon"]),U(" "+N(w(o).item.name),1)])):D("",!0)],40,Bt),w(o).isOpen?(f(),k("div",Vt,[(f(!0),k(B,null,q(w(o).item.children,(v,E)=>(f(),k("div",{key:E},[$(m,{item:v,onEvent_callback:c},null,8,["item"])]))),128))])):D("",!0)])}}});var Jt=T(Ht,[["__scopeId","data-v-736aab12"]]);const Kt={class:"tree"},Ut=L({emits:["event_callback"],setup(s,{emit:e}){const t=A({items:void 0}),{store_data:o}=H();O(()=>o.state.dictMenu,(a,i)=>{c(a)});const n=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)};V(()=>{console.log("[mounted]"),c(o.state.dictMenu)});const c=a=>{console.log("[onChanged_dictMenu]"),t.items=void 0;const i=a,l={name:"",children:[],path:"",file:"",time:""},r="/",u={[r]:l};i.forEach(function(d){d.key.split("/").reduce(function(_,m){if(_[m])return _[m];{const v={name:m,children:[],path:d.path,file:"md",time:d.atime};return _[r].children.push(v),_[r].file="",_[m]={[r]:v}}},u)}),console.log(l),setTimeout(()=>{t.items=l.children},500)};return(a,i)=>(f(),k("div",Kt,[(f(!0),k(B,null,q(w(t).items,l=>(f(),k("div",{key:l.path},[$(Jt,{item:l,onEvent_callback:n},null,8,["item"])]))),128))]))}});var qt=T(Ut,[["__scopeId","data-v-1f034d00"]]);const zt=L({props:{level:{type:Number,required:!0}},setup(s,e){return{tag:P(()=>`h${s.level}`)}}});function Yt(s,e,t,o,n,c){return f(),z(Ce(s.tag),{class:"h_tag"},{default:te(()=>[Se(s.$slots,"default",{},void 0,!0)]),_:3})}var Gt=T(zt,[["render",Yt],["__scopeId","data-v-1765be40"]]);const Wt=L({emits:["event_callback"],components:{heading:Gt},setup(s,e){const{store_data:t}=H(),o=A({listTag:[]});O(()=>t.state.tags,(a,i)=>{console.log(a),o.listTag=a});function n(a){t.do_cmd("update_jump",a)}function c(a){return`${a.text}`}return{state:o,dispTitle:c,jumpSource:n}}}),Zt={class:"tag"},Qt=["onClick"];function Xt(s,e,t,o,n,c){const a=j("heading");return f(),k("div",Zt,[(f(!0),k(B,null,q(s.state.listTag,(i,l)=>(f(),k("div",{key:l,onClick:r=>s.jumpSource(l),class:"item"},[$(a,{level:i.tag},{default:te(()=>[U(N(s.dispTitle(i)),1)]),_:2},1032,["level"])],8,Qt))),128))])}var eo=T(Wt,[["render",Xt],["__scopeId","data-v-1d58b53a"]]);const to=L({emits:["event_callback"],setup(s,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(n,c)=>{console.log(`cmd=${n}, name=${c}`),e.emit("event_callback",n,c)}}}}),oo={class:"main",style:{_height:"100px"}},no=["onClick","title"];function so(s,e,t,o,n,c){const a=j("fa");return f(),k("div",oo,[(f(!0),k(B,null,q(s.objToolbar,(i,l)=>(f(),k("button",{class:"btn-item",key:l,onClick:r=>s.event_callback("action",i.cmd),title:i.cmd},[$(a,{icon:i.icon},null,8,["icon"])],8,no))),128))])}var io=T(to,[["render",so],["__scopeId","data-v-2dca080d"]]);const ee={};class ao{constructor(e,t){h(this,"cmdid",0);h(this,"monaco",null);h(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=t}add(e,t,o,n,c=null){let a;switch(n.length){case 0:a=this.generateCommand(e,c);break;case 1:a=this.generateHeaderCommand(n[0]);break;case 2:a=this.generateWrapperCommand(n[0],n[1]);break}ee[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:o,contextMenuGroupId:t&&"navigation",contextMenuOrder:t&&1.5,run:ee[e]})}generateCommand(e,t){return(o,n)=>{t(o)}}generateWrapperCommand(e,t){const o=e.length+t.length;return this.editor,this.editor.getModel(),this.monaco,(n,c)=>{const a=n.getModel(),i=n.getSelections();if(i==null)return;const l=[];return i.forEach(r=>{l.push(new c.Selection(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn+o)),a.pushEditOperations([],[{range:{startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.startLineNumber,endColumn:r.startColumn},text:e},{range:{startLineNumber:r.endLineNumber,startColumn:r.endColumn,endLineNumber:r.endLineNumber,endColumn:r.endColumn},text:t}])}),n.setSelections(l),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(t,o)=>{const n=t.getModel();let c=t.getSelections();return c==null&&(c=[t.getSelection()]),c.forEach(a=>{const i=n.findNextMatch("^(#+ )",{lineNumber:a.startLineNumber,column:1},!0,!1,null,!0);if(i!=null&&i.range.startLineNumber==a.startLineNumber&&i.range.startColumn==1){if(i.matches[1]==e)return;n.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:i.matches[1].length+1},text:""}])}n.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:1},text:e}])}),null}}}function co(s,e){const t=n=>{const c=a=>`00${a}`.slice(-2);return`${n.getFullYear()}/${c(n.getMonth()+1)}/${c(n.getDate())} ${c(n.getHours())}:${c(n.getMinutes())}:${c(n.getSeconds())}`};console.log("[setupShortcutKeys]");const o=new ao(s,e);o.add("Bold","8_",[],["**","**"]),o.add("Italic","1_",[],["__","__"]),o.add("Underline","9_",[],["<u>","</u>"]),o.add("Strikethrough",!1,[s.KeyMod.CtrlCmd|s.KeyMod.Shift|s.KeyCode.KEY_S],["~~","~~"]),o.add("Code",!1,[],["`","`"]),o.add("Link",!1,[],["[","]()"]),o.add("Link-2",!1,[],["[](",")"]),o.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),o.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),o.add("Header 1",!1,[],["# ",""]),o.add("Header 2",!1,[],["## ",""]),o.add("Header 3",!1,[],["### ",""]),o.add("Header 4",!1,[],["#### ",""]),o.add("Header 5",!1,[],["##### ",""]),o.add("Header 6",!1,[],["###### ",""]),o.add("Check",!1,[],["- [ ] ",""]),o.add("Blockquotes",!1,[],["> ",""]),o.add("Today",!1,[],[`${t(new Date)}`,""]),o.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),o.add("Format","8_",[],[],n=>{console.log("format"),n.getAction("editor.action.formatDocument").run()})}const ro={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},lo=L({emits:["event_callback"],components:{ToolbarEditor:io},props:{isActive_preview:{type:Boolean,default:!1}},setup(s,e){const t=G(null),o={editor:void 0},{store_data:n}=H(),c=A({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});V(()=>{console.log("[mounted]"),i(),v(n.state.obj.content)}),O(()=>n.state.obj.content,(b,x)=>{console.log("[watch-body]"),c.filename!=""&&S(),v(b),I(n.state.obj.position,!0),c.filename=n.state.filename}),O(()=>n.state.ObjTag,(b,x)=>{console.log(`[watch](ObjTag)-${b}`),a(b)}),O(()=>s.isActive_preview,(b,x)=>{console.log(`[watch](editor_toggle)-${b}`),b==!0&&E()});const a=b=>{const x=g=>{_(g)};console.log(`[jump_cursor]ObjTag={${Object.values(b)}}`);const p=b.line;x(p),setTimeout(()=>{const g=o.editor;c.pos_scroll=g.getScrollTop()},500)},i=()=>{const b=()=>{const x=(y,M)=>{co(y,M)},p=document.getElementById("container");if(console.log(`root=${p}`),p==null)return;const g=Me.create(p,ro);return x(re,g),console.log(`editor=${g}`),g.onDidScrollChange(y=>{c.scrollInfo.height=y.scrollHeight,c.scrollInfo.top=y.scrollTop}),g};o.editor=b(),l()},l=()=>{o.editor.onDidBlurEditorText(b=>{E()})},r=(b,x)=>{switch(console.log(`[event_callback] cmd=${b}`),b){case"action":u(x);break;case"save":E();break}},u=b=>{console.log("[action]"),ee[b]!=null&&ee[b](o.editor,re)},d=()=>o.editor.getValue(),_=b=>{const x=new je(b+1,0,b+1,0);console.log(`Line=${b}`),o.editor.revealRangeAtTop(x)},m=()=>o.editor.getModel().getAlternativeVersionId(),v=b=>{o.editor.setValue(b),c.iVersion=m()},E=()=>{const b=m();if(console.info(`iVersion=${c.iVersion}, iVersion_cur=${b}`),c.iVersion==b)return;S();const x=d();n.do_cmd("save_file",x),c.iVersion=m(),console.info(`iVersion=${c.iVersion}`)},S=()=>{const b=o.editor,x={top:b.getScrollTop(),height:b.getScrollHeight(),contentHeight:b.getLayoutInfo().height,scrolled:c.pos_scroll!=b.getScrollTop()};return n.do_cmd("update_position",x,void 0),x},I=(b,x=!1)=>{if(b==null)return;console.log(`[e-set]value=${JSON.stringify(b)}`);const p=o.editor;if(x?!0:b.scrolled){const y=b.top/b.height;console.log(`per=${y}`);const M=p.getScrollHeight();p.setScrollTop(M*y)}else a(n.state.ObjTag);setTimeout(()=>{c.pos_scroll=p.getScrollTop()},500)};P(()=>o.editor.getScrollTop());const F=P(()=>n.state.height-27+"px");return{editorEx:o,event_callback:r,HeightEx:F,md_editor_monaco:t,get_position:S,set_position:I}}}),uo={class:"editor"};function _o(s,e,t,o,n,c){const a=j("ToolbarEditor");return f(),k("div",uo,[$(a,{class:"toolbar",onEvent_callback:s.event_callback},null,8,["onEvent_callback"]),C("div",{id:"container",ref:"md_editor_monaco",class:"core",style:K({height:s.HeightEx})},null,4)])}var mo=T(lo,[["render",_o],["__scopeId","data-v-1dc20672"]]);const po=L({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(s,e){const t=G(null),{store_data:o}=H(),n=A({contentsPosition:[],tocMap:new Map,observer:null,elm_target_before:null,pos_scroll:-1,filename:""});V(()=>{function d(){const _=new ne.Renderer;_.link=function(m,v,E){return m.indexOf("http")!=-1?`<a target="_blank" href="${m}">${E}</a>`:`<a target="_blank" href="#${m}">${E}</a>`},ne.setOptions({renderer:_,langPrefix:"",breaks:!0})}console.log("[created]"),d()}),O(()=>o.state.obj.content,(d,_)=>{console.log("[watch-body]"),t.value,n.filename!=""&&i(),setTimeout(()=>{c(),l(o.state.obj.position,!0),n.filename=o.state.filename},0)});function c(){const d=b=>{b.forEach(x=>{const p=n.tocMap.get(x.target);console.log(x.intersectionRatio),x.intersectionRatio?(n.elm_target_before!=null&&n.elm_target_before.classList.remove("active"),p.classList.add("active"),n.elm_target_before=null):n.elm_target_before=p})},_={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},m=new IntersectionObserver(d,_),v=new Map,S=document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),F=document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5");console.log(`el_contents=${S.length}/${JSON.stringify(S)}`),console.log(`el_toc=${F.length}/${JSON.stringify(F)}`),S.forEach((b,x)=>{m.observe(b),v.set(F.item(x),b),v.set(b,F.item(x))}),n.tocMap=v,n.observer=m}O(()=>o.state.ObjTag,(d,_)=>{console.log(`[watch](ObjTag)-${d}`),a(d)}),O(()=>s.isActive_preview,(d,_)=>{console.log(`[watch](editor_toggle)-${d}`)}),P(()=>t.value.querySelector(".md_core_viewer"));function a(d){const _=(E,S)=>{console.log(`tag=${E}, num=${S}`);const I=t.value,F=I.querySelectorAll(".md_core_viewer > h"+E);F.length!=0&&(I.scrollTop=F[S].getBoundingClientRect().top-I.getBoundingClientRect().top+I.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(d)}}`);const m=d.tag,v=d.num;d.line,_(m,v),setTimeout(()=>{const E=t.value;n.pos_scroll=E.scrollTop},0)}const i=()=>{const d=t.value,_={top:d.scrollTop,height:d.scrollHeight,contentHeight:0,scrolled:n.pos_scroll!=d.scrollTop};return o.do_cmd("update_position",_,n.filename),_},l=(d,_=!1)=>{console.log(`[v-set]value=${JSON.stringify(d)}`);const m=t.value;if(d==null){m.scrollTop=0;return}if(_?!0:d.scrolled){const E=d.top/d.height;console.log(`per=${E}`),console.log(`scrollTop=${m.scrollTop}, scrollHeight=${m.scrollHeight}`),m.scrollTop=m.scrollHeight*E}else a(o.state.ObjTag);setTimeout(()=>{n.pos_scroll=m.scrollTop},0)},r=P(()=>ne.parse(o.state.obj.content)),u=P(()=>o.state.height+"px");return{status,Markdown:r,HeightEx:u,md_viewer:t,get_position:i,set_position:l}}}),go=["innerHTML"];function ho(s,e,t,o,n,c){return f(),k("div",{class:"md_core_viewer note",innerHTML:s.Markdown,style:K({height:s.HeightEx}),ref:"md_viewer"},null,12,go)}var be=T(po,[["render",ho],["__scopeId","data-v-05199a28"]]);const fo=L({components:{MarkdownEditor:mo,MarkdownViewer:be},props:{editor_toggle:{type:Boolean,default:!0}},setup(s,e){const t=G(),o=G(),n=A({isActive_preview:!0});O(()=>s.editor_toggle,(i,l)=>{console.log(`[watch](editor_toggle)-${i}`),a()}),V(()=>{console.log("[mounted]"),document.addEventListener("keydown",c)}),pe(()=>{document.removeEventListener("keydown",c)});const c=i=>{if(i.keyCode===83&&i.ctrlKey){i.preventDefault(),console.log("save"),a();return}else if(i.keyCode===69&&i.ctrlKey){i.preventDefault(),console.log("toggle"),a();return}},a=()=>{var r;const i=n.isActive_preview?{now:t,next:o}:{now:o,next:t},l=(r=i.now.value)==null?void 0:r.get_position();console.log(`isActive_preview=${n.isActive_preview}, scrollIndo=${JSON.stringify(l)}`),n.isActive_preview=!n.isActive_preview,setTimeout(()=>{var u;(u=i.next.value)==null||u.set_position(l)},500)};return{state:n,MdViewer:t,MdEditor:o}}});function bo(s,e,t,o,n,c){const a=j("MarkdownViewer"),i=j("MarkdownEditor");return f(),k("div",null,[s.state.isActive_preview?(f(),z(a,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:s.state.isActive_preview},null,8,["isActive_preview"])):(f(),z(i,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:s.state.isActive_preview},null,8,["isActive_preview"]))])}var vo=T(fo,[["render",bo]]);const ko=L({emits:["event_callback"],setup(s,e){const{store_dlg:t}=ae(),{store_data:o}=H(),n=A({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});O(()=>t.state.objParam,d=>{c(d)});const c=d=>{const _=(m,v=!1)=>m!=null?m:v;console.log("[onChanged_objParam]"),n.title=d.title,n.title2=d.title2,n.edit=d.edit,n.edit_org=_(d.edit_org,d.edit),n.check=0,n.isShowDlg=!0,n.isNoEdit=_(d.isNoEdit),n.isFileOpen=_(d.isFileOpen),n.isReadOnly=_(d.isReadOnly),n.isCheck=_(d.isCheck),n.isMulti=_(d.isMulti),n.isDisabled=!0,n.action=d.action,r(!0)},a=d=>{if(console.log(`[doAction] flg=${d}, edit=${n.edit}`),d){const _=n.action(n);o.do_cmd(_[0],_[1],_[2])}n.isShowDlg=!1,r(!1)},i=d=>{const m=(d.target.files||d.dataTransfer.files)[0],v=n.action(n);o.do_cmd(v[0],m),n.isShowDlg=!1,r(!1)},l=()=>{const d=n.edit_org,_=n.edit==d&&!n.isReadOnly;return console.log(`[isDisabled]=${_}`),_},r=d=>{d==!0?document.addEventListener("keydown",u):document.removeEventListener("keydown",u)},u=d=>{if(d.keyCode===27){d.preventDefault(),a(!1);return}};return{state:n,props:s,doAction:a,onFileChange:i,isDisabled:l}}}),wo={class:"modal-mask"},yo={class:"modal-wrapper"},$o={class:"modal-container"},xo={class:"header"},Eo={ref:"form",class:"form"},Co=["disabled"],So=["disabled"],Mo={class:"modal-actions"},jo=["disabled"];function Lo(s,e,t,o,n,c){const a=j("fa");return Q((f(),z(Ae,{persistent:""},{default:te(()=>[C("div",wo,[C("div",yo,[C("div",$o,[C("div",xo,N(s.state.title)+"?",1),C("form",Eo,[s.state.isFileOpen==!0?(f(),k("input",{key:0,class:"input",type:"file",onChange:e[0]||(e[0]=(...i)=>s.onFileChange&&s.onFileChange(...i))},null,32)):D("",!0),s.state.isNoEdit==!1?(f(),k(B,{key:1},[s.state.isMulti==!0?Q((f(),k("textarea",{key:0,class:"input",_autofocus:"","onUpdate:modelValue":e[1]||(e[1]=i=>s.state.edit=i),disabled:s.state.isReadOnly},null,8,Co)),[[le,s.state.edit]]):Q((f(),k("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":e[2]||(e[2]=i=>s.state.edit=i),disabled:s.state.isReadOnly},null,8,So)),[[le,s.state.edit]])],64)):D("",!0),s.state.isCheck==!0?(f(),k(B,{key:2},[Q(C("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=i=>s.state.check=i)},null,512),[[Oe,s.state.check]]),U(" "+N(s.state.title2),1)],64)):D("",!0)],512),C("div",Mo,[C("button",{class:"btn btn-ok",ref:"ok",disabled:s.isDisabled(),onClick:e[4]||(e[4]=i=>s.doAction(!0))},[$(a,{icon:"check"}),U(" "+N(s.state.title),1)],8,jo),C("button",{class:"btn btn-can",onClick:e[5]||(e[5]=i=>s.doAction(!1))},"cancel")])])])])]),_:1},512)),[[Le,s.state.isShowDlg]])}var Oo=T(ko,[["render",Lo],["__scopeId","data-v-2041bfb8"]]);const Ao={class:"container"},To={class:"main"},No=L({emits:["event_callback"],setup(s,{emit:e}){const{store_data:t}=H(),{store_dlg:o}=ae(),n=_e(),c=ie(),a={snackbar:!1,message:"",timeout:-1,color:"green",actions:()=>{console.log("sb_actions")}},i=A({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,snackbar_ex:a,toggle_list:!1});V(()=>{console.log("[mounted]"),l(),window.addEventListener("resize",r),document.body.style.overflow="hidden"}),pe(()=>{console.log("unmounted!"),window.removeEventListener("resize",r)});const l=()=>{console.log("init");const _=c.path.substring(1),v=c.fullPath.split("api_bookmark?=");if(console.log(v),v.length==2){t.do_cmd("bookmark",decodeURIComponent(v.pop()));return}t.do_cmd("filter_menu",null),console.log(`filename=${_}`),_==null||_==""?t.do_cmd("restore_file",""):t.do_cmd("open_file",_),r()},r=()=>{const _=window.innerHeight-45;console.log(`height=${_}`),t.update_height(_)},u=async(_,m)=>{switch(console.log(`[event_callback] cmd=${_}, va0=${m}`),_){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"openSnackbar":break;case"onClick_snackbar":break;case"config":i.objDlgConf={cmd:_,filename:"",commit:""};break;case"print":const v=n.resolve({path:`/print/${t.filename}`});window.open(v.href,"_blank");break;case"filelist":document.querySelector(".col-3");const E=!i.toggle_list;i.toggle_list=E,console.log(i.toggle_list);break;default:if(_.indexOf("dlg_")!=-1){const S=Object.assign({},d(_,m));o.update_param(S)}else t.do_cmd(_,m);break}},d=(_,m)=>{const v=xt[_],E=m!=null?m:t.state.filename;return v.init(v,E),v};return(_,m)=>(f(),k("div",Ao,[$(It,{ref:"appbar",onEvent_callback:u},null,512),$(Oo,{objParam:w(i).objDlgCmn,onEvent_callback:u},null,8,["objParam"]),C("div",To,[w(i).toggle_list?(f(),z(qt,{key:0,class:"col-3",onEvent_callback:u,style:K({height:w(i).height+"px"})},null,8,["style"])):D("",!0),$(vo,{class:"col-2",ref:"pane",editor_toggle:w(i).editor_toggle,style:K({height:w(i).height+"px"})},null,8,["editor_toggle","style"]),$(eo,{class:"col-1",onEvent_callback:u,style:K({height:w(i).height+"px"})},null,8,["style"])])]))}});var Do=T(No,[["__scopeId","data-v-12732ce5"]]);const Io={_class:"container"},Fo=L({emits:["event_callback"],setup(s,{emit:e}){H();const t=ie(),o=A({filename:"",height:window.innerHeight,timer3:-1});V(()=>{console.log("[mounted]"),n(),document.body.style.overflow="hidden"});const n=()=>{console.log("init");const c=t.path.substring(1);t.fullPath,console.log(`filename=${c}`),o.filename=c,o.timer3=window.setTimeout(()=>{clearTimeout(o.timer3),window.print()},500)};return(c,a)=>(f(),k("div",Io,[U(N(w(o).filename)+" ",1),$(be,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}}),Bo=[{name:"viewer",path:"/:pathMatch(.*)*",component:Do},{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Fo}],Po=Te({history:Ne(),routes:Bo});function Ro(s={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:n,onRegisterError:c}=s;let a;const i=async(l=!0)=>{};return"serviceWorker"in navigator&&(a=new De("./sw.js",{scope:"./"}),a.addEventListener("activated",l=>{l.isUpdate?window.location.reload():o==null||o()}),a.register({immediate:e}).then(l=>{n==null||n(l)}).catch(l=>{c==null||c(l)})),i}Ro();Ie.add(Fe);Be(tt).use(Po).component("fa",Pe).mount("#app");
