var we=Object.defineProperty;var ye=(s,o,e)=>o in s?we(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e;var W=(s,o,e)=>(ye(s,typeof o!="symbol"?o+"":o,e),e);import{D as $e,a as ie,i as re,p as de,u as ue,b as ne,r as j,d as M,c as K,e as A,o as f,f as k,g as v,F as R,h as $,j as U,t as D,k as N,l as J,w as _e,m as O,n as H,q as E,s as Z,v as F,x as P,y as me,z as pe,A as q,B as xe,C as Ee,E as Ce,G as Se,H as ae,R as Me,I as te,J as he,K as Q,L as Oe,M as ce,N as je,T as Ae,O as Le,P as De,Q as Te,S as Ne,_ as Ie,U as Re,V as Fe}from"./vendor.627b5464.js";const Be=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}};Be();class B{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(o,e="",t=[],n=!1){e!=""&&(this.path=e),t!=[]&&(this.tags=t),this.content=o;const a=this.get_time();this.atime=a,n==!0&&(this.ctime=a)}set_default(o){this.path=o,this.content="",this.tags=[];const e=this.get_time();this.atime=e,this.ctime=e}copy(o){Object.assign(this,o)}duplicate(o,e=""){const t=new B;return t.copy(this),t.content=o,t.path=e,t.update_contentEx(),t.update_time(),t}update_content(o){o!=null&&(this.content=o),this.update_contentEx()}update_contentEx(o=!0){o&&(this.atime=this.get_time()),this.tags=this.build_tag(this.content)}update_position(o){this.position=o}get_time(){return this.cnv_time(new Date)}cnv_time(o){const e=t=>`00${t}`.slice(-2);return`${o.getFullYear()}/${e(o.getMonth()+1)}/${e(o.getDate())} ${e(o.getHours())}:${e(o.getMinutes())}:${e(o.getSeconds())}`}update_time(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(o){return o}build_tag(o){console.log("[build_tag]");const e=[],t=[0,0,0,0,0],n=o.split(/\r\n|\n|\r/);for(let a=0;a<n.length;a++)if(n[a].search(/^\s*#/)!=-1){const i=n[a].split(" "),d=i[0].length;i.shift();const l=i.join(" ");e.push({text:l,line:a,tag:d,num:t[d]}),t[d]++}return e}split(o){const e=[],t=this.content.split(/\r\n|\n|\r/),n=this.tags.filter(function(l){return l.tag==o}),a=[],c=t.length;for(var i=0;i<n.length;i++){const l=n[i].line;a.push({start:l,end:c,title:n[i].text}),i!=0&&(a[i-1].end=l-1)}const d=this.path.replace(".","_");return a.reverse(),a.forEach(l=>{const r=t.splice(l.start,l.end).join(`\r
`),_=this.duplicate(r,`${d}/${l.title}`);e.push(_)}),e.reverse(),e}}class Pe extends $e{constructor(){super("OdenDB");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class Ve{constructor(o){this.db=new Pe,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async e=>{const t=await this.dbx.get(e);return t!=null?t.data:null},this.write=async(e,t)=>{const n=JSON.stringify(t);await this.dbx.put({key:e,data:n,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async e=>{await this.dbx.delete(e),this.set_time_DB()},this.caller=o,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const o=[];return(await this.dbx.toArray()).forEach(t=>{o[t.key]=t.data}),this.atime=this.get_time_DB(),o}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const o=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",o),this.atime=o,o}get_time_DB(){var o;return(o=localStorage.getItem("update_DB_time"))!=null?o:""}}class He{constructor(o){this.write=(e,t)=>this.storeLS.write(e,t),this.delete=e=>this.storeLS.delete(e),this.rename=async(e,t)=>{console.log(`[rename] _key_org=${e}, _key_new=${t}`);const n=this.as(await this.get(e));return n.path=t,await this.write(t,n),await this.delete(e),n},this.split=async e=>{console.log(`[split] _key_org=${e}`);const n=this.as(await this.get(e)).split(1);return n.forEach(a=>{this.write(a.path,a)}),n},this.merge=(e,t)=>{console.log(`[merge] _path=${e}`);const n=new B;return n.set_default(e),n.update_content(t),this.write(e,n),n},this.as=e=>Object.assign(new B,e),this.sync_DB=()=>this.storeLS.sync_DB(),this._=o,this.storeLS=new Ve(this._)}async get(o){console.log(`[get] _key=${o}`);const e=await this.read(o);return e!=null?JSON.parse(e):this.create(o)}async exist(o){return console.log(`[exist] _key=${o}`),await this.read(o)!=null}async set(o,e){console.log(`[set] _key=${o}`);const t=this.as(await this.get(o));return t.path==""&&(t.path=o),t.update_content(e),this.write(o,t),t}async set_ex(o,e){console.log(`[set_ex] _key=${o}`);const t=this.as(e);return e.path==""&&(e.path=o),t.update_content(void 0),this.write(o,t),t}async read(o){return await this.storeLS.read(o)}create(o){console.log(`[create] _key=${o}`);const e=new B;return o!=null&&(e.set_default(o),this.write(o,e)),e}}const oe="menu.json";class Ue{constructor(o){this._=o}async rebuildMenu(o=null){console.log("[rebuildMenu]");const e=await this._.mgrCache.getLstContent(o),t=this.buildMenu(e);return console.log(`${e.length}/${t.length}`),this._.contentEx.set(oe,JSON.stringify(t)),t}async getMenu(o){if(console.log(`[getMenu] _filter=${JSON.stringify(o)}`),o!=null)return await this.rebuildMenu(o);{const e=await this._.contentEx.get(oe);return JSON.parse(e.content)}}buildMenu(o){function e(n){const a=new Set;return n.forEach(c=>{a.add(c.group)}),[...a]}function t(n){console.log("storeEx_index:buildMenuEx");const a=e(n);return n.reduce((c,i)=>{if(i.path==oe)return c;let d=i.group,l=i.title,u=`${d}/${l}`;return a.includes(u)&&(d=u,l=".index",u=`${d}/${l}`),c.push({key:u,group:d,title:l,path:i.path,atime:i.atime}),c},[])}return t(o).sort(this.compare_group)}compare_group(o,e){let t=o.group,n=e.group;t==n&&(t=`${o.group}/${o.title}`,n=`${e.group}/${e.title}`);const a=t.toUpperCase(),c=n.toUpperCase();let i=0;return a>c?i=1:a<c&&(i=-1),i}}class G{static async read(o){console.log(`[read] filename=${o}`);const e=new URLSearchParams;return e.append("filename",o),G.post_cmdEx("load_file_md",e)}static write(o,e){console.log(`[write] filename=${o}`);const t=new URLSearchParams;return t.append("filename",o),t.append("source",e),G.post_cmdEx("save_file_md",t)}static async get_cmdEx(o){const e="http://localhost:5000/api/viewer/"+o;return console.log(`[store_RST:get_cmdEx] api=${e}`),ie.get(e).then(t=>t.data).catch(t=>{throw t.response.status})}static async post_cmdEx(o,e){const t="http://localhost:5000/api/viewer/"+o;return console.log(`[store_RST:post_cmdEx] api=${t}`),ie.post(t,e).then(n=>n.data).catch(n=>{throw n.response.status})}}class Je{constructor(o){this.backupEx=(e,t,n)=>{const a=()=>{const i=new URLSearchParams;i.append("lstContent",JSON.stringify(e)),G.post_cmdEx("backup_contents",i).then(d=>console.log(d)).catch(d=>console.log(d))},c=()=>{const i=new Blob([JSON.stringify(e)],{type:"text/plain"}),d=(u,r)=>{const _=new Date,m=p=>`00${p}`.slice(-2);return`${u}_${_.getFullYear()}${m(_.getMonth()+1)}${m(_.getDate())}_${m(_.getHours())}.${r}`},l=document.createElement("a");l.download=d("lstData","json"),l.href=URL.createObjectURL(i),l.click(),URL.revokeObjectURL(l.href)};switch(console.log(`[backup] mode=${t}`),t){case"backup":a();break;case"export":c();break}},this._=o}async restoreEx(o,e,t){function n(d){d.forEach(l=>{const u=new B;u.copy(l),u.update_contentEx(!1),i.write(u.path,u)})}async function a(d,l){G.get_cmdEx("restore_contents").then(u=>{n(u),d(u)}).catch(u=>{console.log(u),l(null)})}async function c(d,l,u){const r=new FileReader;r.onload=()=>{var p;console.log("onload");const _=(p=r.result)!=null?p:"",m=JSON.parse(_);n(m),l(m)},r.onerror=_=>{u("error")},r.readAsText(d)}console.log("[importExport:restore]");const i=this._.contentEx;return new Promise(function(d,l){switch(o){case"restore":a(d,l);break;case"import":c(e,d,l);break}})}}class Ke{constructor(o){this.journal2=async(e,t)=>{const n=(c,i)=>`
## ${this._.contentEx.as(c).cnv_time(t)}
${i}
`;console.log("[journal]");const a=await this.geolocation();return e.content+=n(e,a),e},this.geolocation=()=>new Promise(e=>{let t="";navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{t=`(Latitude,longitude)=(${n.coords.latitude},${n.coords.longitude})
`,e(t)},n=>{switch(n.code){case 1:t="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:t="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:t="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}e(t)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),e(t))}),this.chat=async(e,t,n)=>{const a=p=>["sun","mon","tue","wed","thu","fri","sat"][p],c=p=>{const w=T=>`00${T}`.slice(-2),C=`${p.getFullYear()}/${w(p.getMonth()+1)}/${w(p.getDate())}(${a(p.getDay())})`,I=`${w(p.getHours())}:${w(p.getMinutes())}`;return[C,I]},i=(p,w)=>p!==w?`
## ${w}
`:"",d=p=>{const w=n.isNoList?"":"- ",C=n.isAddTime?`${p} : `:"";return`${w}${C}${t}
${_}`};console.log("[chat]");const l=e.content.indexOf(`
`),[u,r]=c(new Date),_=n.isAddGeo?await this.geolocation()+`
`:"",m=i(e.content.substring(0,l),u)+d(r);return e.content=`${u}${e.content.substring(l)}${m}`,e},this._=o}async path_rename(o,e,t){console.log(`_from=${o}, _to=${e}`);const n=this.collect_filename_by_group(o,t);for(let a=0;a<n.length;a++){const c=n[a],i=`${c[1]}/${c[0]}`,d=`${e}${c[2]}/${c[0]}`;await this._.contentEx.rename(i,d)}}async path_delete(o,e){console.log(`_path=${o}`);const t=this.collect_filename_by_group(o,e);for(let n=0;n<t.length;n++){const a=t[n],c=`${a[1]}/${a[0]}`;await this._.contentEx.delete(c)}}async path_merge(o,e,t){console.log(`_path=${o}`);const n=[],a=this.collect_filename_by_group(o,t);for(let i=0;i<a.length;i++){const d=a[i],l=`${d[1]}/${d[0]}`,u=await this._.contentEx.get(l);n.push(u.content)}const c=n.join(`\r
`);return this._.contentEx.merge(e,c)}collect_filename_by_group(o,e){console.log(`[collect_filename_by_group] group=${o}`);const t=[],n=o.length!=0?1:0;return e.forEach((a,c)=>{if(a.group==o){const i=a.group.substring(o.length+n);t.push([a.title,a.group,i.length!=0?`/${i}`:""])}}),t}}class ze{constructor(o){this._=o}async getLstContent(o){console.log("[getLstContent]");const e=a=>{const c=o.path==""?!0:a.path.indexOf(o.path)!=-1,i=o.keyword==""?!0:a.content.toLowerCase().indexOf(o.keyword)!=-1;return c&&i},t=await this.buildLstContent();return o!=null?t.filter(e):t}async buildLstContent(){var a;console.log("[buildLstContent]");const o=c=>{var l,u;let i=c.path;(i==""||i==null)&&(i=`@test/${new Date().toLocaleString()}`);const d=i.split("/");return c.title=(l=d.pop())!=null?l:".",c.group=(u=d.join("/"))!=null?u:"@test",c.tags=[],c.htags=[],c},e=await this._.contentEx.storeLS.getStrageEx(),t=[],n=c=>e[c];for(const c of Object.keys(e))try{t.push(o(JSON.parse((a=n(c))!=null?a:"")))}catch(i){console.log(`@ error key=${c},e=${i} - other error`)}return t}}class qe{constructor(){this.contentEx=new He(this),this.mgrExchange=new Je(this),this.mgrEtc=new Ke(this),this.mgrMenu=new Ue(this),this.mgrCache=new ze(this),console.log("[constructor]")}async cmd_getMenu(o=null){return this.mgrMenu.getMenu(o)}async cmd_load(o){return this.contentEx.get(o)}async cmd_create(o){return await this.contentEx.get(o)}async cmd_save(o,e){return this.contentEx.set(o,e)}async cmd_save_ex(o,e){return this.contentEx.set_ex(o,e)}async cmd_delete(o){await this.contentEx.delete(o)}async cmd_rename(o,e){await this.contentEx.rename(o,e)}async cmd_exist(o){return this.contentEx.exist(o)}async cmd_backup(o,e="",t=null){const n=await this.mgrCache.getLstContent(t);this.mgrExchange.backupEx(n,o,e)}async cmd_restoreEx(o,e,t=""){await this.mgrExchange.restoreEx(o,e,t)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(o){await this.contentEx.split(o)}async cmd_path_rename(o,e){const t=await this.cmd_getMenu();await this.mgrEtc.path_rename(o,e,t)}async cmd_path_delete(o){const e=await this.cmd_getMenu();await this.mgrEtc.path_delete(o,e)}async cmd_path_merge(o,e){const t=await this.cmd_getMenu();await this.mgrEtc.path_merge(o,e,t)}async cmd_chat(o,e,t){const a=(()=>{const d=new Date;return`${o}${t.mode}_${d.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${a}`);const c=await this.contentEx.get(a),i=await this.mgrEtc.chat(c,e,t);return await this.contentEx.set(a,i.content),[i,a]}}class Ge{constructor(o){this.KEY="",console.log(o),this.KEY=o}get(o){var e;if(localStorage.getItem(this.KEY)!=null){const t=JSON.parse((e=localStorage.getItem(this.KEY))!=null?e:"");o(t),console.log(t)}}set(o){localStorage.setItem(this.KEY,JSON.stringify(o)),console.log(o)}}const Ye=1e3*60*10,ge=Symbol(),We=()=>{const s=ue(),o=ne(),e=j({storeEx:new qe,persisted:new Ge("lifeLog-Viewer-params"),filename:"",obj:new B,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),t=h=>{console.log(`[update_filename] : new=${h}`),h!=e.filename&&n(h)},n=async h=>{const g=y=>{o.path.indexOf(y)==-1&&(console.log(`_value=${y}`),s.push(`/${y}`)),e.persisted.set({filename:y}),e.filename=y};if(console.log(`[load_obj] : new=${h}`),h!=""){const y=await e.storeEx.cmd_load(h);d(y)}else l("");g(h)},a=()=>{console.log("restore_filename"),e.persisted.get(h=>{t(h.filename)})},c=async h=>{if(h==""){console.log("skip save - empty data");return}l(h),d(e.obj),await e.storeEx.cmd_save_ex(e.filename,e.obj),_()},i=()=>{console.log("[auto_save] start"),e.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(e.intervalId_autoSave)),e.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await b("export",null,null),e.intervalId_autoSave=null},Ye)},d=h=>{const g=h instanceof B?h:Object.assign(new B,h);g.update_contentEx(),e.tags=g.tags,e.obj=g},l=h=>{e.obj.content=h},u=async(h,g)=>{if(console.log(h),g!=null){const y=await e.storeEx.cmd_load(g);y.position=h,await e.storeEx.cmd_save_ex(g,y)}else e.obj.position=h},r=h=>{e.dictMenu=h},_=()=>{setTimeout(async()=>{r(await e.storeEx.cmd_rebuild()),i()},250)},m=h=>{e.jump=h,h!=-1&&(console.log(`jump=${h}`),e.ObjTag=JSON.parse(JSON.stringify(e.tags[h])),console.log(JSON.stringify(e.ObjTag)))},p=h=>{e.height=h},w=async(h,g)=>{const[y,S]=await e.storeEx.cmd_chat(e.path_expand,h,g);d(y),t(S),_()},C=async(h,g)=>{const y=await e.storeEx.cmd_exist(h);if(g==y)return!0;{const S=g?`error : ${h} is not exist. please enter exist filename.`:`error : ${h} is already exist. please enter other filename.`;return console.log(S),!1}},I=async(h,g)=>{await C(h,!1)&&(await e.storeEx.cmd_rename(g,h),t(h),_())},T=async(h,g)=>{const y=x(g)[0],S=x(h)[0];await e.storeEx.cmd_path_rename(y,S),t(""),_()},b=async(h,g,y)=>{console.log(`[do_cmd] mode=${h}`);let S=g!=""?g:e.filename,z="",Y;switch(h){case"update_jump":m(g);break;case"rebuild_menu":_();break;case"filter_menu":const ee=g;g!=null&&(ee.path=ee.isUnderFolder?x(e.filename)[0]:""),r(await e.storeEx.cmd_getMenu(ee));break;case"open_file":t(g);break;case"restore_file":a();break;case"save_file":await c(g);break;case"new":await C(g,!1)&&(await e.storeEx.cmd_create(g),t(g),_());break;case"delete":await C(S,!0)&&(await e.storeEx.cmd_delete(S),t(""),_());break;case"rename":I(g,y);break;case"backup":e.storeEx.cmd_backup("backup");break;case"export":e.storeEx.cmd_backup("export");break;case"restore":await e.storeEx.cmd_restoreEx("restore",null),_();break;case"import":await e.storeEx.cmd_restoreEx("import",g),_();break;case"split":await C(S,!0)&&(await e.storeEx.cmd_split(S),_());break;case"path_rename":T(g,y);break;case"path_delete":z=x(g)[0],await e.storeEx.cmd_path_delete(z),t(""),_();break;case"path_merge":z=x(g)[0],S=`${z}.md`,await C(S,!1)&&(await e.storeEx.cmd_path_merge(z,S),t(S),_());break;case"print":const ke=s.resolve({path:`/print/${e.filename}`});window.open(ke.href,"_blank");break;case"journal":w("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":w(g,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":w(g,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":Y={keyword:y.filter.toLowerCase(),isUnderFolder:y.isCheck,path:""},r(await e.storeEx.cmd_getMenu(Y));break;case"update_position":await u(g,y);break;case"move_archive":I(`@archive/${g}`,g);break;case"move_path_archive":T(`@archive/${g}`,g);break;case"export_archive":Y={keyword:"",isUnderFolder:!0,path:"@archive/"},e.storeEx.cmd_backup("export","",Y);break}},x=h=>{const g=h.split("/"),y=g[g.length-1];return[g.slice(0,-1).join("/"),y]};return{store_data:{state:e,update_height:p,do_cmd:b}}},Qe=()=>{de(ge,We())},V=()=>re(ge),Xe=()=>{const s=j({objParam:null});return{store_dlg:{state:s,update_param:e=>{s.objParam=e}}}},fe=Symbol(),Ze=()=>{de(fe,Xe())},se=()=>re(fe);const et=M({setup(s){return Qe(),Ze(),(o,e)=>{const t=A("routerView");return f(),K(t)}}});var L=(s,o)=>{const e=s.__vccOpts||s;for(const[t,n]of o)e[t]=n;return e};const tt={key:0,class:"item"},ot={key:1,class:"line"},nt={key:1,class:"folder"},st={key:2,class:"dropdown"},it=M({props:{item:null},emits:["event_callback"],setup(s,{emit:o}){const e=s,t=j({isOpen:!1,item:e.item,isFolder:e.item.children&&e.item.children.length,isActive:!0}),n=(c,i)=>{console.log(`[event_callback] cmd=${c}`),o("event_callback",c,i)},a=c=>{if(t.isFolder)console.log("onClick-folder"),t.isOpen=!t.isOpen;else{const i=c.cmd;n(i,null)}};return(c,i)=>{const d=A("fa"),l=A("MenuTreeItem",!0);return f(),k("div",{class:"menu_tree",onClick:i[0]||(i[0]=u=>a(v(t).item)),onContextmenu:i[1]||(i[1]=_e(()=>{},["right","prevent"]))},[v(t).isFolder?N("",!0):(f(),k(R,{key:0},[v(t).item.title!=""?(f(),k("span",tt,[$(d,{icon:v(t).item.icon},null,8,["icon"]),U(" "+D(v(t).item.title),1)])):N("",!0),v(t).item.title==""?(f(),k("div",ot)):N("",!0)],64)),v(t).isFolder?(f(),k("span",nt,[$(d,{icon:v(t).item.icon},null,8,["icon"]),U(" "+D(v(t).item.title),1)])):N("",!0),v(t).isFolder?(f(),k("div",st,[(f(!0),k(R,null,J(v(t).item.children,(u,r)=>(f(),k("div",{key:r},[$(l,{item:u,onEvent_callback:n},null,8,["item"])]))),128))])):N("",!0)],32)}}});var at=L(it,[["__scopeId","data-v-0c5cb0a6"]]);const ct=M({props:{mouse:null,items:null},emits:["event_callback"],setup(s,{emit:o}){const e=s;console.log(`[props]=${JSON.stringify(e)}`);const t=j({items:e.items,pos_x:-1,pos_y:-1,isShow:!1,style:"display:none"});console.log(`[state]=${JSON.stringify(t)}`),O(()=>e.mouse,(c,i)=>{console.log("props"),t.isShow=!0,t.pos_x=e.mouse.clientX,t.pos_y=e.mouse.clientY,t.items=e.items,t.style="display:block"});const n=(c,i)=>{console.log(`[event_callback] cmd=${c}`),o("event_callback",c,i)},a=c=>{t.style=c?"display:block":"display:none"};return(c,i)=>(f(),k("div",{class:"menu",style:H(v(t).style),onMouseover:i[0]||(i[0]=d=>a(!0)),onMouseleave:i[1]||(i[1]=d=>a(!1))},[(f(!0),k(R,null,J(v(t).items,d=>(f(),k("div",{key:d.path},[$(at,{item:d,onEvent_callback:n},null,8,["item"])]))),128))],36))}});var be=L(ct,[["__scopeId","data-v-84c66a70"]]);const lt=M({props:{objMenu:null},emits:["event_callback"],setup(s,{emit:o}){const t=j({items:s.objMenu,event:void 0}),n=(c,i)=>{console.log(`[event_callback] cmd=${c}`),o("event_callback",c,i)},a=c=>{console.log("onClick"),t.event=c};return(c,i)=>{const d=A("fa");return f(),k("div",{class:"dropdown",onClick:a},[$(d,{icon:"bars"}),$(be,{mouse:v(t).event,items:v(t).items,onEvent_callback:n},null,8,["mouse","items"])])}}});var rt=L(lt,[["__scopeId","data-v-9ea7c1a6"]]);const dt={class:"base"},ut={key:0,class:"dropdown"},_t=["onClick"],mt={class:"title_sub2"},pt={class:"title"},ht={class:"title_sub"},gt={class:"base2"},ft=M({props:{objMenuItem:null},emits:["event_callback"],setup(s,{emit:o}){const e=s,t=j({items:[],items2:[],isShowDlg:!1});O(()=>e.objMenuItem,(i,d)=>{t.items=n(i),t.items2=t.items.slice(0,5)});const n=i=>{console.log("[cnvLstRecent]");function d(u,r){const _=u.atime,m=r.atime;let p=0;return _>m?p=-1:_<m&&(p=1),p}const l=[...i];return l.sort(d),l.slice(0,15)},a=i=>{const d=t.items[i].path;o("event_callback","open_file",d),t.isShowDlg=!1},c=i=>{t.isShowDlg=i};return(i,d)=>{const l=A("fa"),u=A("button2");return f(),k("div",dt,[E("span",{class:"_base",onMouseover:d[0]||(d[0]=r=>c(!0)),onMouseleave:d[1]||(d[1]=r=>c(!1))},[$(l,{icon:"history",class:"_item"}),v(t).isShowDlg?(f(),k("ul",ut,[(f(!0),k(R,null,J(v(t).items,(r,_)=>(f(),k("li",{class:"item",key:_,onClick:m=>a(_)},[$(l,{class:"title_item",icon:"file-alt"}),E("span",mt,D(r.group)+"/ ",1),E("span",pt,D(r.title),1),E("span",ht," ["+D(r.atime)+"]",1)],8,_t))),128))])):N("",!0)],32),E("div",gt,[(f(!0),k(R,null,J(v(t).items2,(r,_)=>(f(),K(u,{class:"btn",key:_,onClick:m=>a(_)},{default:Z(()=>[U(D(r.title),1)]),_:2},1032,["onClick"]))),128))])])}}});var bt=L(ft,[["__scopeId","data-v-6c38e47c"]]);const vt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],kt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],wt=[{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],yt={dlg_import:{init:(s,o)=>{s.title="Restore",s.isFileOpen=!0,s.isNoEdit=!0,s.edit=""},action:s=>["import"]},dlg_delete:{init:(s,o)=>{s.title="Delete",s.isReadOnly=!0,s.edit=o},action:s=>["delete",s.edit,""]},dlg_rename:{init:(s,o)=>{s.title="Rename",s.edit=o},action:s=>["rename",s.edit,s.edit_org]},dlg_new:{init:(s,o)=>{s.title="Create",s.edit=o.split("/").slice(0,-1).join("/")+"/*.md"},action:s=>["new",s.edit,""]},dlg_path_rename:{init:(s,o)=>{s.title="Rename of Path",s.edit=o.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_rename",s.edit,s.edit_org]},dlg_path_delete:{init:(s,o)=>{s.title="Delete of Path",s.isReadOnly=!0,s.edit=o.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_delete",s.edit,""]},dlg_path_merge:{init:(s,o)=>{s.title="Merge of Path",s.isReadOnly=!0,s.edit=o.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_merge",s.edit,""]},dlg_tweet:{init:(s,o)=>{s.title="Tweet",s.edit=""},action:s=>["tweet",s.edit,""]},dlg_bookmark:{init:(s,o)=>{s.title="Bookmark",s.edit="",s.isMulti=!0},action:s=>["bookmark",s.edit,""]},dlg_filter:{init:(s,o)=>{s.title="Filter",s.title2="target under folder",s.edit="",s.edit_org="@",s.isCheck=!0},action:s=>(console.log("dlg_filter"),["filter",s.filename,{filter:s.edit,isCheck:s.check}])}},le={FOCUS:150,BREAK_SHORT:30,BREAK_LONG:90,FOCUS_ADD:30,BREAK_SHORT_ADD:6,BREAK_LONG_ADD:18};class $t{constructor(o){this.status_info=null,this.log=[],this.dct_param_popup={to_break:{_message:"Let's have a [coffee break]?",_btn:"do_break",_action:e=>{const t=e==0?"do_break":"do_snooz";this.doAction(t)},_icon:"../icon/break.png"},to_focus:{_message:"Let's get back to [focus]!",_btn:"do_focus",_action:e=>{const t=e==0?"do_focus":"do_snooz";this.doAction(t)},_icon:"../icon/focus.png"}},this.callback_timer=o,this.state={time_all:1,time_total:1,mode:-1,cnt:{focus:1,break:0,snooz:0,add:0,cur:{snooz:0,add:0}},mode_before:-1,isPause:!1,btn_enable:0,color_bk:""},this.status_info=this.set_status_info(le),this.mounted()}mounted(){console.log("mounted"),this.doAction("do_stop"),console.log(le),console.log("get TIME_TBL")}get_time_tbl(){}set_status_info(o){return console.log(JSON.stringify(o)),[{id:0,name:"none",color:"#2196F3",time:[0,0],cmd_next:"do_focus"},{id:1,name:"focus",color:"#00bfff",time:[o.FOCUS,o.FOCUS_ADD],cmd_next:"do_pause"},{id:2,name:"break-short",color:"#00fa9a",time:[o.BREAK_SHORT,o.BREAK_SHORT_ADD],cmd_next:"do_focus"},{id:3,name:"break-long",color:"#ee82ee",time:[o.BREAK_LONG,o.BREAK_LONG_ADD],cmd_next:"do_focus"},{id:4,name:"pause",color:"#9E9E9E",time:[0,0],cmd_next:"do_pause"},{id:5,name:"expire",color:"#dc143c",time:[0,0],cmd_next:"do_focus"},{id:6,name:"snooz",color:"#2196F3",time:[0,0],cmd_next:"do_stop"}]}display(o=!0){const e=a=>(a<10?"0":"")+a,t=e(Math.floor(this.state.time_total/60)),n=e(this.state.time_total-Number(t)*60);return o?`${t}${n}`:`${t}:${n}`}get_state(){return this.state}get_log(){}func_update(o){o.state.time_total--,o.watch_time_total(o.state.time_total),o.callback_timer(o.state),console.log(o.state.time_total)}doAction(o,e=0){const t=()=>{this.timer=setInterval(this.func_update,1e3,this),this.state.isPause=!1},n=()=>{clearInterval(this.timer),this.timer=null,this.state.isPause=!1},a=(p,w=0)=>{const C=()=>{this.state.cnt.cur.snooz=0,this.state.cnt.cur.add=0};this.get_time_tbl(),this.state.mode_before=this.state.mode,this.state.mode=p,this.set_icon(p),C()},c=(p,w=0)=>this.status_info[p].time[w],i=(p,w=!1,C=!1)=>{w?(this.state.time_total+=p,C&&(this.state.time_all+=p)):(this.state.time_total=p,this.state.time_all=p)},d=this.state.mode==1,l=!(this.state.cnt.break%3);console.log(`[doAction] cmd=${o},type=${e},mode=${this.state.mode}`);let[u,r,_,m]=[-1,-1,!1,!1];switch(o){case"do_focus":n(),[u,r,_,m]=[1,0,!1,!1],a(u),i(c(u,r),_,m),t(),this.state.cnt.focus+=1;break;case"do_break":n(),[u,r,_,m]=[1,0,!1,!1],u=l?3:2,a(u),i(c(u,r),_,m),t(),this.state.cnt.break+=1;break;case"do_snooz":n(),[u,r,_,m]=[this.state.mode,1,!0,!0],i(c(u,r),_,m),t(),this.state.cnt.snooz+=1,this.state.cnt.cur.snooz+=1;break;case"do_stop":n(),a(0),this.state.time_total=0;break;case"do_add":[u,r,_,m]=[this.state.mode,1,!0,!1],i(c(u,r),_,m),this.state.cnt.add+=1,this.state.cnt.cur.add+=1;break;case"do_pause":this.state.isPause?(this.set_icon(this.state.mode),t(),this.state.isPause=!1):(n(),this.set_icon(4),this.state.isPause=!0);break;case"do_play":this.doAction(d?"do_pause":"do_focus");break;case"do_reset":this.doAction(d?"do_focus":"do_break");break;case"do_next":this.doAction(d?"do_break":"do_focus");break;case"goto":this.doAction(this.status_info[this.state.mode].cmd_next);break}}set_log(o){new Date,this.state.time_all,this.state.time_total}set_icon(o){const e=this.status_info[o].color;this.state.color_bk=e;const t=document.createElement("canvas");t.width=19,t.height=19;const n=t.getContext("2d");n.fillStyle=e,n.fillRect(0,0,t.width,t.height)}set_color_bk(o){this.state.color_bk=status_info[o].color}watch_time_total(o){const e=()=>{clearInterval(this.timer),this.timer=null};if(!(o>0))switch(this.state.mode){case 1:e(),this.openSnackbar(this.dct_param_popup.to_break);break;case 2:case 3:e(),this.openSnackbar(this.dct_param_popup.to_focus);break}}openSnackbar(o){o._message+`
  [ snooz : ${this.state.cnt.cur.snooz}, add : ${this.state.cnt.cur.add} ]`,o._icon,o._btn}}const xt=s=>(me("data-v-e7fd4736"),s=s(),pe(),s),Et=xt(()=>E("div",{class:"title"},"Pomodoro",-1)),Ct=M({emits:["event_callback"],setup(s,{emit:o}){const e=j({core:void 0,time_total:-1,time_all:-1,color_bk:"",totalTime:1,displayed:0,tbl_timer:[1500,1500,300,900],btn_enable:0,state_status:-1,state:{times:1,color_bk:"blue",status_before:-1}}),t=d=>{e.core=d,e.time_total=d.time_total,e.time_all=d.time_all,e.color_bk=d.color_bk},n=new $t(t);F(()=>`--color-bk : ${e.color_bk};`);const a=F(()=>{const d=e.time_total/e.time_all*100;return`--per-now : ${100-d}%; --color-bk : ${e.color_bk};`}),c=F(()=>{const d=_=>(_<10?"0":"")+_,l=e.time_total,u=d(Math.floor(l/60)),r=d(l-Number(u)*60);return`${u}:${r}`}),i=(d,l=0)=>{n.doAction(d,l)};return O(()=>e.state_status,(d,l)=>{}),P(()=>{console.log("[mounted]"),n.doAction("do_focus")}),(d,l)=>{const u=A("fa");return f(),k("div",{id:"popup",class:"panel",style:H({background:v(e).color_bk})},[E("div",{class:"circle",style:H(v(a))},null,4),Et,E("div",{class:"time button",onClick:l[0]||(l[0]=r=>i("do_pause"))},D(v(c)),1),$(u,{icon:"play",class:"do_focus button",onClick:l[1]||(l[1]=r=>i("do_focus"))}),$(u,{icon:"stop",class:"do_stop button",onClick:l[2]||(l[2]=r=>i("do_stop"))}),$(u,{icon:"plus",class:"do_add button",onClick:l[3]||(l[3]=r=>i("do_add"))}),$(u,{icon:"forward",class:"do_next button",onClick:l[4]||(l[4]=r=>i("do_next"))})],4)}}});var St=L(Ct,[["__scopeId","data-v-e7fd4736"]]);const Mt=s=>(me("data-v-3ef8d120"),s=s(),pe(),s),Ot={class:"nav"},jt=["title"],At={class:"cmd"},Lt=Mt(()=>E("span",{class:"item"},null,-1)),Dt=M({emits:["event_callback"],setup(s,{emit:o}){const{store_data:e}=V();se();const t=q(null),n=j({filename:"@",objMenu:vt,dctMenu:[]}),a=(l,u)=>{console.log(`[event_callback] cmd=${l}`),l=="top"?t.value.scrollIntoView({}):o("event_callback",l,u)};P(()=>{console.log("[mounted]")});const c=l=>{console.log(`[doAction] cmd=${l}`),o("event_callback",l,!0)};O(()=>e.state.filename,(l,u)=>{console.log(`[watch:filename] ${l}`),d(l)}),O(()=>e.state.dictMenu,(l,u)=>{n.dctMenu=l}),O(()=>e.state.jump,(l,u)=>{window.setTimeout(()=>{i()},500)});const i=()=>{t.value.scrollIntoView({})},d=l=>{console.log(`[onChanged_filename] new=${l}`),n.filename=l,i()};return(l,u)=>{const r=A("fa");return f(),k("header",{class:"appbar",ref_key:"appbar",ref:t,onClick:u[6]||(u[6]=_=>a("top",!0))},[E("nav",Ot,[$(rt,{class:"item",objMenu:v(n).objMenu,onEvent_callback:a,title:"menu"},null,8,["objMenu"]),E("section",{class:"item logo",onClick:u[0]||(u[0]=_=>a("filelist",!0)),title:v(n).filename},"Oden",8,jt),$(bt,{class:"item",objMenuItem:v(n).dctMenu,onEvent_callback:a,title:"history"},null,8,["objMenuItem"]),v(n).filename!==""?(f(),k("span",{key:0,class:"item name",onClick:u[1]||(u[1]=_=>a("dlg_rename",null))}," ["+D(v(n).filename)+"] ",1)):N("",!0),E("span",{class:"item mark",onClick:u[2]||(u[2]=_=>c("toggle_editor")),title:"editor/viewer"},[$(r,{icon:"edit"})])]),E("span",At,[E("span",{class:"item",onClick:u[3]||(u[3]=_=>c("dlg_filter")),title:"filter"},[$(r,{icon:"paw"})]),E("span",{class:"item",onClick:u[4]||(u[4]=_=>c("dlg_tweet")),title:"tweet"},[$(r,{icon:"grimace"})]),E("span",{class:"item",onClick:u[5]||(u[5]=_=>c("dlg_bookmark")),title:"bookmark"},[$(r,{icon:"bookmark"})]),Lt,$(St,{onEvent_callback:a,_class:"ma-1 pa-0 text-right"})])],512)}}});var Tt=L(Dt,[["__scopeId","data-v-3ef8d120"]]);const Nt={class:"file_tree"},It=["onContextmenu"],Rt=["title"],Ft={key:1,class:"folder"},Bt={key:0},Pt=M({props:{item:null},emits:["event_callback"],setup(s,{emit:o}){const e=s,t=j({isOpen:!1,item:e.item,isFolder:e.item.children&&e.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:n}=V();O(()=>n.state.filename,(u,r)=>{l(u)});const a=(u,r)=>{console.log(`[event_callback] cmd=${u}`),o("event_callback",u,r)},c=(u,r)=>{console.log(`[event_callbackEx] cmd=${u}`),o("event_callback",u,t.item.path)};P(()=>{l(n.state.filename)});const i=u=>{if(t.isFolder)console.log("onClick-folder"),t.isOpen=!t.isOpen;else{const r=u.path;console.log(`onClick-filename=${r}`),n.do_cmd("open_file",r)}},d=u=>{console.log("onClickEx"),t.menu=t.isFolder?wt:kt,t.event=u},l=u=>{t.item.path==u,u.indexOf(t.item.name)!=-1&&(t.isOpen=!0),t.class_item=t.item.path==u?"item active":"item"};return(u,r)=>{const _=A("fa"),m=A("tree-item",!0);return f(),k("div",Nt,[$(be,{mouse:v(t).event,items:v(t).menu,onEvent_callback:c},null,8,["mouse","items"]),E("div",{onContextmenu:_e(d,["prevent"]),onClick:r[0]||(r[0]=p=>i(v(t).item))},[v(t).isFolder?N("",!0):(f(),k("div",{key:0,class:xe(v(t).class_item),title:v(t).item.time},D(v(t).item.name),11,Rt)),v(t).isFolder?(f(),k("div",Ft,[$(_,{icon:v(t).isOpen?"folder-open":"folder"},null,8,["icon"]),U(" "+D(v(t).item.name),1)])):N("",!0)],40,It),v(t).isOpen?(f(),k("div",Bt,[(f(!0),k(R,null,J(v(t).item.children,(p,w)=>(f(),k("div",{key:w},[$(m,{item:p,onEvent_callback:a},null,8,["item"])]))),128))])):N("",!0)])}}});var Vt=L(Pt,[["__scopeId","data-v-72fb2f54"]]);const Ht={class:"tree"},Ut=M({emits:["event_callback"],setup(s,{emit:o}){const e=j({items:void 0}),{store_data:t}=V();O(()=>t.state.dictMenu,(c,i)=>{a(c)});const n=(c,i)=>{console.log(`[event_callback] cmd=${c}`),o("event_callback",c,i)};P(()=>{console.log("[mounted]"),a(t.state.dictMenu)});const a=c=>{console.log("[onChanged_dictMenu]"),e.items=void 0;const i=c,d={name:"",children:[],path:"",file:"",time:""},l="/",u={[l]:d};i.forEach(function(r){r.key.split("/").reduce(function(_,m){if(_[m])return _[m];{const p={name:m,children:[],path:r.path,file:"md",time:r.atime};return _[l].children.push(p),_[l].file="",_[m]={[l]:p}}},u)}),console.log(d),setTimeout(()=>{e.items=d.children},500)};return(c,i)=>(f(),k("div",Ht,[(f(!0),k(R,null,J(v(e).items,d=>(f(),k("div",{key:d.path},[$(Vt,{item:d,onEvent_callback:n},null,8,["item"])]))),128))]))}});var Jt=L(Ut,[["__scopeId","data-v-878ee508"]]);const Kt=M({props:{level:{type:Number,required:!0}},setup(s,o){return{tag:F(()=>`h${s.level}`)}}});function zt(s,o,e,t,n,a){return f(),K(Ee(s.tag),{class:"h_tag"},{default:Z(()=>[Ce(s.$slots,"default",{},void 0,!0)]),_:3})}var qt=L(Kt,[["render",zt],["__scopeId","data-v-224980d8"]]);const Gt=M({emits:["event_callback"],components:{heading:qt},setup(s,o){const{store_data:e}=V(),t=j({listTag:[]});O(()=>e.state.tags,(c,i)=>{console.log(c),t.listTag=c});function n(c){e.do_cmd("update_jump",c)}function a(c){return`${c.text}`}return{state:t,dispTitle:a,jumpSource:n}}}),Yt={class:"tag"},Wt=["onClick"];function Qt(s,o,e,t,n,a){const c=A("heading");return f(),k("div",Yt,[(f(!0),k(R,null,J(s.state.listTag,(i,d)=>(f(),k("div",{key:d,onClick:l=>s.jumpSource(d),class:"item"},[$(c,{level:i.tag},{default:Z(()=>[U(D(s.dispTitle(i)),1)]),_:2},1032,["level"])],8,Wt))),128))])}var Xt=L(Gt,[["render",Qt],["__scopeId","data-v-06e31c53"]]);const Zt=M({emits:["event_callback"],setup(s,o){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(n,a)=>{console.log(`cmd=${n}, name=${a}`),o.emit("event_callback",n,a)}}}}),eo={class:"main",style:{_height:"100px"}},to=["onClick","title"];function oo(s,o,e,t,n,a){const c=A("fa");return f(),k("div",eo,[(f(!0),k(R,null,J(s.objToolbar,(i,d)=>(f(),k("button",{class:"btn-item",key:d,onClick:l=>s.event_callback("action",i.cmd),title:i.cmd},[$(c,{icon:i.icon},null,8,["icon"])],8,to))),128))])}var no=L(Zt,[["render",oo],["__scopeId","data-v-9ba5d562"]]);const X={};class so{constructor(o,e){W(this,"cmdid",0);W(this,"monaco",null);W(this,"editor",null);console.log("[constructer]"),this.monaco=o,this.editor=e}add(o,e,t,n,a=null){let c;switch(n.length){case 0:c=this.generateCommand(o,a);break;case 1:c=this.generateHeaderCommand(n[0]);break;case 2:c=this.generateWrapperCommand(n[0],n[1]);break}X[o]=c,this.editor.addAction({id:"markdown-"+this.cmdid++,label:o,keybindings:t,contextMenuGroupId:e&&"navigation",contextMenuOrder:e&&1.5,run:X[o]})}generateCommand(o,e){return(t,n)=>{e(t)}}generateWrapperCommand(o,e){const t=o.length+e.length;return this.editor,this.editor.getModel(),this.monaco,(n,a)=>{const c=n.getModel(),i=n.getSelections();if(i==null)return;const d=[];return i.forEach(l=>{d.push(new a.Selection(l.startLineNumber,l.startColumn,l.endLineNumber,l.endColumn+t)),c.pushEditOperations([],[{range:{startLineNumber:l.startLineNumber,startColumn:l.startColumn,endLineNumber:l.startLineNumber,endColumn:l.startColumn},text:o},{range:{startLineNumber:l.endLineNumber,startColumn:l.endColumn,endLineNumber:l.endLineNumber,endColumn:l.endColumn},text:e}])}),n.setSelections(d),null}}generateHeaderCommand(o){return this.editor,this.editor.getModel(),(e,t)=>{const n=e.getModel();let a=e.getSelections();return a==null&&(a=[e.getSelection()]),a.forEach(c=>{const i=n.findNextMatch("^(#+ )",{lineNumber:c.startLineNumber,column:1},!0,!1,null,!0);if(i!=null&&i.range.startLineNumber==c.startLineNumber&&i.range.startColumn==1){if(i.matches[1]==o)return;n.pushEditOperations([],[{range:{startLineNumber:c.startLineNumber,startColumn:1,endLineNumber:c.startLineNumber,endColumn:i.matches[1].length+1},text:""}])}n.pushEditOperations([],[{range:{startLineNumber:c.startLineNumber,startColumn:1,endLineNumber:c.startLineNumber,endColumn:1},text:o}])}),null}}}function io(s,o){const e=n=>{const a=c=>`00${c}`.slice(-2);return`${n.getFullYear()}/${a(n.getMonth()+1)}/${a(n.getDate())} ${a(n.getHours())}:${a(n.getMinutes())}:${a(n.getSeconds())}`};console.log("[setupShortcutKeys]");const t=new so(s,o);t.add("Bold","8_",[],["**","**"]),t.add("Italic","1_",[],["__","__"]),t.add("Underline","9_",[],["<u>","</u>"]),t.add("Strikethrough",!1,[s.KeyMod.CtrlCmd|s.KeyMod.Shift|s.KeyCode.KEY_S],["~~","~~"]),t.add("Code",!1,[],["`","`"]),t.add("Link",!1,[],["[","]()"]),t.add("Link-2",!1,[],["[](",")"]),t.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),t.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),t.add("Header 1",!1,[],["# ",""]),t.add("Header 2",!1,[],["## ",""]),t.add("Header 3",!1,[],["### ",""]),t.add("Header 4",!1,[],["#### ",""]),t.add("Header 5",!1,[],["##### ",""]),t.add("Header 6",!1,[],["###### ",""]),t.add("Check",!1,[],["- [ ] ",""]),t.add("Blockquotes",!1,[],["> ",""]),t.add("Today",!1,[],[`${e(new Date)}`,""]),t.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),t.add("Format","8_",[],[],n=>{console.log("format"),n.getAction("editor.action.formatDocument").run()})}const ao={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},co=M({emits:["event_callback"],components:{ToolbarEditor:no},props:{isActive_preview:{type:Boolean,default:!1}},setup(s,o){const e=q(null),t={editor:void 0},{store_data:n}=V(),a=j({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});P(()=>{console.log("[mounted]"),i(),p(n.state.obj.content)}),O(()=>n.state.obj.content,(b,x)=>{console.log("[watch-body]"),a.filename!=""&&C(),p(b),I(n.state.obj.position,!0),a.filename=n.state.filename}),O(()=>n.state.ObjTag,(b,x)=>{console.log(`[watch](ObjTag)-${b}`),c(b)}),O(()=>s.isActive_preview,(b,x)=>{console.log(`[watch](editor_toggle)-${b}`),b==!0&&w()});const c=b=>{const x=g=>{_(g)};console.log(`[jump_cursor]ObjTag={${Object.values(b)}}`);const h=b.line;x(h),setTimeout(()=>{const g=t.editor;a.pos_scroll=g.getScrollTop()},500)},i=()=>{const b=()=>{const x=(y,S)=>{io(y,S)},h=document.getElementById("container");if(console.log(`root=${h}`),h==null)return;const g=Se.create(h,ao);return x(ae,g),console.log(`editor=${g}`),g.onDidScrollChange(y=>{a.scrollInfo.height=y.scrollHeight,a.scrollInfo.top=y.scrollTop}),g};t.editor=b(),d()},d=()=>{t.editor.onDidBlurEditorText(b=>{w()})},l=(b,x)=>{switch(console.log(`[event_callback] cmd=${b}`),b){case"action":u(x);break;case"save":w();break}},u=b=>{console.log("[action]"),X[b]!=null&&X[b](t.editor,ae)},r=()=>t.editor.getValue(),_=b=>{const x=new Me(b+1,0,b+1,0);console.log(`Line=${b}`),t.editor.revealRangeAtTop(x)},m=()=>t.editor.getModel().getAlternativeVersionId(),p=b=>{t.editor.setValue(b),a.iVersion=m()},w=()=>{const b=m();if(console.info(`iVersion=${a.iVersion}, iVersion_cur=${b}`),a.iVersion==b)return;C();const x=r();n.do_cmd("save_file",x),a.iVersion=m(),console.info(`iVersion=${a.iVersion}`)},C=()=>{const b=t.editor,x={top:b.getScrollTop(),height:b.getScrollHeight(),contentHeight:b.getLayoutInfo().height,scrolled:a.pos_scroll!=b.getScrollTop()};return n.do_cmd("update_position",x,void 0),x},I=(b,x=!1)=>{if(b==null)return;console.log(`[e-set]value=${JSON.stringify(b)}`);const h=t.editor;if(x?!0:b.scrolled){const y=b.top/b.height;console.log(`per=${y}`);const S=h.getScrollHeight();h.setScrollTop(S*y)}else c(n.state.ObjTag);setTimeout(()=>{a.pos_scroll=h.getScrollTop()},500)};F(()=>t.editor.getScrollTop());const T=F(()=>n.state.height-27+"px");return{editorEx:t,event_callback:l,HeightEx:T,md_editor_monaco:e,get_position:C,set_position:I}}}),lo={class:"editor"};function ro(s,o,e,t,n,a){const c=A("ToolbarEditor");return f(),k("div",lo,[$(c,{class:"toolbar",onEvent_callback:s.event_callback},null,8,["onEvent_callback"]),E("div",{id:"container",ref:"md_editor_monaco",class:"core",style:H({height:s.HeightEx})},null,4)])}var uo=L(co,[["render",ro],["__scopeId","data-v-0e2bda63"]]);const _o=M({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(s,o){const e=q(null),{store_data:t}=V(),n=j({contentsPosition:[],tocMap:new Map,observer:null,elm_target_before:null,pos_scroll:-1,filename:""});P(()=>{function r(){const _=new te.Renderer;_.link=function(m,p,w){return m.indexOf("http")!=-1?`<a target="_blank" href="${m}">${w}</a>`:`<a target="_blank" href="#${m}">${w}</a>`},te.setOptions({renderer:_,langPrefix:"",breaks:!0})}console.log("[created]"),r()}),O(()=>t.state.obj.content,(r,_)=>{console.log("[watch-body]"),e.value,n.filename!=""&&i(),setTimeout(()=>{a(),d(t.state.obj.position,!0),n.filename=t.state.filename},0)});function a(){const r=b=>{b.forEach(x=>{const h=n.tocMap.get(x.target);console.log(x.intersectionRatio),x.intersectionRatio?(n.elm_target_before!=null&&n.elm_target_before.classList.remove("active"),h.classList.add("active"),n.elm_target_before=null):n.elm_target_before=h})},_={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},m=new IntersectionObserver(r,_),p=new Map,C=document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),T=document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5");console.log(`el_contents=${C.length}/${JSON.stringify(C)}`),console.log(`el_toc=${T.length}/${JSON.stringify(T)}`),C.forEach((b,x)=>{m.observe(b),p.set(T.item(x),b),p.set(b,T.item(x))}),n.tocMap=p,n.observer=m}O(()=>t.state.ObjTag,(r,_)=>{console.log(`[watch](ObjTag)-${r}`),c(r)}),O(()=>s.isActive_preview,(r,_)=>{console.log(`[watch](editor_toggle)-${r}`)}),F(()=>e.value.querySelector(".md_core_viewer"));function c(r){const _=(w,C)=>{console.log(`tag=${w}, num=${C}`);const I=e.value,T=I.querySelectorAll(".md_core_viewer > h"+w);T.length!=0&&(I.scrollTop=T[C].getBoundingClientRect().top-I.getBoundingClientRect().top+I.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(r)}}`);const m=r.tag,p=r.num;r.line,_(m,p),setTimeout(()=>{const w=e.value;n.pos_scroll=w.scrollTop},0)}const i=()=>{const r=e.value,_={top:r.scrollTop,height:r.scrollHeight,contentHeight:0,scrolled:n.pos_scroll!=r.scrollTop};return t.do_cmd("update_position",_,n.filename),_},d=(r,_=!1)=>{console.log(`[v-set]value=${JSON.stringify(r)}`);const m=e.value;if(r==null){m.scrollTop=0;return}if(_?!0:r.scrolled){const w=r.top/r.height;console.log(`per=${w}`),console.log(`scrollTop=${m.scrollTop}, scrollHeight=${m.scrollHeight}`),m.scrollTop=m.scrollHeight*w}else c(t.state.ObjTag);setTimeout(()=>{n.pos_scroll=m.scrollTop},0)},l=F(()=>te.parse(t.state.obj.content)),u=F(()=>t.state.height+"px");return{status,Markdown:l,HeightEx:u,md_viewer:e,get_position:i,set_position:d}}}),mo=["innerHTML"];function po(s,o,e,t,n,a){return f(),k("div",{class:"md_core_viewer note",innerHTML:s.Markdown,style:H({height:s.HeightEx}),ref:"md_viewer"},null,12,mo)}var ve=L(_o,[["render",po],["__scopeId","data-v-c03e578c"]]);const ho=M({components:{MarkdownEditor:uo,MarkdownViewer:ve},props:{editor_toggle:{type:Boolean,default:!0}},setup(s,o){const e=q(),t=q(),n=j({isActive_preview:!0});O(()=>s.editor_toggle,(i,d)=>{console.log(`[watch](editor_toggle)-${i}`),c()}),P(()=>{console.log("[mounted]"),document.addEventListener("keydown",a)}),he(()=>{document.removeEventListener("keydown",a)});const a=i=>{if(i.keyCode===83&&i.ctrlKey){i.preventDefault(),console.log("save"),c();return}else if(i.keyCode===69&&i.ctrlKey){i.preventDefault(),console.log("toggle"),c();return}},c=()=>{var l;const i=n.isActive_preview?{now:e,next:t}:{now:t,next:e},d=(l=i.now.value)==null?void 0:l.get_position();console.log(`isActive_preview=${n.isActive_preview}, scrollIndo=${JSON.stringify(d)}`),n.isActive_preview=!n.isActive_preview,setTimeout(()=>{var u;(u=i.next.value)==null||u.set_position(d)},500)};return{state:n,MdViewer:e,MdEditor:t}}});function go(s,o,e,t,n,a){const c=A("MarkdownViewer"),i=A("MarkdownEditor");return f(),k("div",null,[s.state.isActive_preview?(f(),K(c,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:s.state.isActive_preview},null,8,["isActive_preview"])):(f(),K(i,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:s.state.isActive_preview},null,8,["isActive_preview"]))])}var fo=L(ho,[["render",go]]);const bo=M({emits:["event_callback"],setup(s,o){const{store_dlg:e}=se(),{store_data:t}=V(),n=j({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});O(()=>e.state.objParam,r=>{a(r)});const a=r=>{const _=(m,p=!1)=>m!=null?m:p;console.log("[onChanged_objParam]"),n.title=r.title,n.title2=r.title2,n.edit=r.edit,n.edit_org=_(r.edit_org,r.edit),n.check=0,n.isShowDlg=!0,n.isNoEdit=_(r.isNoEdit),n.isFileOpen=_(r.isFileOpen),n.isReadOnly=_(r.isReadOnly),n.isCheck=_(r.isCheck),n.isMulti=_(r.isMulti),n.isDisabled=!0,n.action=r.action,l(!0)},c=r=>{if(console.log(`[doAction] flg=${r}, edit=${n.edit}`),r){const _=n.action(n);t.do_cmd(_[0],_[1],_[2])}n.isShowDlg=!1,l(!1)},i=r=>{const m=(r.target.files||r.dataTransfer.files)[0],p=n.action(n);t.do_cmd(p[0],m),n.isShowDlg=!1,l(!1)},d=()=>{const r=n.edit_org,_=n.edit==r&&!n.isReadOnly;return console.log(`[isDisabled]=${_}`),_},l=r=>{r==!0?document.addEventListener("keydown",u):document.removeEventListener("keydown",u)},u=r=>{if(r.keyCode===27){r.preventDefault(),c(!1);return}};return{state:n,props:s,doAction:c,onFileChange:i,isDisabled:d}}}),vo={class:"modal-mask"},ko={class:"modal-wrapper"},wo={class:"modal-container"},yo={class:"header"},$o={ref:"form",class:"form"},xo=["disabled"],Eo=["disabled"],Co={class:"modal-actions"},So=["disabled"];function Mo(s,o,e,t,n,a){const c=A("fa");return Q((f(),K(Ae,{persistent:""},{default:Z(()=>[E("div",vo,[E("div",ko,[E("div",wo,[E("div",yo,D(s.state.title)+"?",1),E("form",$o,[s.state.isFileOpen==!0?(f(),k("input",{key:0,class:"input",type:"file",onChange:o[0]||(o[0]=(...i)=>s.onFileChange&&s.onFileChange(...i))},null,32)):N("",!0),s.state.isNoEdit==!1?(f(),k(R,{key:1},[s.state.isMulti==!0?Q((f(),k("textarea",{key:0,class:"input",_autofocus:"","onUpdate:modelValue":o[1]||(o[1]=i=>s.state.edit=i),disabled:s.state.isReadOnly},null,8,xo)),[[ce,s.state.edit]]):Q((f(),k("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":o[2]||(o[2]=i=>s.state.edit=i),disabled:s.state.isReadOnly},null,8,Eo)),[[ce,s.state.edit]])],64)):N("",!0),s.state.isCheck==!0?(f(),k(R,{key:2},[Q(E("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=i=>s.state.check=i)},null,512),[[je,s.state.check]]),U(" "+D(s.state.title2),1)],64)):N("",!0)],512),E("div",Co,[E("button",{class:"btn btn-ok",ref:"ok",disabled:s.isDisabled(),onClick:o[4]||(o[4]=i=>s.doAction(!0))},[$(c,{icon:"check"}),U(" "+D(s.state.title),1)],8,So),E("button",{class:"btn btn-can",onClick:o[5]||(o[5]=i=>s.doAction(!1))},"cancel")])])])])]),_:1},512)),[[Oe,s.state.isShowDlg]])}var Oo=L(bo,[["render",Mo],["__scopeId","data-v-063a6425"]]);const jo={class:"container"},Ao={class:"main"},Lo=M({emits:["event_callback"],setup(s,{emit:o}){const{store_data:e}=V(),{store_dlg:t}=se(),n=ue(),a=ne(),c={snackbar:!1,message:"",timeout:-1,color:"green",actions:()=>{console.log("sb_actions")}},i=j({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,snackbar_ex:c,toggle_list:!1});P(()=>{console.log("[mounted]"),d(),window.addEventListener("resize",l),document.body.style.overflow="hidden"}),he(()=>{console.log("unmounted!"),window.removeEventListener("resize",l)});const d=()=>{console.log("init");const _=a.path.substring(1),p=a.fullPath.split("api_bookmark?=");if(console.log(p),p.length==2){e.do_cmd("bookmark",decodeURIComponent(p.pop()));return}e.do_cmd("filter_menu",null),console.log(`filename=${_}`),_==null||_==""?e.do_cmd("restore_file",""):e.do_cmd("open_file",_),l()},l=()=>{const _=window.innerHeight-45;console.log(`height=${_}`),e.update_height(_)},u=async(_,m)=>{switch(console.log(`[event_callback] cmd=${_}, va0=${m}`),_){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"openSnackbar":break;case"onClick_snackbar":break;case"config":i.objDlgConf={cmd:_,filename:"",commit:""};break;case"print":const p=n.resolve({path:`/print/${e.filename}`});window.open(p.href,"_blank");break;case"filelist":document.querySelector(".col-3");const w=!i.toggle_list;i.toggle_list=w,console.log(i.toggle_list);break;default:if(_.indexOf("dlg_")!=-1){const C=Object.assign({},r(_,m));t.update_param(C)}else e.do_cmd(_,m);break}},r=(_,m)=>{const p=yt[_],w=m!=null?m:e.state.filename;return p.init(p,w),p};return(_,m)=>(f(),k("div",jo,[$(Tt,{ref:"appbar",onEvent_callback:u},null,512),$(Oo,{objParam:v(i).objDlgCmn,onEvent_callback:u},null,8,["objParam"]),E("div",Ao,[v(i).toggle_list?(f(),K(Jt,{key:0,class:"col-3",onEvent_callback:u,style:H({height:v(i).height+"px"})},null,8,["style"])):N("",!0),$(fo,{class:"col-2",ref:"pane",editor_toggle:v(i).editor_toggle,style:H({height:v(i).height+"px"})},null,8,["editor_toggle","style"]),$(Xt,{class:"col-1",onEvent_callback:u,style:H({height:v(i).height+"px"})},null,8,["style"])])]))}});var Do=L(Lo,[["__scopeId","data-v-78fb7f1e"]]);const To={_class:"container"},No=M({emits:["event_callback"],setup(s,{emit:o}){V();const e=ne(),t=j({filename:"",height:window.innerHeight,timer3:-1});P(()=>{console.log("[mounted]"),n(),document.body.style.overflow="hidden"});const n=()=>{console.log("init");const a=e.path.substring(1);e.fullPath,console.log(`filename=${a}`),t.filename=a,t.timer3=window.setTimeout(()=>{clearTimeout(t.timer3),window.print()},500)};return(a,c)=>(f(),k("div",To,[U(D(v(t).filename)+" ",1),$(ve,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}}),Io=[{name:"viewer",path:"/:pathMatch(.*)*",component:Do},{name:"viewer_print",path:"/print/:pathMatch(.*)",component:No}],Ro=Le({history:De(),routes:Io});function Fo(s={}){const{immediate:o=!1,onNeedRefresh:e,onOfflineReady:t,onRegistered:n,onRegisterError:a}=s;let c;const i=async(d=!0)=>{};return"serviceWorker"in navigator&&(c=new Te("./sw.js",{scope:"./"}),c.addEventListener("activated",d=>{d.isUpdate?window.location.reload():t==null||t()}),c.register({immediate:o}).then(d=>{n==null||n(d)}).catch(d=>{a==null||a(d)})),i}Fo();Ne.add(Ie);Re(et).use(Ro).component("fa",Fe).mount("#app");
