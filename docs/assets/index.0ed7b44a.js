var Tn=Object.defineProperty;var jn=(t,e,o)=>e in t?Tn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var Me=(t,e,o)=>(jn(t,typeof e!="symbol"?e+"":e,o),o);import{D as On,a as ct,i as Mt,p as Dt,u as Qe,b as Ne,r as O,d as A,c as re,e as H,o as v,f as y,g as f,h as D,j as _e,t as z,k as F,F as J,l as Z,w as Je,m as j,n as X,q as w,s as E,v as ee,x as Bt,y as Lt,z as P,A as Fe,T as An,B as Q,C as Nn,E as Fn,G as In,H as rt,R as Rn,I as Ie,J as He,K as ie,L as Tt,M as We,N as jt,O as Pn,P as Vn,Q as zn,S as Hn,U as le,V as Kn,W as Gn,X as Un,Y as Yn,Z as Jn,_ as Ot,$ as we,a0 as Wn,a1 as qn,a2 as At,a3 as Xn,a4 as Zn,a5 as Qn,a6 as eo,a7 as et,a8 as to,a9 as no,aa as ne,ab as oo,ac as so,ad as ao,ae as io,af as lo,ag as co,ah as ro,ai as uo}from"./vendor.a2051790.js";var K=Object.freeze(Object.defineProperty({__proto__:null,get svg(){return Yt},get g(){return nt},get asstSvg(){return Jt},get foreign(){return Wt}},Symbol.toStringTag,{value:"Module"}));const po=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}};po();class oe{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(e,o="",n=[],s=!1){o!=""&&(this.path=o),n!=[]&&(this.tags=n),this.content=e;const a=this.get_time();this.atime=a,s==!0&&(this.ctime=a)}set_default(e){this.path=e,this.content="",this.tags=[];const o=this.get_time();this.atime=o,this.ctime=o}copy(e){Object.assign(this,e)}duplicate(e,o=""){const n=new oe;return n.copy(this),n.content=e,n.path=o,n.update_time(),n.update_tag(),n}update_content2(e){this.content=e}update_time(){console.log(`update_time path=${this.path}`),this.atime=this.get_time()}update_tag(){return this.tags=this.build_tag(this.content),this.tags}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const o=n=>`00${n}`.slice(-2);return`${e.getFullYear()}/${o(e.getMonth()+1)}/${o(e.getDate())} ${o(e.getHours())}:${o(e.getMinutes())}:${o(e.getSeconds())}`}update_time_all(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){const o=[],n=[0,0,0,0,0],s=e.split(/\r\n|\n|\r/);for(let a=0;a<s.length;a++)if(s[a].search(/^\s*#/)!=-1){const l=s[a].split(" "),c=l[0].length;l.shift();const r=l.join(" ");o.push({text:r,line:a,tag:c,num:n[c]}),n[c]++}return o}split(e){const o=[],n=this.content.split(/\r\n|\n|\r/),s=this.tags.filter(function(r){return r.tag==e}),a=[],i=n.length;for(var l=0;l<s.length;l++){const r=s[l].line;a.push({start:r,end:i,title:s[l].text}),l!=0&&(a[l-1].end=r-1)}const c=this.path.replace(".","_");return a.reverse(),a.forEach(r=>{const p=n.splice(r.start,r.end).join(`\r
`),h=this.duplicate(p,`${c}/${r.title}`);o.push(h)}),o.reverse(),o}}class ho extends On{constructor(){super("OdenDB");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class mo{constructor(e){this.db=new ho,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async o=>{const n=await this.dbx.get(o);return n!=null?n.data:null},this.write=async(o,n)=>{const s=JSON.stringify(n);await this.dbx.put({key:o,data:s,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async o=>{console.log(`delete key=${o}`),await this.dbx.delete(o),this.set_time_DB()},this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(n=>{e[n.key]=n.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class go{constructor(e){this.write=(o,n)=>this.storeLS.write(o,n),this.delete=o=>this.storeLS.delete(o),this.rename=async(o,n,s)=>{console.log(`[rename] _key_org=${o}, _key_new=${n}`);const a=this.as(await this.get(o));return a.path=n,await this.write(n,a),s&&await this.delete(o),a},this.split=async o=>{console.log(`[split] _key_org=${o}`);const s=this.as(await this.get(o)).split(1);return s.forEach(a=>{this.write(a.path,a)}),s},this.merge=(o,n)=>{console.log(`[merge] _path=${o}`);const s=new oe;return s.set_default(o),s.update_content2(n),s.update_time(),s.update_tag(),this.write(o,s),s},this.as=o=>Object.assign(new oe,o),this.sync_DB=()=>this.storeLS.sync_DB(),this._=e,this.storeLS=new mo(this._)}async get(e){console.log(`[get] _key=${e}`);const o=await this.read(e);return o!=null?JSON.parse(o):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,o){console.log(`[set] _key=${e}`);const n=this.as(await this.get(e));return n.path==""&&(n.path=e),n.update_content2(o),n.update_time(),n.update_tag(),this.write(e,n),n}async set_ex(e,o,n){console.log(`[set_ex] _key=${e}`);const s=this.as(o);return o.path==""&&(o.path=e),n!=null&&n.hasOwnProperty("no_upate_time")||s.update_time(),s.update_tag(),this.write(e,s),s}async read(e){return await this.storeLS.read(e)}create(e){console.log(`[create] _key=${e}`);const o=new oe;return e!=null&&(o.set_default(e),this.write(e,o)),o}}const Ke="menu.json";class fo{constructor(e){this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const o=await this._.mgrCache.getLstContent(e),n=this.buildMenu(o);return console.log(`${o.length}/${n.length}`),this._.contentEx.set(Ke,JSON.stringify(n)),n}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const o=await this._.contentEx.get(Ke);return JSON.parse(o.content)}}buildMenu(e){function o(s){const a=new Set;return s.forEach(i=>{a.add(i.group)}),[...a]}function n(s){console.log("storeEx_index:buildMenuEx");const a=o(s);return s.reduce((i,l)=>{if(l.path==Ke)return i;let c=l.group,r=l.title,d=`${c}/${r}`;return a.includes(d)&&(c=d,r=".index",d=`${c}/${r}`),i.push({key:d,group:c,title:r,path:l.path,atime:l.atime}),i},[])}return n(e).sort(this.compare_group)}compare_group(e,o){let n=e.group,s=o.group;n==s&&(n=`${e.group}/${e.title}`,s=`${o.group}/${o.title}`);const a=n.toUpperCase(),i=s.toUpperCase();let l=0;return a>i?l=1:a<i&&(l=-1),l}}class $e{static async read(e){console.log(`[read] filename=${e}`);const o=new URLSearchParams;return o.append("filename",e),$e.post_cmdEx("load_file_md",o)}static write(e,o){console.log(`[write] filename=${e}`);const n=new URLSearchParams;return n.append("filename",e),n.append("source",o),$e.post_cmdEx("save_file_md",n)}static async get_cmdEx(e){const o="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:get_cmdEx] api=${o}`),ct.get(o).then(n=>n.data).catch(n=>{throw n.response.status})}static async post_cmdEx(e,o){const n="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:post_cmdEx] api=${n}`),ct.post(n,o).then(s=>s.data).catch(s=>{throw s.response.status})}}class _o{constructor(e){this.backupEx=(o,n,s)=>{const a=()=>{const l=new URLSearchParams;l.append("lstContent",JSON.stringify(o)),$e.post_cmdEx("backup_contents",l).then(c=>console.log(c)).catch(c=>console.log(c))},i=()=>{const l=new Blob([JSON.stringify(o)],{type:"text/plain"}),c=(d,p)=>{const h=new Date,u=g=>`00${g}`.slice(-2);return`${d}_${h.getFullYear()}${u(h.getMonth()+1)}${u(h.getDate())}_${u(h.getHours())}.${p}`},r=document.createElement("a");r.download=c("lstData","json"),r.href=URL.createObjectURL(l),r.click(),URL.revokeObjectURL(r.href)};switch(console.log(`[backup] mode=${n}`),n){case"backup":a();break;case"export":i();break}},this._=e}async restoreEx(e,o,n){function s(c){c.forEach(r=>{const d=new oe;d.copy(r),d.update_tag(),l.write(d.path,d)})}async function a(c,r){$e.get_cmdEx("restore_contents").then(d=>{s(d),c(d)}).catch(d=>{console.log(d),r(null)})}async function i(c,r,d){const p=new FileReader;p.onload=()=>{var g;console.log("onload");const h=(g=p.result)!=null?g:"",u=JSON.parse(h);s(u),r(u)},p.onerror=h=>{d("error")},p.readAsText(c)}console.log("[importExport:restore]");const l=this._.contentEx;return new Promise(function(c,r){switch(e){case"restore":a(c,r);break;case"import":i(o,c,r);break}})}}class vo{constructor(e){this.journal2=async(o,n)=>{const s=(i,l)=>`
## ${this._.contentEx.as(i).cnv_time(n)}
${l}
`;console.log("[journal]");const a=await this.geolocation();return o.content+=s(o,a),o},this.geolocation=()=>new Promise(o=>{let n="";navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{n=`(Latitude,longitude)=(${s.coords.latitude},${s.coords.longitude})
`,o(n)},s=>{switch(s.code){case 1:n="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:n="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:n="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}o(n)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),o(n))}),this.chat=async(o,n,s)=>{const a=g=>["sun","mon","tue","wed","thu","fri","sat"][g],i=g=>{const b=S=>`00${S}`.slice(-2),k=`${g.getFullYear()}/${b(g.getMonth()+1)}/${b(g.getDate())}(${a(g.getDay())})`,$=`${b(g.getHours())}:${b(g.getMinutes())}`;return[k,$]},l=(g,b)=>g!==b?`
## ${b}
`:"",c=g=>{const b=s.isNoList?"":"- ",k=s.isAddTime?`${g} : `:"";return`${b}${k}${n}
${h}`};console.log("[chat]");const r=o.content.indexOf(`
`),[d,p]=i(new Date),h=s.isAddGeo?await this.geolocation()+`
`:"",u=l(o.content.substring(0,r),d)+c(p);return o.content=`${d}${o.content.substring(r)}${u}`,o},this._=e}async path_rename(e,o,n){console.log(`_from=${e}, _to=${o}`);const s=this.collect_filename_by_group(e,n);for(let a=0;a<s.length;a++){const i=s[a],l=`${i[1]}/${i[0]}`,c=`${o}${i[2]}/${i[0]}`;await this._.contentEx.rename(l,c)}}async path_delete(e,o){console.log(`_path=${e}`);const n=this.collect_filename_by_group(e,o);for(let s=0;s<n.length;s++){const a=n[s],i=`${a[1]}/${a[0]}`;await this._.contentEx.delete(i)}}async path_merge(e,o,n){console.log(`_path=${e}`);const s=[],a=this.collect_filename_by_group(e,n);for(let l=0;l<a.length;l++){const c=a[l],r=`${c[1]}/${c[0]}`,d=await this._.contentEx.get(r);s.push(d.content)}const i=s.join(`\r
`);return this._.contentEx.merge(o,i)}collect_filename_by_group(e,o){console.log(`[collect_filename_by_group] pat=${e}`);const n=[],s=e.length!=0?1:0;return o.forEach((a,i)=>{if(a.group==e){const l=a.group.substring(e.length+s);n.push([a.title,a.group,l.length!=0?`/${l}`:""])}}),n}}class bo{constructor(e){this._=e}async getLstContent(e){console.log("[getLstContent]");const o=a=>{const i=e.path==""?!0:a.path.indexOf(e.path)!=-1,l=e.keyword==""?!0:a.content.toLowerCase().indexOf(e.keyword)!=-1;return i&&l},n=await this.buildLstContent();return e!=null?n.filter(o):n}async buildLstContent(){var a;console.log("[buildLstContent]");const e=i=>{var r,d;let l=i.path;(l==""||l==null)&&(l=`@test/${new Date().toLocaleString()}`);const c=l.split("/");return i.title=(r=c.pop())!=null?r:".",i.group=(d=c.join("/"))!=null?d:"@test",i.tags=[],i.htags=[],i},o=await this._.contentEx.storeLS.getStrageEx(),n=[],s=i=>o[i];for(const i of Object.keys(o))try{n.push(e(JSON.parse((a=s(i))!=null?a:"")))}catch(l){console.log(`@ error key=${i},e=${l} - other error`)}return n}}class yo{constructor(){this.contentEx=new go(this),this.mgrExchange=new _o(this),this.mgrEtc=new vo(this),this.mgrMenu=new fo(this),this.mgrCache=new bo(this),console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,o){return this.contentEx.set(e,o)}async cmd_save_ex(e,o,n){return this.contentEx.set_ex(e,o,n)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_copy(e,o){await this.contentEx.rename(e,o,!1)}async cmd_rename(e,o,n){await this.contentEx.rename(e,o,n)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,o="",n=null){const s=await this.mgrCache.getLstContent(n);this.mgrExchange.backupEx(s,e,o)}async cmd_restoreEx(e,o,n=""){await this.mgrExchange.restoreEx(e,o,n)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,o){const n=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,o,n)}async cmd_path_delete(e){const o=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,o)}async cmd_path_merge(e,o){const n=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,o,n)}async cmd_chat(e,o,n){const a=(()=>{const c=new Date;return`${e}${n.mode}_${c.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${a}`);const i=await this.contentEx.get(a),l=await this.mgrEtc.chat(i,o,n);return await this.contentEx.set(a,l.content),[l,a]}}class wo{constructor(e){this.KEY="",console.log(e),this.KEY=e}get(e){var o;if(localStorage.getItem(this.KEY)!=null){const n=JSON.parse((o=localStorage.getItem(this.KEY))!=null?o:"");e(n),console.log(n)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const xo=1e3*60*10,Nt=Symbol(),ko=()=>{const t=Qe();Ne();const e=O({storeEx:new yo,persisted:new wo("lifeLog-Viewer-params"),filename:"",obj:new oe,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),o=m=>{console.log(`[update_filename] : new=${m}`),n(m)},n=async m=>{console.log(`[load_obj] : new=${m}`),e.persisted.set({filename:m});const _=t.currentRoute.value.name.toString();if(m!=""){if(m.indexOf(_)==-1){t.push(m.indexOf(".mm")!=-1?"/mm/":"/"),console.log("router.push");return}const C=await e.storeEx.cmd_load(m);l(C)}else l(c(""));e.filename=m},s=()=>{console.log("restore_filename"),e.persisted.get(m=>{o(m.filename)})},a=async m=>{if(m==""){console.log("skip save - empty data");return}l(c(m),{update_time:!0}),await e.storeEx.cmd_save_ex(e.filename,e.obj),p()},i=()=>{console.log("[auto_save] start"),e.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(e.intervalId_autoSave)),e.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await S("export",null,null),e.intervalId_autoSave=null},xo)},l=(m,_)=>{const C=m instanceof oe?m:Object.assign(new oe,m);_!=null&&_.hasOwnProperty("update_time")&&C.update_time(),e.tags=C.update_tag(),e.obj=C},c=m=>(e.obj.content=m,e.obj),r=async(m,_)=>{if(console.log(m),_!=null){const C=await e.storeEx.cmd_load(_);C.position=m,await e.storeEx.cmd_save_ex(_,C,{no_upate_time:!0})}else e.obj.position=m},d=m=>{e.dictMenu=m},p=()=>{setTimeout(async()=>{d(await e.storeEx.cmd_rebuild()),i()},250)},h=m=>{e.jump=m,m!=-1&&(console.log(`jump=${m}`),e.ObjTag=JSON.parse(JSON.stringify(e.tags[m])),console.log(JSON.stringify(e.ObjTag)))},u=m=>{e.height=m},g=async(m,_)=>{const[C,T]=await e.storeEx.cmd_chat(e.path_expand,m,_);l(C,{update_time:!0}),o(T),p()},b=async(m,_)=>{const C=await e.storeEx.cmd_exist(m);if(_==C)return!0;{const T=_?`error : ${m} is not exist. please enter exist filename.`:`error : ${m} is already exist. please enter other filename.`;return console.log(T),!1}},k=async(m,_,C=!0)=>{await b(m,!1)&&(o(""),await e.storeEx.cmd_rename(_,m,C),o(m),p())},$=async(m,_)=>{const C=M(_)[0],T=M(m)[0];o(""),await e.storeEx.cmd_path_rename(C,T),p()},S=async(m,_,C)=>{console.log(`[do_cmd] mode=${m}`);let T=_!=""?_:e.filename,Y="",se;switch(m){case"update_jump":h(_);break;case"rebuild_menu":p();break;case"filter_menu":const ze=_;_!=null&&(ze.path=ze.isUnderFolder?M(e.filename)[0]:""),d(await e.storeEx.cmd_getMenu(ze));break;case"open_file":o(_);break;case"restore_file":s();break;case"save_file":await a(_);break;case"new":await b(_,!1)&&(await e.storeEx.cmd_create(_),o(_),p());break;case"delete":await b(T,!0)&&(o(""),await e.storeEx.cmd_delete(T),p());break;case"rename":k(_,C);break;case"copy":k(_,C,!1);break;case"backup":e.storeEx.cmd_backup("backup");break;case"export":e.storeEx.cmd_backup("export");break;case"restore":await e.storeEx.cmd_restoreEx("restore",null),p();break;case"import":await e.storeEx.cmd_restoreEx("import",_),p();break;case"split":await b(T,!0)&&(await e.storeEx.cmd_split(T),p());break;case"path_rename":$(_,C);break;case"path_delete":Y=M(_)[0],await e.storeEx.cmd_path_delete(Y),o(""),p();break;case"path_merge":Y=M(_)[0],T=`${Y}.md`,await b(T,!1)&&(await e.storeEx.cmd_path_merge(Y,T),o(T),p());break;case"print":const Ln=t.resolve({path:`/print/${e.filename}`});window.open(Ln.href,"_blank");break;case"journal":g("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":g(_,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":g(_,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":se={keyword:C.filter.toLowerCase(),isUnderFolder:C.isCheck,path:""},d(await e.storeEx.cmd_getMenu(se));break;case"update_position":await r(_,C);break;case"move_archive":k(`@archive/${_}`,_);break;case"move_path_archive":$(`@archive/${_}`,_);break;case"export_archive":se={keyword:"",isUnderFolder:!0,path:"@archive/"},e.storeEx.cmd_backup("export","",se);break}},M=m=>{const _=m.split("/"),C=_[_.length-1];return[_.slice(0,-1).join("/"),C]};return{store_data:{state:e,update_height:u,do_cmd:S}}},$o=()=>{Dt(Nt,ko())},te=()=>Mt(Nt),Eo=()=>{const t=O({objParam:null});return{store_dlg:{state:t,update_param:o=>{t.objParam=o}}}},Ft=Symbol(),Co=()=>{Dt(Ft,Eo())},Re=()=>Mt(Ft);const So=A({setup(t){return $o(),Co(),(e,o)=>{const n=H("routerView");return v(),re(n)}}});var N=(t,e)=>{const o=t.__vccOpts||t;for(const[n,s]of e)o[n]=s;return o};const Mo={key:0},Do={key:1,class:"line"},Bo={key:2,class:"dropdown"},Lo=A({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=O({isOpen:!1,item:o.item,isFolder:o.item.children&&o.item.children.length,isActive:!0}),s=(i,l)=>{console.log(`[event_callback] cmd=${i}`),e("event_callback",i,l)},a=i=>{if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const l=i.cmd;s(l,null)}};return(i,l)=>{const c=H("fa"),r=H("MenuTreeItem",!0);return v(),y("div",{class:"menu_tree",onClick:l[0]||(l[0]=d=>a(f(n).item)),onContextmenu:l[1]||(l[1]=Je(()=>{},["right","prevent"]))},[f(n).item.title!=""?(v(),y("div",Mo,[D(c,{icon:f(n).item.icon},null,8,["icon"]),_e(" "+z(f(n).item.title),1)])):F("",!0),f(n).item.title==""?(v(),y("div",Do)):F("",!0),f(n).isFolder?(v(),y("div",Bo,[(v(!0),y(J,null,Z(f(n).item.children,(d,p)=>(v(),y("div",{key:p},[D(r,{item:d,onEvent_callback:s},null,8,["item"])]))),128))])):F("",!0)],32)}}});var To=N(Lo,[["__scopeId","data-v-d08517be"]]);const jo=A({props:{mouse:null,items:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=O({items:o.items,pos_x:-1,pos_y:-1,style:"display:none"});j(()=>o.mouse,(i,l)=>{console.log("props"),n.pos_x=o.mouse.clientX,n.pos_y=o.mouse.clientY,n.items=o.items,n.style="display:block"});const s=(i,l)=>{console.log(`[event_callback] cmd=${i}`),e("event_callback",i,l)},a=i=>{n.style=i?"display:block":"display:none"};return(i,l)=>(v(),y("div",{class:"menu",style:X(f(n).style),onMouseover:l[0]||(l[0]=c=>a(!0)),onMouseleave:l[1]||(l[1]=c=>a(!1))},[(v(!0),y(J,null,Z(f(n).items,c=>(v(),y("div",{key:c.path},[D(To,{item:c,onEvent_callback:s},null,8,["item"])]))),128))],36))}});var It=N(jo,[["__scopeId","data-v-62ad7429"]]);const Oo=A({props:{objMenu:null},emits:["event_callback"],setup(t,{emit:e}){const n=O({items:t.objMenu,event:void 0,style:"display:none"}),s=(l,c)=>{console.log(`[event_callback] cmd=${l}`),e("event_callback",l,c)},a=l=>{console.log("onClick"),n.event=l},i=l=>{n.style=l?"display:block":"display:none"};return(l,c)=>{const r=H("fa");return v(),y("div",{class:"dropdown",onClick:a,onMouseover:c[0]||(c[0]=d=>i(!0)),onMouseleave:c[1]||(c[1]=d=>i(!1))},[D(r,{icon:"bars"}),D(It,{class:"menu",mouse:f(n).event,items:f(n).items,onEvent_callback:s,style:X(f(n).style)},null,8,["mouse","items","style"])],32)}}});var Ao=N(Oo,[["__scopeId","data-v-1a158634"]]);const No={class:"base"},Fo={key:0,class:"dropdown"},Io=["onClick"],Ro={class:"title_sub2"},Po={class:"title"},Vo={class:"title_sub"},zo=A({props:{objMenuItem:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=O({items:[],items2:[],isShowDlg:!1});j(()=>o.objMenuItem,(l,c)=>{n.items=s(l),n.items2=n.items.slice(0,5)});const s=l=>{console.log("[cnvLstRecent]");function c(d,p){const h=d.atime,u=p.atime;let g=0;return h>u?g=-1:h<u&&(g=1),g}const r=[...l];return r.sort(c),r.slice(0,15)},a=l=>{const c=n.items[l].path;e("event_callback","open_file",c),n.isShowDlg=!1},i=l=>{n.isShowDlg=l};return(l,c)=>{const r=H("fa");return v(),y("div",No,[w("span",{class:"_base",onMouseover:c[0]||(c[0]=d=>i(!0)),onMouseleave:c[1]||(c[1]=d=>i(!1))},[D(r,{icon:"history",class:"_item"}),f(n).isShowDlg?(v(),y("ul",Fo,[(v(!0),y(J,null,Z(f(n).items,(d,p)=>(v(),y("li",{class:"item",key:p,onClick:h=>a(p)},[D(r,{class:"title_item",icon:"file-alt"}),w("span",Ro,z(d.group)+"/",1),w("span",Po,z(d.title),1),w("span",Vo,"["+z(d.atime)+"]",1)],8,Io))),128))])):F("",!0)],32)])}}});var Ho=N(zo,[["__scopeId","data-v-dc1261d8"]]);const Ko=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],Go=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"copy",cmd:"dlg_copy",icon:"copy",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],Uo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],Rt={dlg_import:{init:(t,e)=>{t.title="Restore",t.isFileOpen=!0,t.isNoEdit=!0,t.edit=""},action:t=>["import"]},dlg_delete:{init:(t,e)=>{t.title="Delete",t.isReadOnly=!0,t.edit=e},action:t=>["delete",t.edit,""]},dlg_rename:{init:(t,e)=>{t.title="Rename",t.edit=e},action:t=>["rename",t.edit,t.edit_org]},dlg_new:{init:(t,e)=>{t.title="Create",t.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:t=>["new",t.edit,""]},dlg_copy:{init:(t,e)=>{t.title="Copy",t.edit=e},action:t=>["copy",t.edit,t.edit_org]},dlg_path_rename:{init:(t,e)=>{t.title="Rename of Path",t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_rename",t.edit,t.edit_org]},dlg_path_delete:{init:(t,e)=>{t.title="Delete of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_delete",t.edit,""]},dlg_path_merge:{init:(t,e)=>{t.title="Merge of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_merge",t.edit,""]},dlg_tweet:{init:(t,e)=>{t.title="Tweet",t.edit=""},action:t=>["tweet",t.edit,""]},dlg_bookmark:{init:(t,e)=>{t.title="Bookmark",t.edit="",t.isMulti=!0},action:t=>["bookmark",t.edit,""]},dlg_filter:{init:(t,e)=>{t.title="Filter",t.title2="target under folder",t.edit="",t.edit_org="@",t.isCheck=!0},action:t=>(console.log("dlg_filter"),["filter",t.filename,{filter:t.edit,isCheck:t.check}])}};const Yo=t=>(Bt("data-v-0ed0b40a"),t=t(),Lt(),t),Jo={class:"nav"},Wo=["title"],qo={class:"cmd"},Xo=Yo(()=>w("span",{class:"item"},null,-1)),Zo=A({emits:["event_callback"],setup(t,{emit:e}){const{store_data:o}=te();Re();const n=E(null),s=O({filename:"@",objMenu:Ko,dctMenu:[]}),a=(r,d)=>{console.log(`[event_callback] cmd=${r}`),r=="top"?n.value.scrollIntoView({}):e("event_callback",r,d)};ee(()=>{console.log("[mounted]")});const i=r=>{console.log(`[doAction] cmd=${r}`),e("event_callback",r,!0)};j(()=>o.state.filename,(r,d)=>{console.log(`[watch:filename] ${r}`),c(r)}),j(()=>o.state.dictMenu,(r,d)=>{s.dctMenu=r}),j(()=>o.state.jump,(r,d)=>{window.setTimeout(()=>{l()},500)});const l=()=>{n.value.scrollIntoView({})},c=r=>{console.log(`[onChanged_filename] new=${r}`),s.filename=r,l()};return(r,d)=>{const p=H("fa");return v(),y("header",{class:"appbar",ref_key:"appbar",ref:n,onClick:d[6]||(d[6]=h=>a("top",!0))},[w("nav",Jo,[D(Ao,{class:"item",objMenu:f(s).objMenu,onEvent_callback:a,title:"menu"},null,8,["objMenu"]),w("section",{class:"item logo",onClick:d[0]||(d[0]=h=>a("filelist",!0)),title:f(s).filename},"Oden",8,Wo),D(Ho,{class:"item",objMenuItem:f(s).dctMenu,onEvent_callback:a,title:"history"},null,8,["objMenuItem"]),f(s).filename!==""?(v(),y("span",{key:0,class:"item name",onClick:d[1]||(d[1]=h=>a("dlg_rename",null))},"["+z(f(s).filename)+"]",1)):F("",!0),w("span",{class:"item mark",onClick:d[2]||(d[2]=h=>i("toggle_editor")),title:"editor/viewer"},[D(p,{icon:"edit"})])]),w("span",qo,[w("span",{class:"item",onClick:d[3]||(d[3]=h=>i("dlg_filter")),title:"filter"},[D(p,{icon:"paw"})]),w("span",{class:"item",onClick:d[4]||(d[4]=h=>i("dlg_tweet")),title:"tweet"},[D(p,{icon:"grimace"})]),w("span",{class:"item",onClick:d[5]||(d[5]=h=>i("dlg_bookmark")),title:"bookmark"},[D(p,{icon:"bookmark"})]),Xo])],512)}}});var Pt=N(Zo,[["__scopeId","data-v-0ed0b40a"]]);const Qo=["title","onContextmenu"],es={key:0},ts=A({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=O({isOpen:!1,item:o.item,isFolder:o.item.children&&o.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:s}=te();j(()=>s.state.filename,(h,u)=>{r(h)});const a=(h,u)=>{console.log(`[event_callback] cmd=${h}`),e("event_callback",h,u)},i=(h,u)=>{console.log(`[event_callbackEx] cmd=${h}`),e("event_callback",h,n.item.path)};ee(()=>{r(s.state.filename)});const l=h=>{if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const u=h.path;console.log(`onClick-filename=${u}`),s.do_cmd("open_file",u)}},c=h=>{console.log("onClickEx"),n.menu=n.isFolder?Uo:Go,n.event=h},r=h=>{n.item.path==h,h.indexOf(n.item.name)!=-1&&(n.isOpen=!0),n.class_item=n.item.path==h?"item active":"item"},d=()=>n.isFolder?"folder":n.class_item,p=()=>n.isFolder?n.isOpen?"folder-open":"folder":n.item.file=="mm"?"pen":"file";return(h,u)=>{const g=H("fa"),b=H("tree-item",!0);return v(),y("div",{class:"file_tree",onContextmenu:u[1]||(u[1]=Je(()=>{},["prevent"]))},[D(It,{mouse:f(n).event,items:f(n).menu,onEvent_callback:i},null,8,["mouse","items"]),w("div",{class:P(d()),title:f(n).item.time,onClick:u[0]||(u[0]=k=>l(f(n).item)),onContextmenu:Je(c,["prevent"])},[D(g,{icon:p(),onClick:c},null,8,["icon"]),_e(" "+z(f(n).item.name),1)],42,Qo),f(n).isOpen?(v(),y("div",es,[(v(!0),y(J,null,Z(f(n).item.children,(k,$)=>(v(),y("div",{key:$},[D(b,{item:k,onEvent_callback:a},null,8,["item"])]))),128))])):F("",!0)],32)}}});var ns=N(ts,[["__scopeId","data-v-6b50d36f"]]);const os={class:"tree"},ss=A({emits:["event_callback"],setup(t,{emit:e}){const o=O({items:void 0}),{store_data:n}=te();j(()=>n.state.dictMenu,(i,l)=>{a(i)});const s=(i,l)=>{console.log(`[event_callback] cmd=${i}`),e("event_callback",i,l)};ee(()=>{console.log("[mounted]"),a(n.state.dictMenu)});const a=i=>{console.log("[onChanged_dictMenu]"),o.items=void 0;const l=i,c={name:"",children:[],path:"",file:"",time:""},r="/",d={[r]:c},p=h=>h.split(".").slice(1);l.forEach(function(h){h.key.split("/").reduce(function(u,g){if(u[g])return u[g];{const b={name:g,children:[],path:h.path,file:p(g),time:h.atime};return u[r].children.push(b),u[r].file="",u[g]={[r]:b}}},d)}),console.dir(c),setTimeout(()=>{o.items=c.children},250)};return(i,l)=>(v(),y("div",os,[D(An,{_appear:"",name:"flip-list",tag:"div"},{default:Fe(()=>[(v(!0),y(J,null,Z(f(o).items,c=>(v(),y("div",{key:c.path},[D(ns,{item:c,onEvent_callback:s},null,8,["item"])]))),128))]),_:1})]))}});var Vt=N(ss,[["__scopeId","data-v-15645628"]]);const as=A({props:{level:null},setup(t){const e=t,o=Q(()=>`h${e.level}`);return(n,s)=>(v(),re(Nn(f(o)),{class:"h_tag"},{default:Fe(()=>[Fn(n.$slots,"default",{},void 0,!0)]),_:3}))}});var is=N(as,[["__scopeId","data-v-7eb56ab3"]]);const ls=A({emits:["event_callback"],components:{heading:is},setup(t,e){const{store_data:o}=te(),n=O({listTag:[]});j(()=>o.state.tags,(i,l)=>{n.listTag=i});function s(i){o.do_cmd("update_jump",i)}function a(i){return`${i.text}`}return{state:n,dispTitle:a,jumpSource:s}}}),cs={class:"tag"},rs=["onClick"];function ds(t,e,o,n,s,a){const i=H("heading");return v(),y("div",cs,[(v(!0),y(J,null,Z(t.state.listTag,(l,c)=>(v(),y("div",{key:c,onClick:r=>t.jumpSource(c),class:"item"},[D(i,{level:l.tag},{default:Fe(()=>[_e(z(t.dispTitle(l)),1)]),_:2},1032,["level"])],8,rs))),128))])}var us=N(ls,[["render",ds],["__scopeId","data-v-c506de12"]]);const ps=A({emits:["event_callback"],setup(t,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(s,a)=>{console.log(`cmd=${s}, name=${a}`),e.emit("event_callback",s,a)}}}}),hs={class:"main",style:{_height:"100px"}},ms=["onClick","title"];function gs(t,e,o,n,s,a){const i=H("fa");return v(),y("div",hs,[(v(!0),y(J,null,Z(t.objToolbar,(l,c)=>(v(),y("button",{class:"btn-item",key:c,onClick:r=>t.event_callback("action",l.cmd),title:l.cmd},[D(i,{icon:l.icon},null,8,["icon"])],8,ms))),128))])}var fs=N(ps,[["render",gs],["__scopeId","data-v-495368bc"]]);const Be={};class _s{constructor(e,o){Me(this,"cmdid",0);Me(this,"monaco",null);Me(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=o}add(e,o,n,s,a=null){let i;switch(s.length){case 0:i=this.generateCommand(e,a);break;case 1:i=this.generateHeaderCommand(s[0]);break;case 2:i=this.generateWrapperCommand(s[0],s[1]);break}Be[e]=i,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:n,contextMenuGroupId:o&&"navigation",contextMenuOrder:o&&1.5,run:Be[e]})}generateCommand(e,o){return(n,s)=>{o(n)}}generateWrapperCommand(e,o){const n=e.length+o.length;return this.editor,this.editor.getModel(),this.monaco,(s,a)=>{const i=s.getModel(),l=s.getSelections();if(l==null)return;const c=[];return l.forEach(r=>{c.push(new a.Selection(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn+n)),i.pushEditOperations([],[{range:{startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.startLineNumber,endColumn:r.startColumn},text:e},{range:{startLineNumber:r.endLineNumber,startColumn:r.endColumn,endLineNumber:r.endLineNumber,endColumn:r.endColumn},text:o}])}),s.setSelections(c),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(o,n)=>{const s=o.getModel();let a=o.getSelections();return a==null&&(a=[o.getSelection()]),a.forEach(i=>{const l=s.findNextMatch("^(#+ )",{lineNumber:i.startLineNumber,column:1},!0,!1,null,!0);if(l!=null&&l.range.startLineNumber==i.startLineNumber&&l.range.startColumn==1){if(l.matches[1]==e)return;s.pushEditOperations([],[{range:{startLineNumber:i.startLineNumber,startColumn:1,endLineNumber:i.startLineNumber,endColumn:l.matches[1].length+1},text:""}])}s.pushEditOperations([],[{range:{startLineNumber:i.startLineNumber,startColumn:1,endLineNumber:i.startLineNumber,endColumn:1},text:e}])}),null}}}function vs(t,e){const o=s=>{const a=i=>`00${i}`.slice(-2);return`${s.getFullYear()}/${a(s.getMonth()+1)}/${a(s.getDate())} ${a(s.getHours())}:${a(s.getMinutes())}:${a(s.getSeconds())}`};console.log("[setupShortcutKeys]");const n=new _s(t,e);n.add("Bold","8_",[],["**","**"]),n.add("Italic","1_",[],["__","__"]),n.add("Underline","9_",[],["<u>","</u>"]),n.add("Strikethrough",!1,[t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.KEY_S],["~~","~~"]),n.add("Code",!1,[],["`","`"]),n.add("Link",!1,[],["[","]()"]),n.add("Link-2",!1,[],["[](",")"]),n.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),n.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),n.add("Header 1",!1,[],["# ",""]),n.add("Header 2",!1,[],["## ",""]),n.add("Header 3",!1,[],["### ",""]),n.add("Header 4",!1,[],["#### ",""]),n.add("Header 5",!1,[],["##### ",""]),n.add("Header 6",!1,[],["###### ",""]),n.add("Check",!1,[],["- [ ] ",""]),n.add("Blockquotes",!1,[],["> ",""]),n.add("Today",!1,[],[`${o(new Date)}`,""]),n.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),n.add("Format","8_",[],[],s=>{console.log("format"),s.getAction("editor.action.formatDocument").run()})}const bs={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},ys=A({emits:["event_callback"],components:{ToolbarEditor:fs},props:{isActive_preview:{type:Boolean,default:!1}},setup(t,e){const o=E(null),n={editor:void 0},{store_data:s}=te(),a=O({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});ee(()=>{console.log("[mounted]"),l(),g(s.state.obj.content)}),j(()=>s.state.obj.content,(m,_)=>{console.log("[watch-body]"),a.filename!=""&&$(),g(m),S(s.state.obj.position,!0),a.filename=s.state.filename}),j(()=>s.state.ObjTag,(m,_)=>{console.log(`[watch](ObjTag)-${m}`),i(m)}),j(()=>t.isActive_preview,(m,_)=>{console.log(`[watch](editor_toggle)-${m}`),m==!0&&k()});const i=m=>{const _=T=>{h(T)};console.log(`[jump_cursor]ObjTag={${Object.values(m)}}`);const C=m.line;_(C),setTimeout(()=>{const T=n.editor;a.pos_scroll=T.getScrollTop()},500)},l=()=>{const m=()=>{const _=(Y,se)=>{vs(Y,se)},C=document.getElementById("container");if(console.log(`root=${C}`),C==null)return;const T=In.create(C,bs);return _(rt,T),console.log(`editor=${T}`),T.onDidScrollChange(Y=>{a.scrollInfo.height=Y.scrollHeight,a.scrollInfo.top=Y.scrollTop}),T};n.editor=m(),c()},c=()=>{n.editor.onDidBlurEditorText(m=>{k()})},r=(m,_)=>{switch(console.log(`[event_callback] cmd=${m}`),m){case"action":d(_);break;case"save":k();break}},d=m=>{console.log("[action]"),Be[m]!=null&&Be[m](n.editor,rt)},p=()=>n.editor.getValue(),h=m=>{const _=new Rn(m+1,0,m+1,0);console.log(`Line=${m}`),n.editor.revealRangeAtTop(_)},u=()=>n.editor.getModel().getAlternativeVersionId(),g=m=>{n.editor.setValue(m),a.iVersion=u()},b=()=>{const m=u();return console.info(`iVersion=${a.iVersion}, iVersion_cur=${m}`),a.iVersion!=m},k=(m=!1)=>{if(!b())return;m||$();const _=p();s.do_cmd("save_file",_),a.iVersion=u(),console.info(`iVersion=${a.iVersion}`)},$=()=>{const m=n.editor,_={top:m.getScrollTop(),height:m.getScrollHeight(),contentHeight:m.getLayoutInfo().height,scrolled:a.pos_scroll!=m.getScrollTop()};return b()?(s.do_cmd("update_position",_,void 0),k(!0)):s.do_cmd("update_position",_,a.filename),_},S=(m,_=!1)=>{if(m==null)return;console.log(`[e-set]value=${JSON.stringify(m)}`);const C=n.editor;if(_?!0:m.scrolled){const Y=m.top/m.height;console.log(`per=${Y}`);const se=C.getScrollHeight();C.setScrollTop(se*Y)}else i(s.state.ObjTag);setTimeout(()=>{a.pos_scroll=C.getScrollTop()},500)};Q(()=>n.editor.getScrollTop());const M=Q(()=>`${s.state.height-27}px`);return{editorEx:n,event_callback:r,HeightEx:M,md_editor_monaco:o,get_position:$,set_position:S}}}),ws={class:"editor"};function xs(t,e,o,n,s,a){const i=H("ToolbarEditor");return v(),y("div",ws,[D(i,{class:"toolbar",onEvent_callback:t.event_callback},null,8,["onEvent_callback"]),w("div",{id:"container",ref:"md_editor_monaco",class:"core",style:X({height:t.HeightEx})},null,4)])}var ks=N(ys,[["render",xs],["__scopeId","data-v-edf1b242"]]);const $s=A({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(t,e){const o=E(null),{store_data:n}=te(),s=O({pos_scroll:-1,filename:"",observer_scroll:null});ee(()=>{function p(){const h=new He.Renderer;h.link=function(u,g,b){return u.indexOf("http")!=-1?`<a target="_blank" href="${u}">${b}</a>`:`<a target="_blank" href="#${u}">${b}</a>`},He.setOptions({renderer:h,langPrefix:"",breaks:!0})}console.log("[mounted]"),p(),s.observer_scroll=new a}),Ie(()=>{}),j(()=>n.state.obj.content,(p,h)=>{console.log("[watch-body]"),o.value,s.filename!=""&&l(),setTimeout(()=>{s.observer_scroll.build(),c(n.state.obj.position,!0),s.filename=n.state.filename},0)});class a{constructor(){this.observer=null,this.tocMap=null,this.elm_target_before=null}destructor(){}build(){const h=()=>document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),u=()=>document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5"),g=(S,M)=>{const m=this.tocMap.get(S);console.log(M),M?(this.elm_target_before!=null&&this.elm_target_before.classList.remove("active"),m.classList.add("active"),this.elm_target_before=null):this.elm_target_before=m},b={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},k=this.set_callback(g,b),$=this.build_toc_map(k,h(),u());this.observer=k,this.tocMap=$}set_callback(h,u){const g=b=>{b.forEach(k=>{h(k.target,k.intersectionRatio)})};return new IntersectionObserver(g,u)}build_toc_map(h,u,g){const b=new Map;return console.log(`el_contents=${u.length}`),console.log(`el_tocs=${g.length}`),u.forEach((k,$)=>{h.observe(k),b.set(g.item($),k),b.set(k,g.item($))}),b}}j(()=>n.state.ObjTag,(p,h)=>{console.log(`[watch](ObjTag)-${p}`),i(p)}),j(()=>t.isActive_preview,(p,h)=>{console.log(`[watch](editor_toggle)-${p}`)}),Q(()=>o.value.querySelector(".md_core_viewer"));function i(p){const h=(b,k)=>{console.log(`tag=${b}, num=${k}`);const $=o.value,S=$.querySelectorAll(".md_core_viewer > h"+b);S.length!=0&&($.scrollTop=S[k].getBoundingClientRect().top-$.getBoundingClientRect().top+$.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(p)}}`);const u=p.tag,g=p.num;p.line,h(u,g),setTimeout(()=>{const b=o.value;s.pos_scroll=b.scrollTop},0)}const l=()=>{const p=o.value,h={top:p.scrollTop,height:p.scrollHeight,contentHeight:0,scrolled:s.pos_scroll!=p.scrollTop};return n.do_cmd("update_position",h,s.filename),h},c=(p,h=!1)=>{if(console.log(`[v-set]value=${JSON.stringify(p)}`),o.value==null)return;const u=o.value;if(p==null){u.scrollTop=0;return}if(h?!0:p.scrolled){const b=p.top/p.height;console.log(`per=${b}`),console.log(`scrollTop=${u.scrollTop}, scrollHeight=${u.scrollHeight}`),u.scrollTop=u.scrollHeight*b}else i(n.state.ObjTag);setTimeout(()=>{s.pos_scroll=u.scrollTop},0)},r=Q(()=>He.parse(n.state.obj.content)),d=Q(()=>n.state.height+"px");return{status,Markdown:r,HeightEx:d,md_viewer:o,get_position:l,set_position:c}}}),Es=["innerHTML"];function Cs(t,e,o,n,s,a){return v(),y("div",{class:"md_core_viewer note",innerHTML:t.Markdown,style:X({height:t.HeightEx}),ref:"md_viewer"},null,12,Es)}var zt=N($s,[["render",Cs],["__scopeId","data-v-42db1dd0"]]);const Ss=A({components:{MarkdownEditor:ks,MarkdownViewer:zt},props:{editor_toggle:{type:Boolean,default:!0}},setup(t,e){const o=E(),n=E(),s=O({isActive_preview:!0});j(()=>t.editor_toggle,(l,c)=>{console.log(`[watch](editor_toggle)-${l}`),i()}),ee(()=>{console.log("[mounted]"),document.addEventListener("keydown",a)}),Ie(()=>{document.removeEventListener("keydown",a)});const a=l=>{if(l.keyCode===83&&l.ctrlKey){l.preventDefault(),console.log("save"),i();return}else if(l.keyCode===69&&l.ctrlKey){l.preventDefault(),console.log("toggle"),i();return}},i=()=>{var r;const l=s.isActive_preview?{now:o,next:n}:{now:n,next:o},c=(r=l.now.value)==null?void 0:r.get_position();console.log(`isActive_preview=${s.isActive_preview}, scrollIndo=${JSON.stringify(c)}`),s.isActive_preview=!s.isActive_preview,setTimeout(()=>{var d;(d=l.next.value)==null||d.set_position(c)},500)};return{state:s,MdViewer:o,MdEditor:n}}});function Ms(t,e,o,n,s,a){const i=H("MarkdownViewer"),l=H("MarkdownEditor");return v(),y("div",null,[t.state.isActive_preview?(v(),re(i,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:t.state.isActive_preview},null,8,["isActive_preview"])):(v(),re(l,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:t.state.isActive_preview},null,8,["isActive_preview"]))])}var Ds=N(Ss,[["render",Ms]]);const Bs={class:"modal-mask"},Ls={class:"modal-wrapper"},Ts={class:"modal-container"},js={class:"header"},Os={class:"form"},As=["disabled"],Ns=["disabled"],Fs={class:"modal-actions"},Is=["disabled"],Rs=A({emits:["event_callback"],setup(t,{emit:e}){const{store_dlg:o}=Re(),{store_data:n}=te(),s=E(null),a=E(null),i=O({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});j(()=>o.state.objParam,u=>{l(u)});const l=u=>{const g=(b,k=!1)=>b!=null?b:k;console.log("[onChanged_objParam]"),i.title=u.title,i.title2=u.title2,i.edit=u.edit,i.edit_org=g(u.edit_org,u.edit),i.check=0,i.isShowDlg=!0,i.isNoEdit=g(u.isNoEdit),i.isFileOpen=g(u.isFileOpen),i.isReadOnly=g(u.isReadOnly),i.isCheck=g(u.isCheck),i.isMulti=g(u.isMulti),i.isDisabled=!0,i.action=u.action,p(!0),setTimeout(()=>{i.isMulti==!0?s.value.focus():a.value.focus()},500)},c=u=>{if(console.log(`[doAction] flg=${u}, edit=${i.edit}`),u){const g=i.action(i);n.do_cmd(g[0],g[1],g[2])}i.isShowDlg=!1,p(!1)},r=u=>{const b=(u.target.files||u.dataTransfer.files)[0],k=i.action(i);n.do_cmd(k[0],b),i.isShowDlg=!1,p(!1)},d=()=>{const u=i.edit_org,g=i.edit==u&&!i.isReadOnly;return console.log(`[isDisabled]=${g}`),g},p=u=>{u==!0?document.addEventListener("keydown",h):document.removeEventListener("keydown",h)},h=u=>{const g=u.key;switch(console.log(`key = ${g}`),g){case"Enter":u.preventDefault(),c(!0);break;case"Escape":u.preventDefault(),c(!1);break}};return(u,g)=>{const b=H("fa");return ie((v(),re(Vn,{persistent:""},{default:Fe(()=>[w("div",Bs,[w("div",Ls,[w("div",Ts,[w("div",js,z(f(i).title)+"?",1),w("form",Os,[f(i).isFileOpen==!0?(v(),y("input",{key:0,class:"input",type:"file",onChange:r},null,32)):F("",!0),f(i).isNoEdit==!1?(v(),y(J,{key:1},[f(i).isMulti==!0?ie((v(),y("textarea",{key:0,class:"input",autofocus:"","onUpdate:modelValue":g[0]||(g[0]=k=>f(i).edit=k),disabled:f(i).isReadOnly,ref_key:"edit",ref:s},null,8,As)),[[We,f(i).edit]]):ie((v(),y("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":g[1]||(g[1]=k=>f(i).edit=k),disabled:f(i).isReadOnly,ref_key:"edit2",ref:a},null,8,Ns)),[[We,f(i).edit]])],64)):F("",!0),f(i).isCheck==!0?(v(),y(J,{key:2},[ie(w("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":g[2]||(g[2]=k=>f(i).check=k)},null,512),[[jt,f(i).check]]),_e(" "+z(f(i).title2),1)],64)):F("",!0)]),w("div",Fs,[w("button",{class:"btn btn-ok",ref:"ok",disabled:d(),onKeydown:g[3]||(g[3]=Pn(k=>c(!0),["enter"])),onClick:g[4]||(g[4]=k=>c(!0))},[D(b,{icon:"check"}),_e(" "+z(f(i).title),1)],40,Is),w("button",{class:"btn btn-can",onClick:g[5]||(g[5]=k=>c(!1))},"cancel")])])])])]),_:1},512)),[[Tt,f(i).isShowDlg]])}}});var Ht=N(Rs,[["__scopeId","data-v-f7cb456a"]]);const Ps={class:"container"},Vs={class:"main"},zs=A({emits:["event_callback"],setup(t,{emit:e}){const{store_data:o}=te(),{store_dlg:n}=Re();Qe();const s=Ne(),a=O({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});ee(()=>{console.log("[mounted]"),i(),window.addEventListener("resize",l),document.body.style.overflow="hidden"}),Ie(()=>{console.log("unmounted!"),window.removeEventListener("resize",l)});const i=()=>{const d=u=>{o.do_cmd("restore_file","")};console.log("init");const h=s.fullPath.split("api_bookmark?=");if(console.log(h),h.length==2){o.do_cmd("bookmark",decodeURIComponent(h.pop()));return}s.path.substring(1),o.do_cmd("filter_menu",null),d(),l()},l=()=>{const d=window.innerHeight-40;console.log(`height=${d}`),a.height=d,o.update_height(d)},c=async(d,p)=>{switch(console.log(`[event_callback] cmd=${d}, va0=${p}`),d){case"toggle_editor":a.editor_toggle=!a.editor_toggle;break;case"config":a.objDlgConf={cmd:d,filename:"",commit:""};break;case"filelist":document.querySelector(".col-3");const h=!a.toggle_list;a.toggle_list=h,console.log(a.toggle_list);break;default:if(d.indexOf("dlg_")!=-1){const u=Object.assign({},r(d,p));n.update_param(u)}else o.do_cmd(d,p);break}},r=(d,p)=>{const h=Rt[d],u=p!=null?p:o.state.filename;return h.init(h,u),h};return(d,p)=>(v(),y("div",Ps,[D(Pt,{ref:"appbar",onEvent_callback:c},null,512),D(Ht,{objParam:f(a).objDlgCmn,onEvent_callback:c},null,8,["objParam"]),w("div",Vs,[f(a).toggle_list?(v(),re(Vt,{key:0,class:"col-3",onEvent_callback:c,style:X({height:f(a).height+"px"})},null,8,["style"])):F("",!0),D(Ds,{class:"col-2",ref:"pane",editor_toggle:f(a).editor_toggle,style:X({height:f(a).height+"px"})},null,8,["editor_toggle","style"]),D(us,{class:"col-1",onEvent_callback:c,style:X({height:f(a).height+"px"})},null,8,["style"])])]))}});var Hs=N(zs,[["__scopeId","data-v-44b61a1c"]]);const Ks={_class:"container"},Gs=A({emits:["event_callback"],setup(t,{emit:e}){te();const o=Ne(),n=O({filename:"",height:window.innerHeight,timer3:-1});ee(()=>{console.log("[mounted]"),s(),document.body.style.overflow="hidden"});const s=()=>{console.log("init");const a=o.path.substring(1);o.fullPath,console.log(`filename=${a}`),n.filename=a,n.timer3=window.setTimeout(()=>{clearTimeout(n.timer3),window.print()},500)};return(a,i)=>(v(),y("div",Ks,[_e(z(f(n).filename)+" ",1),D(zt,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}}),L=zn(),Us="_container_rovsp_1",Ys="_svg_rovsp_18",Js="_trigger_rovsp_44",Ws="_dragging_rovsp_47",qs="_hidden_rovsp_53",Xs="_text_rovsp_73",Zs="_selected_rovsp_79",Qs="_content_rovsp_79",ea="_root_rovsp_82",ta="_edited_rovsp_86",na="_outline_rovsp_89",oa="_collapse_rovsp_99",sa="_disabled_rovsp_145",aa="_gps_rovsp_156",ia="_fit_rovsp_159",la="_download_rovsp_162",ca="_prev_rovsp_165",ra="_next_rovsp_168",da="_close_rovsp_171";var x={container:Us,"svg-wrapper":"_svg-wrapper_rovsp_1","asst-svg":"_asst-svg_rovsp_12",svg:Ys,trigger:Js,dragging:Ws,"add-btn":"_add-btn_rovsp_47",hidden:qs,"expand-btn":"_expand-btn_rovsp_64",text:Xs,selected:Zs,content:Qs,root:ea,edited:ta,outline:na,collapse:oa,"button-list":"_button-list_rovsp_103","right-bottom":"_right-bottom_rovsp_106","right-top":"_right-top_rovsp_110",disabled:sa,gps:aa,fit:ia,download:la,prev:ca,next:ra,close:da};const ce=E(),G=E(),me=E(),Ge=E(),ae=E(),W=E();function ua(){const t=this.querySelector(`g.${x["add-btn"]}`);t&&(t.style.opacity="1");const e=this.querySelector(`g.${x["expand-btn"]}`);e&&(e.style.opacity="1")}function pa(){const t=this.querySelector(`g.${x["add-btn"]}`);t&&(t.style.opacity="0");const e=this.querySelector(`g.${x["expand-btn"]}`);e&&(e.style.opacity="0")}const ha=t=>{const{g:e}=K;!e||(Oe.value=t.transform,e.attr("transform",t.transform.toString()))};function Kt(t,e){console.log("[onSelect]"),t.stopPropagation(),V(e)}function tt(t,e){var l,c;console.log("[onEdit]");const{foreign:o}=K;if(!rn||!o||!W.value)return;const n=(l=this.parentNode)==null?void 0:l.parentNode;n.classList.add(x.edited),L.emit("edit-flag",!1),console.log(`name/id=${e.name}/${e.id}`),o.attr("x",e.x-2-(e.left?e.width:0)).attr("y",e.y-B.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const s=W.value;s.textContent=e.name,s.focus(),(c=getSelection())==null||c.selectAllChildren(s);const a=n.querySelector(`:scope > .${x.content}`);a&&Pe(a);const i=r=>{const d=r.key;switch(console.log(`[onEdit] keydown=${d}`),d){case"Enter":if(r.shiftKey)return;r.stopPropagation(),qe(new FocusEvent("")),setTimeout(()=>{V(e),G.value.focus()},250);break;case"Escape":r.stopPropagation(),qe(new FocusEvent(""),!0),G.value.focus();break}};s.addEventListener("keydown",i)}const qe=(t,e=!1)=>{var a;if(console.log("[onEditBlur]"),(a=document.getElementsByClassName(x.edited)[0])==null||a.classList.remove(x.edited),ae.value==null||W.value==null){console.log("skip not active foreign");return}if(ae.value.style.display=="none"){console.log("skip display=none");return}ae.value.style.display="none";const o=ae.value.getAttribute("data-id"),n=ae.value.getAttribute("data-name"),s=W.value.textContent;e||o&&s!==null&&s!==n&&Sn(o,s)},dt=t=>{if(t.preventDefault(),!ce.value)return;console.log("onContextmenu");const e=Na(ce.value,t);Xt.value=e;const o=t.composedPath(),n=o.find(i=>{var l;return(l=i.classList)==null?void 0:l.contains("node")}),s=o.find(i=>i.tagName=="foreignObject");let a=n?1:s?2:0;if(console.log(a),a==1){const{classList:i}=n,l=i.contains(x.root),c=i.contains(x.collapse);i.contains(x.selected)||V(n),en.value.disabled=l,sn.value.disabled=l,an.value.disabled=l,nn.value.disabled=l,on.value.disabled=l,tn.value.disabled=l,Qt.value.disabled=!c,Zt.value.disabled=c||i.contains("leaf")}qt.value=a,L.emit("showContextmenu",!0)},I=(t,e)=>{var o,n,s;if(console.log(`[onClickMenu] name=${t}`),t.indexOf("icon_")!=-1){const a=R(),i=(o=B.find(a.id))==null?void 0:o.rawData;i&&(console.log(i),Sn(a.id,`${t.slice(5)}${i.name}`));return}switch(t){case"zoomfit":De();break;case"zoomin":mt(!1);break;case"zoomout":mt(!0);break;case"add":Gt(new MouseEvent("click"),R());break;case"delete":{const a=R(),i=a.parent;Ct(a.id),V(i)}break;case"delete-one":{const a=R(),i=a.parent;wi(a.id),V(i)}break;case"collapse":{const a=R();xi(a.id),V(a)}break;case"expand":{const a=R();Dn(a.id),V(a)}break;case"add-sibling":{const a=R(),i=St(a.id,"");i&&(V(i),ye(i))}break;case"add-sibling-before":{const a=R(),i=St(a.id,"",!0);i&&(ye(i),V(i))}break;case"add-parent":{const a=R(),i=ki(a.id,"");i&&(ye(i),V(i))}break;case"cut":{const{id:a}=R(),i=(n=B.find(a))==null?void 0:n.rawData;i&&navigator.clipboard.writeText(JSON.stringify(i)),Ct(a)}break;case"copy":{const a=R(),i=(s=B.find(a.id))==null?void 0:s.rawData;i&&navigator.clipboard.writeText(JSON.stringify(i))}break;case"paste":{const a=R();navigator.clipboard.readText().then(i=>{const l=Pa(i)||{name:i},c=Mn(a.id,l);V(c)})}break;case"edit":ye(R());break;case"undo":st();break;case"redo":ot();break;case"move_focus_x":ma(e==null?void 0:e.direct);break;case"move_focus_y":ga(e==null?void 0:e.direct);break}},ma=t=>{let e=null;const o=R();if(console.log(`seleData.left=${o.left}`),!!(o.left&&t==!1||o.left==!1&&t))if(console.log("to child"),o.children.length!=0)e=o.children[0];else return;else if(console.log("to parent"),o.parent!=null)e=o.parent;else return;const s=V(e);Pe(s),console.log("@")},ga=t=>{let e=null;const o=R();if(o==null||o.parent==null)return;let n=+o.id.split("-").pop(),s=o.parent.children.length,a=n+(t?1:-1);if(0<=a&&a<s){e=o.parent.children[a];const i=V(e);Pe(i)}},Gt=(t,e)=>{const o=Mn(e.id,"");o&&(ye(o,t),V(e))};function ye(t,e=new MouseEvent("click")){const{g:o}=K;if(!o)return;const s=o.selectAll(`g[data-id='${Ve(t)}'] > g.${x.content} > g.${x.text}`).node();s&&(L.emit("edit-flag",!0),tt.call(s,e,t))}const Ut=(t,e)=>{Dn(e.id)};function fa(t,e){var c;const o=(c=this.parentNode)==null?void 0:c.parentNode;G.value&&G.value.classList.add(x.dragging);const{g:n}=K;if(!n)return;_n(o,e,[t.x-e.x,t.y-e.y]);const s=Hn(t,me.value);s[1]+=B.data.y;const a=n.selectAll("g.node").filter(r=>{if(r!==e&&r!==e.parent&&!r.id.startsWith(e.id)){let d=q,p=r.width+q;r.left&&r.depth!==0&&([d,p]=[p,d]);const h={x0:r.x-d,x1:r.x+p,y0:r.y-q,y1:r.y+r.height+q};return s[0]>h.x0&&s[1]>h.y0&&s[0]<h.x1&&s[1]<h.y1}return!1}),i=Array.from(document.getElementsByClassName(x.outline)),l=a.node();i.forEach(r=>{r!==l&&r.classList.remove(x.outline)}),l==null||l.classList.add(x.outline)}function _a(t,e){var h;const o=(h=this.parentNode)==null?void 0:h.parentNode;G.value&&G.value.classList.remove(x.dragging);const n=document.getElementsByClassName(x.outline)[0];if(n){n.classList.remove(x.outline);const u=n.getAttribute("data-id");if(u)e.px=0,e.py=0,yi(u,e.id);else throw new Error("outline data-id null");return}const s=e.x-B.getRootWidth()/2;console.log(`d.x/getRootWidth=${e.x}/${B.getRootWidth()}`);const a=e.depth===1&&s*(s+e.px)<0,i=a?u=>u.left!==e.left:u=>u.left===e.left;console.log(`xToCenter/lr=${s}/${a}`);const l=o.parentNode;let c=a?{y:1/0,id:e.id}:e,r=a?{y:-1/0,id:e.id}:e;const d=le(l).selectAll(`g.${at(e).join(".")}`).filter(u=>u!==e&&i(u)),p=e.y+e.py;d.each(u=>{(a||u.y>e.y)&&u.y<p&&u.y>r.y&&(r=u),(a||u.y<e.y)&&u.y>p&&u.y<c.y&&(c=u)}),a?(e.px=0,e.py=0,$i(e.id)):c.id!==e.id?(e.px=0,e.py=0,Et(e.id,c.id)):r.id!==e.id?(e.px=0,e.py=0,Et(e.id,r.id,1)):_n(o,e,[0,0],500)}const ut=t=>{const{svg:e}=K;!e||(t?(Se(e),e.on("dblclick.zoom",null)):e.on(".zoom",null))},va=t=>{const{g:e}=K;if(!W.value||!e)return;const o=e.selectAll(`g.${x.text}`);t?o.on("click",tt):o.on("click",null)},ba=t=>{const{g:e}=K;if(!e)return;const o=e.selectAll(`g.${x.text}`);t?o.on("mousedown",Kt):o.on("mousedown",null)},pt=t=>{!ce.value||(t?(console.log("@switchContextmenu"),ce.value.addEventListener("contextmenu",dt)):ce.value.removeEventListener("contextmenu",dt))},ya=t=>{const{g:e}=K;if(!e)return;const o=e.selectAll(`g.node:not(.${x.root}) > g > g.${x.text}`);t?un(o):o.on(".drag",null)};let Yt,nt,Jt,Wt;L.on("selection-svg",t=>Yt=t);L.on("selection-g",t=>nt=t);L.on("selection-asstSvg",t=>Jt=t);L.on("selection-foreign",t=>Wt=t);const qt=E(0),Xt=E({left:0,top:0}),Zt=E({name:"collapse",disabled:!0}),Qt=E({name:"expand",disabled:!0}),en=E({name:"delete",disabled:!1}),wa=E({name:"add",disabled:!1}),tn=E({name:"add-parent",disabled:!1}),nn=E({name:"add-sibling",disabled:!1}),on=E({name:"add-sibling-before",disabled:!0}),sn=E({name:"cut",disabled:!1}),xa=E({name:"copy",disabled:!1}),ka=E({name:"paste",disabled:!1}),an=E({name:"delete-one",disabled:!1}),$a=Q(()=>[[wa.value,tn.value,nn.value,on.value],[sn.value,xa.value,ka.value],[en.value,an.value],[{name:"selectall",disabled:!0}],[Zt.value,Qt.value]].filter((t,e)=>e===0||e===1?ue.value.edit:!0)),Ea=Q(()=>[[{name:"zoomin",disabled:Oe.value.k>=ve[1]},{name:"zoomout",disabled:Oe.value.k<=ve[0]},{name:"zoomfit",disabled:!1}],[{name:"selectall",disabled:!0}]]),Ca=Q(()=>[[{name:"\u2705"},{name:"\u274E"},{name:"\u{1F195}"},{name:"\u{1F196}"},{name:"\u{1F197}"}],[{name:"\u{1F4D1}"},{name:"\u{1F4C3}"},{name:"\u{1F4DD}"},{name:"\u2B50"},{name:"\u{1F514}"},{name:"\u{1F6A7}"}],[{name:"\u{1F642}"},{name:"\u{1F610}"},{name:"\u{1F616}"},{name:"\u{1F635}"},{name:"\u{1F62B}"},{name:"\u{1F631}"}],[{name:"\u26D4"},{name:"\u{1F6AB}"},{name:"\u{1F516}"},{name:"\u{1F380}"},{name:"\u{1F388}"}],[{name:"\u{1F648}"},{name:"\u{1F649}"},{name:"\u{1F64A}"},{name:"\u{1F44D}"},{name:"\u{1F449}"},{name:"\u{1F448}"}],[{name:"\u{1F340}"},{name:"\u{1F463}"},{name:"\u{1F5EF}"},{name:"\u{1F4A5}"},{name:"\u{1F4A6}"}],[{name:"\u23F0"}]]),Sa=Q(()=>{let t;switch(qt.value){case 0:t=Ea.value;break;case 1:t=$a.value;break;case 2:t=Ca.value;break}return t}),ln=Kn().source(t=>t.source).target(t=>t.target),Ma=Gn().curve(Un),Da=({source:t,target:e})=>Ma([t,e]);let Le=!1,cn=ln;const Te=E(!1);L.on("sharp_corner",t=>{Le!==t&&(Te.value=!0),Le=!!t,cn=t?Da:ln});let je=4;L.on("branch",t=>je=t||je);let ve=[.1,8];L.on("scale-extent",t=>ve=t||ve);let rn=!1;L.on("edit-flag",t=>rn=!!t);const Ba=6,he=10;let ge=16,xe=64,q=Math.min(ge/2-1,he);L.on("gap",t=>{!t||(xe=t.xGap,ge=t.yGap,q=Math.min(ge/2-1,he),q=Math.min(xe/2-1,q))});const La=new ResizeObserver(t=>{const{foreign:e}=K;if(!e)return;const o=t[0],n=o.target,{width:s,height:a}=o.contentRect,i=parseInt(getComputedStyle(n).paddingLeft||"0",10),l=parseInt(getComputedStyle(n.parentNode).borderTopWidth||"0",10),c=(i+l)*2;e.attr("width",s+c).attr("height",a+c),e.style("display")!=="none"&&Pe(n),console.log("observer")}),be={side:12,padding:2,margin:8},dn=be.side+be.padding*2,pe={width:16,height:4,radius:2},Oe=E(Ot),Se=Yn().on("zoom",ha).scaleExtent(ve),un=Jn().container(Fa).on("drag",fa).on("end",_a),Ee=E(!1);let pn;L.on("mindmap-context",t=>t?pn=t:null);const ue=E({drag:!1,edit:!1});class Ta{constructor(e=20){this.length=e,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(e){const o=we.exports.cloneDeep(e);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(o),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,we.exports.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,we.exports.cloneDeep(this.snapshots[this.cursor])):null}}const Ce=new Ta,hn=E(!1),mn=E(!1),ja=()=>{hn.value=Ce.hasPrev,mn.value=Ce.hasNext},Oa=(t,e)=>{const o=-e/2,n=-t/2,s=t/2,a=e/2;return`M${a},${s}H${s}V${a}H${n}V${s}H${o}V${n}H${n}V${o}H${s}V${n}H${a}V${s}Z`},gn=t=>{const e=t.split(`
`);return e.length>1&&e[e.length-1]===""&&e.pop(),e},Aa=(t,e)=>{qn(t).then(o=>{const n=o.toDataURL(),s=open();s&&(s.document.write(`<img src='${n}'>`),s.document.title=e,s.document.close())})},fn=(t,e)=>Wn().duration(t).ease(e),Na=(t,e)=>{const{pageX:o,pageY:n}=e,s=t.getBoundingClientRect(),a=s.left+window.pageXOffset,i=s.top+window.pageYOffset;return{left:o-a,top:n-i}};function Fa(){var t,e;return(e=(t=this.parentNode)==null?void 0:t.parentNode)==null?void 0:e.parentNode}function V(t){const e=t instanceof SVGGElement?t:document.querySelector(`g[data-id='${Ve(t)}']`),o=document.getElementsByClassName(x.selected)[0];if(e)o?o!==e?(o.classList.remove(x.selected),e.classList.add(x.selected),console.log("remove & add selected")):(console.log("edit-flag - same"),L.emit("edit-flag",!0)):(console.log("add selected"),e.classList.add(x.selected));else throw new Error("selectGNode failed");return e}function R(){console.log("getSelectedGData");const e=le(`.${x.selected}`).data();if(e.length==0)return null;const o=e[0];return console.log(`id/name=${o.id}/${o.name}`),o}const ht=t=>{const{asstSvg:e}=K;if(!e)throw new Error("asstSvg undefined");const o=gn(t),n=e.append("text");n.selectAll("tspan").data(o).enter().append("tspan").text(a=>a).attr("x",0);const s=n.node().getBBox();return n.remove(),{width:Math.max(s.width,22),height:Math.max(s.height,22)*o.length}},_n=(t,e,o,n=0)=>{const s=fn(n,At);e.px=o[0],e.py=o[1],le(t).transition(s).attr("transform",bn),le(`g[data-id='${Ve(e)}'] > path`).transition(s).attr("d",a=>Ae(a))},Ue=()=>{const{svg:t}=K;if(!t)return;const e=B.data;Se.translateTo(t,0+e.width/2,0+e.height/2)},De=()=>{const{svg:t}=K;if(!t||!me.value||!G.value)return;const e=me.value.getBBox(),o=G.value.getBoundingClientRect(),n=Math.min(o.width/e.width,o.height/e.height),s={x:o.width/2,y:o.height/2},a={x:e.width*n/2,y:e.height*n/2},i=Ot.translate(-e.x*n+s.x-a.x,-e.y*n+s.y-a.y).scale(n);Se.transform(t,i)},Pe=t=>{const{svg:e}=K;if(e&&G.value){const{k:o}=Oe.value,n=t.getBoundingClientRect(),{x:s,y:a,width:i,height:l}=G.value.getBoundingClientRect(),c=n.x-s,r=c+n.width,d=n.y-a,p=d+n.height,h=2;let u=0,g=0;c<0&&(u=-c/o+h),(n.width>i||r>i)&&(u=-(r-i)/o-h),d<0&&(g=-d/o+h),(n.height>l||p>l)&&(g=-(p-l)/o-h),Se.translateBy(e,u,g)}},mt=t=>{const{svg:e}=K;!e||Se.scaleBy(e,t?1.1:.9)},Ia=()=>{!ce.value||Aa(ce.value,B.data.name)},ot=()=>{const t=Ce.next();t&&(B.data=t,U(!1))},st=()=>{const t=Ce.prev();t&&(B.data=t,U(!1))},Ra=()=>{console.log("bindForeignDiv:pre"),W.value&&(console.log("bindForeignDiv:enter"),La.observe(W.value),W.value.addEventListener("blur",qe),W.value.addEventListener("mousedown",t=>{t.stopPropagation(),console.log("foreignDivEle@mousedown")}),W.value.addEventListener("keydown",t=>{t.stopPropagation();const e=t.key;console.log(`foreignDivEle@keydown=${e}`)}),G.value.addEventListener("keydown",t=>{const e=t.key;switch(console.log(`svgEle@keydown=${e}`),e){case"ArrowRight":I("move_focus_x",{direct:!0});break;case"ArrowLeft":I("move_focus_x",{direct:!1});break;case"ArrowDown":I("move_focus_y",{direct:!0});break;case"ArrowUp":I("move_focus_y",{direct:!1});break;case"Insert":case"i":t.preventDefault(),I(t.ctrlKey?"add-sibling":"add");break;case"b":t.preventDefault(),I("add-sibling");break;case"Delete":case"d":I(t.ctrlKey?"delete":"delete-one");break;case"Enter":t.preventDefault(),I("edit");break;case"@":I("zoomfit");{const o=R();V(o)}break;case"[":I("zoomout");break;case"]":I("zoomin");break;case"c":I("copy");break;case"v":I("paste");break;case"z":st();break;case"y":ot();break;case"o":I("collapse");break;case"e":I("expand");break}}))},Pa=t=>{let e;try{return e=JSON.parse(t),"name"in e?e:!1}catch{return!1}},vn=()=>3,at=t=>{const e=["node"];return t&&e.push(`depth-${t.depth}`),e},Va=t=>{const e=at(t);return t&&(t.depth===0&&e.push(x.root),t.collapse?e.push(x.collapse):(!t.children||t.children.length===0)&&e.push("leaf")),e},za=t=>[x["add-btn"]],bn=t=>`translate(${t.dx+t.px},${t.dy+t.py})`,Ve=t=>t.id,yn=t=>{const e=gn(t.name),o=t.height/e.length;return e.map(n=>({name:n,height:o}))},Ae=t=>{let e=0,o=0;const n=Math.max(q-3,0);let s=t.width+n;const a=vn();let i=a;const{parent:l}=t;l&&(e=l.width,o=l.height,l.depth===0&&(Le||(e/=2),o/=2,i=0)),t.left&&(l&&(l.depth!==0?e=-e:Le&&(e=0)),s=-s);const c=[-t.dx+e-t.px,-t.dy+o+i-t.py],r=[0,t.height+a];return`${cn({source:c,target:r})}L${s},${r[1]}`},Ha=(t,e)=>{const o=t.height/2;let n=t.width+e+dn/2+be.margin;return t.left&&(n=-n),`translate(${n},${o})`},Ka=(t,e)=>{const n=t.height+vn();let s=t.width+e+4;return t.left&&(s=-s),`translate(${s},${n})`},wn=(t,e,o,n,s)=>{t?(vt(e,he),gt(o,he,Ba),n&&ft(n,he),s&&_t(s,he)):(vt(e,q),gt(o,q),n&&ft(n,q),s&&_t(s,q))},xn=(t,e)=>{const o=t.attr("class",s=>Va(s).join(" ")).attr("data-id",Ve);(e?o.transition(e):o).attr("transform",bn)},kn=(t,e)=>{(e?t.transition(e):t).attr("transform",n=>`translate(${n.left?-n.width:0},0)`)},it=t=>{t.attr("alignment-baseline","text-before-edge").text(e=>e.name||" ").attr("x",0).attr("dy",(e,o)=>o?e.height:0)},Ga=t=>{const{side:e,padding:o}=be,n=4,s=-o-e/2,a=e+o*2;t.attr("x",s).attr("y",s).attr("rx",n).attr("ry",n).attr("width",a).attr("height",a)},Ua=t=>{t.attr("x",-pe.width/2).attr("y",-pe.height/2).attr("width",pe.width).attr("height",pe.height).attr("rx",pe.radius).attr("ry",pe.radius).attr("stroke",e=>e.color||"grey").attr("fill",e=>e.color||"grey")},Ye=(t,e)=>{t.attr("cx",e).attr("cy",0).attr("r",1)},gt=(t,e,o=4)=>{t.attr("x",n=>-e-(n.left?n.width:0)).attr("y",-e).attr("rx",o).attr("ry",o).attr("width",n=>n.width+e*2).attr("height",n=>n.height+e*2)},ft=(t,e)=>{t.attr("class",x["expand-btn"]).attr("transform",o=>Ka(o,e)).style("color",o=>o.color)},_t=(t,e)=>{t.attr("class",o=>za().join(" ")).attr("transform",o=>Ha(o,e))},vt=(t,e)=>{const o=dn+be.margin,n=e*2;t.attr("class",x.trigger).attr("x",s=>-e-(s.left?s.width+o:0)).attr("y",-e).attr("width",s=>s.width+n+o).attr("height",s=>s.height+n)},$n=(t,e)=>{const o=t.attr("stroke",n=>n.color).attr("stroke-width",je);if(e){const n=o.transition(e);Te.value?n.attrTween("d",Ya):n.attr("d",Ae)}else o.attr("d",Ae)};function Ya(t,e,o){const s=Ae(t),a=o[e],i=a.cloneNode(),l=a.getTotalLength();i.setAttribute("d",s);const c=i.getTotalLength(),r=[0],d=10/Math.max(l,c);let p=0;for(;(p+=d)<1;)r.push(p);r.push(1);const h=r.map(u=>{const g=a.getPointAtLength(u*l),b=i.getPointAtLength(u*c);return Xn([g.x,g.y],[b.x,b.y])});return u=>u<1?"M"+h.map(g=>g(u)).join("L"):s}const Ja=t=>{const e=t.append("tspan");return it(e),e},Wa=t=>(it(t),t),qa=t=>{const e=t.append("g");return Ga(e.append("rect")),e.append("path").attr("d",Oa(2,be.side)),e},Xa=t=>{const e=t.append("g");return Ua(e.append("rect")),Ye(e.append("circle"),-4),Ye(e.append("circle"),0),Ye(e.append("circle"),4),e},En=t=>{const e=qa(t);return e.on("click",Gt),e},Za=t=>{const e=Xa(t);return e.on("click",Ut),e},Qa=(t,e)=>{if(t.select(`:scope > g.${x.content} > g.${x["expand-btn"]}`).on("click",Ut),ue.value.drag||ue.value.edit){const n=t.select(`:scope > g.${x.content} > g.${x.text}`);n.on("mousedown",Kt),ue.value.drag&&!e&&un(n),ue.value.edit&&n.on("click",tt)}Ee.value&&t.select(`:scope > g.${x.content}`).on("mouseenter",ua).on("mouseleave",pa)},ei=t=>{var p;console.log("appendNode");const e=!((p=t.data()[0])!=null&&p.depth),o=t.append("g");xn(o),$n(o.append("path"));const n=o.append("g").attr("class",x.content),s=n.append("rect"),a=n.append("g").attr("class",x.text),i=a.append("rect"),l=a.append("text");kn(l);const c=l.selectAll("tspan").data(yn).enter().append("tspan");it(c);const r=Ee.value?En(n):void 0;let d;return t.data().length!=0&&(d=Za(n)),wn(e,s,i,d,r),Qa(o,e),o.each((h,u)=>{!h.children||fe(h.children,o.filter((g,b)=>u===b))}),n.raise(),o},ti=t=>{var d;const e=!((d=t.data()[0])!=null&&d.depth),o=fn(500,At);xn(t,o),$n(t.select(":scope > path"),o);const n=t.select(`:scope > g.${x.content}`),s=n.select(":scope > rect"),a=n.select(`g.${x.text}`),i=a.select("rect"),l=a.select("text");kn(l,o),l.selectAll("tspan").data(yn).join(Ja,Wa,p=>p.remove());let c=n.select(`g.${x["add-btn"]}`),r=t.data().length!=0?n.select(`g.${x["expand-btn"]}`):void 0;return Ee.value?c.node()||(c=En(n)):c.remove(),wn(e,s,i,r,c),t.each((p,h)=>{!p.children||fe(p.children,t.filter((u,g)=>h===g))}),n.raise(),t},fe=(t=[B.data],e=nt)=>{e.selectAll(`g.${at(t[0]).join(".")}`).data(t,n=>n.gKey).join(ei,ti)};class ni{constructor(e,o,n,s){this.w=e,this.h=o,this.y=n,this.c=s,this.cs=s.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function bt(t){t.cs===0?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function ke(t){return t.y+t.h}class oi{constructor(e,o,n){this.lowY=e,this.index=o,this.next=n}}function yt(t,e,o){for(;o!==null&&t>=o.lowY;)o=o.next;return new oi(t,e,o)}function si(t,e,o,n){if(o!==e-1){const s=e-o;t.c[o+1].shift+=n/s,t.c[e].shift-=n/s,t.c[e].change-=n-n/s}}function ai(t,e,o,n){t.c[e].mod+=n,t.c[e].msel+=n,t.c[e].mser+=n,si(t,e,o,n)}function ii(t){return t.cs===0?t.tl:t.c[0]}function li(t){return t.cs===0?t.tr:t.c[t.cs-1]}function ci(t,e,o,n){const s=t.c[0].el;s.tl=o;const a=n-o.mod-t.c[0].msel;s.mod+=a,s.prelim-=a,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}function ri(t,e,o,n){const s=t.c[e].er;s.tr=o;const a=n-o.mod-t.c[e].mser;s.mod+=a,s.prelim-=a,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}function di(t,e,o){let n=t.c[e-1],s=n.mod,a=t.c[e],i=a.mod;for(;n!==null&&a!==null;){ke(n)>o.lowY&&(o=o.next);const l=s+n.prelim+n.w-(i+a.prelim);l>0&&(i+=l,ai(t,e,o.index,l));const c=ke(n),r=ke(a);c<=r&&(n=li(n),n!==null&&(s+=n.mod)),c>=r&&(a=ii(a),a!==null&&(i+=a.mod))}n===null&&a!==null?ci(t,e,a,i):n!==null&&a===null&&ri(t,e,n,s)}function ui(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}function Xe(t){if(t.cs===0){bt(t);return}Xe(t.c[0]);let e=yt(ke(t.c[0].el),0,null);for(let o=1;o<t.cs;o++){Xe(t.c[o]);const n=ke(t.c[o].er);di(t,o,e),e=yt(n,o,e)}ui(t),bt(t)}function pi(t){let e=0,o=0;for(let n=0;n<t.cs;n++)e+=t.c[n].shift,o+=e+t.c[n].change,t.c[n].mod+=o}function Cn(t,e){e+=t.mod,t.x=t.prelim+e,pi(t);for(let o=0;o<t.cs;o++)Cn(t.c[o],e)}function hi(t){Xe(t),Cn(t,0)}class mi{constructor(e,o){this.gap=e,this.bottomPadding=o}addBoundingBox(e,o){return{width:e+this.gap,height:o+this.bottomPadding}}removeBoundingBox(e,o){return{x:e+this.gap/2,y:o}}}class gi{constructor(e){this.bb=e}layout(e){const o=this.convert(e);hi(o);const{boundingBox:n,result:s}=this.assignLayout(o,e);return{result:s,boundingBox:n}}convert(e,o=0){const{width:n,height:s}=this.bb.addBoundingBox(e.width,e.height),a=[];if(e.children&&e.children.length)for(let i=0;i<e.children.length;i++)a[i]=this.convert(e.children[i],o+s);return new ni(n,s,o,a)}assignCoordinates(e,o){const{x:n,y:s}=this.bb.removeBoundingBox(e.x,e.y);o.x=n,o.y=s;for(let a=0;a<e.c.length;a++)this.assignCoordinates(e.c[a],o.children[a])}getSize(e,o){const{x:n,y:s,width:a,height:i}=e;if(o||(o={left:n,right:n+a,top:s,bottom:s+i}),o.left=Math.min(o.left,n),o.right=Math.max(o.right,n+a),o.top=Math.min(o.top,s),o.bottom=Math.max(o.bottom,s+i),e.children)for(const l of e.children)this.getSize(l,o);return o}assignLayout(e,o,n){const{x:s,y:a}=this.bb.removeBoundingBox(e.x,e.y);o.x=s,o.y=a;const{width:i,height:l}=o;n||(n={left:s,right:s+i,top:a,bottom:a+l}),n.left=Math.min(n.left,s),n.right=Math.max(n.right,s+i),n.top=Math.min(n.top,a),n.bottom=Math.max(n.bottom,a+l);for(let c=0;c<e.c.length;c++)this.assignLayout(e.c[c],o.children[c],n);return{result:o,boundingBox:n}}}const wt=t=>[t.width,t.height]=[t.height,t.width],fi=t=>{t.parent?(t.dx=t.x-t.parent.x,t.dy=t.y-t.parent.y):(t.dx=0,t.dy=0)},de=(t,e)=>t.id=e,_i=t=>{t.parent?t.depth=t.parent.depth+1:t.depth=0},xt=t=>{t.parent&&t.parent.color&&(t.color=t.parent.color)},vi=t=>{t.depth>1&&t.parent&&(t.left=t.parent.left)},bi=t=>{const e=Object.assign({},t),o=Object.assign({},t);if(!t.collapse){const{children:n}=t;e.children=[],o.children=[],n.forEach(s=>{s.left?e.children.push(s):o.children.push(s),s.parent&&(s.parent=o)})}return{left:e,right:o}},Ze=(t,e,o="0")=>{var s;e.forEach(a=>{a(t,o)});const{children:n}=t;if(n)for(let a=0;a<n.length;){const i=n[a];i.id==="del"?(n.splice(a,1),(s=t.rawData.children)==null||s.splice(a,1)):(Ze(i,e,`${o}-${a}`),a+=1)}},kt=(t,e)=>{const o=new mi(e,t);return new gi(o)};class $t{constructor(e,o,n,s,a=Zn(Qn)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.update=!1,this.colorScale=a,this.getSize=s,this.layout=kt(o,n),this.data=this.createMdataFromData(e,"0"),this.renew(),this.update=!1}createMdataFromData(e,o,n=null){const{name:s,collapse:a,children:i}=e,{width:l,height:c}=this.getSize(s),r=n?n.depth+1:0;let d=!1,p=n?n.color:"";r===1?(d=!!e.left,p=this.colorScale(`${this.colorNumber+=1}`)):r!==0&&n&&(d=n.left);const h={id:o,name:s,rawData:e,parent:n,left:d,color:p,depth:r,x:0,y:0,dx:0,dy:0,px:0,py:0,width:l,height:c,children:[],_children:[],collapse:!!a,gKey:this.gKey+=1};return i&&(h.collapse?i.forEach((u,g)=>{h._children.push(this.createMdataFromData(u,`${o}-${g}`,h))}):i.forEach((u,g)=>{h.children.push(this.createMdataFromData(u,`${o}-${g}`,h))})),this.update=!1,h}renew(...e){Ze(this.data,[wt,_i,vi]),this.data=this.l(this.data);const o=[wt,this.renewXY.bind(this),fi];Ze(this.data,o.concat(e)),this.update=!0}l(e){const{left:o,right:n}=bi(e);return this.layout.layout(o),this.layout.layout(n),this.diffY=n.x-o.x,this.rootWidth=o.height,n.children=e.children,n}renewXY(e){[e.x,e.y]=[e.y,e.x],e.left&&(e.x=-e.x+this.rootWidth,e.y+=this.diffY)}isUpdate(){return this.update}getRootWidth(){return this.rootWidth}setBoundingBox(e,o){this.layout=kt(e,o),this.renew()}find(e){const o=e.split("-").map(s=>~~s);let n=this.data;for(let s=1;s<o.length;s++){const a=o[s],{children:i}=n;if(a<i.length)n=i[a];else return null}return n.id===e?n:null}rename(e,o){if(e.length>0){const n=this.find(e);if(n&&n.name!==o){n.name=o,n.rawData.name=o;const s=this.getSize(n.name);n.width=s.width,n.height=s.height,this.renew()}return n}else return null}moveChild(e,o){var i,l;if(e===o)return null;const n=this.find(e),s=this.find(o),a=o.split("-").pop();if(a&&n&&s){const c=s.parent;(i=c==null?void 0:c.children)==null||i.splice(~~a,1),(l=c==null?void 0:c.rawData.children)==null||l.splice(~~a,1),s.parent=n,s.gKey=this.gKey+=1,s.depth=s.parent.depth+1,s.depth===1?s.color=this.colorScale(`${this.colorNumber+=1}`):s.left=s.parent.left,n.collapse?n._children.push(s):n.children.push(s),n.rawData.children?n.rawData.children.push(s.rawData):n.rawData.children=[s.rawData],this.renew(de,xt)}return s}moveSibling(e,o,n=0){const s=e.split("-"),a=o.split("-");let i=s.pop(),l=a.pop();if(e===o||s.length!==a.length||!i||!l)return null;const c=this.find(e),r=this.find(o);if(r&&c&&c.parent){i=parseInt(i,10),l=parseInt(l,10),i<l&&(l-=1);const{children:d}=c.parent,{children:p}=c.parent.rawData;if(d&&p)return d.splice(i,1),d.splice(l+n,0,c),p.splice(i,1),p.splice(l+n,0,c.rawData),c.depth===1&&(c.left=r.left),this.renew(de),c}return null}add(e,o){const n=this.find(e);if(n)if(n.collapse&&this.expand(e),n.rawData.children||(n.rawData.children=[]),typeof o=="string"){const s=o,a=this.getSize(s),i={name:s},l=n.color?n.color:this.colorScale(`${this.colorNumber+=1}`),c={id:`${n.id}-${n.children.length}`,name:s,rawData:i,parent:n,left:n.left,collapse:!1,color:l,gKey:this.gKey+=1,width:a.width,height:a.height,depth:n.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return n.children.push(c),n.rawData.children.push(i),this.renew(),c}else{const s=o,a=this.createMdataFromData(s,`${n.id}-${n.children.length}`,n);return n.children.push(a),n.rawData.children.push(s),this.renew(),a}return null}expand(e){return this.eoc(e,!1,[xt,de])}collapse(e){return this.eoc(e,!0)}eoc(e,o,n=[]){const s=this.find(e);return s&&(s.collapse=o,s.rawData.collapse=o,[s._children,s.children]=[s.children,s._children],this.renew(...n)),s}delete(e){const o=this.find(e);if(o&&o.parent)o.id="del",this.renew(de);else throw new Error(o?"\u6682\u4E0D\u652F\u6301\u5220\u9664\u6839\u8282\u70B9":"\u672A\u627E\u5230\u9700\u8981\u5220\u9664\u7684\u8282\u70B9")}deleteOne(e){var n;const o=this.find(e);if(o&&o.parent){const{parent:s,children:a,_children:i,collapse:l,rawData:c}=o,r=parseInt(e.split("-").pop(),10);s.children.splice(r,1,...l?i:a),(n=s.rawData.children)==null||n.splice(r,1,...c.children||[]),a.forEach(d=>{d.parent=s,d.depth===1&&(d.rawData.left=d.left)}),this.renew(de)}}addSibling(e,o,n=!1){var a;console.log(`[addSibling] id=${e},name=${o}`);const s=this.find(e);if(s&&s.parent){const i=parseInt(e.split("-").pop(),10),{parent:l,left:c}=s,r={name:o,left:c},d=this.getSize(o),p=n?i:i+1,h=l.color?l.color:this.colorScale(`${this.colorNumber+=1}`),u={name:o,parent:l,children:[],_children:[],color:h,collapse:!1,rawData:r,id:`${l.id}-${p}`,left:c,gKey:this.gKey+=1,depth:s.depth,width:d.width,height:d.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return l.children.splice(p,0,u),(a=l.rawData.children)==null||a.splice(p,0,r),console.log(`index=${i},start=${p},sibling.id=${u.id}`),this.renew(de),u}return null}addParent(e,o){var s;const n=this.find(e);if(n&&n.parent){const{parent:a,left:i,color:l}=n,c=this.getSize(o),r=parseInt(n.id.split("-").pop(),10),d={name:o,children:[n.rawData],left:i};(s=a.rawData.children)==null||s.splice(r,1,d);const p={rawData:d,left:i,name:o,color:l,collapse:!1,parent:a,id:n.id,depth:n.depth,width:c.width,height:c.height,gKey:this.gKey+=1,children:[n],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return n.parent=p,a.children.splice(r,1,p),this.renew(de),p}return null}changeLeft(e){console.log("changeLeft");const o=this.find(e);return o&&(o.left=!o.left,o.rawData.left=o.left,this.renew()),o}}let B;L.on("mmdata",t=>t?B=t:null);const U=(t=!0)=>{console.log("afterOperation"),t&&Ce.snap(B.data),pn.emit("update:modelValue",eo([B.data.rawData])),ja(),fe()},Sn=(t,e,o=!1)=>{console.log(`rename: id/name=${t}/${e}`),B.rename(t,e),o||U()},yi=(t,e)=>{B.moveChild(t,e),U()},Et=(t,e,o=0)=>{B.moveSibling(t,e,o),U()},Mn=(t,e)=>{const o=B.add(t,e);return U(),o},Ct=t=>{B.delete(t),U()},wi=t=>{B.deleteOne(t),U()},Dn=t=>{B.expand(t),U()},xi=t=>{B.collapse(t),U()},St=(t,e,o=!1)=>{const n=B.addSibling(t,e,o);return U(),n},ki=(t,e)=>{const o=B.addParent(t,e);return U(),o},$i=t=>{B.changeLeft(t),U()};var Ei={translation:{contextmenu:{collapse:"\u6298\u53E0\u8282\u70B9",expand:"\u5C55\u5F00\u8282\u70B9",delete:"\u5220\u9664\u8282\u70B9","delete-one":"\u5220\u9664\u5355\u4E2A\u8282\u70B9",add:"\u65B0\u5EFA\u5B50\u8282\u70B9","add-parent":"\u65B0\u5EFA\u7236\u8282\u70B9","add-sibling":"\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9","add-sibling-before":"\u5728\u6B64\u4E4B\u524D\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9",cut:"\u526A\u5207",copy:"\u62F7\u8D1D",paste:"\u7C98\u8D34",selectall:"\u5168\u9009",zoomin:"\u653E\u5927",zoomout:"\u7F29\u5C0F",zoomfit:"\u7F29\u653E\u81F3\u5408\u9002\u5927\u5C0F"}}},Ci={translation:{contextmenu:{collapse:"collapse",expand:"expand",delete:"delete","delete-one":"delete a single node",add:"add child node","add-parent":"add parent node","add-sibling":"add sibling node","add-sibling-before":"add sibling node before",cut:"cut",copy:"copy",paste:"paste",selectall:"select all",zoomin:"zoom in",zoomout:"zoom out",zoomfit:"zoom fit"}}};et.init({fallbackLng:"zh",lng:"zh",resources:{zh:Ei,en:Ci}});const Si="_container_2lmy6_1",Mi="_menu_2lmy6_1",Di="_disabled_2lmy6_47";var Bi={container:Si,menu:Mi,disabled:Di};const Li=A({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(t,e){const o=E(!1),n=to(),s=E(),a=E(),i=O({top:0,left:0}),l=8;L.on("showContextmenu",async d=>{if(!s.value||!a.value)return;console.log("showContextmenu"),o.value=!!d,await no();const{offsetWidth:p,offsetHeight:h}=s.value,{offsetWidth:u,offsetHeight:g}=a.value,{top:b,left:k}=t.position;i.top=b+g>h?h-g-l:b,i.left=k+u>p?k-u:k});const c=()=>o.value=!1;return{style:n,show:o,close:c,onClick:d=>{c(),e.emit("click-item",d)},menuEle:a,containerEle:s,pos:i,i18n:et}}}),Ti=["id"],ji=["onClick"];function Oi(t,e,o,n,s,a){return ie((v(),y("div",{class:P(t.style.container),ref:"containerEle"},[w("div",{onMousedown:e[0]||(e[0]=(...i)=>t.close&&t.close(...i))},null,32),w("div",{ref:"menuEle",id:t.style.menu,style:X({top:t.pos.top+"px",left:t.pos.left+"px"})},[(v(!0),y(J,null,Z(t.groups,(i,l)=>(v(),y("tr",{key:l},[(v(!0),y(J,null,Z(i,c=>(v(),y("td",{key:c.name},[w("div",{class:P(c.disabled?t.style.disabled:""),onClick:r=>t.onClick(c.disabled==null?`icon_${c.name}`:c.name)},z(c.name),11,ji)]))),128))]))),128))],12,Ti)],2)),[[Tt,t.show]])}const Bn={};Bn.$style=Bi;var Ai=N(Li,[["render",Oi],["__cssModules",Bn]]);const Ni=A({name:"Mindmap",emits:["event_callback"],components:{Contextmenu:Ai},props:{update:Boolean,modelValue:{type:Array,required:!0},xGap:{type:Number,default:xe},yGap:{type:Number,default:ge},branch:{type:Number,default:je,validator:t=>t>=1&&t<=6},scaleExtent:{type:Object,default:ve},sharpCorner:Boolean,centerBtn:Boolean,fitBtn:Boolean,downloadBtn:Boolean,timetravel:Boolean,addNodeBtn:Boolean,edit:Boolean,drag:Boolean,keyboard:Boolean,ctm:Boolean,zoom:Boolean,locale:{type:String,default:"zh"}},setup(t,e){ne(()=>et.changeLanguage(t.locale)),ne(()=>L.emit("scale-extent",t.scaleExtent)),ne(()=>L.emit("branch",t.branch)),ne(()=>L.emit("sharp-corner",t.sharpCorner)),ne(()=>L.emit("gap",{xGap:t.xGap,yGap:t.yGap})),ne(()=>L.emit("mindmap-context",e)),ne(()=>Ee.value=t.edit&&t.addNodeBtn),ne(()=>ue.value.drag=t.drag),ne(()=>ue.value.edit=t.edit),ee(()=>{if(!G.value||!me.value||!Ge.value||!ae.value||!W.value)return;L.emit("selection-svg",le(G.value)),L.emit("selection-g",le(me.value)),L.emit("selection-asstSvg",le(Ge.value)),L.emit("selection-foreign",le(ae.value)),L.emit("mmdata",new $t(we.exports.cloneDeep(t.modelValue[0]),xe,ge,ht)),Te.value=!1,U();const{svg:n,foreign:s}=K;s==null||s.raise(),Ra(),Ue(),De(),n==null||n.on("mousedown",()=>{console.log("svg@mousedown");const a=document.getElementsByClassName(x.selected)[0];a==null||a.classList.remove(x.selected)}),n==null||n.on("blur",()=>{console.log("svg@blur"),B.isUpdate()&&o("blur","")}),ut(t.zoom),pt(t.ctm)}),j(()=>[t.update],n=>{console.log("props.update"),L.emit("mmdata",new $t(we.exports.cloneDeep(t.modelValue[0]),xe,ge,ht)),fe(),Ue(),De()}),j(()=>[t.branch,Ee.value,t.sharpCorner],()=>{fe(),Te.value=!1}),j(()=>[t.xGap,t.yGap],n=>{B.setBoundingBox(n[0],n[1]),fe()}),j(()=>[t.drag,t.edit],n=>{ba(n[0]||n[1]),ya(n[0]),va(n[1])}),j(()=>t.zoom,n=>ut(n)),j(()=>t.ctm,n=>pt(n));const o=(n,s)=>{console.log(`cmd=${n}, name=${s}`),e.emit("event_callback",n,s)};return{wrapperEle:ce,svgEle:G,gEle:me,style:x,asstSvgEle:Ge,foreignEle:ae,foreignDivEle:W,centerView:Ue,fitView:De,download:Ia,menu:Sa,contextmenuPos:Xt,onClickMenu:I,next:ot,prev:st,hasPrev:hn,hasNext:mn}}}),Fi=["id"],Ii={ref:"gEle"},Ri={ref:"foreignEle",style:{display:"none"}},Pi={ref:"foreignDivEle",contenteditable:""};function Vi(t,e,o,n,s,a){const i=H("contextmenu");return v(),y("div",{class:P(t.style.container)},[w("div",{id:t.style["svg-wrapper"],ref:"wrapperEle"},[(v(),y("svg",{class:P(t.style.svg),ref:"svgEle"},[w("g",Ii,[(v(),y("foreignObject",Ri,[w("div",Pi,null,512)],512))],512)],2))],8,Fi),(v(),y("svg",{ref:"asstSvgEle",class:P(t.style["asst-svg"])},null,2)),w("div",{class:P([t.style["button-list"],t.style["right-bottom"]])},[t.centerBtn?(v(),y("button",{key:0,onClick:e[0]||(e[0]=l=>t.centerView())},[w("i",{class:P(t.style.gps)},null,2)])):F("",!0),t.fitBtn?(v(),y("button",{key:1,onClick:e[1]||(e[1]=l=>t.fitView())},[w("i",{class:P(t.style.fit)},null,2)])):F("",!0),t.downloadBtn?(v(),y("button",{key:2,onClick:e[2]||(e[2]=l=>t.download())},[w("i",{class:P(t.style.download)},null,2)])):F("",!0)],2),t.timetravel?(v(),y("div",{key:0,class:P([t.style["button-list"],t.style["right-top"]])},[w("button",{onClick:e[3]||(e[3]=(...l)=>t.prev&&t.prev(...l)),class:P({[t.style.disabled]:!t.hasPrev})},[w("i",{class:P(t.style.prev)},null,2)],2),w("button",{onClick:e[4]||(e[4]=(...l)=>t.next&&t.next(...l)),class:P({[t.style.disabled]:!t.hasNext})},[w("i",{class:P(t.style.next)},null,2)],2)],2)):F("",!0),t.ctm?(v(),re(i,{key:1,position:t.contextmenuPos,groups:t.menu,onClickItem:t.onClickMenu},null,8,["position","groups","onClickItem"])):F("",!0)],2)}var zi=N(Ni,[["render",Vi]]);const lt=t=>(Bt("data-v-2659593a"),t=t(),Lt(),t),Hi={class:"container"},Ki={class:"main"},Gi=lt(()=>w("label",{for:"language-select"},"Language",-1)),Ui=lt(()=>w("option",{value:"zh"},"\u7B80\u4F53\u4E2D\u6587",-1)),Yi=lt(()=>w("option",{value:"en"},"English",-1)),Ji=[Ui,Yi],Wi=["name","onUpdate:modelValue","disabled"],qi=["for"],Xi=["name","onUpdate:modelValue","min","max"],Zi=["for"],Qi=A({emits:["event_callback"],setup(t,{emit:e}){const{store_data:o}=te(),{store_dlg:n}=Re();Qe();const s=Ne();E(null);const a=O({height:window.innerHeight,update:!1,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});ee(()=>{console.log("[mounted]"),l(),window.addEventListener("resize",c),document.addEventListener("keydown",i),document.body.style.overflow="hidden"}),Ie(()=>{console.log("unmounted!"),window.removeEventListener("resize",c),document.removeEventListener("keydown",i)});const i=$=>{if($.keyCode===83&&$.ctrlKey){$.preventDefault(),console.log("save"),g(p.value);return}},l=()=>{const $=S=>{o.do_cmd("restore_file","")};console.log("init"),s.path.substring(1),s.fullPath,$(),o.do_cmd("filter_menu",null),c()},c=()=>{const $=window.innerHeight-40;console.log(`height=${$}`),a.height=$,o.update_height($)},r=O({center_btn:{value:!0},fit_btn:{value:!0},timetravel:{value:!0},download_btn:{value:!0},add_node_btn:{value:!0},keyboard:{value:!1,disabled:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},sharp_corner:{value:!1},vertical:{value:!1,disabled:!0}}),d=O({branch:{value:4,min:1,max:6},x_gap:{value:42,min:0,max:100},y_gap:{value:9,min:0,max:100}}),p=E([{name:"start",children:[]}]),h=E("en");j(()=>o.state.obj.content,($,S)=>{console.log("[watch-body]"),u($)});const u=$=>{try{p.value=JSON.parse($)}catch(S){console.log(S),p.value=[{name:"@start",children:[]}]}a.update=!a.update},g=$=>{o.do_cmd("save_file",JSON.stringify(p.value))},b=async($,S)=>{switch(console.log(`[event_callback] cmd=${$}, va0=${S}`),$){case"toggle_editor":g(p.value);break;case"filelist":document.querySelector(".col-3");const M=!a.toggle_list;a.toggle_list=M,console.log(a.toggle_list);break;case"blur":g(p.value);break;default:if($.indexOf("dlg_")!=-1){const m=Object.assign({},k($,S));console.log(m),n.update_param(m)}else o.do_cmd($,S);break}},k=($,S)=>{const M=Rt[$],m=S!=null?S:o.state.filename;return M.init(M,m),M};return($,S)=>(v(),y("div",Hi,[D(Pt,{ref:"appbar",onEvent_callback:b},null,512),D(Ht,{objParam:f(a).objDlgCmn,onEvent_callback:b},null,8,["objParam"]),w("div",Ki,[f(a).toggle_list?(v(),re(Vt,{key:0,class:"col-3",onEvent_callback:b,style:X({height:f(a).height+"px"})},null,8,["style"])):F("",!0),D(f(zi),{class:"col-2",modelValue:p.value,"onUpdate:modelValue":S[0]||(S[0]=M=>p.value=M),update:f(a).update,branch:f(d).branch.value,"x-gap":f(d).x_gap.value,"y-gap":f(d).y_gap.value,zoom:f(r).zoom.value,"fit-btn":f(r).fit_btn.value,"center-btn":f(r).center_btn.value,"download-btn":f(r).download_btn.value,drag:f(r).drag.value,edit:f(r).edit.value,"add-node-btn":f(r).add_node_btn.value,"sharp-corner":f(r).sharp_corner.value,ctm:f(r).contextmenu.value,timetravel:f(r).timetravel.value,locale:h.value,style:X({height:f(a).height+"px"}),onEvent_callback:b},null,8,["modelValue","update","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","ctm","timetravel","locale","style"]),f(a).toggle_list?(v(),y("div",{key:1,class:"col-3",style:X({height:f(a).height+"px"})},[w("div",null,[Gi,ie(w("select",{id:"language-select","onUpdate:modelValue":S[1]||(S[1]=M=>h.value=M)},Ji,512),[[oo,h.value]])]),(v(!0),y(J,null,Z(f(r),(M,m)=>(v(),y("div",{key:m},[ie(w("input",{type:"checkbox",name:m.toString(),"onUpdate:modelValue":_=>M.value=_,disabled:M.disabled},null,8,Wi),[[jt,M.value]]),w("label",{for:m.toString()},z(m),9,qi)]))),128)),(v(!0),y(J,null,Z(f(d),(M,m)=>(v(),y("div",{key:m},[ie(w("input",{type:"range",name:m,"onUpdate:modelValue":_=>M.value=_,min:M.min,max:M.max},null,8,Xi),[[We,M.value,void 0,{number:!0}]]),w("label",{for:m},z(m)+"\uFF08"+z(M.value)+"\uFF09",9,Zi)]))),128))],4)):F("",!0)])]))}});var el=N(Qi,[["__scopeId","data-v-2659593a"]]);const tl=[{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Gs},{name:".mm",path:"/mm/:pathMatch(.*)",component:el},{name:".md",path:"/:pathMatch(.*)*",component:Hs}],nl=so({history:ao(),routes:tl});function ol(t={}){const{immediate:e=!1,onNeedRefresh:o,onOfflineReady:n,onRegistered:s,onRegisterError:a}=t;let i;const l=async(c=!0)=>{};return"serviceWorker"in navigator&&(i=new io("./sw.js",{scope:"./"}),i.addEventListener("activated",c=>{c.isUpdate?window.location.reload():n==null||n()}),i.register({immediate:e}).then(c=>{s==null||s(c)}).catch(c=>{a==null||a(c)})),l}ol();lo.add(co);ro(So).use(nl).component("fa",uo).mount("#app");
