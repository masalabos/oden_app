var Mn=Object.defineProperty;var Bn=(t,e,o)=>e in t?Mn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var Se=(t,e,o)=>(Bn(t,typeof e!="symbol"?e+"":e,o),o);import{D as Ln,a as st,i as kt,p as Et,u as qe,b as Ae,r as N,d as A,c as ie,e as V,o as f,f as b,g,F as G,h as B,j as re,t as R,k as O,l as q,w as Ct,m as j,n as me,q as $,s as E,v as X,x as St,y as Mt,z as P,A as Ie,T as Dn,B as ee,C as Tn,E as jn,G as On,H as it,R as Nn,I as Ve,J as We,K as ne,L as Bt,M as Ue,N as Lt,O as An,P as In,Q as Fn,S as oe,U as Rn,V as Pn,W as Vn,X as zn,Y as Hn,Z as Dt,_ as be,$ as Gn,a0 as Un,a1 as Tt,a2 as Kn,a3 as Jn,a4 as Yn,a5 as qn,a6 as Xe,a7 as Wn,a8 as Xn,a9 as Q,aa as Zn,ab as Qn,ac as eo,ad as to,ae as no,af as oo,ag as so,ah as io}from"./vendor.baad1c69.js";var z=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",get svg(){return Gt},get g(){return Qe},get asstSvg(){return Ut},get foreign(){return Kt}});const ao=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=o(s);fetch(s.href,i)}};ao();class te{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(e,o="",n=[],s=!1){o!=""&&(this.path=o),n!=[]&&(this.tags=n),this.content=e;const i=this.get_time();this.atime=i,s==!0&&(this.ctime=i)}set_default(e){this.path=e,this.content="",this.tags=[];const o=this.get_time();this.atime=o,this.ctime=o}copy(e){Object.assign(this,e)}duplicate(e,o=""){const n=new te;return n.copy(this),n.content=e,n.path=o,n.update_contentEx(),n.update_time(),n}update_content(e){e!=null&&(this.content=e),this.update_contentEx()}update_contentEx(e=!0){e&&(this.atime=this.get_time()),this.tags=this.build_tag(this.content)}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const o=n=>`00${n}`.slice(-2);return`${e.getFullYear()}/${o(e.getMonth()+1)}/${o(e.getDate())} ${o(e.getHours())}:${o(e.getMinutes())}:${o(e.getSeconds())}`}update_time(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){console.log("[build_tag]");const o=[],n=[0,0,0,0,0],s=e.split(/\r\n|\n|\r/);for(let i=0;i<s.length;i++)if(s[i].search(/^\s*#/)!=-1){const l=s[i].split(" "),c=l[0].length;l.shift();const r=l.join(" ");o.push({text:r,line:i,tag:c,num:n[c]}),n[c]++}return o}split(e){const o=[],n=this.content.split(/\r\n|\n|\r/),s=this.tags.filter(function(r){return r.tag==e}),i=[],a=n.length;for(var l=0;l<s.length;l++){const r=s[l].line;i.push({start:r,end:a,title:s[l].text}),l!=0&&(i[l-1].end=r-1)}const c=this.path.replace(".","_");return i.reverse(),i.forEach(r=>{const h=n.splice(r.start,r.end).join(`\r
`),u=this.duplicate(h,`${c}/${r.title}`);o.push(u)}),o.reverse(),o}}class lo extends Ln{constructor(){super("OdenDB");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class co{constructor(e){this.db=new lo,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async o=>{const n=await this.dbx.get(o);return n!=null?n.data:null},this.write=async(o,n)=>{const s=JSON.stringify(n);await this.dbx.put({key:o,data:s,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async o=>{await this.dbx.delete(o),this.set_time_DB()},this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(n=>{e[n.key]=n.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class ro{constructor(e){this.write=(o,n)=>this.storeLS.write(o,n),this.delete=o=>this.storeLS.delete(o),this.rename=async(o,n)=>{console.log(`[rename] _key_org=${o}, _key_new=${n}`);const s=this.as(await this.get(o));return s.path=n,await this.write(n,s),await this.delete(o),s},this.split=async o=>{console.log(`[split] _key_org=${o}`);const s=this.as(await this.get(o)).split(1);return s.forEach(i=>{this.write(i.path,i)}),s},this.merge=(o,n)=>{console.log(`[merge] _path=${o}`);const s=new te;return s.set_default(o),s.update_content(n),this.write(o,s),s},this.as=o=>Object.assign(new te,o),this.sync_DB=()=>this.storeLS.sync_DB(),this._=e,this.storeLS=new co(this._)}async get(e){console.log(`[get] _key=${e}`);const o=await this.read(e);return o!=null?JSON.parse(o):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,o){console.log(`[set] _key=${e}`);const n=this.as(await this.get(e));return n.path==""&&(n.path=e),n.update_content(o),this.write(e,n),n}async set_ex(e,o){console.log(`[set_ex] _key=${e}`);const n=this.as(o);return o.path==""&&(o.path=e),n.update_content(void 0),this.write(e,n),n}async read(e){return await this.storeLS.read(e)}create(e){console.log(`[create] _key=${e}`);const o=new te;return e!=null&&(o.set_default(e),this.write(e,o)),o}}const ze="menu.json";class uo{constructor(e){this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const o=await this._.mgrCache.getLstContent(e),n=this.buildMenu(o);return console.log(`${o.length}/${n.length}`),this._.contentEx.set(ze,JSON.stringify(n)),n}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const o=await this._.contentEx.get(ze);return JSON.parse(o.content)}}buildMenu(e){function o(s){const i=new Set;return s.forEach(a=>{i.add(a.group)}),[...i]}function n(s){console.log("storeEx_index:buildMenuEx");const i=o(s);return s.reduce((a,l)=>{if(l.path==ze)return a;let c=l.group,r=l.title,d=`${c}/${r}`;return i.includes(d)&&(c=d,r=".index",d=`${c}/${r}`),a.push({key:d,group:c,title:r,path:l.path,atime:l.atime}),a},[])}return n(e).sort(this.compare_group)}compare_group(e,o){let n=e.group,s=o.group;n==s&&(n=`${e.group}/${e.title}`,s=`${o.group}/${o.title}`);const i=n.toUpperCase(),a=s.toUpperCase();let l=0;return i>a?l=1:i<a&&(l=-1),l}}class xe{static async read(e){console.log(`[read] filename=${e}`);const o=new URLSearchParams;return o.append("filename",e),xe.post_cmdEx("load_file_md",o)}static write(e,o){console.log(`[write] filename=${e}`);const n=new URLSearchParams;return n.append("filename",e),n.append("source",o),xe.post_cmdEx("save_file_md",n)}static async get_cmdEx(e){const o="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:get_cmdEx] api=${o}`),st.get(o).then(n=>n.data).catch(n=>{throw n.response.status})}static async post_cmdEx(e,o){const n="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:post_cmdEx] api=${n}`),st.post(n,o).then(s=>s.data).catch(s=>{throw s.response.status})}}class ho{constructor(e){this.backupEx=(o,n,s)=>{const i=()=>{const l=new URLSearchParams;l.append("lstContent",JSON.stringify(o)),xe.post_cmdEx("backup_contents",l).then(c=>console.log(c)).catch(c=>console.log(c))},a=()=>{const l=new Blob([JSON.stringify(o)],{type:"text/plain"}),c=(d,h)=>{const u=new Date,p=m=>`00${m}`.slice(-2);return`${d}_${u.getFullYear()}${p(u.getMonth()+1)}${p(u.getDate())}_${p(u.getHours())}.${h}`},r=document.createElement("a");r.download=c("lstData","json"),r.href=URL.createObjectURL(l),r.click(),URL.revokeObjectURL(r.href)};switch(console.log(`[backup] mode=${n}`),n){case"backup":i();break;case"export":a();break}},this._=e}async restoreEx(e,o,n){function s(c){c.forEach(r=>{const d=new te;d.copy(r),d.update_contentEx(!1),l.write(d.path,d)})}async function i(c,r){xe.get_cmdEx("restore_contents").then(d=>{s(d),c(d)}).catch(d=>{console.log(d),r(null)})}async function a(c,r,d){const h=new FileReader;h.onload=()=>{var m;console.log("onload");const u=(m=h.result)!=null?m:"",p=JSON.parse(u);s(p),r(p)},h.onerror=u=>{d("error")},h.readAsText(c)}console.log("[importExport:restore]");const l=this._.contentEx;return new Promise(function(c,r){switch(e){case"restore":i(c,r);break;case"import":a(o,c,r);break}})}}class po{constructor(e){this.journal2=async(o,n)=>{const s=(a,l)=>`
## ${this._.contentEx.as(a).cnv_time(n)}
${l}
`;console.log("[journal]");const i=await this.geolocation();return o.content+=s(o,i),o},this.geolocation=()=>new Promise(o=>{let n="";navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{n=`(Latitude,longitude)=(${s.coords.latitude},${s.coords.longitude})
`,o(n)},s=>{switch(s.code){case 1:n="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:n="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:n="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}o(n)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),o(n))}),this.chat=async(o,n,s)=>{const i=m=>["sun","mon","tue","wed","thu","fri","sat"][m],a=m=>{const y=C=>`00${C}`.slice(-2),k=`${m.getFullYear()}/${y(m.getMonth()+1)}/${y(m.getDate())}(${i(m.getDay())})`,L=`${y(m.getHours())}:${y(m.getMinutes())}`;return[k,L]},l=(m,y)=>m!==y?`
## ${y}
`:"",c=m=>{const y=s.isNoList?"":"- ",k=s.isAddTime?`${m} : `:"";return`${y}${k}${n}
${u}`};console.log("[chat]");const r=o.content.indexOf(`
`),[d,h]=a(new Date),u=s.isAddGeo?await this.geolocation()+`
`:"",p=l(o.content.substring(0,r),d)+c(h);return o.content=`${d}${o.content.substring(r)}${p}`,o},this._=e}async path_rename(e,o,n){console.log(`_from=${e}, _to=${o}`);const s=this.collect_filename_by_group(e,n);for(let i=0;i<s.length;i++){const a=s[i],l=`${a[1]}/${a[0]}`,c=`${o}${a[2]}/${a[0]}`;await this._.contentEx.rename(l,c)}}async path_delete(e,o){console.log(`_path=${e}`);const n=this.collect_filename_by_group(e,o);for(let s=0;s<n.length;s++){const i=n[s],a=`${i[1]}/${i[0]}`;await this._.contentEx.delete(a)}}async path_merge(e,o,n){console.log(`_path=${e}`);const s=[],i=this.collect_filename_by_group(e,n);for(let l=0;l<i.length;l++){const c=i[l],r=`${c[1]}/${c[0]}`,d=await this._.contentEx.get(r);s.push(d.content)}const a=s.join(`\r
`);return this._.contentEx.merge(o,a)}collect_filename_by_group(e,o){console.log(`[collect_filename_by_group] group=${e}`);const n=[],s=e.length!=0?1:0;return o.forEach((i,a)=>{if(i.group==e){const l=i.group.substring(e.length+s);n.push([i.title,i.group,l.length!=0?`/${l}`:""])}}),n}}class go{constructor(e){this._=e}async getLstContent(e){console.log("[getLstContent]");const o=i=>{const a=e.path==""?!0:i.path.indexOf(e.path)!=-1,l=e.keyword==""?!0:i.content.toLowerCase().indexOf(e.keyword)!=-1;return a&&l},n=await this.buildLstContent();return e!=null?n.filter(o):n}async buildLstContent(){var i;console.log("[buildLstContent]");const e=a=>{var r,d;let l=a.path;(l==""||l==null)&&(l=`@test/${new Date().toLocaleString()}`);const c=l.split("/");return a.title=(r=c.pop())!=null?r:".",a.group=(d=c.join("/"))!=null?d:"@test",a.tags=[],a.htags=[],a},o=await this._.contentEx.storeLS.getStrageEx(),n=[],s=a=>o[a];for(const a of Object.keys(o))try{n.push(e(JSON.parse((i=s(a))!=null?i:"")))}catch(l){console.log(`@ error key=${a},e=${l} - other error`)}return n}}class mo{constructor(){this.contentEx=new ro(this),this.mgrExchange=new ho(this),this.mgrEtc=new po(this),this.mgrMenu=new uo(this),this.mgrCache=new go(this),console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,o){return this.contentEx.set(e,o)}async cmd_save_ex(e,o){return this.contentEx.set_ex(e,o)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_rename(e,o){await this.contentEx.rename(e,o)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,o="",n=null){const s=await this.mgrCache.getLstContent(n);this.mgrExchange.backupEx(s,e,o)}async cmd_restoreEx(e,o,n=""){await this.mgrExchange.restoreEx(e,o,n)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,o){const n=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,o,n)}async cmd_path_delete(e){const o=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,o)}async cmd_path_merge(e,o){const n=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,o,n)}async cmd_chat(e,o,n){const i=(()=>{const c=new Date;return`${e}${n.mode}_${c.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${i}`);const a=await this.contentEx.get(i),l=await this.mgrEtc.chat(a,o,n);return await this.contentEx.set(i,l.content),[l,i]}}class fo{constructor(e){this.KEY="",console.log(e),this.KEY=e}get(e){var o;if(localStorage.getItem(this.KEY)!=null){const n=JSON.parse((o=localStorage.getItem(this.KEY))!=null?o:"");e(n),console.log(n)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const _o=1e3*60*10,jt=Symbol(),vo=()=>{const t=qe(),e=Ae(),o=N({storeEx:new mo,persisted:new fo("lifeLog-Viewer-params"),filename:"",obj:new te,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),n=v=>{console.log(`[update_filename] : new=${v}`),v!=o.filename&&s(v)},s=async v=>{const w=M=>{e.path.indexOf(M)==-1&&console.log(`_value=${M}`),M.indexOf(".mm")!=-1?t.push("/mm/"):t.push("/"),o.persisted.set({filename:M}),o.filename=M};if(console.log(`[load_obj] : new=${v}`),v!=""){const M=await o.storeEx.cmd_load(v);c(M)}else r("");w(v)},i=()=>{console.log("restore_filename"),o.persisted.get(v=>{n(v.filename)})},a=async v=>{if(v==""){console.log("skip save - empty data");return}r(v),c(o.obj),await o.storeEx.cmd_save_ex(o.filename,o.obj),u()},l=()=>{console.log("[auto_save] start"),o.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(o.intervalId_autoSave)),o.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await _("export",null,null),o.intervalId_autoSave=null},_o)},c=v=>{const w=v instanceof te?v:Object.assign(new te,v);w.update_contentEx(),o.tags=w.tags,o.obj=w},r=v=>{o.obj.content=v},d=async(v,w)=>{if(console.log(v),w!=null){const M=await o.storeEx.cmd_load(w);M.position=v,await o.storeEx.cmd_save_ex(w,M)}else o.obj.position=v},h=v=>{o.dictMenu=v},u=()=>{setTimeout(async()=>{h(await o.storeEx.cmd_rebuild()),l()},250)},p=v=>{o.jump=v,v!=-1&&(console.log(`jump=${v}`),o.ObjTag=JSON.parse(JSON.stringify(o.tags[v])),console.log(JSON.stringify(o.ObjTag)))},m=v=>{o.height=v},y=async(v,w)=>{const[M,I]=await o.storeEx.cmd_chat(o.path_expand,v,w);c(M),n(I),u()},k=async(v,w)=>{const M=await o.storeEx.cmd_exist(v);if(w==M)return!0;{const I=w?`error : ${v} is not exist. please enter exist filename.`:`error : ${v} is already exist. please enter other filename.`;return console.log(I),!1}},L=async(v,w)=>{await k(v,!1)&&(await o.storeEx.cmd_rename(w,v),n(v),u())},C=async(v,w)=>{const M=S(w)[0],I=S(v)[0];await o.storeEx.cmd_path_rename(M,I),n(""),u()},_=async(v,w,M)=>{console.log(`[do_cmd] mode=${v}`);let I=w!=""?w:o.filename,ve="",Ce;switch(v){case"update_jump":p(w);break;case"rebuild_menu":u();break;case"filter_menu":const Pe=w;w!=null&&(Pe.path=Pe.isUnderFolder?S(o.filename)[0]:""),h(await o.storeEx.cmd_getMenu(Pe));break;case"open_file":n(w);break;case"restore_file":i();break;case"save_file":await a(w);break;case"new":await k(w,!1)&&(await o.storeEx.cmd_create(w),n(w),u());break;case"delete":await k(I,!0)&&(await o.storeEx.cmd_delete(I),n(""),u());break;case"rename":L(w,M);break;case"backup":o.storeEx.cmd_backup("backup");break;case"export":o.storeEx.cmd_backup("export");break;case"restore":await o.storeEx.cmd_restoreEx("restore",null),u();break;case"import":await o.storeEx.cmd_restoreEx("import",w),u();break;case"split":await k(I,!0)&&(await o.storeEx.cmd_split(I),u());break;case"path_rename":C(w,M);break;case"path_delete":ve=S(w)[0],await o.storeEx.cmd_path_delete(ve),n(""),u();break;case"path_merge":ve=S(w)[0],I=`${ve}.md`,await k(I,!1)&&(await o.storeEx.cmd_path_merge(ve,I),n(I),u());break;case"print":const Sn=t.resolve({path:`/print/${o.filename}`});window.open(Sn.href,"_blank");break;case"journal":y("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":y(w,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":y(w,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":Ce={keyword:M.filter.toLowerCase(),isUnderFolder:M.isCheck,path:""},h(await o.storeEx.cmd_getMenu(Ce));break;case"update_position":await d(w,M);break;case"move_archive":L(`@archive/${w}`,w);break;case"move_path_archive":C(`@archive/${w}`,w);break;case"export_archive":Ce={keyword:"",isUnderFolder:!0,path:"@archive/"},o.storeEx.cmd_backup("export","",Ce);break}},S=v=>{const w=v.split("/"),M=w[w.length-1];return[w.slice(0,-1).join("/"),M]};return{store_data:{state:o,update_height:m,do_cmd:_}}},bo=()=>{Et(jt,vo())},Z=()=>kt(jt),wo=()=>{const t=N({objParam:null});return{store_dlg:{state:t,update_param:o=>{t.objParam=o}}}},Ot=Symbol(),yo=()=>{Et(Ot,wo())},Fe=()=>kt(Ot);const xo=A({setup(t){return bo(),yo(),(e,o)=>{const n=V("routerView");return f(),ie(n)}}});var F=(t,e)=>{const o=t.__vccOpts||t;for(const[n,s]of e)o[n]=s;return o};const $o={key:0,class:"item"},ko={key:1,class:"line"},Eo={key:1,class:"folder"},Co={key:2,class:"dropdown"},So=A({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=N({isOpen:!1,item:o.item,isFolder:o.item.children&&o.item.children.length,isActive:!0}),s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const l=a.cmd;s(l,null)}};return(a,l)=>{const c=V("fa"),r=V("MenuTreeItem",!0);return f(),b("div",{class:"menu_tree",onClick:l[0]||(l[0]=d=>i(g(n).item)),onContextmenu:l[1]||(l[1]=Ct(()=>{},["right","prevent"]))},[g(n).isFolder?O("",!0):(f(),b(G,{key:0},[g(n).item.title!=""?(f(),b("span",$o,[B(c,{icon:g(n).item.icon},null,8,["icon"]),re(" "+R(g(n).item.title),1)])):O("",!0),g(n).item.title==""?(f(),b("div",ko)):O("",!0)],64)),g(n).isFolder?(f(),b("span",Eo,[B(c,{icon:g(n).item.icon},null,8,["icon"]),re(" "+R(g(n).item.title),1)])):O("",!0),g(n).isFolder?(f(),b("div",Co,[(f(!0),b(G,null,q(g(n).item.children,(d,h)=>(f(),b("div",{key:h},[B(r,{item:d,onEvent_callback:s},null,8,["item"])]))),128))])):O("",!0)],32)}}});var Mo=F(So,[["__scopeId","data-v-51bfd584"]]);const Bo=A({props:{mouse:null,items:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=N({items:o.items,pos_x:-1,pos_y:-1,isShow:!1,style:"display:none"});console.log(`[state]=${JSON.stringify(n)}`),j(()=>o.mouse,(a,l)=>{console.log("props"),n.isShow=!0,n.pos_x=o.mouse.clientX,n.pos_y=o.mouse.clientY,n.items=o.items,n.style="display:block"});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{n.style=a?"display:block":"display:none"};return(a,l)=>(f(),b("div",{class:"menu",style:me(g(n).style),onMouseover:l[0]||(l[0]=c=>i(!0)),onMouseleave:l[1]||(l[1]=c=>i(!1))},[(f(!0),b(G,null,q(g(n).items,c=>(f(),b("div",{key:c.path},[B(Mo,{item:c,onEvent_callback:s},null,8,["item"])]))),128))],36))}});var Nt=F(Bo,[["__scopeId","data-v-31e96fb6"]]);const Lo=A({props:{objMenu:null},emits:["event_callback"],setup(t,{emit:e}){const n=N({items:t.objMenu,event:void 0}),s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{console.log("onClick"),n.event=a};return(a,l)=>{const c=V("fa");return f(),b("div",{class:"dropdown",onClick:i},[B(c,{icon:"bars"}),B(Nt,{mouse:g(n).event,items:g(n).items,onEvent_callback:s},null,8,["mouse","items"])])}}});var Do=F(Lo,[["__scopeId","data-v-2baeb9a8"]]);const To={class:"base"},jo={key:0,class:"dropdown"},Oo=["onClick"],No={class:"title_sub2"},Ao={class:"title"},Io={class:"title_sub"},Fo=A({props:{objMenuItem:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=N({items:[],items2:[],isShowDlg:!1});j(()=>o.objMenuItem,(l,c)=>{n.items=s(l),n.items2=n.items.slice(0,5)});const s=l=>{console.log("[cnvLstRecent]");function c(d,h){const u=d.atime,p=h.atime;let m=0;return u>p?m=-1:u<p&&(m=1),m}const r=[...l];return r.sort(c),r.slice(0,15)},i=l=>{const c=n.items[l].path;e("event_callback","open_file",c),n.isShowDlg=!1},a=l=>{n.isShowDlg=l};return(l,c)=>{const r=V("fa");return f(),b("div",To,[$("span",{class:"_base",onMouseover:c[0]||(c[0]=d=>a(!0)),onMouseleave:c[1]||(c[1]=d=>a(!1))},[B(r,{icon:"history",class:"_item"}),g(n).isShowDlg?(f(),b("ul",jo,[(f(!0),b(G,null,q(g(n).items,(d,h)=>(f(),b("li",{class:"item",key:h,onClick:u=>i(h)},[B(r,{class:"title_item",icon:"file-alt"}),$("span",No,R(d.group)+"/ ",1),$("span",Ao,R(d.title),1),$("span",Io," ["+R(d.atime)+"]",1)],8,Oo))),128))])):O("",!0)],32)])}}});var Ro=F(Fo,[["__scopeId","data-v-0145e15d"]]);const Po=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],Vo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],zo=[{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],At={dlg_import:{init:(t,e)=>{t.title="Restore",t.isFileOpen=!0,t.isNoEdit=!0,t.edit=""},action:t=>["import"]},dlg_delete:{init:(t,e)=>{t.title="Delete",t.isReadOnly=!0,t.edit=e},action:t=>["delete",t.edit,""]},dlg_rename:{init:(t,e)=>{t.title="Rename",t.edit=e},action:t=>["rename",t.edit,t.edit_org]},dlg_new:{init:(t,e)=>{t.title="Create",t.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:t=>["new",t.edit,""]},dlg_path_rename:{init:(t,e)=>{t.title="Rename of Path",t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_rename",t.edit,t.edit_org]},dlg_path_delete:{init:(t,e)=>{t.title="Delete of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_delete",t.edit,""]},dlg_path_merge:{init:(t,e)=>{t.title="Merge of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_merge",t.edit,""]},dlg_tweet:{init:(t,e)=>{t.title="Tweet",t.edit=""},action:t=>["tweet",t.edit,""]},dlg_bookmark:{init:(t,e)=>{t.title="Bookmark",t.edit="",t.isMulti=!0},action:t=>["bookmark",t.edit,""]},dlg_filter:{init:(t,e)=>{t.title="Filter",t.title2="target under folder",t.edit="",t.edit_org="@",t.isCheck=!0},action:t=>(console.log("dlg_filter"),["filter",t.filename,{filter:t.edit,isCheck:t.check}])}};const Ho=t=>(St("data-v-a16678bc"),t=t(),Mt(),t),Go={class:"nav"},Uo=["title"],Ko={class:"cmd"},Jo=Ho(()=>$("span",{class:"item"},null,-1)),Yo=A({emits:["event_callback"],setup(t,{emit:e}){const{store_data:o}=Z();Fe();const n=E(null),s=N({filename:"@",objMenu:Po,dctMenu:[]}),i=(r,d)=>{console.log(`[event_callback] cmd=${r}`),r=="top"?n.value.scrollIntoView({}):e("event_callback",r,d)};X(()=>{console.log("[mounted]")});const a=r=>{console.log(`[doAction] cmd=${r}`),e("event_callback",r,!0)};j(()=>o.state.filename,(r,d)=>{console.log(`[watch:filename] ${r}`),c(r)}),j(()=>o.state.dictMenu,(r,d)=>{s.dctMenu=r}),j(()=>o.state.jump,(r,d)=>{window.setTimeout(()=>{l()},500)});const l=()=>{n.value.scrollIntoView({})},c=r=>{console.log(`[onChanged_filename] new=${r}`),s.filename=r,l()};return(r,d)=>{const h=V("fa");return f(),b("header",{class:"appbar",ref_key:"appbar",ref:n,onClick:d[6]||(d[6]=u=>i("top",!0))},[$("nav",Go,[B(Do,{class:"item",objMenu:g(s).objMenu,onEvent_callback:i,title:"menu"},null,8,["objMenu"]),$("section",{class:"item logo",onClick:d[0]||(d[0]=u=>i("filelist",!0)),title:g(s).filename},"Oden",8,Uo),B(Ro,{class:"item",objMenuItem:g(s).dctMenu,onEvent_callback:i,title:"history"},null,8,["objMenuItem"]),g(s).filename!==""?(f(),b("span",{key:0,class:"item name",onClick:d[1]||(d[1]=u=>i("dlg_rename",null))}," ["+R(g(s).filename)+"] ",1)):O("",!0),$("span",{class:"item mark",onClick:d[2]||(d[2]=u=>a("toggle_editor")),title:"editor/viewer"},[B(h,{icon:"edit"})])]),$("span",Ko,[$("span",{class:"item",onClick:d[3]||(d[3]=u=>a("dlg_filter")),title:"filter"},[B(h,{icon:"paw"})]),$("span",{class:"item",onClick:d[4]||(d[4]=u=>a("dlg_tweet")),title:"tweet"},[B(h,{icon:"grimace"})]),$("span",{class:"item",onClick:d[5]||(d[5]=u=>a("dlg_bookmark")),title:"bookmark"},[B(h,{icon:"bookmark"})]),Jo])],512)}}});var It=F(Yo,[["__scopeId","data-v-a16678bc"]]);const qo={class:"file_tree"},Wo=["onContextmenu"],Xo=["title"],Zo={key:1,class:"folder"},Qo={key:0},es=A({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=N({isOpen:!1,item:o.item,isFolder:o.item.children&&o.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:s}=Z();j(()=>s.state.filename,(d,h)=>{r(d)});const i=(d,h)=>{console.log(`[event_callback] cmd=${d}`),e("event_callback",d,h)},a=(d,h)=>{console.log(`[event_callbackEx] cmd=${d}`),e("event_callback",d,n.item.path)};X(()=>{r(s.state.filename)});const l=d=>{if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const h=d.path;console.log(`onClick-filename=${h}`),s.do_cmd("open_file",h)}},c=d=>{console.log("onClickEx"),n.menu=n.isFolder?zo:Vo,n.event=d},r=d=>{n.item.path==d,d.indexOf(n.item.name)!=-1&&(n.isOpen=!0),n.class_item=n.item.path==d?"item active":"item"};return(d,h)=>{const u=V("fa"),p=V("tree-item",!0);return f(),b("div",qo,[B(Nt,{mouse:g(n).event,items:g(n).menu,onEvent_callback:a},null,8,["mouse","items"]),$("div",{onContextmenu:Ct(c,["prevent"]),onClick:h[0]||(h[0]=m=>l(g(n).item))},[g(n).isFolder?O("",!0):(f(),b("div",{key:0,class:P(g(n).class_item),title:g(n).item.time},R(g(n).item.name),11,Xo)),g(n).isFolder?(f(),b("div",Zo,[B(u,{icon:g(n).isOpen?"folder-open":"folder"},null,8,["icon"]),re(" "+R(g(n).item.name),1)])):O("",!0)],40,Wo),g(n).isOpen?(f(),b("div",Qo,[(f(!0),b(G,null,q(g(n).item.children,(m,y)=>(f(),b("div",{key:y},[B(p,{item:m,onEvent_callback:i},null,8,["item"])]))),128))])):O("",!0)])}}});var ts=F(es,[["__scopeId","data-v-13eef0e1"]]);const ns={class:"tree"},os=A({emits:["event_callback"],setup(t,{emit:e}){const o=N({items:void 0}),{store_data:n}=Z();j(()=>n.state.dictMenu,(a,l)=>{i(a)});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)};X(()=>{console.log("[mounted]"),i(n.state.dictMenu)});const i=a=>{console.log("[onChanged_dictMenu]"),o.items=void 0;const l=a,c={name:"",children:[],path:"",file:"",time:""},r="/",d={[r]:c};l.forEach(function(h){h.key.split("/").reduce(function(u,p){if(u[p])return u[p];{const m={name:p,children:[],path:h.path,file:"md",time:h.atime};return u[r].children.push(m),u[r].file="",u[p]={[r]:m}}},d)}),console.log(c),setTimeout(()=>{o.items=c.children},500)};return(a,l)=>(f(),b("div",ns,[B(Dn,{_appear:"",name:"flip-list",tag:"div"},{default:Ie(()=>[(f(!0),b(G,null,q(g(o).items,c=>(f(),b("div",{key:c.path},[B(ts,{item:c,onEvent_callback:s},null,8,["item"])]))),128))]),_:1})]))}});var Ft=F(os,[["__scopeId","data-v-3de96301"]]);const ss=A({props:{level:null},setup(t){const e=t,o=ee(()=>`h${e.level}`);return(n,s)=>(f(),ie(Tn(g(o)),{class:"h_tag"},{default:Ie(()=>[jn(n.$slots,"default",{},void 0,!0)]),_:3}))}});var is=F(ss,[["__scopeId","data-v-7eb56ab3"]]);const as=A({emits:["event_callback"],components:{heading:is},setup(t,e){const{store_data:o}=Z(),n=N({listTag:[]});j(()=>o.state.tags,(a,l)=>{console.log(a),n.listTag=a});function s(a){o.do_cmd("update_jump",a)}function i(a){return`${a.text}`}return{state:n,dispTitle:i,jumpSource:s}}}),ls={class:"tag"},cs=["onClick"];function rs(t,e,o,n,s,i){const a=V("heading");return f(),b("div",ls,[(f(!0),b(G,null,q(t.state.listTag,(l,c)=>(f(),b("div",{key:c,onClick:r=>t.jumpSource(c),class:"item"},[B(a,{level:l.tag},{default:Ie(()=>[re(R(t.dispTitle(l)),1)]),_:2},1032,["level"])],8,cs))),128))])}var ds=F(as,[["render",rs],["__scopeId","data-v-499a1cf1"]]);const us=A({emits:["event_callback"],setup(t,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(s,i)=>{console.log(`cmd=${s}, name=${i}`),e.emit("event_callback",s,i)}}}}),hs={class:"main",style:{_height:"100px"}},ps=["onClick","title"];function gs(t,e,o,n,s,i){const a=V("fa");return f(),b("div",hs,[(f(!0),b(G,null,q(t.objToolbar,(l,c)=>(f(),b("button",{class:"btn-item",key:c,onClick:r=>t.event_callback("action",l.cmd),title:l.cmd},[B(a,{icon:l.icon},null,8,["icon"])],8,ps))),128))])}var ms=F(us,[["render",gs],["__scopeId","data-v-495368bc"]]);const Le={};class fs{constructor(e,o){Se(this,"cmdid",0);Se(this,"monaco",null);Se(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=o}add(e,o,n,s,i=null){let a;switch(s.length){case 0:a=this.generateCommand(e,i);break;case 1:a=this.generateHeaderCommand(s[0]);break;case 2:a=this.generateWrapperCommand(s[0],s[1]);break}Le[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:n,contextMenuGroupId:o&&"navigation",contextMenuOrder:o&&1.5,run:Le[e]})}generateCommand(e,o){return(n,s)=>{o(n)}}generateWrapperCommand(e,o){const n=e.length+o.length;return this.editor,this.editor.getModel(),this.monaco,(s,i)=>{const a=s.getModel(),l=s.getSelections();if(l==null)return;const c=[];return l.forEach(r=>{c.push(new i.Selection(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn+n)),a.pushEditOperations([],[{range:{startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.startLineNumber,endColumn:r.startColumn},text:e},{range:{startLineNumber:r.endLineNumber,startColumn:r.endColumn,endLineNumber:r.endLineNumber,endColumn:r.endColumn},text:o}])}),s.setSelections(c),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(o,n)=>{const s=o.getModel();let i=o.getSelections();return i==null&&(i=[o.getSelection()]),i.forEach(a=>{const l=s.findNextMatch("^(#+ )",{lineNumber:a.startLineNumber,column:1},!0,!1,null,!0);if(l!=null&&l.range.startLineNumber==a.startLineNumber&&l.range.startColumn==1){if(l.matches[1]==e)return;s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:l.matches[1].length+1},text:""}])}s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:1},text:e}])}),null}}}function _s(t,e){const o=s=>{const i=a=>`00${a}`.slice(-2);return`${s.getFullYear()}/${i(s.getMonth()+1)}/${i(s.getDate())} ${i(s.getHours())}:${i(s.getMinutes())}:${i(s.getSeconds())}`};console.log("[setupShortcutKeys]");const n=new fs(t,e);n.add("Bold","8_",[],["**","**"]),n.add("Italic","1_",[],["__","__"]),n.add("Underline","9_",[],["<u>","</u>"]),n.add("Strikethrough",!1,[t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.KEY_S],["~~","~~"]),n.add("Code",!1,[],["`","`"]),n.add("Link",!1,[],["[","]()"]),n.add("Link-2",!1,[],["[](",")"]),n.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),n.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),n.add("Header 1",!1,[],["# ",""]),n.add("Header 2",!1,[],["## ",""]),n.add("Header 3",!1,[],["### ",""]),n.add("Header 4",!1,[],["#### ",""]),n.add("Header 5",!1,[],["##### ",""]),n.add("Header 6",!1,[],["###### ",""]),n.add("Check",!1,[],["- [ ] ",""]),n.add("Blockquotes",!1,[],["> ",""]),n.add("Today",!1,[],[`${o(new Date)}`,""]),n.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),n.add("Format","8_",[],[],s=>{console.log("format"),s.getAction("editor.action.formatDocument").run()})}const vs={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},bs=A({emits:["event_callback"],components:{ToolbarEditor:ms},props:{isActive_preview:{type:Boolean,default:!1}},setup(t,e){const o=E(null),n={editor:void 0},{store_data:s}=Z(),i=N({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});X(()=>{console.log("[mounted]"),l(),m(s.state.obj.content)}),j(()=>s.state.obj.content,(_,S)=>{console.log("[watch-body]"),i.filename!=""&&k(),m(_),L(s.state.obj.position,!0),i.filename=s.state.filename}),j(()=>s.state.ObjTag,(_,S)=>{console.log(`[watch](ObjTag)-${_}`),a(_)}),j(()=>t.isActive_preview,(_,S)=>{console.log(`[watch](editor_toggle)-${_}`),_==!0&&y()});const a=_=>{const S=w=>{u(w)};console.log(`[jump_cursor]ObjTag={${Object.values(_)}}`);const v=_.line;S(v),setTimeout(()=>{const w=n.editor;i.pos_scroll=w.getScrollTop()},500)},l=()=>{const _=()=>{const S=(M,I)=>{_s(M,I)},v=document.getElementById("container");if(console.log(`root=${v}`),v==null)return;const w=On.create(v,vs);return S(it,w),console.log(`editor=${w}`),w.onDidScrollChange(M=>{i.scrollInfo.height=M.scrollHeight,i.scrollInfo.top=M.scrollTop}),w};n.editor=_(),c()},c=()=>{n.editor.onDidBlurEditorText(_=>{y()})},r=(_,S)=>{switch(console.log(`[event_callback] cmd=${_}`),_){case"action":d(S);break;case"save":y();break}},d=_=>{console.log("[action]"),Le[_]!=null&&Le[_](n.editor,it)},h=()=>n.editor.getValue(),u=_=>{const S=new Nn(_+1,0,_+1,0);console.log(`Line=${_}`),n.editor.revealRangeAtTop(S)},p=()=>n.editor.getModel().getAlternativeVersionId(),m=_=>{n.editor.setValue(_),i.iVersion=p()},y=()=>{const _=p();if(console.info(`iVersion=${i.iVersion}, iVersion_cur=${_}`),i.iVersion==_)return;k();const S=h();s.do_cmd("save_file",S),i.iVersion=p(),console.info(`iVersion=${i.iVersion}`)},k=()=>{const _=n.editor,S={top:_.getScrollTop(),height:_.getScrollHeight(),contentHeight:_.getLayoutInfo().height,scrolled:i.pos_scroll!=_.getScrollTop()};return s.do_cmd("update_position",S,void 0),S},L=(_,S=!1)=>{if(_==null)return;console.log(`[e-set]value=${JSON.stringify(_)}`);const v=n.editor;if(S?!0:_.scrolled){const M=_.top/_.height;console.log(`per=${M}`);const I=v.getScrollHeight();v.setScrollTop(I*M)}else a(s.state.ObjTag);setTimeout(()=>{i.pos_scroll=v.getScrollTop()},500)};ee(()=>n.editor.getScrollTop());const C=ee(()=>`${s.state.height-27}px`);return{editorEx:n,event_callback:r,HeightEx:C,md_editor_monaco:o,get_position:k,set_position:L}}}),ws={class:"editor"};function ys(t,e,o,n,s,i){const a=V("ToolbarEditor");return f(),b("div",ws,[B(a,{class:"toolbar",onEvent_callback:t.event_callback},null,8,["onEvent_callback"]),$("div",{id:"container",ref:"md_editor_monaco",class:"core",style:me({height:t.HeightEx})},null,4)])}var xs=F(bs,[["render",ys],["__scopeId","data-v-6db75566"]]);const $s=A({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(t,e){const o=E(null),{store_data:n}=Z(),s=N({contentsPosition:[],tocMap:new Map,observer:null,elm_target_before:null,pos_scroll:-1,filename:""});X(()=>{function h(){const u=new Ve.Renderer;u.link=function(p,m,y){return p.indexOf("http")!=-1?`<a target="_blank" href="${p}">${y}</a>`:`<a target="_blank" href="#${p}">${y}</a>`},Ve.setOptions({renderer:u,langPrefix:"",breaks:!0})}console.log("[created]"),h()}),j(()=>n.state.obj.content,(h,u)=>{console.log("[watch-body]"),o.value,s.filename!=""&&l(),setTimeout(()=>{i(),c(n.state.obj.position,!0),s.filename=n.state.filename},0)});function i(){const h=_=>{_.forEach(S=>{const v=s.tocMap.get(S.target);console.log(S.intersectionRatio),S.intersectionRatio?(s.elm_target_before!=null&&s.elm_target_before.classList.remove("active"),v.classList.add("active"),s.elm_target_before=null):s.elm_target_before=v})},u={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},p=new IntersectionObserver(h,u),m=new Map,k=document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),C=document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5");console.log(`el_contents=${k.length}/${JSON.stringify(k)}`),console.log(`el_toc=${C.length}/${JSON.stringify(C)}`),k.forEach((_,S)=>{p.observe(_),m.set(C.item(S),_),m.set(_,C.item(S))}),s.tocMap=m,s.observer=p}j(()=>n.state.ObjTag,(h,u)=>{console.log(`[watch](ObjTag)-${h}`),a(h)}),j(()=>t.isActive_preview,(h,u)=>{console.log(`[watch](editor_toggle)-${h}`)}),ee(()=>o.value.querySelector(".md_core_viewer"));function a(h){const u=(y,k)=>{console.log(`tag=${y}, num=${k}`);const L=o.value,C=L.querySelectorAll(".md_core_viewer > h"+y);C.length!=0&&(L.scrollTop=C[k].getBoundingClientRect().top-L.getBoundingClientRect().top+L.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(h)}}`);const p=h.tag,m=h.num;h.line,u(p,m),setTimeout(()=>{const y=o.value;s.pos_scroll=y.scrollTop},0)}const l=()=>{const h=o.value,u={top:h.scrollTop,height:h.scrollHeight,contentHeight:0,scrolled:s.pos_scroll!=h.scrollTop};return n.do_cmd("update_position",u,s.filename),u},c=(h,u=!1)=>{console.log(`[v-set]value=${JSON.stringify(h)}`);const p=o.value;if(h==null){p.scrollTop=0;return}if(u?!0:h.scrolled){const y=h.top/h.height;console.log(`per=${y}`),console.log(`scrollTop=${p.scrollTop}, scrollHeight=${p.scrollHeight}`),p.scrollTop=p.scrollHeight*y}else a(n.state.ObjTag);setTimeout(()=>{s.pos_scroll=p.scrollTop},0)},r=ee(()=>Ve.parse(n.state.obj.content)),d=ee(()=>n.state.height+"px");return{status,Markdown:r,HeightEx:d,md_viewer:o,get_position:l,set_position:c}}}),ks=["innerHTML"];function Es(t,e,o,n,s,i){return f(),b("div",{class:"md_core_viewer note",innerHTML:t.Markdown,style:me({height:t.HeightEx}),ref:"md_viewer"},null,12,ks)}var Rt=F($s,[["render",Es],["__scopeId","data-v-09bee926"]]);const Cs=A({components:{MarkdownEditor:xs,MarkdownViewer:Rt},props:{editor_toggle:{type:Boolean,default:!0}},setup(t,e){const o=E(),n=E(),s=N({isActive_preview:!0});j(()=>t.editor_toggle,(l,c)=>{console.log(`[watch](editor_toggle)-${l}`),a()}),X(()=>{console.log("[mounted]"),document.addEventListener("keydown",i)}),We(()=>{document.removeEventListener("keydown",i)});const i=l=>{if(l.keyCode===83&&l.ctrlKey){l.preventDefault(),console.log("save"),a();return}else if(l.keyCode===69&&l.ctrlKey){l.preventDefault(),console.log("toggle"),a();return}},a=()=>{var r;const l=s.isActive_preview?{now:o,next:n}:{now:n,next:o},c=(r=l.now.value)==null?void 0:r.get_position();console.log(`isActive_preview=${s.isActive_preview}, scrollIndo=${JSON.stringify(c)}`),s.isActive_preview=!s.isActive_preview,setTimeout(()=>{var d;(d=l.next.value)==null||d.set_position(c)},500)};return{state:s,MdViewer:o,MdEditor:n}}});function Ss(t,e,o,n,s,i){const a=V("MarkdownViewer"),l=V("MarkdownEditor");return f(),b("div",null,[t.state.isActive_preview?(f(),ie(a,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:t.state.isActive_preview},null,8,["isActive_preview"])):(f(),ie(l,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:t.state.isActive_preview},null,8,["isActive_preview"]))])}var Ms=F(Cs,[["render",Ss]]);const Bs={class:"modal-mask"},Ls={class:"modal-wrapper"},Ds={class:"modal-container"},Ts={class:"header"},js={ref:"form",class:"form"},Os=["disabled"],Ns=["disabled"],As={class:"modal-actions"},Is=["disabled"],Fs=A({emits:["event_callback"],setup(t,{emit:e}){const{store_dlg:o}=Fe(),{store_data:n}=Z(),s=E(null),i=N({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});j(()=>o.state.objParam,u=>{a(u)});const a=u=>{const p=(m,y=!1)=>m!=null?m:y;console.log("[onChanged_objParam]"),i.title=u.title,i.title2=u.title2,i.edit=u.edit,i.edit_org=p(u.edit_org,u.edit),i.check=0,i.isShowDlg=!0,i.isNoEdit=p(u.isNoEdit),i.isFileOpen=p(u.isFileOpen),i.isReadOnly=p(u.isReadOnly),i.isCheck=p(u.isCheck),i.isMulti=p(u.isMulti),i.isDisabled=!0,i.action=u.action,d(!0),s.value.focus()},l=u=>{if(console.log(`[doAction] flg=${u}, edit=${i.edit}`),u){const p=i.action(i);n.do_cmd(p[0],p[1],p[2])}i.isShowDlg=!1,d(!1)},c=u=>{const m=(u.target.files||u.dataTransfer.files)[0],y=i.action(i);n.do_cmd(y[0],m),i.isShowDlg=!1,d(!1)},r=()=>{const u=i.edit_org,p=i.edit==u&&!i.isReadOnly;return console.log(`[isDisabled]=${p}`),p},d=u=>{u==!0?document.addEventListener("keydown",h):document.removeEventListener("keydown",h)},h=u=>{if(u.keyCode===27){u.preventDefault(),l(!1);return}};return(u,p)=>{const m=V("fa");return ne((f(),ie(An,{persistent:""},{default:Ie(()=>[$("div",Bs,[$("div",Ls,[$("div",Ds,[$("div",Ts,R(g(i).title)+"?",1),$("form",js,[g(i).isFileOpen==!0?(f(),b("input",{key:0,class:"input",type:"file",onChange:c},null,32)):O("",!0),g(i).isNoEdit==!1?(f(),b(G,{key:1},[g(i).isMulti==!0?ne((f(),b("textarea",{key:0,class:"input",_autofocus:"","onUpdate:modelValue":p[0]||(p[0]=y=>g(i).edit=y),disabled:g(i).isReadOnly,ref:"edit"},null,8,Os)),[[Ue,g(i).edit]]):ne((f(),b("input",{key:1,class:"input",type:"search",ref_key:"ref_search",ref:s,_autofocus:"","onUpdate:modelValue":p[1]||(p[1]=y=>g(i).edit=y),disabled:g(i).isReadOnly},null,8,Ns)),[[Ue,g(i).edit]])],64)):O("",!0),g(i).isCheck==!0?(f(),b(G,{key:2},[ne($("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":p[2]||(p[2]=y=>g(i).check=y)},null,512),[[Lt,g(i).check]]),re(" "+R(g(i).title2),1)],64)):O("",!0)],512),$("div",As,[$("button",{class:"btn btn-ok",ref:"ok",disabled:r(),onClick:p[3]||(p[3]=y=>l(!0))},[B(m,{icon:"check"}),re(" "+R(g(i).title),1)],8,Is),$("button",{class:"btn btn-can",onClick:p[4]||(p[4]=y=>l(!1))},"cancel")])])])])]),_:1},512)),[[Bt,g(i).isShowDlg]])}}});var Pt=F(Fs,[["__scopeId","data-v-11016c8d"]]);const Rs={class:"container"},Ps={class:"main"},Vs=A({emits:["event_callback"],setup(t,{emit:e}){const{store_data:o}=Z(),{store_dlg:n}=Fe();qe();const s=Ae(),i=N({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});X(()=>{console.log("[mounted]"),a(),window.addEventListener("resize",l),document.body.style.overflow="hidden"}),We(()=>{console.log("unmounted!"),window.removeEventListener("resize",l)});const a=()=>{const d=p=>{o.do_cmd("restore_file","")};console.log("init");const u=s.fullPath.split("api_bookmark?=");if(console.log(u),u.length==2){o.do_cmd("bookmark",decodeURIComponent(u.pop()));return}s.path.substring(1),o.do_cmd("filter_menu",null),d(),l()},l=()=>{const d=window.innerHeight-40;console.log(`height=${d}`),i.height=d,o.update_height(d)},c=async(d,h)=>{switch(console.log(`[event_callback] cmd=${d}, va0=${h}`),d){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"config":i.objDlgConf={cmd:d,filename:"",commit:""};break;case"filelist":document.querySelector(".col-3");const u=!i.toggle_list;i.toggle_list=u,console.log(i.toggle_list);break;default:if(d.indexOf("dlg_")!=-1){const p=Object.assign({},r(d,h));n.update_param(p)}else o.do_cmd(d,h);break}},r=(d,h)=>{const u=At[d],p=h!=null?h:o.state.filename;return u.init(u,p),u};return(d,h)=>(f(),b("div",Rs,[B(It,{ref:"appbar",onEvent_callback:c},null,512),B(Pt,{objParam:g(i).objDlgCmn,onEvent_callback:c},null,8,["objParam"]),$("div",Ps,[g(i).toggle_list?(f(),ie(Ft,{key:0,class:"col-3",onEvent_callback:c,style:me({height:g(i).height+"px"})},null,8,["style"])):O("",!0),B(Ms,{class:"col-2",ref:"pane",editor_toggle:g(i).editor_toggle,_style:"{ height: state.height + 'px' }"},null,8,["editor_toggle"]),B(ds,{class:"col-1",onEvent_callback:c,style:me({height:g(i).height+"px"})},null,8,["style"])])]))}});var zs=F(Vs,[["__scopeId","data-v-5e652e69"]]);const Hs={_class:"container"},Gs=A({emits:["event_callback"],setup(t,{emit:e}){Z();const o=Ae(),n=N({filename:"",height:window.innerHeight,timer3:-1});X(()=>{console.log("[mounted]"),s(),document.body.style.overflow="hidden"});const s=()=>{console.log("init");const i=o.path.substring(1);o.fullPath,console.log(`filename=${i}`),n.filename=i,n.timer3=window.setTimeout(()=>{clearTimeout(n.timer3),window.print()},500)};return(i,a)=>(f(),b("div",Hs,[re(R(g(n).filename)+" ",1),B(Rt,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}}),D=In(),Us="_container_fgvb6_1",Ks="_svg_fgvb6_18",Js="_trigger_fgvb6_44",Ys="_dragging_fgvb6_47",qs="_hidden_fgvb6_53",Ws="_text_fgvb6_73",Xs="_selected_fgvb6_79",Zs="_content_fgvb6_79",Qs="_root_fgvb6_82",ei="_edited_fgvb6_86",ti="_outline_fgvb6_89",ni="_collapse_fgvb6_99",oi="_disabled_fgvb6_145",si="_gps_fgvb6_156",ii="_fit_fgvb6_159",ai="_download_fgvb6_162",li="_prev_fgvb6_165",ci="_next_fgvb6_168",ri="_close_fgvb6_171";var x={container:Us,"svg-wrapper":"_svg-wrapper_fgvb6_1","asst-svg":"_asst-svg_fgvb6_12",svg:Ks,trigger:Js,dragging:Ys,"add-btn":"_add-btn_fgvb6_47",hidden:qs,"expand-btn":"_expand-btn_fgvb6_64",text:Ws,selected:Xs,content:Zs,root:Qs,edited:ei,outline:ti,collapse:ni,"button-list":"_button-list_fgvb6_103","right-bottom":"_right-bottom_fgvb6_106","right-top":"_right-top_fgvb6_110",disabled:oi,gps:si,fit:ii,download:ai,prev:li,next:ci,close:ri};const se=E(),Y=E(),ue=E(),He=E(),W=E(),H=E();function di(){const t=this.querySelector(`g.${x["add-btn"]}`);t&&(t.style.opacity="1")}function ui(){const t=this.querySelector(`g.${x["add-btn"]}`);t&&(t.style.opacity="0")}const hi=t=>{const{g:e}=z;!e||(Oe.value=t.transform,e.attr("transform",t.transform.toString()))},Vt=(t,e)=>{console.log("onSelect"),t.stopPropagation(),pe(e)};function Ze(t,e){var s,i;const o=(s=this.parentNode)==null?void 0:s.parentNode,{foreign:n}=z;if(sn&&n&&H.value){o.classList.add(x.edited),D.emit("edit-flag",!1),n.attr("x",e.x-2-(e.left?e.width:0)).attr("y",e.y-T.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const a=H.value;a.textContent=e.name,a.focus(),(i=getSelection())==null||i.selectAllChildren(a);const l=o.querySelector(`:scope > .${x.content}`);l&&gn(l)}}const pi=()=>{var t;if(console.log("onEditBlur"),(t=document.getElementsByClassName(x.edited)[0])==null||t.classList.remove(x.edited,x.selected),W.value&&H.value){W.value.style.display="none";const e=W.value.getAttribute("data-id"),o=W.value.getAttribute("data-name"),n=H.value.textContent;e&&n!==null&&n!==o&&$n(e,n)}},gi=()=>{if(console.log("onEditUpdate"),W.value&&H.value){const t=W.value.getAttribute("data-id"),e=W.value.getAttribute("data-name"),o=H.value.textContent;t&&o!==null&&o!==e&&$n(t,o,!0)}},at=t=>{if(t.preventDefault(),!se.value)return;const e=Ni(se.value,t);Jt.value=e;const n=t.composedPath().find(s=>{var i;return(i=s.classList)==null?void 0:i.contains("node")});if(n){const{classList:s}=n,i=s.contains(x.root),a=s.contains(x.collapse);s.contains(x.selected)||pe(n),Wt.value.disabled=i,en.value.disabled=i,tn.value.disabled=i,Zt.value.disabled=i,Qt.value.disabled=i,Xt.value.disabled=i,qt.value.disabled=!a,Yt.value.disabled=a||s.contains("leaf"),Ke.value=!1}else Ke.value=!0;D.emit("showContextmenu",!0)},zt=t=>{var e,o;switch(t){case"zoomfit":Be();break;case"zoomin":dt(!0);break;case"zoomout":dt(!0);break;case"add":Ht(new MouseEvent("click"),J());break;case"delete":xt(J().id);break;case"delete-one":$a(J().id);break;case"collapse":ka(J().id);break;case"expand":En(J().id);break;case"add-sibling":{console.log("add-sibling");const n=J(),s=$t(n.id,"");s&&(Me(s),pe(s))}break;case"add-sibling-before":{const n=J(),s=$t(n.id,"",!0);s&&(Me(s),pe(s))}break;case"add-parent":{const n=J(),s=Ea(n.id,"");s&&(Me(s),pe(s))}break;case"cut":{const{id:n}=J(),s=(e=T.find(n))==null?void 0:e.rawData;s&&navigator.clipboard.writeText(JSON.stringify(s)),xt(n)}break;case"copy":{const n=J(),s=(o=T.find(n.id))==null?void 0:o.rawData;s&&navigator.clipboard.writeText(JSON.stringify(s))}break;case"paste":{const n=J();navigator.clipboard.readText().then(s=>{const i=zi(s)||{name:s};kn(n.id,i)})}break}},Ht=(t,e)=>{const o=kn(e.id,"");o&&(Me(o,t),pe(e))};function Me(t,e=new MouseEvent("click")){const{g:o}=z;if(!o)return;const s=o.selectAll(`g[data-id='${Re(t)}'] > g.${x.content} > g.${x.text}`).node();s&&(D.emit("edit-flag",!0),Ze.call(s,e,t))}const mi=(t,e)=>{En(e.id)};function fi(t,e){var c;const o=(c=this.parentNode)==null?void 0:c.parentNode;Y.value&&Y.value.classList.add(x.dragging);const{g:n}=z;if(!n)return;pn(o,e,[t.x-e.x,t.y-e.y]);const s=Fn(t,ue.value);s[1]+=T.data.y;const i=n.selectAll("g.node").filter(r=>{if(r!==e&&r!==e.parent&&!r.id.startsWith(e.id)){let d=K,h=r.width+K;r.left&&r.depth!==0&&([d,h]=[h,d]);const u={x0:r.x-d,x1:r.x+h,y0:r.y-K,y1:r.y+r.height+K};return s[0]>u.x0&&s[1]>u.y0&&s[0]<u.x1&&s[1]<u.y1}return!1}),a=Array.from(document.getElementsByClassName(x.outline)),l=i.node();a.forEach(r=>{r!==l&&r.classList.remove(x.outline)}),l==null||l.classList.add(x.outline)}function _i(t,e){var u;const o=(u=this.parentNode)==null?void 0:u.parentNode;Y.value&&Y.value.classList.remove(x.dragging);const n=document.getElementsByClassName(x.outline)[0];if(n){n.classList.remove(x.outline);const p=n.getAttribute("data-id");if(p)e.px=0,e.py=0,xa(p,e.id);else throw new Error("outline data-id null");return}const s=e.x-T.getRootWidth()/2,i=e.depth===1&&s*(s+e.px)<0,a=i?p=>p.left!==e.left:p=>p.left===e.left,l=o.parentNode;let c=i?{y:1/0,id:e.id}:e,r=i?{y:-1/0,id:e.id}:e;const d=oe(l).selectAll(`g.${tt(e).join(".")}`).filter(p=>p!==e&&a(p)),h=e.y+e.py;d.each(p=>{(i||p.y>e.y)&&p.y<h&&p.y>r.y&&(r=p),(i||p.y<e.y)&&p.y>h&&p.y<c.y&&(c=p)}),c.id!==e.id?(e.px=0,e.py=0,yt(e.id,c.id)):r.id!==e.id?(e.px=0,e.py=0,yt(e.id,r.id,1)):i?(e.px=0,e.py=0,Ca(e.id)):pn(o,e,[0,0],500)}const lt=t=>{const{svg:e}=z;!e||(t?(Ee(e),e.on("dblclick.zoom",null)):e.on(".zoom",null))},vi=t=>{const{g:e}=z;if(!H.value||!e)return;const o=e.selectAll(`g.${x.text}`);t?o.on("click",Ze):o.on("click",null)},bi=t=>{const{g:e}=z;if(!e)return;const o=e.selectAll(`g.${x.text}`);t?o.on("mousedown",Vt):o.on("mousedown",null)},ct=t=>{!se.value||(t?se.value.addEventListener("contextmenu",at):se.value.removeEventListener("contextmenu",at))},wi=t=>{const{g:e}=z;if(!e)return;const o=e.selectAll(`g.node:not(.${x.root}) > g > g.${x.text}`);t?ln(o):o.on(".drag",null)};let Gt,Qe,Ut,Kt;D.on("selection-svg",t=>Gt=t);D.on("selection-g",t=>Qe=t);D.on("selection-asstSvg",t=>Ut=t);D.on("selection-foreign",t=>Kt=t);const Ke=E(!0),Jt=E({left:0,top:0}),Yt=E({name:"collapse",disabled:!0}),qt=E({name:"expand",disabled:!0}),Wt=E({name:"delete",disabled:!1}),yi=E({name:"add",disabled:!1}),Xt=E({name:"add-parent",disabled:!1}),Zt=E({name:"add-sibling",disabled:!1}),Qt=E({name:"add-sibling-before",disabled:!0}),en=E({name:"cut",disabled:!1}),xi=E({name:"copy",disabled:!1}),$i=E({name:"paste",disabled:!1}),tn=E({name:"delete-one",disabled:!1}),ki=ee(()=>[[yi.value,Xt.value,Zt.value,Qt.value],[en.value,xi.value,$i.value,Wt.value,tn.value],[{name:"selectall",disabled:!0}],[Yt.value,qt.value]].filter((t,e)=>e===0||e===1?ce.value.edit:!0)),Ei=ee(()=>[[{name:"zoomin",disabled:Oe.value.k>=fe[1]},{name:"zoomout",disabled:Oe.value.k<=fe[0]},{name:"zoomfit",disabled:!1}],[{name:"selectall",disabled:!0}]]),Ci=ee(()=>Ke.value?Ei.value:ki.value),nn=Rn().source(t=>t.source).target(t=>t.target),Si=Pn().curve(Vn),Mi=({source:t,target:e})=>Si([t,e]);let De=!1,on=nn;const Te=E(!1);D.on("sharp_corner",t=>{De!==t&&(Te.value=!0),De=!!t,on=t?Mi:nn});let je=4;D.on("branch",t=>je=t||je);let fe=[.1,8];D.on("scale-extent",t=>fe=t||fe);let sn=!1;D.on("edit-flag",t=>sn=!!t);const Bi=6,de=10;let he=18,we=84,K=Math.min(he/2-1,de);D.on("gap",t=>{!t||(we=t.xGap,he=t.yGap,K=Math.min(he/2-1,de),K=Math.min(we/2-1,K))});const Li=new ResizeObserver(t=>{const{foreign:e}=z;if(!e)return;const o=t[0],n=o.target,{width:s,height:i}=o.contentRect,a=parseInt(getComputedStyle(n).paddingLeft||"0",10),l=parseInt(getComputedStyle(n.parentNode).borderTopWidth||"0",10),c=(a+l)*2;e.attr("width",s+c).attr("height",i+c),e.style("display")!=="none"&&gn(n)}),_e={side:12,padding:2,margin:8},an=_e.side+_e.padding*2,le={width:16,height:4,radius:2},Oe=E(Dt),Ee=zn().on("zoom",hi).scaleExtent(fe),ln=Hn().container(Ai).on("drag",fi).on("end",_i),$e=E(!1);let cn;D.on("mindmap-context",t=>t?cn=t:null);const ce=E({drag:!1,edit:!1});class Di{constructor(e=20){this.length=e,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(e){const o=be.exports.cloneDeep(e);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(o),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,be.exports.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,be.exports.cloneDeep(this.snapshots[this.cursor])):null}}const ke=new Di,rn=E(!1),dn=E(!1),Ti=()=>{rn.value=ke.hasPrev,dn.value=ke.hasNext},ji=(t,e)=>{const o=-e/2,n=-t/2,s=t/2,i=e/2;return`M${i},${s}H${s}V${i}H${n}V${s}H${o}V${n}H${n}V${o}H${s}V${n}H${i}V${s}Z`},un=t=>{const e=t.split(`
`);return e.length>1&&e[e.length-1]===""&&e.pop(),e},Oi=(t,e)=>{Un(t).then(o=>{const n=o.toDataURL(),s=open();s&&(s.document.write(`<img src='${n}'>`),s.document.title=e,s.document.close())})},hn=(t,e)=>Gn().duration(t).ease(e),Ni=(t,e)=>{const{pageX:o,pageY:n}=e,s=t.getBoundingClientRect(),i=s.left+window.pageXOffset,a=s.top+window.pageYOffset;return{left:o-i,top:n-a}};function Ai(){var t,e;return(e=(t=this.parentNode)==null?void 0:t.parentNode)==null?void 0:e.parentNode}function pe(t){const e=t instanceof SVGGElement?t:document.querySelector(`g[data-id='${Re(t)}']`),o=document.getElementsByClassName(x.selected)[0];if(e)o?o!==e?(o.classList.remove(x.selected),e.classList.add(x.selected)):D.emit("edit-flag",!0):e.classList.add(x.selected);else throw new Error("selectGNode failed")}function J(){return console.log("getSelectedGData"),oe(`.${x.selected}`).data()[0]}const rt=t=>{const{asstSvg:e}=z;if(!e)throw new Error("asstSvg undefined");const o=un(t),n=e.append("text");n.selectAll("tspan").data(o).enter().append("tspan").text(i=>i).attr("x",0);const s=n.node().getBBox();return n.remove(),{width:Math.max(s.width,22),height:Math.max(s.height,22)*o.length}},pn=(t,e,o,n=0)=>{const s=hn(n,Tt);e.px=o[0],e.py=o[1],oe(t).transition(s).attr("transform",mn),oe(`g[data-id='${Re(e)}'] > path`).transition(s).attr("d",i=>Ne(i))},Ii=()=>{const{svg:t}=z;if(!t)return;const e=T.data;Ee.translateTo(t,0+e.width/2,0+e.height/2)},Be=()=>{const{svg:t}=z;if(!t||!ue.value||!Y.value)return;const e=ue.value.getBBox(),o=Y.value.getBoundingClientRect(),n=Math.min(o.width/e.width,o.height/e.height),s={x:o.width/2,y:o.height/2},i={x:e.width*n/2,y:e.height*n/2},a=Dt.translate(-e.x*n+s.x-i.x,-e.y*n+s.y-i.y).scale(n);Ee.transform(t,a)},gn=t=>{const{svg:e}=z;if(e&&Y.value){const{k:o}=Oe.value,n=t.getBoundingClientRect(),{x:s,y:i,width:a,height:l}=Y.value.getBoundingClientRect(),c=n.x-s,r=c+n.width,d=n.y-i,h=d+n.height,u=2;let p=0,m=0;c<0&&(p=-c/o+u),(n.width>a||r>a)&&(p=-(r-a)/o-u),d<0&&(m=-d/o+u),(n.height>l||h>l)&&(m=-(h-l)/o-u),Ee.translateBy(e,p,m)}},dt=t=>{const{svg:e}=z;!e||Ee.scaleBy(e,t?1.1:.9)},Fi=()=>{!se.value||Oi(se.value,T.data.name)},Ri=()=>{const t=ke.next();t&&(T.data=t,U(!1))},Pi=()=>{const t=ke.prev();t&&(T.data=t,U(!1))},Vi=()=>{console.log("bindForeignDiv:pre"),H.value&&(console.log("bindForeignDiv:enter"),Li.observe(H.value),H.value.addEventListener("blur",pi),H.value.addEventListener("mousedown",t=>t.stopPropagation()),H.value.addEventListener("keydown",t=>{const e=t.keyCode;e==13&&(console.log(`keydown=${e}`),gi(),setTimeout(()=>{zt("add-sibling")},250),t.stopPropagation())}))},zi=t=>{let e;try{return e=JSON.parse(t),"name"in e?e:!1}catch{return!1}},et=()=>3,tt=t=>{const e=["node"];return t&&e.push(`depth-${t.depth}`),e},Hi=t=>{const e=tt(t);return t&&(t.depth===0&&e.push(x.root),t.collapse?e.push(x.collapse):(!t.children||t.children.length===0)&&e.push("leaf")),e},Gi=t=>{const e=[x["add-btn"]];return t.collapse&&e.push(x.hidden),e},mn=t=>`translate(${t.dx+t.px},${t.dy+t.py})`,Re=t=>t.id,fn=t=>{const e=un(t.name),o=t.height/e.length;return e.map(n=>({name:n,height:o}))},Ne=t=>{let e=0,o=0;const n=Math.max(K-3,0);let s=t.width+n;const i=et();let a=i;const{parent:l}=t;l&&(e=l.width,o=l.height,l.depth===0&&(De||(e/=2),o/=2,a=0)),t.left&&(l&&(l.depth!==0?e=-e:De&&(e=0)),s=-s);const c=[-t.dx+e-t.px,-t.dy+o+a-t.py],r=[0,t.height+i];return`${on({source:c,target:r})}L${s},${r[1]}`},Ui=(t,e)=>{const o=t.depth===0?t.height/2:t.height+et();let n=t.width+e+an/2+_e.margin;return t.left&&(n=-n),`translate(${n},${o})`},Ki=(t,e)=>{const n=t.depth===0?t.height/2:t.height+et();let s=t.width+e+le.width/2+4;return t.left&&(s=-s),`translate(${s},${n})`},_n=(t,e,o,n,s)=>{t?(gt(e,de),ut(o,de,Bi),ht(n,de),s&&pt(s,de)):(gt(e,K),ut(o,K),ht(n,K),s&&pt(s,K))},vn=(t,e)=>{const o=t.attr("class",s=>Hi(s).join(" ")).attr("data-id",Re);(e?o.transition(e):o).attr("transform",mn)},bn=(t,e)=>{(e?t.transition(e):t).attr("transform",n=>`translate(${n.left?-n.width:0},0)`)},nt=t=>{t.attr("alignment-baseline","text-before-edge").text(e=>e.name||" ").attr("x",0).attr("dy",(e,o)=>o?e.height:0)},Ji=t=>{const{side:e,padding:o}=_e,n=4,s=-o-e/2,i=e+o*2;t.attr("x",s).attr("y",s).attr("rx",n).attr("ry",n).attr("width",i).attr("height",i)},Yi=t=>{t.attr("x",-le.width/2).attr("y",-le.height/2).attr("width",le.width).attr("height",le.height).attr("rx",le.radius).attr("ry",le.radius).attr("stroke",e=>e.color||"grey").attr("fill",e=>e.color||"grey")},Ge=(t,e)=>{t.attr("cx",e).attr("cy",0).attr("r",1)},ut=(t,e,o=4)=>{t.attr("x",n=>-e-(n.left?n.width:0)).attr("y",-e).attr("rx",o).attr("ry",o).attr("width",n=>n.width+e*2).attr("height",n=>n.height+e*2)},ht=(t,e)=>{t.attr("class",x["expand-btn"]).attr("transform",o=>Ki(o,e)).style("color",o=>o.color)},pt=(t,e)=>{t.attr("class",o=>Gi(o).join(" ")).attr("transform",o=>Ui(o,e))},gt=(t,e)=>{const o=an+_e.margin,n=e*2;t.attr("class",x.trigger).attr("x",s=>-e-(s.left?s.width+o:0)).attr("y",-e).attr("width",s=>s.width+n+o).attr("height",s=>s.height+n)},wn=(t,e)=>{const o=t.attr("stroke",n=>n.color).attr("stroke-width",je);if(e){const n=o.transition(e);Te.value?n.attrTween("d",qi):n.attr("d",Ne)}else o.attr("d",Ne)};function qi(t,e,o){const s=Ne(t),i=o[e],a=i.cloneNode(),l=i.getTotalLength();a.setAttribute("d",s);const c=a.getTotalLength(),r=[0],d=10/Math.max(l,c);let h=0;for(;(h+=d)<1;)r.push(h);r.push(1);const u=r.map(p=>{const m=i.getPointAtLength(p*l),y=a.getPointAtLength(p*c);return Kn([m.x,m.y],[y.x,y.y])});return p=>p<1?"M"+u.map(m=>m(p)).join("L"):s}const Wi=t=>{const e=t.append("tspan");return nt(e),e},Xi=t=>(nt(t),t),Zi=t=>{const e=t.append("g");return Ji(e.append("rect")),e.append("path").attr("d",ji(2,_e.side)),e},yn=t=>{const e=Zi(t);return e.on("click",Ht),e},Qi=t=>{const e=t.append("g");return Yi(e.append("rect")),Ge(e.append("circle"),-4),Ge(e.append("circle"),0),Ge(e.append("circle"),4),e},ea=(t,e)=>{t.stopPropagation(),console.log(`key=${t}`)},ta=(t,e)=>{if(t.select(`:scope > g.${x.content} > g.${x["expand-btn"]}`).on("click",mi),ce.value.drag||ce.value.edit){const n=t.select(`:scope > g.${x.content} > g.${x.text}`);n.on("mousedown",Vt),ce.value.drag&&!e&&ln(n),ce.value.edit&&n.on("click",Ze),n.on("keydown",ea)}$e.value&&t.select(`:scope > g.${x.content}`).on("mouseenter",di).on("mouseleave",ui)},na=t=>{var h;const e=!((h=t.data()[0])==null?void 0:h.depth),o=t.append("g");vn(o),wn(o.append("path"));const n=o.append("g").attr("class",x.content),s=n.append("rect"),i=n.append("g").attr("class",x.text),a=i.append("rect"),l=i.append("text");bn(l);const c=l.selectAll("tspan").data(fn).enter().append("tspan");nt(c);let r;$e.value&&(r=yn(n));const d=Qi(n);return _n(e,s,a,d,r),ta(o,e),o.each((u,p)=>{!u.children||ge(u.children,o.filter((m,y)=>p===y))}),n.raise(),o},oa=t=>{var d;const e=!((d=t.data()[0])==null?void 0:d.depth),o=hn(500,Tt);vn(t,o),wn(t.select(":scope > path"),o);const n=t.select(`:scope > g.${x.content}`),s=n.select(":scope > rect"),i=n.select(`g.${x.text}`),a=i.select("rect"),l=i.select("text");bn(l,o),l.selectAll("tspan").data(fn).join(Wi,Xi,h=>h.remove());let c=n.select(`g.${x["add-btn"]}`);const r=n.select(`g.${x["expand-btn"]}`);return $e.value?c.node()||(c=yn(n)):c.remove(),_n(e,s,a,r,c),t.each((h,u)=>{!h.children||ge(h.children,t.filter((p,m)=>u===m))}),n.raise(),t},ge=(t=[T.data],e=Qe)=>{e.selectAll(`g.${tt(t[0]).join(".")}`).data(t,n=>n.gKey).join(na,oa)};class sa{constructor(e,o,n,s){this.w=e,this.h=o,this.y=n,this.c=s,this.cs=s.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function mt(t){t.cs===0?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function ye(t){return t.y+t.h}class ia{constructor(e,o,n){this.lowY=e,this.index=o,this.next=n}}function ft(t,e,o){for(;o!==null&&t>=o.lowY;)o=o.next;return new ia(t,e,o)}function aa(t,e,o,n){if(o!==e-1){const s=e-o;t.c[o+1].shift+=n/s,t.c[e].shift-=n/s,t.c[e].change-=n-n/s}}function la(t,e,o,n){t.c[e].mod+=n,t.c[e].msel+=n,t.c[e].mser+=n,aa(t,e,o,n)}function ca(t){return t.cs===0?t.tl:t.c[0]}function ra(t){return t.cs===0?t.tr:t.c[t.cs-1]}function da(t,e,o,n){const s=t.c[0].el;s.tl=o;const i=n-o.mod-t.c[0].msel;s.mod+=i,s.prelim-=i,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}function ua(t,e,o,n){const s=t.c[e].er;s.tr=o;const i=n-o.mod-t.c[e].mser;s.mod+=i,s.prelim-=i,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}function ha(t,e,o){let n=t.c[e-1],s=n.mod,i=t.c[e],a=i.mod;for(;n!==null&&i!==null;){ye(n)>o.lowY&&(o=o.next);const l=s+n.prelim+n.w-(a+i.prelim);l>0&&(a+=l,la(t,e,o.index,l));const c=ye(n),r=ye(i);c<=r&&(n=ra(n),n!==null&&(s+=n.mod)),c>=r&&(i=ca(i),i!==null&&(a+=i.mod))}n===null&&i!==null?da(t,e,i,a):n!==null&&i===null&&ua(t,e,n,s)}function pa(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}function Je(t){if(t.cs===0){mt(t);return}Je(t.c[0]);let e=ft(ye(t.c[0].el),0,null);for(let o=1;o<t.cs;o++){Je(t.c[o]);const n=ye(t.c[o].er);ha(t,o,e),e=ft(n,o,e)}pa(t),mt(t)}function ga(t){let e=0,o=0;for(let n=0;n<t.cs;n++)e+=t.c[n].shift,o+=e+t.c[n].change,t.c[n].mod+=o}function xn(t,e){e+=t.mod,t.x=t.prelim+e,ga(t);for(let o=0;o<t.cs;o++)xn(t.c[o],e)}function ma(t){Je(t),xn(t,0)}class fa{constructor(e,o){this.gap=e,this.bottomPadding=o}addBoundingBox(e,o){return{width:e+this.gap,height:o+this.bottomPadding}}removeBoundingBox(e,o){return{x:e+this.gap/2,y:o}}}class _a{constructor(e){this.bb=e}layout(e){const o=this.convert(e);ma(o);const{boundingBox:n,result:s}=this.assignLayout(o,e);return{result:s,boundingBox:n}}convert(e,o=0){const{width:n,height:s}=this.bb.addBoundingBox(e.width,e.height),i=[];if(e.children&&e.children.length)for(let a=0;a<e.children.length;a++)i[a]=this.convert(e.children[a],o+s);return new sa(n,s,o,i)}assignCoordinates(e,o){const{x:n,y:s}=this.bb.removeBoundingBox(e.x,e.y);o.x=n,o.y=s;for(let i=0;i<e.c.length;i++)this.assignCoordinates(e.c[i],o.children[i])}getSize(e,o){const{x:n,y:s,width:i,height:a}=e;if(o||(o={left:n,right:n+i,top:s,bottom:s+a}),o.left=Math.min(o.left,n),o.right=Math.max(o.right,n+i),o.top=Math.min(o.top,s),o.bottom=Math.max(o.bottom,s+a),e.children)for(const l of e.children)this.getSize(l,o);return o}assignLayout(e,o,n){const{x:s,y:i}=this.bb.removeBoundingBox(e.x,e.y);o.x=s,o.y=i;const{width:a,height:l}=o;n||(n={left:s,right:s+a,top:i,bottom:i+l}),n.left=Math.min(n.left,s),n.right=Math.max(n.right,s+a),n.top=Math.min(n.top,i),n.bottom=Math.max(n.bottom,i+l);for(let c=0;c<e.c.length;c++)this.assignLayout(e.c[c],o.children[c],n);return{result:o,boundingBox:n}}}const _t=t=>[t.width,t.height]=[t.height,t.width],va=t=>{t.parent?(t.dx=t.x-t.parent.x,t.dy=t.y-t.parent.y):(t.dx=0,t.dy=0)},ae=(t,e)=>t.id=e,ba=t=>{t.parent?t.depth=t.parent.depth+1:t.depth=0},vt=t=>{t.parent&&t.parent.color&&(t.color=t.parent.color)},wa=t=>{t.depth>1&&t.parent&&(t.left=t.parent.left)},ya=t=>{const e=Object.assign({},t),o=Object.assign({},t);if(!t.collapse){const{children:n}=t;e.children=[],o.children=[],n.forEach(s=>{s.left?e.children.push(s):o.children.push(s),s.parent&&(s.parent=o)})}return{left:e,right:o}},Ye=(t,e,o="0")=>{var s;e.forEach(i=>{i(t,o)});const{children:n}=t;if(n)for(let i=0;i<n.length;){const a=n[i];a.id==="del"?(n.splice(i,1),(s=t.rawData.children)==null||s.splice(i,1)):(Ye(a,e,`${o}-${i}`),i+=1)}},bt=(t,e)=>{const o=new fa(e,t);return new _a(o)};class wt{constructor(e,o,n,s,i=Jn(Yn)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.colorScale=i,this.getSize=s,this.layout=bt(o,n),this.data=this.createMdataFromData(e,"0"),this.renew()}createMdataFromData(e,o,n=null){const{name:s,collapse:i,children:a}=e,{width:l,height:c}=this.getSize(s),r=n?n.depth+1:0;let d=!1,h=n?n.color:"";r===1?(d=!!e.left,h=this.colorScale(`${this.colorNumber+=1}`)):r!==0&&n&&(d=n.left);const u={id:o,name:s,rawData:e,parent:n,left:d,color:h,depth:r,x:0,y:0,dx:0,dy:0,px:0,py:0,width:l,height:c,children:[],_children:[],collapse:!!i,gKey:this.gKey+=1};return a&&(u.collapse?a.forEach((p,m)=>{u._children.push(this.createMdataFromData(p,`${o}-${m}`,u))}):a.forEach((p,m)=>{u.children.push(this.createMdataFromData(p,`${o}-${m}`,u))})),u}renew(...e){Ye(this.data,[_t,ba,wa]),this.data=this.l(this.data);const o=[_t,this.renewXY.bind(this),va];Ye(this.data,o.concat(e))}l(e){const{left:o,right:n}=ya(e);return this.layout.layout(o),this.layout.layout(n),this.diffY=n.x-o.x,this.rootWidth=o.height,n.children=e.children,n}renewXY(e){[e.x,e.y]=[e.y,e.x],e.left&&(e.x=-e.x+this.rootWidth,e.y+=this.diffY)}getRootWidth(){return this.rootWidth}setBoundingBox(e,o){this.layout=bt(e,o),this.renew()}find(e){const o=e.split("-").map(s=>~~s);let n=this.data;for(let s=1;s<o.length;s++){const i=o[s],{children:a}=n;if(i<a.length)n=a[i];else return null}return n.id===e?n:null}rename(e,o){if(e.length>0){const n=this.find(e);if(n&&n.name!==o){n.name=o,n.rawData.name=o;const s=this.getSize(n.name);n.width=s.width,n.height=s.height,this.renew()}return n}else return null}moveChild(e,o){var a,l;if(e===o)return null;const n=this.find(e),s=this.find(o),i=o.split("-").pop();if(i&&n&&s){const c=s.parent;(a=c==null?void 0:c.children)==null||a.splice(~~i,1),(l=c==null?void 0:c.rawData.children)==null||l.splice(~~i,1),s.parent=n,s.gKey=this.gKey+=1,s.depth=s.parent.depth+1,s.depth===1?s.color=this.colorScale(`${this.colorNumber+=1}`):s.left=s.parent.left,n.collapse?n._children.push(s):n.children.push(s),n.rawData.children?n.rawData.children.push(s.rawData):n.rawData.children=[s.rawData],this.renew(ae,vt)}return s}moveSibling(e,o,n=0){const s=e.split("-"),i=o.split("-");let a=s.pop(),l=i.pop();if(e===o||s.length!==i.length||!a||!l)return null;const c=this.find(e),r=this.find(o);if(r&&c&&c.parent){a=parseInt(a,10),l=parseInt(l,10),a<l&&(l-=1);const{children:d}=c.parent,{children:h}=c.parent.rawData;if(d&&h)return d.splice(a,1),d.splice(l+n,0,c),h.splice(a,1),h.splice(l+n,0,c.rawData),c.depth===1&&(c.left=r.left),this.renew(ae),c}return null}add(e,o){const n=this.find(e);if(n)if(n.collapse&&this.expand(e),n.rawData.children||(n.rawData.children=[]),typeof o=="string"){const s=o,i=this.getSize(s),a={name:s},l=n.color?n.color:this.colorScale(`${this.colorNumber+=1}`),c={id:`${n.id}-${n.children.length}`,name:s,rawData:a,parent:n,left:n.left,collapse:!1,color:l,gKey:this.gKey+=1,width:i.width,height:i.height,depth:n.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return n.children.push(c),n.rawData.children.push(a),this.renew(),c}else{const s=o,i=this.createMdataFromData(s,`${n.id}-${n.children.length}`,n);return n.children.push(i),n.rawData.children.push(s),this.renew(),i}return null}expand(e){return this.eoc(e,!1,[vt,ae])}collapse(e){return this.eoc(e,!0)}eoc(e,o,n=[]){const s=this.find(e);return s&&(s.collapse=o,s.rawData.collapse=o,[s._children,s.children]=[s.children,s._children],this.renew(...n)),s}delete(e){const o=this.find(e);if(o&&o.parent)o.id="del",this.renew(ae);else throw new Error(o?"\u6682\u4E0D\u652F\u6301\u5220\u9664\u6839\u8282\u70B9":"\u672A\u627E\u5230\u9700\u8981\u5220\u9664\u7684\u8282\u70B9")}deleteOne(e){var n;const o=this.find(e);if(o&&o.parent){const{parent:s,children:i,_children:a,collapse:l,rawData:c}=o,r=parseInt(e.split("-").pop(),10);s.children.splice(r,1,...l?a:i),(n=s.rawData.children)==null||n.splice(r,1,...c.children||[]),i.forEach(d=>{d.parent=s,d.depth===1&&(d.rawData.left=d.left)}),this.renew(ae)}}addSibling(e,o,n=!1){var i;const s=this.find(e);if(s&&s.parent){const a=parseInt(e.split("-").pop(),10),{parent:l,left:c}=s,r={name:o,left:c},d=this.getSize(o),h=n?a:a+1,u=l.color?l.color:this.colorScale(`${this.colorNumber+=1}`),p={name:o,parent:l,children:[],_children:[],color:u,collapse:!1,rawData:r,id:`${l.id}-${h}`,left:c,gKey:this.gKey+=1,depth:s.depth,width:d.width,height:d.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return l.children.splice(h,0,p),(i=l.rawData.children)==null||i.splice(h,0,r),this.renew(ae),p}return null}addParent(e,o){var s;const n=this.find(e);if(n&&n.parent){const{parent:i,left:a,color:l}=n,c=this.getSize(o),r=parseInt(n.id.split("-").pop(),10),d={name:o,children:[n.rawData],left:a};(s=i.rawData.children)==null||s.splice(r,1,d);const h={rawData:d,left:a,name:o,color:l,collapse:!1,parent:i,id:n.id,depth:n.depth,width:c.width,height:c.height,gKey:this.gKey+=1,children:[n],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return n.parent=h,i.children.splice(r,1,h),this.renew(ae),h}return null}changeLeft(e){const o=this.find(e);return o&&(o.left=!o.left,this.renew()),o}}let T;D.on("mmdata",t=>t?T=t:null);const U=(t=!0)=>{console.log("afterOperation"),t&&ke.snap(T.data),cn.emit("update:modelValue",qn([T.data.rawData])),Ti(),ge()},$n=(t,e,o=!1)=>{T.rename(t,e),o||U()},xa=(t,e)=>{T.moveChild(t,e),U()},yt=(t,e,o=0)=>{T.moveSibling(t,e,o),U()},kn=(t,e)=>{const o=T.add(t,e);return U(),o},xt=t=>{T.delete(t),U()},$a=t=>{T.deleteOne(t),U()},En=t=>{T.expand(t),U()},ka=t=>{T.collapse(t),U()},$t=(t,e,o=!1)=>{const n=T.addSibling(t,e,o);return U(),n},Ea=(t,e)=>{const o=T.addParent(t,e);return U(),o},Ca=t=>{T.changeLeft(t),U()};var Sa={translation:{contextmenu:{collapse:"\u6298\u53E0\u8282\u70B9",expand:"\u5C55\u5F00\u8282\u70B9",delete:"\u5220\u9664\u8282\u70B9","delete-one":"\u5220\u9664\u5355\u4E2A\u8282\u70B9",add:"\u65B0\u5EFA\u5B50\u8282\u70B9","add-parent":"\u65B0\u5EFA\u7236\u8282\u70B9","add-sibling":"\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9","add-sibling-before":"\u5728\u6B64\u4E4B\u524D\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9",cut:"\u526A\u5207",copy:"\u62F7\u8D1D",paste:"\u7C98\u8D34",selectall:"\u5168\u9009",zoomin:"\u653E\u5927",zoomout:"\u7F29\u5C0F",zoomfit:"\u7F29\u653E\u81F3\u5408\u9002\u5927\u5C0F"}}},Ma={translation:{contextmenu:{collapse:"collapse",expand:"expand",delete:"delete","delete-one":"delete a single node",add:"add child node","add-parent":"add parent node","add-sibling":"add sibling node","add-sibling-before":"add sibling node before",cut:"cut",copy:"copy",paste:"paste",selectall:"select all",zoomin:"zoom in",zoomout:"zoom out",zoomfit:"zoom fit"}}};Xe.init({fallbackLng:"zh",lng:"zh",resources:{zh:Sa,en:Ma}});const Ba="_container_wezgq_1",La="_menu_wezgq_1",Da="_disabled_wezgq_57";var Ta={container:Ba,menu:La,disabled:Da};const ja=A({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(t,e){const o=E(!1),n=Wn(),s=E(),i=E(),a=N({top:0,left:0}),l=8;D.on("showContextmenu",async d=>{if(!s.value||!i.value)return;o.value=!!d,await Xn();const{offsetWidth:h,offsetHeight:u}=s.value,{offsetWidth:p,offsetHeight:m}=i.value,{top:y,left:k}=t.position;a.top=y+m>u?u-m-l:y,a.left=k+p>h?k-p:k});const c=()=>o.value=!1;return{style:n,show:o,close:c,onClick:d=>{c(),e.emit("click-item",d)},menuEle:i,containerEle:s,pos:a,i18n:Xe}}}),Oa=["id"],Na=["onClick"];function Aa(t,e,o,n,s,i){return ne((f(),b("div",{class:P(t.style.container),ref:"containerEle"},[$("div",{onMousedown:e[0]||(e[0]=(...a)=>t.close&&t.close(...a))},null,32),$("div",{ref:"menuEle",id:t.style.menu,style:me({top:t.pos.top+"px",left:t.pos.left+"px"})},[(f(!0),b(G,null,q(t.groups,(a,l)=>(f(),b("ul",{key:l},[(f(!0),b(G,null,q(a,c=>(f(),b("li",{class:P(c.disabled?t.style.disabled:""),key:c.name,onClick:r=>t.onClick(c.name)},R(t.i18n.t(`contextmenu.${c.name}`)),11,Na))),128))]))),128))],12,Oa)],2)),[[Bt,t.show]])}const Cn={};Cn.$style=Ta;var Ia=F(ja,[["render",Aa],["__cssModules",Cn]]);const Fa=A({name:"Mindmap",components:{Contextmenu:Ia},props:{update:Boolean,modelValue:{type:Array,required:!0},xGap:{type:Number,default:we},yGap:{type:Number,default:he},branch:{type:Number,default:je,validator:t=>t>=1&&t<=6},scaleExtent:{type:Object,default:fe},sharpCorner:Boolean,centerBtn:Boolean,fitBtn:Boolean,downloadBtn:Boolean,timetravel:Boolean,addNodeBtn:Boolean,edit:Boolean,drag:Boolean,keyboard:Boolean,ctm:Boolean,zoom:Boolean,locale:{type:String,default:"zh"}},setup(t,e){Q(()=>Xe.changeLanguage(t.locale)),Q(()=>D.emit("scale-extent",t.scaleExtent)),Q(()=>D.emit("branch",t.branch)),Q(()=>D.emit("sharp-corner",t.sharpCorner)),Q(()=>D.emit("gap",{xGap:t.xGap,yGap:t.yGap})),Q(()=>D.emit("mindmap-context",e)),Q(()=>$e.value=t.edit&&t.addNodeBtn),Q(()=>ce.value.drag=t.drag),Q(()=>ce.value.edit=t.edit),X(()=>{if(!Y.value||!ue.value||!He.value||!W.value||!H.value)return;D.emit("selection-svg",oe(Y.value)),D.emit("selection-g",oe(ue.value)),D.emit("selection-asstSvg",oe(He.value)),D.emit("selection-foreign",oe(W.value)),D.emit("mmdata",new wt(be.exports.cloneDeep(t.modelValue[0]),we,he,rt)),Te.value=!1,U();const{svg:n,foreign:s}=z;s==null||s.raise(),Vi(),Be(),n==null||n.on("mousedown",()=>{console.log("mousedown");const i=document.getElementsByClassName(x.selected)[0];i==null||i.classList.remove(x.selected)}),n==null||n.on("keydown",o),lt(t.zoom),ct(t.ctm)});const o=n=>{console.log(`keydown - key=${n}`),n.keyCode};return j(()=>[t.update],n=>{D.emit("mmdata",new wt(be.exports.cloneDeep(t.modelValue[0]),we,he,rt)),ge(),Be()}),j(()=>[t.branch,$e.value,t.sharpCorner],()=>{ge(),Te.value=!1}),j(()=>[t.xGap,t.yGap],n=>{T.setBoundingBox(n[0],n[1]),ge()}),j(()=>[t.drag,t.edit],n=>{bi(n[0]||n[1]),wi(n[0]),vi(n[1])}),j(()=>t.zoom,n=>lt(n)),j(()=>t.ctm,n=>ct(n)),{wrapperEle:se,svgEle:Y,gEle:ue,style:x,asstSvgEle:He,foreignEle:W,foreignDivEle:H,centerView:Ii,fitView:Be,download:Fi,menu:Ci,contextmenuPos:Jt,onClickMenu:zt,next:Ri,prev:Pi,hasPrev:rn,hasNext:dn}}}),Ra=["id"],Pa={ref:"gEle"},Va={ref:"foreignEle",style:{display:"none"}},za={ref:"foreignDivEle",contenteditable:""};function Ha(t,e,o,n,s,i){const a=V("contextmenu");return f(),b("div",{class:P(t.style.container)},[$("div",{id:t.style["svg-wrapper"],ref:"wrapperEle"},[(f(),b("svg",{class:P(t.style.svg),ref:"svgEle"},[$("g",Pa,[(f(),b("foreignObject",Va,[$("div",za,null,512)],512))],512)],2))],8,Ra),(f(),b("svg",{ref:"asstSvgEle",class:P(t.style["asst-svg"])},null,2)),$("div",{class:P([t.style["button-list"],t.style["right-bottom"]])},[t.centerBtn?(f(),b("button",{key:0,onClick:e[0]||(e[0]=l=>t.centerView())},[$("i",{class:P(t.style.gps)},null,2)])):O("",!0),t.fitBtn?(f(),b("button",{key:1,onClick:e[1]||(e[1]=l=>t.fitView())},[$("i",{class:P(t.style.fit)},null,2)])):O("",!0),t.downloadBtn?(f(),b("button",{key:2,onClick:e[2]||(e[2]=l=>t.download())},[$("i",{class:P(t.style.download)},null,2)])):O("",!0)],2),t.timetravel?(f(),b("div",{key:0,class:P([t.style["button-list"],t.style["right-top"]])},[$("button",{onClick:e[3]||(e[3]=(...l)=>t.prev&&t.prev(...l)),class:P({[t.style.disabled]:!t.hasPrev})},[$("i",{class:P(t.style.prev)},null,2)],2),$("button",{onClick:e[4]||(e[4]=(...l)=>t.next&&t.next(...l)),class:P({[t.style.disabled]:!t.hasNext})},[$("i",{class:P(t.style.next)},null,2)],2)],2)):O("",!0),t.ctm?(f(),ie(a,{key:1,position:t.contextmenuPos,groups:t.menu,onClickItem:t.onClickMenu},null,8,["position","groups","onClickItem"])):O("",!0)],2)}var Ga=F(Fa,[["render",Ha]]);const ot=t=>(St("data-v-050f2fff"),t=t(),Mt(),t),Ua={class:"container"},Ka={class:"main"},Ja={key:1,class:"col-3",_class:"right-bottom"},Ya=ot(()=>$("label",{for:"language-select"},"Language",-1)),qa=ot(()=>$("option",{value:"zh"},"\u7B80\u4F53\u4E2D\u6587",-1)),Wa=ot(()=>$("option",{value:"en"},"English",-1)),Xa=[qa,Wa],Za=["name","onUpdate:modelValue","disabled"],Qa=["for"],el=["name","onUpdate:modelValue","min","max"],tl=["for"],nl=A({emits:["event_callback"],setup(t,{emit:e}){const{store_data:o}=Z(),{store_dlg:n}=Fe();qe();const s=Ae(),i=N({height:window.innerHeight,update:!1,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});X(()=>{console.log("[mounted]"),a(),window.addEventListener("resize",l),document.body.style.overflow="hidden"}),We(()=>{console.log("unmounted!"),window.removeEventListener("resize",l)});const a=()=>{const k=L=>{o.do_cmd("restore_file","")};console.log("init"),s.path.substring(1),s.fullPath,o.do_cmd("filter_menu",null),k(),l()},l=()=>{const k=window.innerHeight-34;console.log(`height=${k}`),o.update_height(k)},c=N({center_btn:{value:!0},fit_btn:{value:!0},timetravel:{value:!0},download_btn:{value:!0},add_node_btn:{value:!0},keyboard:{value:!1,disabled:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},sharp_corner:{value:!1},vertical:{value:!1,disabled:!0}}),r=N({branch:{value:4,min:1,max:6},x_gap:{value:84,min:0,max:100},y_gap:{value:18,min:0,max:100}}),d=E([{name:"\u30B9\u30BF\u30FC\u30C8",children:[]}]),h=E("en");j(()=>o.state.obj.content,(k,L)=>{console.log("[watch-body]"),u(k)});const u=k=>{if(console.log(k),k!="")try{d.value=JSON.parse(k)}catch(L){console.log(L),d.value=[{name:"\u30B9\u30BF\u30FC\u30C8",children:[]}]}i.update=!i.update},p=k=>{o.do_cmd("save_file",JSON.stringify(d.value))},m=async(k,L)=>{switch(console.log(`[event_callback] cmd=${k}, va0=${L}`),k){case"toggle_editor":p(d.value);break;case"filelist":document.querySelector(".col-3");const C=!i.toggle_list;i.toggle_list=C,console.log(i.toggle_list);break;default:if(k.indexOf("dlg_")!=-1){const _=Object.assign({},y(k,L));console.log(_),n.update_param(_)}else o.do_cmd(k,L);break}},y=(k,L)=>{const C=At[k],_=L!=null?L:o.state.filename;return C.init(C,_),C};return(k,L)=>(f(),b("div",Ua,[B(It,{ref:"appbar",onEvent_callback:m},null,512),B(Pt,{objParam:g(i).objDlgCmn,onEvent_callback:m},null,8,["objParam"]),$("div",Ka,[g(i).toggle_list?(f(),ie(Ft,{key:0,class:"col-3",onEvent_callback:m,style:{"{\n              height":"state.height + 'px'"}})):O("",!0),B(g(Ga),{class:"col-2",_class:"left-bottom",modelValue:d.value,"onUpdate:modelValue":L[0]||(L[0]=C=>d.value=C),update:g(i).update,branch:g(r).branch.value,"x-gap":g(r).x_gap.value,"y-gap":g(r).y_gap.value,zoom:g(c).zoom.value,"fit-btn":g(c).fit_btn.value,"center-btn":g(c).center_btn.value,"download-btn":g(c).download_btn.value,drag:g(c).drag.value,edit:g(c).edit.value,"add-node-btn":g(c).add_node_btn.value,"sharp-corner":g(c).sharp_corner.value,ctm:g(c).contextmenu.value,timetravel:g(c).timetravel.value,locale:h.value,style:{"{\n            height":"state.height + 'px'"}},null,8,["modelValue","update","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","ctm","timetravel","locale"]),g(i).toggle_list?(f(),b("div",Ja,[$("div",null,[Ya,ne($("select",{id:"language-select","onUpdate:modelValue":L[1]||(L[1]=C=>h.value=C)},Xa,512),[[Zn,h.value]])]),(f(!0),b(G,null,q(g(c),(C,_)=>(f(),b("div",{key:_},[ne($("input",{type:"checkbox",name:_.toString(),"onUpdate:modelValue":S=>C.value=S,disabled:C.disabled},null,8,Za),[[Lt,C.value]]),$("label",{for:_.toString()},R(_),9,Qa)]))),128)),(f(!0),b(G,null,q(g(r),(C,_)=>(f(),b("div",{key:_},[ne($("input",{type:"range",name:_,"onUpdate:modelValue":S=>C.value=S,min:C.min,max:C.max},null,8,el),[[Ue,C.value,void 0,{number:!0}]]),$("label",{for:_},R(_)+"\uFF08"+R(C.value)+"\uFF09",9,tl)]))),128))])):O("",!0)])]))}});var ol=F(nl,[["__scopeId","data-v-050f2fff"]]);const sl=[{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Gs},{name:"mindmap",path:"/mm/:pathMatch(.*)",component:ol},{name:"md",path:"/:pathMatch(.*)*",component:zs}],il=Qn({history:eo(),routes:sl});function al(t={}){const{immediate:e=!1,onNeedRefresh:o,onOfflineReady:n,onRegistered:s,onRegisterError:i}=t;let a;const l=async(c=!0)=>{};return"serviceWorker"in navigator&&(a=new to("./sw.js",{scope:"./"}),a.addEventListener("activated",c=>{c.isUpdate?window.location.reload():n==null||n()}),a.register({immediate:e}).then(c=>{s==null||s(c)}).catch(c=>{i==null||i(c)})),l}al();no.add(oo);so(xo).use(il).component("fa",io).mount("#app");
