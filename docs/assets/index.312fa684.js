var e=Object.defineProperty,t=(t,o,n)=>(((t,o,n)=>{o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n})(t,"symbol"!=typeof o?o+"":o,n),n);import{D as o,a as n,r as i,g as s,u as a,b as l,i as c,p as r,c as d,d as u,e as m,f as h,h as g,o as p,j as _,k as v,l as b,m as f,n as w,F as k,q as y,s as x,t as $,v as E,w as C,x as S,y as M,z as j,A as O,B as T,C as L,E as N,G as D,H as A,I,J as R,K as B,L as F,R as H,M as J,N as V,O as P,P as q,T as U,Q as K,S as Y,U as G,V as W,W as z,_ as X,X as Q,Y as Z}from"./vendor.051bbebb.js";class ee{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(e,t="",o=[],n=!1){""!=t&&(this.path=t),o!=[]&&(this.tags=o),this.content=e;const i=this.get_time();this.atime=i,1==n&&(this.ctime=i)}set_default(e){this.path=e,this.content="",this.tags=[];const t=this.get_time();this.atime=t,this.ctime=t}copy(e){Object.assign(this,e)}duplicate(e,t=""){const o=new ee;return o.copy(this),o.content=e,o.path=t,o.update_contentEx(),o.update_time(),o}update_content(e){null!=e&&(this.content=e),this.update_contentEx()}update_contentEx(){this.atime=this.get_time(),this.tags=this.build_tag(this.content)}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const t=e=>`00${e}`.slice(-2);return`${e.getFullYear()}/${t(e.getMonth()+1)}/${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`}update_time(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){console.log("[build_tag]");const t=[],o=[0,0,0,0,0],n=e.split(/\r\n|\n|\r/);for(let i=0;i<n.length;i++){if(-1!=n[i].search(/^\s*#/)){const e=n[i].split(" "),s=e[0].length;e.shift();const a=e.join(" ");t.push({text:a,line:i,tag:s,num:o[s]}),o[s]++}}return t}split(e){const t=[],o=this.content.split(/\r\n|\n|\r/),n=this.tags.filter((function(t){return t.tag==e})),i=[],s=o.length;for(var a=0;a<n.length;a++){const e=n[a].line;i.push({start:e,end:s,title:n[a].text}),0!=a&&(i[a-1].end=e-1)}const l=this.path.replace(".","_");return i.reverse(),i.forEach((e=>{const n=o.splice(e.start,e.end).join("\r\n"),i=this.duplicate(n,`${l}/${e.title}`);t.push(i)})),t.reverse(),t}}class te extends o{constructor(){super("OdenDB"),this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class oe{constructor(e){this.db=new te,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async e=>{const t=await this.dbx.get(e);return null!=t?t.data:null},this.write=async(e,t)=>{const o=JSON.stringify(t);await this.dbx.put({key:e,data:o,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async e=>{await this.dbx.delete(e),this.set_time_DB()},this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach((t=>{e[t.key]=t.data})),this.atime=this.get_time_DB(),e}async sync_DB(){0==this.check_async_DB()&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return null!=(e=localStorage.getItem("update_DB_time"))?e:""}}class ne{constructor(e){this.write=(e,t)=>this.storeLS.write(e,t),this.delete=e=>this.storeLS.delete(e),this.rename=async(e,t)=>{console.log(`[rename] _key_org=${e}, _key_new=${t}`);const o=this.as(await this.get(e));return o.path=t,await this.write(t,o),await this.delete(e),o},this.split=async e=>{console.log(`[split] _key_org=${e}`);const t=this.as(await this.get(e)).split(1);return t.forEach((e=>{this.write(e.path,e)})),t},this.merge=(e,t)=>{console.log(`[merge] _path=${e}`);const o=new ee;return o.set_default(e),o.update_content(t),this.write(e,o),o},this.as=e=>Object.assign(new ee,e),this.sync_DB=()=>this.storeLS.sync_DB(),this._=e,this.storeLS=new oe(this._)}async get(e){console.log(`[get] _key=${e}`);const t=await this.read(e);return null!=t?JSON.parse(t):this.create(e)}async exist(e){console.log(`[exist] _key=${e}`);return null!=await this.read(e)}async set(e,t){console.log(`[set] _key=${e}`);const o=this.as(await this.get(e));return""==o.path&&(o.path=e),o.update_content(t),this.write(e,o),o}async set_ex(e,t){console.log(`[set_ex] _key=${e}`);const o=this.as(t);return""==t.path&&(t.path=e),o.update_content(void 0),this.write(e,o),o}async read(e){return await this.storeLS.read(e)}create(e){console.log(`[create] _key=${e}`);const t=new ee;return null!=e&&(t.set_default(e),this.write(e,t)),t}}class ie{constructor(e){this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const t=await this._.mgrCache.getLstContent(e),o=this.buildMenu(t);return console.log(`${t.length}/${o.length}`),this._.contentEx.set("menu.json",JSON.stringify(o)),o}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),null!=e)return await this.rebuildMenu(e);{const e=await this._.contentEx.get("menu.json");return JSON.parse(e.content)}}buildMenu(e){return function(e){console.log("storeEx_index:buildMenuEx");const t=function(e){const t=new Set;return e.forEach((e=>{t.add(e.group)})),[...t]}(e);return e.reduce(((e,o)=>{if("menu.json"==o.path)return e;let n=o.group,i=o.title,s=`${n}/${i}`;return t.includes(s)&&(n=s,i=".index",s=`${n}/${i}`),e.push({key:s,group:n,title:i,path:o.path,atime:o.atime}),e}),[])}(e).sort(this.compare_group)}compare_group(e,t){let o=e.group,n=t.group;o==n&&(o=`${e.group}/${e.title}`,n=`${t.group}/${t.title}`);const i=o.toUpperCase(),s=n.toUpperCase();let a=0;return i>s?a=1:i<s&&(a=-1),a}}class se{static async read(e){console.log(`[read] filename=${e}`);const t=new URLSearchParams;return t.append("filename",e),se.post_cmdEx("load_file_md",t)}static write(e,t){console.log(`[write] filename=${e}`);const o=new URLSearchParams;return o.append("filename",e),o.append("source",t),se.post_cmdEx("save_file_md",o)}static async get_cmdEx(e){const t="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:get_cmdEx] api=${t}`),n.get(t).then((e=>e.data)).catch((e=>{throw e.response.status}))}static async post_cmdEx(e,t){const o="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:post_cmdEx] api=${o}`),n.post(o,t).then((e=>e.data)).catch((e=>{throw e.response.status}))}}class ae{constructor(e){this.backupEx=(e,t,o)=>{switch(console.log(`[backup] mode=${t}`),t){case"backup":(()=>{const t=new URLSearchParams;t.append("lstContent",JSON.stringify(e)),se.post_cmdEx("backup_contents",t).then((e=>console.log(e))).catch((e=>console.log(e)))})();break;case"export":(()=>{const t=new Blob([JSON.stringify(e)],{type:"text/plain"}),o=document.createElement("a");o.download=((e,t)=>{const o=new Date,n=e=>`00${e}`.slice(-2);return`${e}_${o.getFullYear()}${n(o.getMonth()+1)}${n(o.getDate())}_${n(o.getHours())}.${t}`})("lstData","json"),o.href=URL.createObjectURL(t),o.click(),URL.revokeObjectURL(o.href)})();break;case"cloud_save":!function(t){const o=new Blob([JSON.stringify(e)],{type:"application/oden"}),n=`${t}/dct_oden.json`;console.log(n);var l=i(s(),n);console.log(l),a(l,o)}(o)}},this._=e}async restoreEx(e,t,o){function n(e){e.forEach((e=>{const t=new ee;t.copy(e),t.update_contentEx(),t.update_time(),a.write(t.path,t)}))}console.log("[importExport:restore]");const a=this._.contentEx;return new Promise((function(a,c){switch(e){case"restore":!async function(e,t){se.get_cmdEx("restore_contents").then((t=>{n(t),e(t)})).catch((e=>{console.log(e),t(null)}))}(a,c);break;case"import":!async function(e,t,o){const i=new FileReader;i.onload=()=>{var e;console.log("onload");const o=null!=(e=i.result)?e:"",s=JSON.parse(o);n(s),t(s)},i.onerror=e=>{o("error")},i.readAsText(e)}(t,a,c);break;case"cloud_load":!async function(e,t,o,a){const c=`${a}/dct_oden.json`;console.log(c);var r=i(s(),c);const d=await l(r),u=await fetch(d);console.log(d);const m=await u.json();n(m),t(m)}(0,a,0,o)}}))}}class le{constructor(e){this.journal2=async(e,t)=>{console.log("[journal]");const o=await this.geolocation();return e.content+=((e,o)=>`\n## ${this._.contentEx.as(e).cnv_time(t)}\n${o}\n`)(e,o),e},this.geolocation=()=>new Promise((e=>{let t="";navigator.geolocation?navigator.geolocation.getCurrentPosition((o=>{t=`(Latitude,longitude)=(${o.coords.latitude},${o.coords.longitude})\n`,e(t)}),(o=>{switch(o.code){case 1:t="<li>位置情報の利用が許可されていません</li>";break;case 2:t="<li>デバイスの位置が判定できませんでした</li>";break;case 3:t="<li>タイムアウトが発生しました</li>"}e(t)})):(window.alert("<li>Geolocation APIが搭載されていないブラウザです。</li>"),e(t))})),this.chat=async(e,t,o)=>{console.log("[chat]");const n=e.content.indexOf("\n"),[i,s]=(e=>{const t=e=>`00${e}`.slice(-2);var o;return[`${e.getFullYear()}/${t(e.getMonth()+1)}/${t(e.getDate())}(${o=e.getDay(),["sun","mon","tue","wed","thu","fri","sat"][o]})`,`${t(e.getHours())}:${t(e.getMinutes())}`]})(new Date),a=o.isAddGeo?await this.geolocation()+"\n":"",l=(e.content.substring(0,n)!==(r=i)?`\n## ${r}\n`:"")+(c=s,`${o.isNoList?"":"- "}${o.isAddTime?`${c} : `:""}${t}\n${a}`);var c,r;return e.content=`${i}${e.content.substring(n)}${l}`,e},this._=e}async path_rename(e,t,o){console.log(`_from=${e}, _to=${t}`);const n=this.collect_filename_by_group(e,o);for(let i=0;i<n.length;i++){const e=n[i],o=`${e[1]}/${e[0]}`,s=`${t}${e[2]}/${e[0]}`;await this._.contentEx.rename(o,s)}}async path_delete(e,t){console.log(`_path=${e}`);const o=this.collect_filename_by_group(e,t);for(let n=0;n<o.length;n++){const e=o[n],t=`${e[1]}/${e[0]}`;await this._.contentEx.delete(t)}}async path_merge(e,t,o){console.log(`_path=${e}`);const n=[],i=this.collect_filename_by_group(e,o);for(let a=0;a<i.length;a++){const e=i[a],t=`${e[1]}/${e[0]}`,o=await this._.contentEx.get(t);n.push(o.content)}const s=n.join("\r\n");return this._.contentEx.merge(t,s)}collect_filename_by_group(e,t){console.log(`[collect_filename_by_group] group=${e}`);const o=[],n=0!=e.length?1:0;return t.forEach(((t,i)=>{if(t.group==e){const i=t.group.substring(e.length+n);o.push([t.title,t.group,0!=i.length?`/${i}`:""])}})),o}}class ce{constructor(e){this._=e}async getLstContent(e){console.log("[getLstContent]");const t=await this.buildLstContent();return null!=e?t.filter((t=>{const o=""==e.path||-1!=t.path.indexOf(e.path),n=""==e.keyword||-1!=t.content.toLowerCase().indexOf(e.keyword);return o&&n})):t}async buildLstContent(){var e;console.log("[buildLstContent]");const t=e=>{var t,o;let n=e.path;""!=n&&null!=n||(n=`@test/${(new Date).toLocaleString()}`);const i=n.split("/");return e.title=null!=(t=i.pop())?t:".",e.group=null!=(o=i.join("/"))?o:"@test",e.tags=[],e.htags=[],e},o=await this._.contentEx.storeLS.getStrageEx(),n=[];for(const s of Object.keys(o))try{n.push(t(JSON.parse(null!=(e=o[s])?e:"")))}catch(i){console.log(`@ error key=${s},e=${i} - other error`)}return n}}class re{constructor(){this.contentEx=new ne(this),this.mgrExchange=new ae(this),this.mgrEtc=new le(this),this.mgrMenu=new ie(this),this.mgrCache=new ce(this),console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,t){return this.contentEx.set(e,t)}async cmd_save_ex(e,t){return this.contentEx.set_ex(e,t)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_rename(e,t){await this.contentEx.rename(e,t)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,t="",o=null){const n=await this.mgrCache.getLstContent(o);this.mgrExchange.backupEx(n,e,t)}async cmd_restoreEx(e,t,o=""){await this.mgrExchange.restoreEx(e,t,o)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,t,o)}async cmd_path_delete(e){const t=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,t)}async cmd_path_merge(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,t,o)}async cmd_chat(e,t,o){const n=(()=>{const t=new Date;return`${e}${o.mode}_${t.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${n}`);const i=await this.contentEx.get(n),s=await this.mgrEtc.chat(i,t,o);return await this.contentEx.set(n,s.content),[s,n]}}class de{constructor(e){this.KEY="",console.log(e),this.KEY=e}get(e){var t;if(null!=localStorage.getItem(this.KEY)){const o=JSON.parse(null!=(t=localStorage.getItem(this.KEY))?t:"");e(o),console.log(o)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const ue=Symbol(),me=()=>{const e=d(),t=u(),o=m({storeEx:new re,persisted:new de("lifeLog-Viewer-params"),filename:"",obj:new ee,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),n=e=>{console.log(`[update_filename] : new=${e}`),e!=o.filename&&i(e)},i=async n=>{if(console.log(`[load_obj] : new=${n}`),""!=n){const e=await o.storeEx.cmd_load(n);s(e)}else a("");var i;i=n,-1==t.path.indexOf(i)&&(console.log(`_value=${i}`),e.push(`/${i}`)),o.persisted.set({filename:i}),o.filename=i},s=e=>{const t=e instanceof ee?e:Object.assign(new ee,e);t.update_contentEx(),o.tags=t.tags,o.obj=t},a=e=>{o.obj.content=e},l=e=>{o.dictMenu=e},c=()=>{setTimeout((async()=>{l(await o.storeEx.cmd_rebuild()),console.log("[auto_save] start"),o.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(o.intervalId_autoSave)),o.intervalId_autoSave=setTimeout((async()=>{console.log("[auto_save] execute"),await _("export",null,null),o.intervalId_autoSave=null}),1e4)}),250)},r=async(e,t)=>{const[i,a]=await o.storeEx.cmd_chat(o.path_expand,e,t);s(i),n(a),c()},h=async(e,t)=>{if(t==await o.storeEx.cmd_exist(e))return!0;{const o=t?`error : ${e} is not exist. please enter exist filename.`:`error : ${e} is already exist. please enter other filename.`;return console.log(o),!1}},g=async(e,t)=>{await h(e,!1)&&(await o.storeEx.cmd_rename(t,e),n(e),c())},p=async(e,t)=>{const i=v(t)[0],s=v(e)[0];await o.storeEx.cmd_path_rename(i,s),n(""),c()},_=async(t,i,d)=>{console.log(`[do_cmd] mode=${t}`);let u,m=""!=i?i:o.filename,_="";switch(t){case"update_jump":b=i,o.jump=b,-1!=b&&(console.log(`jump=${b}`),o.ObjTag=JSON.parse(JSON.stringify(o.tags[b])),console.log(JSON.stringify(o.ObjTag)));break;case"rebuild_menu":c();break;case"filter_menu":const t=i;null!=i&&(t.path=t.isUnderFolder?v(o.filename)[0]:""),l(await o.storeEx.cmd_getMenu(t));break;case"open_file":n(i);break;case"restore_file":console.log("restore_filename"),o.persisted.get((e=>{n(e.filename)}));break;case"save_file":await(async e=>{""!=e?(a(e),s(o.obj),await o.storeEx.cmd_save_ex(o.filename,o.obj),c()):console.log("skip save - empty data")})(i);break;case"new":await h(i,!1)&&(await o.storeEx.cmd_create(i),n(i),c());break;case"delete":await h(m,!0)&&(await o.storeEx.cmd_delete(m),n(""),c());break;case"rename":g(i,d);break;case"backup":o.storeEx.cmd_backup("backup");break;case"export":o.storeEx.cmd_backup("export");break;case"restore":await o.storeEx.cmd_restoreEx("restore",null),c();break;case"import":await o.storeEx.cmd_restoreEx("import",i),c();break;case"split":await h(m,!0)&&(await o.storeEx.cmd_split(m),c());break;case"path_rename":p(i,d);break;case"path_delete":_=v(i)[0],await o.storeEx.cmd_path_delete(_),n(""),c();break;case"path_merge":_=v(i)[0],m=`${_}.md`,await h(m,!1)&&(await o.storeEx.cmd_path_merge(_,m),n(m),c());break;case"print":const f=e.resolve({path:`/print/${o.filename}`});window.open(f.href,"_blank");break;case"journal":r("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":r(i,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":r(i,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":u={keyword:d.filter,isUnderFolder:d.isCheck,path:""},l(await o.storeEx.cmd_getMenu(u));break;case"update_position":await(async(e,t)=>{if(console.log(e),null!=t){const n=await o.storeEx.cmd_load(t);n.position=e,await o.storeEx.cmd_save_ex(t,n)}else o.obj.position=e})(i,d);break;case"move_archive":g(`@archive/${i}`,i);break;case"move_path_archive":p(`@archive/${i}`,i);break;case"export_archive":u={keyword:"",isUnderFolder:!0,path:"@archive/"},o.storeEx.cmd_backup("export","",u)}var b},v=e=>{const t=e.split("/"),o=t[t.length-1];return[t.slice(0,-1).join("/"),o]};return{store_data:{state:o,update_height:e=>{o.height=e},do_cmd:_}}},he=()=>c(ue),ge=Symbol(),pe=()=>{r(ge,(()=>{const e=m({objParam:null});return{store_dlg:{state:e,update_param:t=>{e.objParam=t}}}})())},_e=()=>c(ge);var ve=h({setup:e=>(r(ue,me()),pe(),(e,t)=>{const o=g("routerView");return p(),_(o)})});v("data-v-af6b6e1a");const be={key:0,class:"item"},fe={key:1,class:"line"},we={key:1,class:"folder"},ke={key:2,class:"dropdown"};b();var ye=h({props:{item:{type:null,required:!0}},emits:["event_callback"],setup(e,{emit:t}){const o=e,n=m({isOpen:!1,item:o.item,isFolder:o.item.children&&o.item.children.length,isActive:!0}),i=(e,o)=>{console.log(`[event_callback] cmd=${e}`),t("event_callback",e,o)};return(e,t)=>{const o=g("fa"),s=g("MenuTreeItem",!0);return p(),f("div",{class:"menu_tree",onClick:t[0]||(t[0]=e=>(e=>{if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const t=e.cmd;i(t,null)}})(w(n).item)),onContextmenu:t[1]||(t[1]=S((()=>{}),["right","prevent"]))},[w(n).isFolder?E("",!0):(p(),f(k,{key:0},[""!=w(n).item.title?(p(),f("span",be,[y(o,{icon:w(n).item.icon},null,8,["icon"]),x(" "+$(w(n).item.title),1)])):E("",!0),""==w(n).item.title?(p(),f("div",fe)):E("",!0)],64)),w(n).isFolder?(p(),f("span",we,[y(o,{icon:w(n).item.icon},null,8,["icon"]),x(" "+$(w(n).item.title),1)])):E("",!0),w(n).isFolder?(p(),f("div",ke,[(p(!0),f(k,null,C(w(n).item.children,((e,t)=>(p(),f("div",{key:t},[y(s,{item:e,onEvent_callback:i},null,8,["item"])])))),128))])):E("",!0)],32)}}});ye.__scopeId="data-v-af6b6e1a";var xe=h({props:{mouse:{type:null,required:!0},items:{type:Array,required:!0}},emits:["event_callback"],setup(e,{emit:t}){const o=e;console.log(`[props]=${JSON.stringify(o)}`);const n=m({items:o.items,pos_x:-1,pos_y:-1,isShow:!1,style:"display:none"});console.log(`[state]=${JSON.stringify(n)}`),M((()=>o.mouse),((e,t)=>{console.log("props"),n.isShow=!0,n.pos_x=o.mouse.clientX,n.pos_y=o.mouse.clientY,n.items=o.items,n.style="display:block"}));const i=(e,o)=>{console.log(`[event_callback] cmd=${e}`),t("event_callback",e,o)},s=e=>{n.style=e?"display:block":"display:none"};return(e,t)=>(p(),f("div",{class:"menu",style:j(w(n).style),onMouseover:t[0]||(t[0]=e=>s(!0)),onMouseleave:t[1]||(t[1]=e=>s(!1))},[(p(!0),f(k,null,C(w(n).items,(e=>(p(),f("div",{key:e.path},[y(ye,{item:e,onEvent_callback:i},null,8,["item"])])))),128))],36))}});xe.__scopeId="data-v-680ebf40";var $e=h({props:{objMenu:{type:Array,required:!0}},emits:["event_callback"],setup(e,{emit:t}){const o=m({items:e.objMenu,event:void 0}),n=(e,o)=>{console.log(`[event_callback] cmd=${e}`),t("event_callback",e,o)},i=e=>{console.log("onClick"),o.event=e};return(e,t)=>{const s=g("fa");return p(),f("div",{class:"dropdown",onClick:i},[y(s,{icon:"bars"}),y(xe,{mouse:w(o).event,items:w(o).items,onEvent_callback:n},null,8,["mouse","items"])])}}});$e.__scopeId="data-v-3a47341c";var Ee=h({emits:["event_callback"],props:{objMenuItem:{type:Array,default:[]}},setup(e,t){const o=m({items:[],items2:[],isShowDlg:!1});M((()=>e.objMenuItem),((e,t)=>{o.items=function(e){function t(e,t){const o=e.atime,n=t.atime;let i=0;return o>n?i=-1:o<n&&(i=1),i}console.log("[cnvLstRecent]");const o=[...e];return o.sort(t),o.slice(0,15)}(e),o.items2=o.items.slice(0,5)}));return{state:o,mouse_hover:function(e){o.isShowDlg=e},select_file:function(e){const n=o.items[e].path;t.emit("event_callback","open_file",n),o.isShowDlg=!1},tooltip:e=>`${e.title}/${e.group}`}}});v("data-v-4be6d922");const Ce={class:"base"},Se={key:0,class:"dropdown"},Me=["onClick"],je={class:"title_sub2"},Oe={class:"title"},Te={class:"title_sub"},Le={class:"base2"};b(),Ee.render=function(e,t,o,n,i,s){const a=g("fa"),l=g("button2");return p(),f("div",Ce,[O("span",{class:"_base",onMouseover:t[0]||(t[0]=t=>e.mouse_hover(!0)),onMouseleave:t[1]||(t[1]=t=>e.mouse_hover(!1))},[y(a,{icon:"history",class:"_item"}),e.state.isShowDlg?(p(),f("ul",Se,[(p(!0),f(k,null,C(e.state.items,((t,o)=>(p(),f("li",{class:"item",key:o,onClick:t=>e.select_file(o)},[y(a,{class:"title_item",icon:"file-alt"}),O("span",je,$(t.group)+"/ ",1),O("span",Oe,$(t.title),1),O("span",Te," ["+$(t.atime)+"]",1)],8,Me)))),128))])):E("",!0)],32),O("div",Le,[(p(!0),f(k,null,C(e.state.items2,((t,o)=>(p(),_(l,{class:"btn",key:o,onClick:t=>e.select_file(o)},{default:T((()=>[x($(t.title),1)])),_:2},1032,["onClick"])))),128))])])},Ee.__scopeId="data-v-4be6d922";const Ne=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],De=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],Ae=[{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],Ie={dlg_import:{init:(e,t)=>{e.title="Restore",e.isFileOpen=!0,e.isNoEdit=!0,e.edit=""},action:e=>["import"]},dlg_delete:{init:(e,t)=>{e.title="Delete",e.isReadOnly=!0,e.edit=t},action:e=>["delete",e.edit,""]},dlg_rename:{init:(e,t)=>{e.title="Rename",e.edit=t},action:e=>["rename",e.edit,e.edit_org]},dlg_new:{init:(e,t)=>{e.title="Create",e.edit=t.split("/").slice(0,-1).join("/")+"/*.md"},action:e=>["new",e.edit,""]},dlg_path_rename:{init:(e,t)=>{e.title="Rename of Path",e.edit=t.split("/").slice(0,-1).join("/")+"/"},action:e=>["path_rename",e.edit,e.edit_org]},dlg_path_delete:{init:(e,t)=>{e.title="Delete of Path",e.isReadOnly=!0,e.edit=t.split("/").slice(0,-1).join("/")+"/"},action:e=>["path_delete",e.edit,""]},dlg_path_merge:{init:(e,t)=>{e.title="Merge of Path",e.isReadOnly=!0,e.edit=t.split("/").slice(0,-1).join("/")+"/"},action:e=>["path_merge",e.edit,""]},dlg_tweet:{init:(e,t)=>{e.title="Tweet",e.edit=""},action:e=>["tweet",e.edit,""]},dlg_bookmark:{init:(e,t)=>{e.title="Bookmark",e.edit="",e.isMulti=!0},action:e=>["bookmark",e.edit,""]},dlg_filter:{init:(e,t)=>{e.title="Filter",e.title2="target under folder",e.edit="",e.edit_org="@",e.isCheck=!0},action:e=>(console.log("dlg_filter"),["filter",e.filename,{filter:e.edit,isCheck:e.check}])}};var Re=h({emits:["event_callback"],components:{MenuCmd:$e,MenuRecent2:Ee},setup(e,t){const{store_data:o}=he();_e();const n=L(null),i=m({filename:"@",objMenu:Ne,dctMenu:[]});N((()=>{console.log("[mounted]")}));M((()=>o.state.filename),((e,t)=>{console.log(`[watch:filename] ${e}`),a(e)})),M((()=>o.state.dictMenu),((e,t)=>{i.dctMenu=e})),M((()=>o.state.jump),((e,t)=>{window.setTimeout((()=>{s()}),500)}));const s=()=>{n.value.scrollIntoView({})},a=e=>{console.log(`[onChanged_filename] new=${e}`),i.filename=e,s()};return{state:i,doAction:e=>{console.log(`[doAction] cmd=${e}`),t.emit("event_callback",e,!0)},event_callback:(e,o)=>{if(console.log(`[event_callback] cmd=${e}`),"top"==e){n.value.scrollIntoView({})}else t.emit("event_callback",e,o)},appbar:n}}});v("data-v-6bf5fa8b");const Be={class:"nav"},Fe=["title"],He={class:"cmd"};b(),Re.render=function(e,t,o,n,i,s){const a=g("MenuCmd"),l=g("MenuRecent2"),c=g("fa");return p(),f("header",{class:"appbar",ref:"appbar",onClick:t[6]||(t[6]=t=>e.event_callback("top",!0))},[O("nav",Be,[y(a,{class:"item",objMenu:e.state.objMenu,onEvent_callback:e.event_callback,title:"menu"},null,8,["objMenu","onEvent_callback"]),O("section",{class:"item logo",onClick:t[0]||(t[0]=t=>e.event_callback("filelist",!0)),title:e.state.filename},"Oden",8,Fe),y(l,{class:"item",objMenuItem:e.state.dctMenu,onEvent_callback:e.event_callback,title:"history"},null,8,["objMenuItem","onEvent_callback"]),""!==e.state.filename?(p(),f("span",{key:0,class:"item name",onClick:t[1]||(t[1]=t=>e.event_callback("dlg_rename",null))}," ["+$(e.state.filename)+"] ",1)):E("",!0),O("span",{class:"item mark",onClick:t[2]||(t[2]=t=>e.doAction("toggle_editor")),title:"editor/viewer"},[y(c,{icon:"edit"})])]),O("span",He,[O("span",{class:"item",onClick:t[3]||(t[3]=t=>e.doAction("dlg_filter")),title:"filter"},[y(c,{icon:"paw"})]),O("span",{class:"item",onClick:t[4]||(t[4]=t=>e.doAction("dlg_tweet")),title:"tweet"},[y(c,{icon:"grimace"})]),O("span",{class:"item",onClick:t[5]||(t[5]=t=>e.doAction("dlg_bookmark")),title:"bookmark"},[y(c,{icon:"bookmark"})])])],512)},Re.__scopeId="data-v-6bf5fa8b",v("data-v-736aab12");const Je={class:"file_tree"},Ve=["onContextmenu"],Pe=["title"],qe={key:1,class:"folder"},Ue={key:0};b();var Ke=h({props:{item:{type:Object,required:!0}},emits:["event_callback"],setup(e,{emit:t}){const o=e,n=m({isOpen:!1,item:o.item,isFolder:o.item.children&&o.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:i}=he();M((()=>i.state.filename),((e,t)=>{c(e)}));const s=(e,o)=>{console.log(`[event_callback] cmd=${e}`),t("event_callback",e,o)},a=(e,o)=>{console.log(`[event_callbackEx] cmd=${e}`),t("event_callback",e,n.item.path)};N((()=>{c(i.state.filename)}));const l=e=>{console.log("onClickEx"),n.menu=n.isFolder?Ae:De,n.event=e},c=e=>{n.item.path;-1!=e.indexOf(n.item.name)&&(n.isOpen=!0),n.class_item=n.item.path==e?"item active":"item"};return(e,t)=>{const o=g("fa"),c=g("tree-item",!0);return p(),f("div",Je,[y(xe,{mouse:w(n).event,items:w(n).menu,onEvent_callback:a},null,8,["mouse","items"]),O("div",{onContextmenu:S(l,["prevent"]),onClick:t[0]||(t[0]=e=>(e=>{if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const t=e.path;console.log(`onClick-filename=${t}`),i.do_cmd("open_file",t)}})(w(n).item))},[w(n).isFolder?E("",!0):(p(),f("div",{key:0,class:D(w(n).class_item),title:w(n).item.time},$(w(n).item.name),11,Pe)),w(n).isFolder?(p(),f("div",qe,[y(o,{icon:w(n).isOpen?"folder-open":"folder"},null,8,["icon"]),x(" "+$(w(n).item.name),1)])):E("",!0)],40,Ve),w(n).isOpen?(p(),f("div",Ue,[(p(!0),f(k,null,C(w(n).item.children,((e,t)=>(p(),f("div",{key:t},[y(c,{item:e,onEvent_callback:s},null,8,["item"])])))),128))])):E("",!0)])}}});Ke.__scopeId="data-v-736aab12",v("data-v-1f034d00");const Ye={class:"tree"};b();var Ge=h({emits:["event_callback"],setup(e,{emit:t}){const o=m({items:void 0}),{store_data:n}=he();M((()=>n.state.dictMenu),((e,t)=>{s(e)}));const i=(e,o)=>{console.log(`[event_callback] cmd=${e}`),t("event_callback",e,o)};N((()=>{console.log("[mounted]"),s(n.state.dictMenu)}));const s=e=>{console.log("[onChanged_dictMenu]"),o.items=void 0;const t={name:"",children:[],path:"",file:"",time:""},n="/",i={[n]:t};e.forEach((function(e){e.key.split("/").reduce((function(t,o){if(t[o])return t[o];{const i={name:o,children:[],path:e.path,file:"md",time:e.atime};return t["/"].children.push(i),t["/"].file="",t[o]={[n]:i}}}),i)})),console.log(t),setTimeout((()=>{o.items=t.children}),500)};return(e,t)=>(p(),f("div",Ye,[(p(!0),f(k,null,C(w(o).items,(e=>(p(),f("div",{key:e.path},[y(Ke,{item:e,onEvent_callback:i},null,8,["item"])])))),128))]))}});Ge.__scopeId="data-v-1f034d00";var We=h({props:{level:{type:Number,required:!0}},setup:(e,t)=>({tag:A((()=>`h${e.level}`))})});v("data-v-1765be40");const ze=x(" # ");b(),We.render=function(e,t,o,n,i,s){return p(),f("div",null,[ze,(p(),_(I(e.tag),{class:"h_tag"},{default:T((()=>[R(e.$slots,"default",{},void 0,!0)])),_:3}))])},We.__scopeId="data-v-1765be40",v("data-v-1d58b53a");const Xe={class:"tag"},Qe=["onClick"],Ze=x(" @@ "),et=x(" @dispTitle(item) ");b();var tt=h({props:{level:{type:Number,required:!0}},emits:["event_callback"],setup(e,{emit:t}){const o=e,{store_data:n}=he();console.log(`[props]=${JSON.stringify(o)}`);const i=m({listTag:[]});return console.log(`[state]=${JSON.stringify(i)}`),M((()=>n.state.tags),((e,t)=>{console.log(e),i.listTag=e})),(e,t)=>(p(),f("div",Xe,[(p(!0),f(k,null,C(w(i).listTag,((e,t)=>(p(),f("div",{key:t,onClick:e=>{return o=t,void n.do_cmd("update_jump",o);var o},class:"item"},[Ze,y(We,{level:e.tag},{default:T((()=>[et])),_:2},1032,["level"])],8,Qe)))),128))]))}});tt.__scopeId="data-v-1d58b53a";var ot=h({emits:["event_callback"],setup:(e,t)=>({objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(e,o)=>{console.log(`cmd=${e}, name=${o}`),t.emit("event_callback",e,o)}})});v("data-v-2dca080d");const nt={class:"main",style:{_height:"100px"}},it=["onClick","title"];b(),ot.render=function(e,t,o,n,i,s){const a=g("fa");return p(),f("div",nt,[(p(!0),f(k,null,C(e.objToolbar,((t,o)=>(p(),f("button",{class:"btn-item",key:o,onClick:o=>e.event_callback("action",t.cmd),title:t.cmd},[y(a,{icon:t.icon},null,8,["icon"])],8,it)))),128))])},ot.__scopeId="data-v-2dca080d";const st={};class at{constructor(e,o){t(this,"cmdid",0),t(this,"monaco",null),t(this,"editor",null),console.log("[constructer]"),this.monaco=e,this.editor=o}add(e,t,o,n,i=null){let s;switch(n.length){case 0:s=this.generateCommand(e,i);break;case 1:s=this.generateHeaderCommand(n[0]);break;case 2:s=this.generateWrapperCommand(n[0],n[1])}st[e]=s,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:o,contextMenuGroupId:t&&"navigation",contextMenuOrder:t&&1.5,run:st[e]})}generateCommand(e,t){return(e,o)=>{t(e)}}generateWrapperCommand(e,t){const o=e.length+t.length;return this.editor,this.editor.getModel(),this.monaco,(n,i)=>{const s=n.getModel(),a=n.getSelections();if(null==a)return;const l=[];return a.forEach((n=>{l.push(new i.Selection(n.startLineNumber,n.startColumn,n.endLineNumber,n.endColumn+o)),s.pushEditOperations([],[{range:{startLineNumber:n.startLineNumber,startColumn:n.startColumn,endLineNumber:n.startLineNumber,endColumn:n.startColumn},text:e},{range:{startLineNumber:n.endLineNumber,startColumn:n.endColumn,endLineNumber:n.endLineNumber,endColumn:n.endColumn},text:t}])})),n.setSelections(l),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(t,o)=>{const n=t.getModel();let i=t.getSelections();return null==i&&(i=[t.getSelection()]),i.forEach((t=>{const o=n.findNextMatch("^(#+ )",{lineNumber:t.startLineNumber,column:1},!0,!1,null,!0);if(null!=o&&o.range.startLineNumber==t.startLineNumber&&1==o.range.startColumn){if(o.matches[1]==e)return;n.pushEditOperations([],[{range:{startLineNumber:t.startLineNumber,startColumn:1,endLineNumber:t.startLineNumber,endColumn:o.matches[1].length+1},text:""}])}n.pushEditOperations([],[{range:{startLineNumber:t.startLineNumber,startColumn:1,endLineNumber:t.startLineNumber,endColumn:1},text:e}])})),null}}}const lt={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1};var ct=h({emits:["event_callback"],components:{ToolbarEditor:ot},props:{isActive_preview:{type:Boolean,default:!1}},setup(e,t){const o=L(null),n={editor:void 0},{store_data:i}=he(),s=m({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});N((()=>{console.log("[mounted]"),l(),h(i.state.obj.content)})),M((()=>i.state.obj.content),((e,t)=>{console.log("[watch-body]"),""!=s.filename&&p(),h(e),_(i.state.obj.position,!0),s.filename=i.state.filename})),M((()=>i.state.ObjTag),((e,t)=>{console.log(`[watch](ObjTag)-${e}`),a(e)})),M((()=>e.isActive_preview),((e,t)=>{console.log(`[watch](editor_toggle)-${e}`),1==e&&g()}));const a=e=>{console.log(`[jump_cursor]ObjTag={${Object.values(e)}}`);const t=e.line;d(t),setTimeout((()=>{const e=n.editor;s.pos_scroll=e.getScrollTop()}),500)},l=()=>{n.editor=(()=>{const e=document.getElementById("container");if(console.log(`root=${e}`),null==e)return;const t=B.create(e,lt);return function(e,t){console.log("[setupShortcutKeys]");const o=new at(e,t);o.add("Bold","8_",[],["**","**"]),o.add("Italic","1_",[],["__","__"]),o.add("Underline","9_",[],["<u>","</u>"]),o.add("Strikethrough",!1,[e.KeyMod.CtrlCmd|e.KeyMod.Shift|e.KeyCode.KEY_S],["~~","~~"]),o.add("Code",!1,[],["`","`"]),o.add("Link",!1,[],["[","]()"]),o.add("Link-2",!1,[],["[](",")"]),o.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),o.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join("\n")]),o.add("Header 1",!1,[],["# ",""]),o.add("Header 2",!1,[],["## ",""]),o.add("Header 3",!1,[],["### ",""]),o.add("Header 4",!1,[],["#### ",""]),o.add("Header 5",!1,[],["##### ",""]),o.add("Header 6",!1,[],["###### ",""]),o.add("Check",!1,[],["- [ ] ",""]),o.add("Blockquotes",!1,[],["> ",""]),o.add("Today",!1,[],[`${(e=>{const t=e=>`00${e}`.slice(-2);return`${e.getFullYear()}/${t(e.getMonth()+1)}/${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`})(new Date)}`,""]),o.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join("\n"),""]),o.add("Format","8_",[],[],(e=>{console.log("format"),e.getAction("editor.action.formatDocument").run()}))}(F,t),console.log(`editor=${t}`),t.onDidScrollChange((e=>{s.scrollInfo.height=e.scrollHeight,s.scrollInfo.top=e.scrollTop})),t})(),c()},c=()=>{n.editor.onDidBlurEditorText((e=>{g()}))},r=e=>{console.log("[action]"),null!=st[e]&&st[e](n.editor,F)},d=e=>{const t=new H(e+1,0,e+1,0);console.log(`Line=${e}`),n.editor.revealRangeAtTop(t)},u=()=>n.editor.getModel().getAlternativeVersionId(),h=e=>{n.editor.setValue(e),s.iVersion=u()},g=()=>{const e=u();if(console.info(`iVersion=${s.iVersion}, iVersion_cur=${e}`),s.iVersion==e)return;p();const t=n.editor.getValue();i.do_cmd("save_file",t),s.iVersion=u(),console.info(`iVersion=${s.iVersion}`)},p=()=>{const e=n.editor,t={top:e.getScrollTop(),height:e.getScrollHeight(),contentHeight:e.getLayoutInfo().height,scrolled:s.pos_scroll!=e.getScrollTop()};return i.do_cmd("update_position",t,void 0),t},_=(e,t=!1)=>{if(null==e)return;console.log(`[e-set]value=${JSON.stringify(e)}`);const o=n.editor;if(!!t||e.scrolled){const t=e.top/e.height;console.log(`per=${t}`);const n=o.getScrollHeight();o.setScrollTop(n*t)}else a(i.state.ObjTag);setTimeout((()=>{s.pos_scroll=o.getScrollTop()}),500)};A((()=>n.editor.getScrollTop()));const v=A((()=>i.state.height-27+"px"));return{editorEx:n,event_callback:(e,t)=>{switch(console.log(`[event_callback] cmd=${e}`),e){case"action":r(t);break;case"save":g()}},HeightEx:v,md_editor_monaco:o,get_position:p,set_position:_}}});v("data-v-1dc20672");const rt={class:"editor"};b(),ct.render=function(e,t,o,n,i,s){const a=g("ToolbarEditor");return p(),f("div",rt,[y(a,{class:"toolbar",onEvent_callback:e.event_callback},null,8,["onEvent_callback"]),O("div",{id:"container",ref:"md_editor_monaco",class:"core",style:j({height:e.HeightEx})},null,4)])},ct.__scopeId="data-v-1dc20672";var dt=h({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(e,t){const o=L(null),{store_data:n}=he(),i=m({contentsPosition:[],tocMap:new Map,observer:null,elm_target_before:null,pos_scroll:-1,filename:""});function s(e){console.log(`[jump_cursor]ObjTag={${Object.values(e)}}`);const t=e.tag,n=e.num;e.line,((e,t)=>{console.log(`tag=${e}, num=${t}`);const n=o.value,i=n.querySelectorAll(".md_core_viewer > h"+e);0!=i.length&&(n.scrollTop=i[t].getBoundingClientRect().top-n.getBoundingClientRect().top+n.scrollTop)})(t,n),setTimeout((()=>{const e=o.value;i.pos_scroll=e.scrollTop}),0)}N((()=>{console.log("[created]"),function(){const e=new J.Renderer;e.link=function(e,t,o){return-1!=e.indexOf("http")?`<a target="_blank" href="${e}">${o}</a>`:`<a target="_blank" href="#${e}">${o}</a>`},J.setOptions({renderer:e,langPrefix:"",breaks:!0})}()})),M((()=>n.state.obj.content),((e,t)=>{console.log("[watch-body]"),o.value,""!=i.filename&&a(),setTimeout((()=>{!function(){const e=e=>{e.forEach((e=>{const t=i.tocMap.get(e.target);console.log(e.intersectionRatio),e.intersectionRatio?(null!=i.elm_target_before&&i.elm_target_before.classList.remove("active"),t.classList.add("active"),i.elm_target_before=null):i.elm_target_before=t}))},t={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},o=new IntersectionObserver(e,t),n=new Map,s=document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),a=document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5");console.log(`el_contents=${s.length}/${JSON.stringify(s)}`),console.log(`el_toc=${a.length}/${JSON.stringify(a)}`),s.forEach(((e,t)=>{o.observe(e),n.set(a.item(t),e),n.set(e,a.item(t))})),i.tocMap=n,i.observer=o}(),l(n.state.obj.position,!0),i.filename=n.state.filename}),0)})),M((()=>n.state.ObjTag),((e,t)=>{console.log(`[watch](ObjTag)-${e}`),s(e)})),M((()=>e.isActive_preview),((e,t)=>{console.log(`[watch](editor_toggle)-${e}`)})),A((()=>o.value.querySelector(".md_core_viewer")));const a=()=>{const e=o.value,t={top:e.scrollTop,height:e.scrollHeight,contentHeight:0,scrolled:i.pos_scroll!=e.scrollTop};return n.do_cmd("update_position",t,i.filename),t},l=(e,t=!1)=>{console.log(`[v-set]value=${JSON.stringify(e)}`);const a=o.value;if(null==e)return void(a.scrollTop=0);if(!!t||e.scrolled){const t=e.top/e.height;console.log(`per=${t}`),console.log(`scrollTop=${a.scrollTop}, scrollHeight=${a.scrollHeight}`),a.scrollTop=a.scrollHeight*t}else s(n.state.ObjTag);setTimeout((()=>{i.pos_scroll=a.scrollTop}),0)},c=A((()=>J.parse(n.state.obj.content))),r=A((()=>n.state.height+"px"));return{status:status,Markdown:c,HeightEx:r,md_viewer:o,get_position:a,set_position:l}}});v("data-v-05199a28");const ut=["innerHTML"];b(),dt.render=function(e,t,o,n,i,s){return p(),f("div",{class:"md_core_viewer note",innerHTML:e.Markdown,style:j({height:e.HeightEx}),ref:"md_viewer"},null,12,ut)},dt.__scopeId="data-v-05199a28";var mt=h({components:{MarkdownEditor:ct,MarkdownViewer:dt},props:{editor_toggle:{type:Boolean,default:!0}},setup(e,t){const o=L(),n=L(),i=m({isActive_preview:!0});M((()=>e.editor_toggle),((e,t)=>{console.log(`[watch](editor_toggle)-${e}`),a()})),N((()=>{console.log("[mounted]"),document.addEventListener("keydown",s)})),V((()=>{document.removeEventListener("keydown",s)}));const s=e=>83===e.keyCode&&e.ctrlKey?(e.preventDefault(),console.log("save"),void a()):69===e.keyCode&&e.ctrlKey?(e.preventDefault(),console.log("toggle"),void a()):void 0,a=()=>{var e;const t=i.isActive_preview?{now:o,next:n}:{now:n,next:o},s=null==(e=t.now.value)?void 0:e.get_position();console.log(`isActive_preview=${i.isActive_preview}, scrollIndo=${JSON.stringify(s)}`),i.isActive_preview=!i.isActive_preview,setTimeout((()=>{var e;null==(e=t.next.value)||e.set_position(s)}),500)};return{state:i,MdViewer:o,MdEditor:n}}});mt.render=function(e,t,o,n,i,s){const a=g("MarkdownViewer"),l=g("MarkdownEditor");return p(),f("div",null,[e.state.isActive_preview?(p(),_(a,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:e.state.isActive_preview},null,8,["isActive_preview"])):(p(),_(l,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:e.state.isActive_preview},null,8,["isActive_preview"]))])};var ht=h({emits:["event_callback"],setup(e,t){const{store_dlg:o}=_e(),{store_data:n}=he(),i=m({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});M((()=>o.state.objParam),(e=>{s(e)}));const s=e=>{const t=(e,t=!1)=>null!=e?e:t;console.log("[onChanged_objParam]"),i.title=e.title,i.title2=e.title2,i.edit=e.edit,i.edit_org=t(e.edit_org,e.edit),i.check=0,i.isShowDlg=!0,i.isNoEdit=t(e.isNoEdit),i.isFileOpen=t(e.isFileOpen),i.isReadOnly=t(e.isReadOnly),i.isCheck=t(e.isCheck),i.isMulti=t(e.isMulti),i.isDisabled=!0,i.action=e.action,l(!0)},a=e=>{if(console.log(`[doAction] flg=${e}, edit=${i.edit}`),e){const e=i.action(i);n.do_cmd(e[0],e[1],e[2])}i.isShowDlg=!1,l(!1)},l=e=>{1==e?document.addEventListener("keydown",c):document.removeEventListener("keydown",c)},c=e=>{if(27===e.keyCode)return e.preventDefault(),void a(!1)};return{state:i,props:e,doAction:a,onFileChange:e=>{const t=(e.target.files||e.dataTransfer.files)[0],o=i.action(i);n.do_cmd(o[0],t),i.isShowDlg=!1,l(!1)},isDisabled:()=>{const e=i.edit_org,t=i.edit==e&&!i.isReadOnly;return console.log(`[isDisabled]=${t}`),t}}}});v("data-v-2041bfb8");const gt={class:"modal-mask"},pt={class:"modal-wrapper"},_t={class:"modal-container"},vt={class:"header"},bt={ref:"form",class:"form"},ft=["disabled"],wt=["disabled"],kt={class:"modal-actions"},yt=["disabled"];b(),ht.render=function(e,t,o,n,i,s){const a=g("fa");return P((p(),_(U,{persistent:""},{default:T((()=>[O("div",gt,[O("div",pt,[O("div",_t,[O("div",vt,$(e.state.title)+"?",1),O("form",bt,[1==e.state.isFileOpen?(p(),f("input",{key:0,class:"input",type:"file",onChange:t[0]||(t[0]=(...t)=>e.onFileChange&&e.onFileChange(...t))},null,32)):E("",!0),0==e.state.isNoEdit?(p(),f(k,{key:1},[1==e.state.isMulti?P((p(),f("textarea",{key:0,class:"input",_autofocus:"","onUpdate:modelValue":t[1]||(t[1]=t=>e.state.edit=t),disabled:e.state.isReadOnly},null,8,ft)),[[K,e.state.edit]]):P((p(),f("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":t[2]||(t[2]=t=>e.state.edit=t),disabled:e.state.isReadOnly},null,8,wt)),[[K,e.state.edit]])],64)):E("",!0),1==e.state.isCheck?(p(),f(k,{key:2},[P(O("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=t=>e.state.check=t)},null,512),[[Y,e.state.check]]),x(" "+$(e.state.title2),1)],64)):E("",!0)],512),O("div",kt,[O("button",{class:"btn btn-ok",ref:"ok",disabled:e.isDisabled(),onClick:t[4]||(t[4]=t=>e.doAction(!0))},[y(a,{icon:"check"}),x(" "+$(e.state.title),1)],8,yt),O("button",{class:"btn btn-can",onClick:t[5]||(t[5]=t=>e.doAction(!1))},"cancel")])])])])])),_:1},512)),[[q,e.state.isShowDlg]])},ht.__scopeId="data-v-2041bfb8",v("data-v-12732ce5");const xt={class:"container"},$t={class:"main"};b();var Et=h({emits:["event_callback"],setup(e,{emit:t}){const{store_data:o}=he(),{store_dlg:n}=_e(),i=d(),s=u(),a={snackbar:!1,message:"",timeout:-1,color:"green",actions:()=>{console.log("sb_actions")}},l=m({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,snackbar_ex:a,toggle_list:!1});N((()=>{console.log("[mounted]"),c(),window.addEventListener("resize",r),document.body.style.overflow="hidden"})),V((()=>{console.log("unmounted!"),window.removeEventListener("resize",r)}));const c=()=>{console.log("init");const e=s.path.substring(1),t=s.fullPath.split("api_bookmark?=");console.log(t),2!=t.length?(o.do_cmd("filter_menu",null),console.log(`filename=${e}`),null==e||""==e?o.do_cmd("restore_file",""):o.do_cmd("open_file",e),r()):o.do_cmd("bookmark",decodeURIComponent(t.pop()))},r=()=>{const e=window.innerHeight-45;console.log(`height=${e}`),o.update_height(e)},h=async(e,t)=>{switch(console.log(`[event_callback] cmd=${e}, va0=${t}`),e){case"toggle_editor":l.editor_toggle=!l.editor_toggle;break;case"openSnackbar":case"onClick_snackbar":break;case"config":l.objDlgConf={cmd:e,filename:"",commit:""};break;case"print":const s=i.resolve({path:`/print/${o.filename}`});window.open(s.href,"_blank");break;case"filelist":document.querySelector(".col-3");const a=!l.toggle_list;l.toggle_list=a,console.log(l.toggle_list);break;default:if(-1!=e.indexOf("dlg_")){const o=Object.assign({},g(e,t));n.update_param(o)}else o.do_cmd(e,t)}},g=(e,t)=>{const n=Ie[e],i=null!=t?t:o.state.filename;return n.init(n,i),n};return(e,t)=>(p(),f("div",xt,[y(Re,{ref:appbar,onEvent_callback:h},null,512),y(ht,{objParam:w(l).objDlgCmn,onEvent_callback:h},null,8,["objParam"]),O("div",$t,[w(l).toggle_list?(p(),_(Ge,{key:0,class:"col-3",onEvent_callback:h,style:j({height:w(l).height+"px"})},null,8,["style"])):E("",!0),y(mt,{class:"col-2",ref:pane,editor_toggle:w(l).editor_toggle,style:j({height:w(l).height+"px"})},null,8,["editor_toggle","style"]),y(tt,{class:"col-1",onEvent_callback:h,style:j({height:w(l).height+"px"})},null,8,["style"])])]))}});Et.__scopeId="data-v-12732ce5";const Ct={_class:"container"};const St=[{name:"viewer",path:"/:pathMatch(.*)*",component:Et},{name:"viewer_print",path:"/print/:pathMatch(.*)",component:h({emits:["event_callback"],setup(e,{emit:t}){he();const o=u(),n=m({filename:"",height:window.innerHeight,timer3:-1});N((()=>{console.log("[mounted]"),i(),document.body.style.overflow="hidden"}));const i=()=>{console.log("init");const e=o.path.substring(1);o.fullPath,console.log(`filename=${e}`),n.filename=e,n.timer3=window.setTimeout((()=>{clearTimeout(n.timer3),window.print()}),500)};return(e,t)=>(p(),f("div",Ct,[x($(w(n).filename)+" ",1),y(dt,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}})}],Mt=G({history:W(),routes:St});z.add(X),Q(ve).use(Mt).component("fa",Z).mount("#app");
