var ve=Object.defineProperty;var be=(s,e,t)=>e in s?ve(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var b=(s,e,t)=>(be(s,typeof e!="symbol"?e+"":e,t),t);import{D as we,a as ie,i as ce,p as le,u as de,b as ne,r as T,d as O,c as q,e as j,o as h,f as w,g as k,F,h as x,j as P,t as N,k as A,l as H,w as ue,m as L,n as U,q as C,s as Z,v as G,x as J,y as ke,z as K,A as ye,B as $e,C as Ee,E as ae,R as xe,G as te,H as _e,I as Q,J as Ce,K as re,L as Me,T as Se,M as je,N as Oe,O as Le,P as Te,_ as De,Q as Ae,S as Ne}from"./vendor.07e89c93.js";const Ie=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}};Ie();class R{constructor(){b(this,"id",-1);b(this,"content","");b(this,"path","");b(this,"title","");b(this,"group","");b(this,"atime",Date());b(this,"ctime",Date());b(this,"tags",[]);b(this,"htags",[]);b(this,"position")}set(e,t="",o=[],n=!1){t!=""&&(this.path=t),o!=[]&&(this.tags=o),this.content=e;const r=this.get_time();this.atime=r,n==!0&&(this.ctime=r)}set_default(e){this.path=e,this.content="",this.tags=[];const t=this.get_time();this.atime=t,this.ctime=t}copy(e){Object.assign(this,e)}duplicate(e,t=""){const o=new R;return o.copy(this),o.content=e,o.path=t,o.update_contentEx(),o.update_time(),o}update_content(e){e!=null&&(this.content=e),this.update_contentEx()}update_contentEx(){this.atime=this.get_time(),this.tags=this.build_tag(this.content)}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const t=o=>`00${o}`.slice(-2);return`${e.getFullYear()}/${t(e.getMonth()+1)}/${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`}update_time(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){console.log("[build_tag]");const t=[],o=[0,0,0,0,0],n=e.split(/\r\n|\n|\r/);for(let r=0;r<n.length;r++)if(n[r].search(/^\s*#/)!=-1){const i=n[r].split(" "),l=i[0].length;i.shift();const c=i.join(" ");t.push({text:c,line:r,tag:l,num:o[l]}),o[l]++}return t}split(e){const t=[],o=this.content.split(/\r\n|\n|\r/),n=this.tags.filter(function(c){return c.tag==e}),r=[],a=o.length;for(var i=0;i<n.length;i++){const c=n[i].line;r.push({start:c,end:a,title:n[i].text}),i!=0&&(r[i-1].end=c-1)}const l=this.path.replace(".","_");return r.reverse(),r.forEach(c=>{const d=o.splice(c.start,c.end).join(`\r
`),u=this.duplicate(d,`${l}/${c.title}`);t.push(u)}),t.reverse(),t}}class Be extends we{constructor(){super("OdenDB");b(this,"viewer");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class Fe{constructor(e){b(this,"caller");b(this,"db",new Be);b(this,"dbx");b(this,"ctime","");b(this,"atime","");b(this,"getStrageEx",async()=>await this.getAll());b(this,"read",async e=>{const t=await this.dbx.get(e);return t!=null?t.data:null});b(this,"write",async(e,t)=>{const o=JSON.stringify(t);await this.dbx.put({key:e,data:o,ctime:this.set_time_DB()}),this.set_time_DB()});b(this,"delete",async e=>{await this.dbx.delete(e),this.set_time_DB()});this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(o=>{e[o.key]=o.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class Re{constructor(e){b(this,"_");b(this,"storeLS");b(this,"write",(e,t)=>this.storeLS.write(e,t));b(this,"delete",e=>this.storeLS.delete(e));b(this,"rename",async(e,t)=>{console.log(`[rename] _key_org=${e}, _key_new=${t}`);const o=this.as(await this.get(e));return o.path=t,await this.write(t,o),await this.delete(e),o});b(this,"split",async e=>{console.log(`[split] _key_org=${e}`);const o=this.as(await this.get(e)).split(1);return o.forEach(n=>{this.write(n.path,n)}),o});b(this,"merge",(e,t)=>{console.log(`[merge] _path=${e}`);const o=new R;return o.set_default(e),o.update_content(t),this.write(e,o),o});b(this,"as",e=>Object.assign(new R,e));b(this,"sync_DB",()=>this.storeLS.sync_DB());this._=e,this.storeLS=new Fe(this._)}async get(e){console.log(`[get] _key=${e}`);const t=await this.read(e);return t!=null?JSON.parse(t):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,t){console.log(`[set] _key=${e}`);const o=this.as(await this.get(e));return o.path==""&&(o.path=e),o.update_content(t),this.write(e,o),o}async set_ex(e,t){console.log(`[set_ex] _key=${e}`);const o=this.as(t);return t.path==""&&(t.path=e),o.update_content(void 0),this.write(e,o),o}async read(e){return await this.storeLS.read(e)}create(e){console.log(`[create] _key=${e}`);const t=new R;return e!=null&&(t.set_default(e),this.write(e,t)),t}}const oe="menu.json";class Ve{constructor(e){b(this,"_");this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const t=await this._.mgrCache.getLstContent(e),o=this.buildMenu(t);return console.log(`${t.length}/${o.length}`),this._.contentEx.set(oe,JSON.stringify(o)),o}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const t=await this._.contentEx.get(oe);return JSON.parse(t.content)}}buildMenu(e){function t(n){const r=new Set;return n.forEach(a=>{r.add(a.group)}),[...r]}function o(n){console.log("storeEx_index:buildMenuEx");const r=t(n);return n.reduce((a,i)=>{if(i.path==oe)return a;let l=i.group,c=i.title,_=`${l}/${c}`;return r.includes(_)&&(l=_,c=".index",_=`${l}/${c}`),a.push({key:_,group:l,title:c,path:i.path,atime:i.atime}),a},[])}return o(e).sort(this.compare_group)}compare_group(e,t){let o=e.group,n=t.group;o==n&&(o=`${e.group}/${e.title}`,n=`${t.group}/${t.title}`);const r=o.toUpperCase(),a=n.toUpperCase();let i=0;return r>a?i=1:r<a&&(i=-1),i}}class W{static async read(e){console.log(`[read] filename=${e}`);const t=new URLSearchParams;return t.append("filename",e),W.post_cmdEx("load_file_md",t)}static write(e,t){console.log(`[write] filename=${e}`);const o=new URLSearchParams;return o.append("filename",e),o.append("source",t),W.post_cmdEx("save_file_md",o)}static async get_cmdEx(e){const t="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:get_cmdEx] api=${t}`),ie.get(t).then(o=>o.data).catch(o=>{throw o.response.status})}static async post_cmdEx(e,t){const o="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:post_cmdEx] api=${o}`),ie.post(o,t).then(n=>n.data).catch(n=>{throw n.response.status})}}class Pe{constructor(e){b(this,"_");b(this,"backupEx",(e,t,o)=>{const n=()=>{const a=new URLSearchParams;a.append("lstContent",JSON.stringify(e)),W.post_cmdEx("backup_contents",a).then(i=>console.log(i)).catch(i=>console.log(i))},r=()=>{const a=new Blob([JSON.stringify(e)],{type:"text/plain"}),i=(c,_)=>{const d=new Date,u=m=>`00${m}`.slice(-2);return`${c}_${d.getFullYear()}${u(d.getMonth()+1)}${u(d.getDate())}_${u(d.getHours())}.${_}`},l=document.createElement("a");l.download=i("lstData","json"),l.href=URL.createObjectURL(a),l.click(),URL.revokeObjectURL(l.href)};switch(console.log(`[backup] mode=${t}`),t){case"backup":n();break;case"export":r();break}});this._=e}async restoreEx(e,t,o){function n(l){l.forEach(c=>{const _=new R;_.copy(c),_.update_contentEx(),_.update_time(),i.write(_.path,_)})}async function r(l,c){W.get_cmdEx("restore_contents").then(_=>{n(_),l(_)}).catch(_=>{console.log(_),c(null)})}async function a(l,c,_){const d=new FileReader;d.onload=()=>{var v;console.log("onload");const u=(v=d.result)!=null?v:"",m=JSON.parse(u);n(m),c(m)},d.onerror=u=>{_("error")},d.readAsText(l)}console.log("[importExport:restore]");const i=this._.contentEx;return new Promise(function(l,c){switch(e){case"restore":r(l,c);break;case"import":a(t,l,c);break}})}}class He{constructor(e){b(this,"_");b(this,"journal2",async(e,t)=>{const o=(r,a)=>`
## ${this._.contentEx.as(r).cnv_time(t)}
${a}
`;console.log("[journal]");const n=await this.geolocation();return e.content+=o(e,n),e});b(this,"geolocation",()=>new Promise(e=>{let t="";navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{t=`(Latitude,longitude)=(${o.coords.latitude},${o.coords.longitude})
`,e(t)},o=>{switch(o.code){case 1:t="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:t="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:t="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}e(t)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),e(t))}));b(this,"chat",async(e,t,o)=>{const n=m=>["sun","mon","tue","wed","thu","fri","sat"][m],r=m=>{const v=I=>`00${I}`.slice(-2),E=`${m.getFullYear()}/${v(m.getMonth()+1)}/${v(m.getDate())}(${n(m.getDay())})`,M=`${v(m.getHours())}:${v(m.getMinutes())}`;return[E,M]},a=(m,v)=>m!==v?`
## ${v}
`:"",i=m=>{const v=o.isNoList?"":"- ",E=o.isAddTime?`${m} : `:"";return`${v}${E}${t}
${d}`};console.log("[chat]");const l=e.content.indexOf(`
`),[c,_]=r(new Date),d=o.isAddGeo?await this.geolocation()+`
`:"",u=a(e.content.substring(0,l),c)+i(_);return e.content=`${c}${e.content.substring(l)}${u}`,e});this._=e}async path_rename(e,t,o){console.log(`_from=${e}, _to=${t}`);const n=this.collect_filename_by_group(e,o);for(let r=0;r<n.length;r++){const a=n[r],i=`${a[1]}/${a[0]}`,l=`${t}${a[2]}/${a[0]}`;await this._.contentEx.rename(i,l)}}async path_delete(e,t){console.log(`_path=${e}`);const o=this.collect_filename_by_group(e,t);for(let n=0;n<o.length;n++){const r=o[n],a=`${r[1]}/${r[0]}`;await this._.contentEx.delete(a)}}async path_merge(e,t,o){console.log(`_path=${e}`);const n=[],r=this.collect_filename_by_group(e,o);for(let i=0;i<r.length;i++){const l=r[i],c=`${l[1]}/${l[0]}`,_=await this._.contentEx.get(c);n.push(_.content)}const a=n.join(`\r
`);return this._.contentEx.merge(t,a)}collect_filename_by_group(e,t){console.log(`[collect_filename_by_group] group=${e}`);const o=[],n=e.length!=0?1:0;return t.forEach((r,a)=>{if(r.group==e){const i=r.group.substring(e.length+n);o.push([r.title,r.group,i.length!=0?`/${i}`:""])}}),o}}class Je{constructor(e){b(this,"_");this._=e}async getLstContent(e){console.log("[getLstContent]");const t=r=>{const a=e.path==""?!0:r.path.indexOf(e.path)!=-1,i=e.keyword==""?!0:r.content.toLowerCase().indexOf(e.keyword)!=-1;return a&&i},o=await this.buildLstContent();return e!=null?o.filter(t):o}async buildLstContent(){var r;console.log("[buildLstContent]");const e=a=>{var c,_;let i=a.path;(i==""||i==null)&&(i=`@test/${new Date().toLocaleString()}`);const l=i.split("/");return a.title=(c=l.pop())!=null?c:".",a.group=(_=l.join("/"))!=null?_:"@test",a.tags=[],a.htags=[],a},t=await this._.contentEx.storeLS.getStrageEx(),o=[],n=a=>t[a];for(const a of Object.keys(t))try{o.push(e(JSON.parse((r=n(a))!=null?r:"")))}catch(i){console.log(`@ error key=${a},e=${i} - other error`)}return o}}class qe{constructor(){b(this,"contentEx",new Re(this));b(this,"mgrExchange",new Pe(this));b(this,"mgrEtc",new He(this));b(this,"mgrMenu",new Ve(this));b(this,"mgrCache",new Je(this));console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,t){return this.contentEx.set(e,t)}async cmd_save_ex(e,t){return this.contentEx.set_ex(e,t)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_rename(e,t){await this.contentEx.rename(e,t)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,t="",o=null){const n=await this.mgrCache.getLstContent(o);this.mgrExchange.backupEx(n,e,t)}async cmd_restoreEx(e,t,o=""){await this.mgrExchange.restoreEx(e,t,o)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,t,o)}async cmd_path_delete(e){const t=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,t)}async cmd_path_merge(e,t){const o=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,t,o)}async cmd_chat(e,t,o){const r=(()=>{const l=new Date;return`${e}${o.mode}_${l.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${r}`);const a=await this.contentEx.get(r),i=await this.mgrEtc.chat(a,t,o);return await this.contentEx.set(r,i.content),[i,r]}}class Ue{constructor(e){b(this,"KEY","");console.log(e),this.KEY=e}get(e){var t;if(localStorage.getItem(this.KEY)!=null){const o=JSON.parse((t=localStorage.getItem(this.KEY))!=null?t:"");e(o),console.log(o)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const Ke=1e3*60*10,me=Symbol(),Ye=()=>{const s=de(),e=ne(),t=T({storeEx:new qe,persisted:new Ue("lifeLog-Viewer-params"),filename:"",obj:new R,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),o=p=>{console.log(`[update_filename] : new=${p}`),p!=t.filename&&n(p)},n=async p=>{const g=y=>{e.path.indexOf(y)==-1&&(console.log(`_value=${y}`),s.push(`/${y}`)),t.persisted.set({filename:y}),t.filename=y};if(console.log(`[load_obj] : new=${p}`),p!=""){const y=await t.storeEx.cmd_load(p);l(y)}else c("");g(p)},r=()=>{console.log("restore_filename"),t.persisted.get(p=>{o(p.filename)})},a=async p=>{if(p==""){console.log("skip save - empty data");return}c(p),l(t.obj),await t.storeEx.cmd_save_ex(t.filename,t.obj),u()},i=()=>{console.log("[auto_save] start"),t.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(t.intervalId_autoSave)),t.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await f("export",null,null),t.intervalId_autoSave=null},Ke)},l=p=>{const g=p instanceof R?p:Object.assign(new R,p);g.update_contentEx(),t.tags=g.tags,t.obj=g},c=p=>{t.obj.content=p},_=async(p,g)=>{if(console.log(p),g!=null){const y=await t.storeEx.cmd_load(g);y.position=p,await t.storeEx.cmd_save_ex(g,y)}else t.obj.position=p},d=p=>{t.dictMenu=p},u=()=>{setTimeout(async()=>{d(await t.storeEx.cmd_rebuild()),i()},250)},m=p=>{t.jump=p,p!=-1&&(console.log(`jump=${p}`),t.ObjTag=JSON.parse(JSON.stringify(t.tags[p])),console.log(JSON.stringify(t.ObjTag)))},v=p=>{t.height=p},E=async(p,g)=>{const[y,S]=await t.storeEx.cmd_chat(t.path_expand,p,g);l(y),o(S),u()},M=async(p,g)=>{const y=await t.storeEx.cmd_exist(p);if(g==y)return!0;{const S=g?`error : ${p} is not exist. please enter exist filename.`:`error : ${p} is already exist. please enter other filename.`;return console.log(S),!1}},I=async(p,g)=>{await M(p,!1)&&(await t.storeEx.cmd_rename(g,p),o(p),u())},B=async(p,g)=>{const y=$(g)[0],S=$(p)[0];await t.storeEx.cmd_path_rename(y,S),o(""),u()},f=async(p,g,y)=>{console.log(`[do_cmd] mode=${p}`);let S=g!=""?g:t.filename,Y="",z;switch(p){case"update_jump":m(g);break;case"rebuild_menu":u();break;case"filter_menu":const ee=g;g!=null&&(ee.path=ee.isUnderFolder?$(t.filename)[0]:""),d(await t.storeEx.cmd_getMenu(ee));break;case"open_file":o(g);break;case"restore_file":r();break;case"save_file":await a(g);break;case"new":await M(g,!1)&&(await t.storeEx.cmd_create(g),o(g),u());break;case"delete":await M(S,!0)&&(await t.storeEx.cmd_delete(S),o(""),u());break;case"rename":I(g,y);break;case"backup":t.storeEx.cmd_backup("backup");break;case"export":t.storeEx.cmd_backup("export");break;case"restore":await t.storeEx.cmd_restoreEx("restore",null),u();break;case"import":await t.storeEx.cmd_restoreEx("import",g),u();break;case"split":await M(S,!0)&&(await t.storeEx.cmd_split(S),u());break;case"path_rename":B(g,y);break;case"path_delete":Y=$(g)[0],await t.storeEx.cmd_path_delete(Y),o(""),u();break;case"path_merge":Y=$(g)[0],S=`${Y}.md`,await M(S,!1)&&(await t.storeEx.cmd_path_merge(Y,S),o(S),u());break;case"print":const fe=s.resolve({path:`/print/${t.filename}`});window.open(fe.href,"_blank");break;case"journal":E("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":E(g,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":E(g,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":z={keyword:y.filter,isUnderFolder:y.isCheck,path:""},d(await t.storeEx.cmd_getMenu(z));break;case"update_position":await _(g,y);break;case"move_archive":I(`@archive/${g}`,g);break;case"move_path_archive":B(`@archive/${g}`,g);break;case"export_archive":z={keyword:"",isUnderFolder:!0,path:"@archive/"},t.storeEx.cmd_backup("export","",z);break}},$=p=>{const g=p.split("/"),y=g[g.length-1];return[g.slice(0,-1).join("/"),y]};return{store_data:{state:t,update_height:v,do_cmd:f}}},Ge=()=>{le(me,Ye())},V=()=>ce(me),We=()=>{const s=T({objParam:null});return{store_dlg:{state:s,update_param:t=>{s.objParam=t}}}},pe=Symbol(),ze=()=>{le(pe,We())},se=()=>ce(pe);const Qe=O({setup(s){return Ge(),ze(),(e,t)=>{const o=j("routerView");return h(),q(o)}}});var D=(s,e)=>{const t=s.__vccOpts||s;for(const[o,n]of e)t[o]=n;return t};const Xe={key:0,class:"item"},Ze={key:1,class:"line"},et={key:1,class:"folder"},tt={key:2,class:"dropdown"},ot=O({props:{item:{type:null,required:!0}},emits:["event_callback"],setup(s,{emit:e}){const t=s,o=T({isOpen:!1,item:t.item,isFolder:t.item.children&&t.item.children.length,isActive:!0}),n=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},r=a=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const i=a.cmd;n(i,null)}};return(a,i)=>{const l=j("fa"),c=j("MenuTreeItem",!0);return h(),w("div",{class:"menu_tree",onClick:i[0]||(i[0]=_=>r(k(o).item)),onContextmenu:i[1]||(i[1]=ue(()=>{},["right","prevent"]))},[k(o).isFolder?A("",!0):(h(),w(F,{key:0},[k(o).item.title!=""?(h(),w("span",Xe,[x(l,{icon:k(o).item.icon},null,8,["icon"]),P(" "+N(k(o).item.title),1)])):A("",!0),k(o).item.title==""?(h(),w("div",Ze)):A("",!0)],64)),k(o).isFolder?(h(),w("span",et,[x(l,{icon:k(o).item.icon},null,8,["icon"]),P(" "+N(k(o).item.title),1)])):A("",!0),k(o).isFolder?(h(),w("div",tt,[(h(!0),w(F,null,H(k(o).item.children,(_,d)=>(h(),w("div",{key:d},[x(c,{item:_,onEvent_callback:n},null,8,["item"])]))),128))])):A("",!0)],32)}}});var nt=D(ot,[["__scopeId","data-v-af6b6e1a"]]);const st=O({props:{mouse:{type:null,required:!0},items:{type:Array,required:!0}},emits:["event_callback"],setup(s,{emit:e}){const t=s;console.log(`[props]=${JSON.stringify(t)}`);const o=T({items:t.items,pos_x:-1,pos_y:-1,isShow:!1,style:"display:none"});console.log(`[state]=${JSON.stringify(o)}`),L(()=>t.mouse,(a,i)=>{console.log("props"),o.isShow=!0,o.pos_x=t.mouse.clientX,o.pos_y=t.mouse.clientY,o.items=t.items,o.style="display:block"});const n=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},r=a=>{o.style=a?"display:block":"display:none"};return(a,i)=>(h(),w("div",{class:"menu",style:U(k(o).style),onMouseover:i[0]||(i[0]=l=>r(!0)),onMouseleave:i[1]||(i[1]=l=>r(!1))},[(h(!0),w(F,null,H(k(o).items,l=>(h(),w("div",{key:l.path},[x(nt,{item:l,onEvent_callback:n},null,8,["item"])]))),128))],36))}});var ge=D(st,[["__scopeId","data-v-680ebf40"]]);const it=O({props:{objMenu:{type:Array,required:!0}},emits:["event_callback"],setup(s,{emit:e}){const o=T({items:s.objMenu,event:void 0}),n=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)},r=a=>{console.log("onClick"),o.event=a};return(a,i)=>{const l=j("fa");return h(),w("div",{class:"dropdown",onClick:r},[x(l,{icon:"bars"}),x(ge,{mouse:k(o).event,items:k(o).items,onEvent_callback:n},null,8,["mouse","items"])])}}});var at=D(it,[["__scopeId","data-v-3a47341c"]]);const rt=O({emits:["event_callback"],props:{objMenuItem:{type:Array,default:[]}},setup(s,e){const t=T({items:[],items2:[],isShowDlg:!1});L(()=>s.objMenuItem,(i,l)=>{t.items=o(i),t.items2=t.items.slice(0,5)});function o(i){console.log("[cnvLstRecent]");function l(_,d){const u=_.atime,m=d.atime;let v=0;return u>m?v=-1:u<m&&(v=1),v}const c=[...i];return c.sort(l),c.slice(0,15)}function n(i){const l=t.items[i].path;e.emit("event_callback","open_file",l),t.isShowDlg=!1}function r(i){t.isShowDlg=i}return{state:t,mouse_hover:r,select_file:n,tooltip:i=>`${i.title}/${i.group}`}}}),ct={class:"base"},lt={key:0,class:"dropdown"},dt=["onClick"],ut={class:"title_sub2"},_t={class:"title"},mt={class:"title_sub"},pt={class:"base2"};function gt(s,e,t,o,n,r){const a=j("fa"),i=j("button2");return h(),w("div",ct,[C("span",{class:"_base",onMouseover:e[0]||(e[0]=l=>s.mouse_hover(!0)),onMouseleave:e[1]||(e[1]=l=>s.mouse_hover(!1))},[x(a,{icon:"history",class:"_item"}),s.state.isShowDlg?(h(),w("ul",lt,[(h(!0),w(F,null,H(s.state.items,(l,c)=>(h(),w("li",{class:"item",key:c,onClick:_=>s.select_file(c)},[x(a,{class:"title_item",icon:"file-alt"}),C("span",ut,N(l.group)+"/ ",1),C("span",_t,N(l.title),1),C("span",mt," ["+N(l.atime)+"]",1)],8,dt))),128))])):A("",!0)],32),C("div",pt,[(h(!0),w(F,null,H(s.state.items2,(l,c)=>(h(),q(i,{class:"btn",key:c,onClick:_=>s.select_file(c)},{default:Z(()=>[P(N(l.title),1)]),_:2},1032,["onClick"]))),128))])])}var ht=D(rt,[["render",gt],["__scopeId","data-v-4be6d922"]]);const ft=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],vt=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],bt=[{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],wt={dlg_import:{init:(s,e)=>{s.title="Restore",s.isFileOpen=!0,s.isNoEdit=!0,s.edit=""},action:s=>["import"]},dlg_delete:{init:(s,e)=>{s.title="Delete",s.isReadOnly=!0,s.edit=e},action:s=>["delete",s.edit,""]},dlg_rename:{init:(s,e)=>{s.title="Rename",s.edit=e},action:s=>["rename",s.edit,s.edit_org]},dlg_new:{init:(s,e)=>{s.title="Create",s.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:s=>["new",s.edit,""]},dlg_path_rename:{init:(s,e)=>{s.title="Rename of Path",s.edit=e.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_rename",s.edit,s.edit_org]},dlg_path_delete:{init:(s,e)=>{s.title="Delete of Path",s.isReadOnly=!0,s.edit=e.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_delete",s.edit,""]},dlg_path_merge:{init:(s,e)=>{s.title="Merge of Path",s.isReadOnly=!0,s.edit=e.split("/").slice(0,-1).join("/")+"/"},action:s=>["path_merge",s.edit,""]},dlg_tweet:{init:(s,e)=>{s.title="Tweet",s.edit=""},action:s=>["tweet",s.edit,""]},dlg_bookmark:{init:(s,e)=>{s.title="Bookmark",s.edit="",s.isMulti=!0},action:s=>["bookmark",s.edit,""]},dlg_filter:{init:(s,e)=>{s.title="Filter",s.title2="target under folder",s.edit="",s.edit_org="@",s.isCheck=!0},action:s=>(console.log("dlg_filter"),["filter",s.filename,{filter:s.edit,isCheck:s.check}])}};const kt=O({emits:["event_callback"],components:{MenuCmd:at,MenuRecent2:ht},setup(s,e){const{store_data:t}=V();se();const o=G(null),n=T({filename:"@",objMenu:ft,dctMenu:[]});J(()=>{console.log("[mounted]")});const r=c=>{console.log(`[doAction] cmd=${c}`),e.emit("event_callback",c,!0)};L(()=>t.state.filename,(c,_)=>{console.log(`[watch:filename] ${c}`),i(c)}),L(()=>t.state.dictMenu,(c,_)=>{n.dctMenu=c}),L(()=>t.state.jump,(c,_)=>{window.setTimeout(()=>{a()},500)});const a=()=>{o.value.scrollIntoView({})},i=c=>{console.log(`[onChanged_filename] new=${c}`),n.filename=c,a()};return{state:n,doAction:r,event_callback:(c,_)=>{console.log(`[event_callback] cmd=${c}`),c=="top"?o.value.scrollIntoView({}):e.emit("event_callback",c,_)},appbar:o}}}),yt={class:"nav"},$t=["title"],Et={class:"cmd"};function xt(s,e,t,o,n,r){const a=j("MenuCmd"),i=j("MenuRecent2"),l=j("fa");return h(),w("header",{class:"appbar",ref:"appbar",onClick:e[6]||(e[6]=c=>s.event_callback("top",!0))},[C("nav",yt,[x(a,{class:"item",objMenu:s.state.objMenu,onEvent_callback:s.event_callback,title:"menu"},null,8,["objMenu","onEvent_callback"]),C("section",{class:"item logo",onClick:e[0]||(e[0]=c=>s.event_callback("filelist",!0)),title:s.state.filename},"Oden",8,$t),x(i,{class:"item",objMenuItem:s.state.dctMenu,onEvent_callback:s.event_callback,title:"history"},null,8,["objMenuItem","onEvent_callback"]),s.state.filename!==""?(h(),w("span",{key:0,class:"item name",onClick:e[1]||(e[1]=c=>s.event_callback("dlg_rename",null))}," ["+N(s.state.filename)+"] ",1)):A("",!0),C("span",{class:"item mark",onClick:e[2]||(e[2]=c=>s.doAction("toggle_editor")),title:"editor/viewer"},[x(l,{icon:"edit"})])]),C("span",Et,[C("span",{class:"item",onClick:e[3]||(e[3]=c=>s.doAction("dlg_filter")),title:"filter"},[x(l,{icon:"paw"})]),C("span",{class:"item",onClick:e[4]||(e[4]=c=>s.doAction("dlg_tweet")),title:"tweet"},[x(l,{icon:"grimace"})]),C("span",{class:"item",onClick:e[5]||(e[5]=c=>s.doAction("dlg_bookmark")),title:"bookmark"},[x(l,{icon:"bookmark"})])])],512)}var Ct=D(kt,[["render",xt],["__scopeId","data-v-6bf5fa8b"]]);const Mt={class:"file_tree"},St=["onContextmenu"],jt=["title"],Ot={key:1,class:"folder"},Lt={key:0},Tt=O({props:{item:{type:Object,required:!0}},emits:["event_callback"],setup(s,{emit:e}){const t=s,o=T({isOpen:!1,item:t.item,isFolder:t.item.children&&t.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:n}=V();L(()=>n.state.filename,(_,d)=>{c(_)});const r=(_,d)=>{console.log(`[event_callback] cmd=${_}`),e("event_callback",_,d)},a=(_,d)=>{console.log(`[event_callbackEx] cmd=${_}`),e("event_callback",_,o.item.path)};J(()=>{c(n.state.filename)});const i=_=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const d=_.path;console.log(`onClick-filename=${d}`),n.do_cmd("open_file",d)}},l=_=>{console.log("onClickEx"),o.menu=o.isFolder?bt:vt,o.event=_},c=_=>{o.item.path==_,_.indexOf(o.item.name)!=-1&&(o.isOpen=!0),o.class_item=o.item.path==_?"item active":"item"};return(_,d)=>{const u=j("fa"),m=j("tree-item",!0);return h(),w("div",Mt,[x(ge,{mouse:k(o).event,items:k(o).menu,onEvent_callback:a},null,8,["mouse","items"]),C("div",{onContextmenu:ue(l,["prevent"]),onClick:d[0]||(d[0]=v=>i(k(o).item))},[k(o).isFolder?A("",!0):(h(),w("div",{key:0,class:ke(k(o).class_item),title:k(o).item.time},N(k(o).item.name),11,jt)),k(o).isFolder?(h(),w("div",Ot,[x(u,{icon:k(o).isOpen?"folder-open":"folder"},null,8,["icon"]),P(" "+N(k(o).item.name),1)])):A("",!0)],40,St),k(o).isOpen?(h(),w("div",Lt,[(h(!0),w(F,null,H(k(o).item.children,(v,E)=>(h(),w("div",{key:E},[x(m,{item:v,onEvent_callback:r},null,8,["item"])]))),128))])):A("",!0)])}}});var Dt=D(Tt,[["__scopeId","data-v-736aab12"]]);const At={class:"tree"},Nt=O({emits:["event_callback"],setup(s,{emit:e}){const t=T({items:void 0}),{store_data:o}=V();L(()=>o.state.dictMenu,(a,i)=>{r(a)});const n=(a,i)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,i)};J(()=>{console.log("[mounted]"),r(o.state.dictMenu)});const r=a=>{console.log("[onChanged_dictMenu]"),t.items=void 0;const i=a,l={name:"",children:[],path:"",file:"",time:""},c="/",_={[c]:l};i.forEach(function(d){d.key.split("/").reduce(function(u,m){if(u[m])return u[m];{const v={name:m,children:[],path:d.path,file:"md",time:d.atime};return u[c].children.push(v),u[c].file="",u[m]={[c]:v}}},_)}),console.log(l),setTimeout(()=>{t.items=l.children},500)};return(a,i)=>(h(),w("div",At,[(h(!0),w(F,null,H(k(t).items,l=>(h(),w("div",{key:l.path},[x(Dt,{item:l,onEvent_callback:n},null,8,["item"])]))),128))]))}});var It=D(Nt,[["__scopeId","data-v-1f034d00"]]);const Bt=O({props:{level:{type:Number,required:!0}},setup(s,e){return{tag:K(()=>`h${s.level}`)}}});function Ft(s,e,t,o,n,r){return h(),q(ye(s.tag),{class:"h_tag"},{default:Z(()=>[$e(s.$slots,"default",{},void 0,!0)]),_:3})}var Rt=D(Bt,[["render",Ft],["__scopeId","data-v-1765be40"]]);const Vt=O({emits:["event_callback"],components:{heading:Rt},setup(s,e){const{store_data:t}=V(),o=T({listTag:[]});L(()=>t.state.tags,(a,i)=>{console.log(a),o.listTag=a});function n(a){t.do_cmd("update_jump",a)}function r(a){return`${a.text}`}return{state:o,dispTitle:r,jumpSource:n}}}),Pt={class:"tag"},Ht=["onClick"];function Jt(s,e,t,o,n,r){const a=j("heading");return h(),w("div",Pt,[(h(!0),w(F,null,H(s.state.listTag,(i,l)=>(h(),w("div",{key:l,onClick:c=>s.jumpSource(l),class:"item"},[x(a,{level:i.tag},{default:Z(()=>[P(N(s.dispTitle(i)),1)]),_:2},1032,["level"])],8,Ht))),128))])}var qt=D(Vt,[["render",Jt],["__scopeId","data-v-1d58b53a"]]);const Ut=O({emits:["event_callback"],setup(s,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(n,r)=>{console.log(`cmd=${n}, name=${r}`),e.emit("event_callback",n,r)}}}}),Kt={class:"main",style:{_height:"100px"}},Yt=["onClick","title"];function Gt(s,e,t,o,n,r){const a=j("fa");return h(),w("div",Kt,[(h(!0),w(F,null,H(s.objToolbar,(i,l)=>(h(),w("button",{class:"btn-item",key:l,onClick:c=>s.event_callback("action",i.cmd),title:i.cmd},[x(a,{icon:i.icon},null,8,["icon"])],8,Yt))),128))])}var Wt=D(Ut,[["render",Gt],["__scopeId","data-v-2dca080d"]]);const X={};class zt{constructor(e,t){b(this,"cmdid",0);b(this,"monaco",null);b(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=t}add(e,t,o,n,r=null){let a;switch(n.length){case 0:a=this.generateCommand(e,r);break;case 1:a=this.generateHeaderCommand(n[0]);break;case 2:a=this.generateWrapperCommand(n[0],n[1]);break}X[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:o,contextMenuGroupId:t&&"navigation",contextMenuOrder:t&&1.5,run:X[e]})}generateCommand(e,t){return(o,n)=>{t(o)}}generateWrapperCommand(e,t){const o=e.length+t.length;return this.editor,this.editor.getModel(),this.monaco,(n,r)=>{const a=n.getModel(),i=n.getSelections();if(i==null)return;const l=[];return i.forEach(c=>{l.push(new r.Selection(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn+o)),a.pushEditOperations([],[{range:{startLineNumber:c.startLineNumber,startColumn:c.startColumn,endLineNumber:c.startLineNumber,endColumn:c.startColumn},text:e},{range:{startLineNumber:c.endLineNumber,startColumn:c.endColumn,endLineNumber:c.endLineNumber,endColumn:c.endColumn},text:t}])}),n.setSelections(l),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(t,o)=>{const n=t.getModel();let r=t.getSelections();return r==null&&(r=[t.getSelection()]),r.forEach(a=>{const i=n.findNextMatch("^(#+ )",{lineNumber:a.startLineNumber,column:1},!0,!1,null,!0);if(i!=null&&i.range.startLineNumber==a.startLineNumber&&i.range.startColumn==1){if(i.matches[1]==e)return;n.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:i.matches[1].length+1},text:""}])}n.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:1},text:e}])}),null}}}function Qt(s,e){const t=n=>{const r=a=>`00${a}`.slice(-2);return`${n.getFullYear()}/${r(n.getMonth()+1)}/${r(n.getDate())} ${r(n.getHours())}:${r(n.getMinutes())}:${r(n.getSeconds())}`};console.log("[setupShortcutKeys]");const o=new zt(s,e);o.add("Bold","8_",[],["**","**"]),o.add("Italic","1_",[],["__","__"]),o.add("Underline","9_",[],["<u>","</u>"]),o.add("Strikethrough",!1,[s.KeyMod.CtrlCmd|s.KeyMod.Shift|s.KeyCode.KEY_S],["~~","~~"]),o.add("Code",!1,[],["`","`"]),o.add("Link",!1,[],["[","]()"]),o.add("Link-2",!1,[],["[](",")"]),o.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),o.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),o.add("Header 1",!1,[],["# ",""]),o.add("Header 2",!1,[],["## ",""]),o.add("Header 3",!1,[],["### ",""]),o.add("Header 4",!1,[],["#### ",""]),o.add("Header 5",!1,[],["##### ",""]),o.add("Header 6",!1,[],["###### ",""]),o.add("Check",!1,[],["- [ ] ",""]),o.add("Blockquotes",!1,[],["> ",""]),o.add("Today",!1,[],[`${t(new Date)}`,""]),o.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),o.add("Format","8_",[],[],n=>{console.log("format"),n.getAction("editor.action.formatDocument").run()})}const Xt={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},Zt=O({emits:["event_callback"],components:{ToolbarEditor:Wt},props:{isActive_preview:{type:Boolean,default:!1}},setup(s,e){const t=G(null),o={editor:void 0},{store_data:n}=V(),r=T({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});J(()=>{console.log("[mounted]"),i(),v(n.state.obj.content)}),L(()=>n.state.obj.content,(f,$)=>{console.log("[watch-body]"),r.filename!=""&&M(),v(f),I(n.state.obj.position,!0),r.filename=n.state.filename}),L(()=>n.state.ObjTag,(f,$)=>{console.log(`[watch](ObjTag)-${f}`),a(f)}),L(()=>s.isActive_preview,(f,$)=>{console.log(`[watch](editor_toggle)-${f}`),f==!0&&E()});const a=f=>{const $=g=>{u(g)};console.log(`[jump_cursor]ObjTag={${Object.values(f)}}`);const p=f.line;$(p),setTimeout(()=>{const g=o.editor;r.pos_scroll=g.getScrollTop()},500)},i=()=>{const f=()=>{const $=(y,S)=>{Qt(y,S)},p=document.getElementById("container");if(console.log(`root=${p}`),p==null)return;const g=Ee.create(p,Xt);return $(ae,g),console.log(`editor=${g}`),g.onDidScrollChange(y=>{r.scrollInfo.height=y.scrollHeight,r.scrollInfo.top=y.scrollTop}),g};o.editor=f(),l()},l=()=>{o.editor.onDidBlurEditorText(f=>{E()})},c=(f,$)=>{switch(console.log(`[event_callback] cmd=${f}`),f){case"action":_($);break;case"save":E();break}},_=f=>{console.log("[action]"),X[f]!=null&&X[f](o.editor,ae)},d=()=>o.editor.getValue(),u=f=>{const $=new xe(f+1,0,f+1,0);console.log(`Line=${f}`),o.editor.revealRangeAtTop($)},m=()=>o.editor.getModel().getAlternativeVersionId(),v=f=>{o.editor.setValue(f),r.iVersion=m()},E=()=>{const f=m();if(console.info(`iVersion=${r.iVersion}, iVersion_cur=${f}`),r.iVersion==f)return;M();const $=d();n.do_cmd("save_file",$),r.iVersion=m(),console.info(`iVersion=${r.iVersion}`)},M=()=>{const f=o.editor,$={top:f.getScrollTop(),height:f.getScrollHeight(),contentHeight:f.getLayoutInfo().height,scrolled:r.pos_scroll!=f.getScrollTop()};return n.do_cmd("update_position",$,void 0),$},I=(f,$=!1)=>{if(f==null)return;console.log(`[e-set]value=${JSON.stringify(f)}`);const p=o.editor;if($?!0:f.scrolled){const y=f.top/f.height;console.log(`per=${y}`);const S=p.getScrollHeight();p.setScrollTop(S*y)}else a(n.state.ObjTag);setTimeout(()=>{r.pos_scroll=p.getScrollTop()},500)};K(()=>o.editor.getScrollTop());const B=K(()=>n.state.height-27+"px");return{editorEx:o,event_callback:c,HeightEx:B,md_editor_monaco:t,get_position:M,set_position:I}}}),eo={class:"editor"};function to(s,e,t,o,n,r){const a=j("ToolbarEditor");return h(),w("div",eo,[x(a,{class:"toolbar",onEvent_callback:s.event_callback},null,8,["onEvent_callback"]),C("div",{id:"container",ref:"md_editor_monaco",class:"core",style:U({height:s.HeightEx})},null,4)])}var oo=D(Zt,[["render",to],["__scopeId","data-v-1dc20672"]]);const no=O({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(s,e){const t=G(null),{store_data:o}=V(),n=T({contentsPosition:[],tocMap:new Map,observer:null,elm_target_before:null,pos_scroll:-1,filename:""});J(()=>{function d(){const u=new te.Renderer;u.link=function(m,v,E){return m.indexOf("http")!=-1?`<a target="_blank" href="${m}">${E}</a>`:`<a target="_blank" href="#${m}">${E}</a>`},te.setOptions({renderer:u,langPrefix:"",breaks:!0})}console.log("[created]"),d()}),L(()=>o.state.obj.content,(d,u)=>{console.log("[watch-body]"),t.value,n.filename!=""&&i(),setTimeout(()=>{r(),l(o.state.obj.position,!0),n.filename=o.state.filename},0)});function r(){const d=f=>{f.forEach($=>{const p=n.tocMap.get($.target);console.log($.intersectionRatio),$.intersectionRatio?(n.elm_target_before!=null&&n.elm_target_before.classList.remove("active"),p.classList.add("active"),n.elm_target_before=null):n.elm_target_before=p})},u={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},m=new IntersectionObserver(d,u),v=new Map,M=document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),B=document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5");console.log(`el_contents=${M.length}/${JSON.stringify(M)}`),console.log(`el_toc=${B.length}/${JSON.stringify(B)}`),M.forEach((f,$)=>{m.observe(f),v.set(B.item($),f),v.set(f,B.item($))}),n.tocMap=v,n.observer=m}L(()=>o.state.ObjTag,(d,u)=>{console.log(`[watch](ObjTag)-${d}`),a(d)}),L(()=>s.isActive_preview,(d,u)=>{console.log(`[watch](editor_toggle)-${d}`)}),K(()=>t.value.querySelector(".md_core_viewer"));function a(d){const u=(E,M)=>{console.log(`tag=${E}, num=${M}`);const I=t.value,B=I.querySelectorAll(".md_core_viewer > h"+E);B.length!=0&&(I.scrollTop=B[M].getBoundingClientRect().top-I.getBoundingClientRect().top+I.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(d)}}`);const m=d.tag,v=d.num;d.line,u(m,v),setTimeout(()=>{const E=t.value;n.pos_scroll=E.scrollTop},0)}const i=()=>{const d=t.value,u={top:d.scrollTop,height:d.scrollHeight,contentHeight:0,scrolled:n.pos_scroll!=d.scrollTop};return o.do_cmd("update_position",u,n.filename),u},l=(d,u=!1)=>{console.log(`[v-set]value=${JSON.stringify(d)}`);const m=t.value;if(d==null){m.scrollTop=0;return}if(u?!0:d.scrolled){const E=d.top/d.height;console.log(`per=${E}`),console.log(`scrollTop=${m.scrollTop}, scrollHeight=${m.scrollHeight}`),m.scrollTop=m.scrollHeight*E}else a(o.state.ObjTag);setTimeout(()=>{n.pos_scroll=m.scrollTop},0)},c=K(()=>te.parse(o.state.obj.content)),_=K(()=>o.state.height+"px");return{status,Markdown:c,HeightEx:_,md_viewer:t,get_position:i,set_position:l}}}),so=["innerHTML"];function io(s,e,t,o,n,r){return h(),w("div",{class:"md_core_viewer note",innerHTML:s.Markdown,style:U({height:s.HeightEx}),ref:"md_viewer"},null,12,so)}var he=D(no,[["render",io],["__scopeId","data-v-05199a28"]]);const ao=O({components:{MarkdownEditor:oo,MarkdownViewer:he},props:{editor_toggle:{type:Boolean,default:!0}},setup(s,e){const t=G(),o=G(),n=T({isActive_preview:!0});L(()=>s.editor_toggle,(i,l)=>{console.log(`[watch](editor_toggle)-${i}`),a()}),J(()=>{console.log("[mounted]"),document.addEventListener("keydown",r)}),_e(()=>{document.removeEventListener("keydown",r)});const r=i=>{if(i.keyCode===83&&i.ctrlKey){i.preventDefault(),console.log("save"),a();return}else if(i.keyCode===69&&i.ctrlKey){i.preventDefault(),console.log("toggle"),a();return}},a=()=>{var c;const i=n.isActive_preview?{now:t,next:o}:{now:o,next:t},l=(c=i.now.value)==null?void 0:c.get_position();console.log(`isActive_preview=${n.isActive_preview}, scrollIndo=${JSON.stringify(l)}`),n.isActive_preview=!n.isActive_preview,setTimeout(()=>{var _;(_=i.next.value)==null||_.set_position(l)},500)};return{state:n,MdViewer:t,MdEditor:o}}});function ro(s,e,t,o,n,r){const a=j("MarkdownViewer"),i=j("MarkdownEditor");return h(),w("div",null,[s.state.isActive_preview?(h(),q(a,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:s.state.isActive_preview},null,8,["isActive_preview"])):(h(),q(i,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:s.state.isActive_preview},null,8,["isActive_preview"]))])}var co=D(ao,[["render",ro]]);const lo=O({emits:["event_callback"],setup(s,e){const{store_dlg:t}=se(),{store_data:o}=V(),n=T({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});L(()=>t.state.objParam,d=>{r(d)});const r=d=>{const u=(m,v=!1)=>m!=null?m:v;console.log("[onChanged_objParam]"),n.title=d.title,n.title2=d.title2,n.edit=d.edit,n.edit_org=u(d.edit_org,d.edit),n.check=0,n.isShowDlg=!0,n.isNoEdit=u(d.isNoEdit),n.isFileOpen=u(d.isFileOpen),n.isReadOnly=u(d.isReadOnly),n.isCheck=u(d.isCheck),n.isMulti=u(d.isMulti),n.isDisabled=!0,n.action=d.action,c(!0)},a=d=>{if(console.log(`[doAction] flg=${d}, edit=${n.edit}`),d){const u=n.action(n);o.do_cmd(u[0],u[1],u[2])}n.isShowDlg=!1,c(!1)},i=d=>{const m=(d.target.files||d.dataTransfer.files)[0],v=n.action(n);o.do_cmd(v[0],m),n.isShowDlg=!1,c(!1)},l=()=>{const d=n.edit_org,u=n.edit==d&&!n.isReadOnly;return console.log(`[isDisabled]=${u}`),u},c=d=>{d==!0?document.addEventListener("keydown",_):document.removeEventListener("keydown",_)},_=d=>{if(d.keyCode===27){d.preventDefault(),a(!1);return}};return{state:n,props:s,doAction:a,onFileChange:i,isDisabled:l}}}),uo={class:"modal-mask"},_o={class:"modal-wrapper"},mo={class:"modal-container"},po={class:"header"},go={ref:"form",class:"form"},ho=["disabled"],fo=["disabled"],vo={class:"modal-actions"},bo=["disabled"];function wo(s,e,t,o,n,r){const a=j("fa");return Q((h(),q(Se,{persistent:""},{default:Z(()=>[C("div",uo,[C("div",_o,[C("div",mo,[C("div",po,N(s.state.title)+"?",1),C("form",go,[s.state.isFileOpen==!0?(h(),w("input",{key:0,class:"input",type:"file",onChange:e[0]||(e[0]=(...i)=>s.onFileChange&&s.onFileChange(...i))},null,32)):A("",!0),s.state.isNoEdit==!1?(h(),w(F,{key:1},[s.state.isMulti==!0?Q((h(),w("textarea",{key:0,class:"input",_autofocus:"","onUpdate:modelValue":e[1]||(e[1]=i=>s.state.edit=i),disabled:s.state.isReadOnly},null,8,ho)),[[re,s.state.edit]]):Q((h(),w("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":e[2]||(e[2]=i=>s.state.edit=i),disabled:s.state.isReadOnly},null,8,fo)),[[re,s.state.edit]])],64)):A("",!0),s.state.isCheck==!0?(h(),w(F,{key:2},[Q(C("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=i=>s.state.check=i)},null,512),[[Me,s.state.check]]),P(" "+N(s.state.title2),1)],64)):A("",!0)],512),C("div",vo,[C("button",{class:"btn btn-ok",ref:"ok",disabled:s.isDisabled(),onClick:e[4]||(e[4]=i=>s.doAction(!0))},[x(a,{icon:"check"}),P(" "+N(s.state.title),1)],8,bo),C("button",{class:"btn btn-can",onClick:e[5]||(e[5]=i=>s.doAction(!1))},"cancel")])])])])]),_:1},512)),[[Ce,s.state.isShowDlg]])}var ko=D(lo,[["render",wo],["__scopeId","data-v-2041bfb8"]]);const yo={class:"container"},$o={class:"main"},Eo=O({emits:["event_callback"],setup(s,{emit:e}){const{store_data:t}=V(),{store_dlg:o}=se(),n=de(),r=ne(),a={snackbar:!1,message:"",timeout:-1,color:"green",actions:()=>{console.log("sb_actions")}},i=T({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,snackbar_ex:a,toggle_list:!1});J(()=>{console.log("[mounted]"),l(),window.addEventListener("resize",c),document.body.style.overflow="hidden"}),_e(()=>{console.log("unmounted!"),window.removeEventListener("resize",c)});const l=()=>{console.log("init");const u=r.path.substring(1),v=r.fullPath.split("api_bookmark?=");if(console.log(v),v.length==2){t.do_cmd("bookmark",decodeURIComponent(v.pop()));return}t.do_cmd("filter_menu",null),console.log(`filename=${u}`),u==null||u==""?t.do_cmd("restore_file",""):t.do_cmd("open_file",u),c()},c=()=>{const u=window.innerHeight-45;console.log(`height=${u}`),t.update_height(u)},_=async(u,m)=>{switch(console.log(`[event_callback] cmd=${u}, va0=${m}`),u){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"openSnackbar":break;case"onClick_snackbar":break;case"config":i.objDlgConf={cmd:u,filename:"",commit:""};break;case"print":const v=n.resolve({path:`/print/${t.filename}`});window.open(v.href,"_blank");break;case"filelist":document.querySelector(".col-3");const E=!i.toggle_list;i.toggle_list=E,console.log(i.toggle_list);break;default:if(u.indexOf("dlg_")!=-1){const M=Object.assign({},d(u,m));o.update_param(M)}else t.do_cmd(u,m);break}},d=(u,m)=>{const v=wt[u],E=m!=null?m:t.state.filename;return v.init(v,E),v};return(u,m)=>(h(),w("div",yo,[x(Ct,{ref:"appbar",onEvent_callback:_},null,512),x(ko,{objParam:k(i).objDlgCmn,onEvent_callback:_},null,8,["objParam"]),C("div",$o,[k(i).toggle_list?(h(),q(It,{key:0,class:"col-3",onEvent_callback:_,style:U({height:k(i).height+"px"})},null,8,["style"])):A("",!0),x(co,{class:"col-2",ref:"pane",editor_toggle:k(i).editor_toggle,style:U({height:k(i).height+"px"})},null,8,["editor_toggle","style"]),x(qt,{class:"col-1",onEvent_callback:_,style:U({height:k(i).height+"px"})},null,8,["style"])])]))}});var xo=D(Eo,[["__scopeId","data-v-12732ce5"]]);const Co={_class:"container"},Mo=O({emits:["event_callback"],setup(s,{emit:e}){V();const t=ne(),o=T({filename:"",height:window.innerHeight,timer3:-1});J(()=>{console.log("[mounted]"),n(),document.body.style.overflow="hidden"});const n=()=>{console.log("init");const r=t.path.substring(1);t.fullPath,console.log(`filename=${r}`),o.filename=r,o.timer3=window.setTimeout(()=>{clearTimeout(o.timer3),window.print()},500)};return(r,a)=>(h(),w("div",Co,[P(N(k(o).filename)+" ",1),x(he,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}}),So=[{name:"viewer",path:"/:pathMatch(.*)*",component:xo},{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Mo}],jo=je({history:Oe(),routes:So});function Oo(s={}){const{immediate:e=!1,onNeedRefresh:t,onOfflineReady:o,onRegistered:n,onRegisterError:r}=s;let a;const i=async(l=!0)=>{};return"serviceWorker"in navigator&&(a=new Le("./sw.js",{scope:"./"}),a.addEventListener("activated",l=>{l.isUpdate?window.location.reload():o==null||o()}),a.register({immediate:e}).then(l=>{n==null||n(l)}).catch(l=>{r==null||r(l)})),i}Oo();Te.add(De);Ae(Qe).use(jo).component("fa",Ne).mount("#app");
