var Bn=Object.defineProperty;var Ln=(t,e,n)=>e in t?Bn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Me=(t,e,n)=>(Ln(t,typeof e!="symbol"?e+"":e,n),n);import{D as Tn,a as rt,i as Dt,p as Bt,u as Ze,b as Ae,r as O,d as N,c as re,e as H,o as v,f as w,g as m,F as U,h as S,j as pe,t as P,k as A,l as X,w as Ue,m as j,n as Z,q as y,s as $,v as Q,x as Lt,y as Tt,z as V,A as Ie,T as jn,B as ne,C as On,E as Nn,G as An,H as dt,R as In,I as Ve,J as Qe,K as ae,L as jt,M as Je,N as Ot,O as Rn,P as Fn,Q as Pn,S as Vn,U as le,V as zn,W as Hn,X as Kn,Y as Gn,Z as Un,_ as Nt,$ as ye,a0 as Jn,a1 as Yn,a2 as At,a3 as Wn,a4 as qn,a5 as Xn,a6 as Zn,a7 as et,a8 as Qn,a9 as eo,aa as te,ab as to,ac as no,ad as oo,ae as so,af as io,ag as ao,ah as lo,ai as co}from"./vendor.c8006559.js";var K=Object.freeze(Object.defineProperty({__proto__:null,get svg(){return Jt},get g(){return nt},get asstSvg(){return Yt},get foreign(){return Wt}},Symbol.toStringTag,{value:"Module"}));const ro=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};ro();class oe{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(e,n="",o=[],s=!1){n!=""&&(this.path=n),o!=[]&&(this.tags=o),this.content=e;const i=this.get_time();this.atime=i,s==!0&&(this.ctime=i)}set_default(e){this.path=e,this.content="",this.tags=[];const n=this.get_time();this.atime=n,this.ctime=n}copy(e){Object.assign(this,e)}duplicate(e,n=""){const o=new oe;return o.copy(this),o.content=e,o.path=n,o.update_time(),o.update_tag(),o}update_content2(e){this.content=e}update_time(){this.atime=this.get_time()}update_tag(){return this.tags=this.build_tag(this.content),this.tags}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const n=o=>`00${o}`.slice(-2);return`${e.getFullYear()}/${n(e.getMonth()+1)}/${n(e.getDate())} ${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}`}update_time_all(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){const n=[],o=[0,0,0,0,0],s=e.split(/\r\n|\n|\r/);for(let i=0;i<s.length;i++)if(s[i].search(/^\s*#/)!=-1){const l=s[i].split(" "),c=l[0].length;l.shift();const r=l.join(" ");n.push({text:r,line:i,tag:c,num:o[c]}),o[c]++}return n}split(e){const n=[],o=this.content.split(/\r\n|\n|\r/),s=this.tags.filter(function(r){return r.tag==e}),i=[],a=o.length;for(var l=0;l<s.length;l++){const r=s[l].line;i.push({start:r,end:a,title:s[l].text}),l!=0&&(i[l-1].end=r-1)}const c=this.path.replace(".","_");return i.reverse(),i.forEach(r=>{const p=o.splice(r.start,r.end).join(`\r
`),u=this.duplicate(p,`${c}/${r.title}`);n.push(u)}),n.reverse(),n}}class uo extends Tn{constructor(){super("OdenDB");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class ho{constructor(e){this.db=new uo,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async n=>{const o=await this.dbx.get(n);return o!=null?o.data:null},this.write=async(n,o)=>{const s=JSON.stringify(o);await this.dbx.put({key:n,data:s,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async n=>{await this.dbx.delete(n),this.set_time_DB()},this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(o=>{e[o.key]=o.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class po{constructor(e){this.write=(n,o)=>this.storeLS.write(n,o),this.delete=n=>this.storeLS.delete(n),this.rename=async(n,o)=>{console.log(`[rename] _key_org=${n}, _key_new=${o}`);const s=this.as(await this.get(n));return s.path=o,await this.write(o,s),await this.delete(n),s},this.split=async n=>{console.log(`[split] _key_org=${n}`);const s=this.as(await this.get(n)).split(1);return s.forEach(i=>{this.write(i.path,i)}),s},this.merge=(n,o)=>{console.log(`[merge] _path=${n}`);const s=new oe;return s.set_default(n),s.update_content2(o),s.update_time(),s.update_tag(),this.write(n,s),s},this.as=n=>Object.assign(new oe,n),this.sync_DB=()=>this.storeLS.sync_DB(),this._=e,this.storeLS=new ho(this._)}async get(e){console.log(`[get] _key=${e}`);const n=await this.read(e);return n!=null?JSON.parse(n):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,n){console.log(`[set] _key=${e}`);const o=this.as(await this.get(e));return o.path==""&&(o.path=e),o.update_content2(n),o.update_time(),o.update_tag(),this.write(e,o),o}async set_ex(e,n){console.log(`[set_ex] _key=${e}`);const o=this.as(n);return n.path==""&&(n.path=e),o.update_time(),o.update_tag(),this.write(e,o),o}async read(e){return await this.storeLS.read(e)}create(e){console.log(`[create] _key=${e}`);const n=new oe;return e!=null&&(n.set_default(e),this.write(e,n)),n}}const ze="menu.json";class go{constructor(e){this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const n=await this._.mgrCache.getLstContent(e),o=this.buildMenu(n);return console.log(`${n.length}/${o.length}`),this._.contentEx.set(ze,JSON.stringify(o)),o}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const n=await this._.contentEx.get(ze);return JSON.parse(n.content)}}buildMenu(e){function n(s){const i=new Set;return s.forEach(a=>{i.add(a.group)}),[...i]}function o(s){console.log("storeEx_index:buildMenuEx");const i=n(s);return s.reduce((a,l)=>{if(l.path==ze)return a;let c=l.group,r=l.title,d=`${c}/${r}`;return i.includes(d)&&(c=d,r=".index",d=`${c}/${r}`),a.push({key:d,group:c,title:r,path:l.path,atime:l.atime}),a},[])}return o(e).sort(this.compare_group)}compare_group(e,n){let o=e.group,s=n.group;o==s&&(o=`${e.group}/${e.title}`,s=`${n.group}/${n.title}`);const i=o.toUpperCase(),a=s.toUpperCase();let l=0;return i>a?l=1:i<a&&(l=-1),l}}class $e{static async read(e){console.log(`[read] filename=${e}`);const n=new URLSearchParams;return n.append("filename",e),$e.post_cmdEx("load_file_md",n)}static write(e,n){console.log(`[write] filename=${e}`);const o=new URLSearchParams;return o.append("filename",e),o.append("source",n),$e.post_cmdEx("save_file_md",o)}static async get_cmdEx(e){const n="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:get_cmdEx] api=${n}`),rt.get(n).then(o=>o.data).catch(o=>{throw o.response.status})}static async post_cmdEx(e,n){const o="http://localhost:5000/api/viewer/"+e;return console.log(`[store_RST:post_cmdEx] api=${o}`),rt.post(o,n).then(s=>s.data).catch(s=>{throw s.response.status})}}class mo{constructor(e){this.backupEx=(n,o,s)=>{const i=()=>{const l=new URLSearchParams;l.append("lstContent",JSON.stringify(n)),$e.post_cmdEx("backup_contents",l).then(c=>console.log(c)).catch(c=>console.log(c))},a=()=>{const l=new Blob([JSON.stringify(n)],{type:"text/plain"}),c=(d,p)=>{const u=new Date,h=_=>`00${_}`.slice(-2);return`${d}_${u.getFullYear()}${h(u.getMonth()+1)}${h(u.getDate())}_${h(u.getHours())}.${p}`},r=document.createElement("a");r.download=c("lstData","json"),r.href=URL.createObjectURL(l),r.click(),URL.revokeObjectURL(r.href)};switch(console.log(`[backup] mode=${o}`),o){case"backup":i();break;case"export":a();break}},this._=e}async restoreEx(e,n,o){function s(c){c.forEach(r=>{const d=new oe;d.copy(r),d.update_tag(),l.write(d.path,d)})}async function i(c,r){$e.get_cmdEx("restore_contents").then(d=>{s(d),c(d)}).catch(d=>{console.log(d),r(null)})}async function a(c,r,d){const p=new FileReader;p.onload=()=>{var _;console.log("onload");const u=(_=p.result)!=null?_:"",h=JSON.parse(u);s(h),r(h)},p.onerror=u=>{d("error")},p.readAsText(c)}console.log("[importExport:restore]");const l=this._.contentEx;return new Promise(function(c,r){switch(e){case"restore":i(c,r);break;case"import":a(n,c,r);break}})}}class _o{constructor(e){this.journal2=async(n,o)=>{const s=(a,l)=>`
## ${this._.contentEx.as(a).cnv_time(o)}
${l}
`;console.log("[journal]");const i=await this.geolocation();return n.content+=s(n,i),n},this.geolocation=()=>new Promise(n=>{let o="";navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{o=`(Latitude,longitude)=(${s.coords.latitude},${s.coords.longitude})
`,n(o)},s=>{switch(s.code){case 1:o="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:o="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:o="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}n(o)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),n(o))}),this.chat=async(n,o,s)=>{const i=_=>["sun","mon","tue","wed","thu","fri","sat"][_],a=_=>{const b=C=>`00${C}`.slice(-2),B=`${_.getFullYear()}/${b(_.getMonth()+1)}/${b(_.getDate())}(${i(_.getDay())})`,x=`${b(_.getHours())}:${b(_.getMinutes())}`;return[B,x]},l=(_,b)=>_!==b?`
## ${b}
`:"",c=_=>{const b=s.isNoList?"":"- ",B=s.isAddTime?`${_} : `:"";return`${b}${B}${o}
${u}`};console.log("[chat]");const r=n.content.indexOf(`
`),[d,p]=a(new Date),u=s.isAddGeo?await this.geolocation()+`
`:"",h=l(n.content.substring(0,r),d)+c(p);return n.content=`${d}${n.content.substring(r)}${h}`,n},this._=e}async path_rename(e,n,o){console.log(`_from=${e}, _to=${n}`);const s=this.collect_filename_by_group(e,o);for(let i=0;i<s.length;i++){const a=s[i],l=`${a[1]}/${a[0]}`,c=`${n}${a[2]}/${a[0]}`;await this._.contentEx.rename(l,c)}}async path_delete(e,n){console.log(`_path=${e}`);const o=this.collect_filename_by_group(e,n);for(let s=0;s<o.length;s++){const i=o[s],a=`${i[1]}/${i[0]}`;await this._.contentEx.delete(a)}}async path_merge(e,n,o){console.log(`_path=${e}`);const s=[],i=this.collect_filename_by_group(e,o);for(let l=0;l<i.length;l++){const c=i[l],r=`${c[1]}/${c[0]}`,d=await this._.contentEx.get(r);s.push(d.content)}const a=s.join(`\r
`);return this._.contentEx.merge(n,a)}collect_filename_by_group(e,n){console.log(`[collect_filename_by_group] pat=${e}`);const o=[],s=e.length!=0?1:0;return n.forEach((i,a)=>{if(i.group==e){const l=i.group.substring(e.length+s);o.push([i.title,i.group,l.length!=0?`/${l}`:""])}}),o}}class fo{constructor(e){this._=e}async getLstContent(e){console.log("[getLstContent]");const n=i=>{const a=e.path==""?!0:i.path.indexOf(e.path)!=-1,l=e.keyword==""?!0:i.content.toLowerCase().indexOf(e.keyword)!=-1;return a&&l},o=await this.buildLstContent();return e!=null?o.filter(n):o}async buildLstContent(){var i;console.log("[buildLstContent]");const e=a=>{var r,d;let l=a.path;(l==""||l==null)&&(l=`@test/${new Date().toLocaleString()}`);const c=l.split("/");return a.title=(r=c.pop())!=null?r:".",a.group=(d=c.join("/"))!=null?d:"@test",a.tags=[],a.htags=[],a},n=await this._.contentEx.storeLS.getStrageEx(),o=[],s=a=>n[a];for(const a of Object.keys(n))try{o.push(e(JSON.parse((i=s(a))!=null?i:"")))}catch(l){console.log(`@ error key=${a},e=${l} - other error`)}return o}}class vo{constructor(){this.contentEx=new po(this),this.mgrExchange=new mo(this),this.mgrEtc=new _o(this),this.mgrMenu=new go(this),this.mgrCache=new fo(this),console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,n){return this.contentEx.set(e,n)}async cmd_save_ex(e,n){return this.contentEx.set_ex(e,n)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_rename(e,n){await this.contentEx.rename(e,n)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,n="",o=null){const s=await this.mgrCache.getLstContent(o);this.mgrExchange.backupEx(s,e,n)}async cmd_restoreEx(e,n,o=""){await this.mgrExchange.restoreEx(e,n,o)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,n){const o=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,n,o)}async cmd_path_delete(e){const n=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,n)}async cmd_path_merge(e,n){const o=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,n,o)}async cmd_chat(e,n,o){const i=(()=>{const c=new Date;return`${e}${o.mode}_${c.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${i}`);const a=await this.contentEx.get(i),l=await this.mgrEtc.chat(a,n,o);return await this.contentEx.set(i,l.content),[l,i]}}class bo{constructor(e){this.KEY="",console.log(e),this.KEY=e}get(e){var n;if(localStorage.getItem(this.KEY)!=null){const o=JSON.parse((n=localStorage.getItem(this.KEY))!=null?n:"");e(o),console.log(o)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const wo=1e3*60*10,It=Symbol(),yo=()=>{const t=Ze();Ae();const e=O({storeEx:new vo,persisted:new bo("lifeLog-Viewer-params"),filename:"",obj:new oe,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null}),n=g=>{console.log(`[update_filename] : new=${g}`),o(g)},o=async g=>{console.log(`[load_obj] : new=${g}`),console.dir(t),e.persisted.set({filename:g});const f=t.currentRoute.value.name.toString();if(g.indexOf(f)==-1){t.push(g.indexOf(".mm")!=-1?"/mm/":"/"),console.log("router.push");return}if(g!=""){const M=await e.storeEx.cmd_load(g);l(M)}else l(c(""));e.filename=g},s=()=>{console.log("restore_filename"),e.persisted.get(g=>{n(g.filename)})},i=async g=>{if(g==""){console.log("skip save - empty data");return}l(c(g)),await e.storeEx.cmd_save_ex(e.filename,e.obj),p()},a=()=>{console.log("[auto_save] start"),e.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(e.intervalId_autoSave)),e.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await C("export",null,null),e.intervalId_autoSave=null},wo)},l=g=>{const f=g instanceof oe?g:Object.assign(new oe,g);f.update_time(),e.tags=f.update_tag(),e.obj=f},c=g=>(e.obj.content=g,e.obj),r=async(g,f)=>{if(console.log(g),f!=null){const M=await e.storeEx.cmd_load(f);M.position=g,await e.storeEx.cmd_save_ex(f,M)}else e.obj.position=g},d=g=>{e.dictMenu=g},p=()=>{setTimeout(async()=>{d(await e.storeEx.cmd_rebuild()),a()},250)},u=g=>{e.jump=g,g!=-1&&(console.log(`jump=${g}`),e.ObjTag=JSON.parse(JSON.stringify(e.tags[g])),console.log(JSON.stringify(e.ObjTag)))},h=g=>{e.height=g},_=async(g,f)=>{const[M,T]=await e.storeEx.cmd_chat(e.path_expand,g,f);l(M),n(T),p()},b=async(g,f)=>{const M=await e.storeEx.cmd_exist(g);if(f==M)return!0;{const T=f?`error : ${g} is not exist. please enter exist filename.`:`error : ${g} is already exist. please enter other filename.`;return console.log(T),!1}},B=async(g,f)=>{await b(g,!1)&&(n(""),await e.storeEx.cmd_rename(f,g),n(g),p())},x=async(g,f)=>{const M=E(f)[0],T=E(g)[0];n(""),await e.storeEx.cmd_path_rename(M,T),p()},C=async(g,f,M)=>{console.log(`[do_cmd] mode=${g}`);let T=f!=""?f:e.filename,Y="",se;switch(g){case"update_jump":u(f);break;case"rebuild_menu":p();break;case"filter_menu":const Pe=f;f!=null&&(Pe.path=Pe.isUnderFolder?E(e.filename)[0]:""),d(await e.storeEx.cmd_getMenu(Pe));break;case"open_file":n(f);break;case"restore_file":s();break;case"save_file":await i(f);break;case"new":await b(f,!1)&&(await e.storeEx.cmd_create(f),n(f),p());break;case"delete":await b(T,!0)&&(n(""),await e.storeEx.cmd_delete(T),p());break;case"rename":B(f,M);break;case"backup":e.storeEx.cmd_backup("backup");break;case"export":e.storeEx.cmd_backup("export");break;case"restore":await e.storeEx.cmd_restoreEx("restore",null),p();break;case"import":await e.storeEx.cmd_restoreEx("import",f),p();break;case"split":await b(T,!0)&&(await e.storeEx.cmd_split(T),p());break;case"path_rename":x(f,M);break;case"path_delete":Y=E(f)[0],await e.storeEx.cmd_path_delete(Y),n(""),p();break;case"path_merge":Y=E(f)[0],T=`${Y}.md`,await b(T,!1)&&(await e.storeEx.cmd_path_merge(Y,T),n(T),p());break;case"print":const Dn=t.resolve({path:`/print/${e.filename}`});window.open(Dn.href,"_blank");break;case"journal":_("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":_(f,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":_(f,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":se={keyword:M.filter.toLowerCase(),isUnderFolder:M.isCheck,path:""},d(await e.storeEx.cmd_getMenu(se));break;case"update_position":await r(f,M);break;case"move_archive":B(`@archive/${f}`,f);break;case"move_path_archive":x(`@archive/${f}`,f);break;case"export_archive":se={keyword:"",isUnderFolder:!0,path:"@archive/"},e.storeEx.cmd_backup("export","",se);break}},E=g=>{const f=g.split("/"),M=f[f.length-1];return[f.slice(0,-1).join("/"),M]};return{store_data:{state:e,update_height:h,do_cmd:C}}},ko=()=>{Bt(It,yo())},ee=()=>Dt(It),xo=()=>{const t=O({objParam:null});return{store_dlg:{state:t,update_param:n=>{t.objParam=n}}}},Rt=Symbol(),$o=()=>{Bt(Rt,xo())},Re=()=>Dt(Rt);const Eo=N({setup(t){return ko(),$o(),(e,n)=>{const o=H("routerView");return v(),re(o)}}});var I=(t,e)=>{const n=t.__vccOpts||t;for(const[o,s]of e)n[o]=s;return n};const Co={key:0,class:"item"},So={key:1,class:"line"},Mo={key:1,class:"folder"},Do={key:2,class:"dropdown"},Bo=N({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const n=t,o=O({isOpen:!1,item:n.item,isFolder:n.item.children&&n.item.children.length,isActive:!0}),s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const l=a.cmd;s(l,null)}};return(a,l)=>{const c=H("fa"),r=H("MenuTreeItem",!0);return v(),w("div",{class:"menu_tree",onClick:l[0]||(l[0]=d=>i(m(o).item)),onContextmenu:l[1]||(l[1]=Ue(()=>{},["right","prevent"]))},[m(o).isFolder?A("",!0):(v(),w(U,{key:0},[m(o).item.title!=""?(v(),w("span",Co,[S(c,{icon:m(o).item.icon},null,8,["icon"]),pe(" "+P(m(o).item.title),1)])):A("",!0),m(o).item.title==""?(v(),w("div",So)):A("",!0)],64)),m(o).isFolder?(v(),w("span",Mo,[S(c,{icon:m(o).item.icon},null,8,["icon"]),pe(" "+P(m(o).item.title),1)])):A("",!0),m(o).isFolder?(v(),w("div",Do,[(v(!0),w(U,null,X(m(o).item.children,(d,p)=>(v(),w("div",{key:p},[S(r,{item:d,onEvent_callback:s},null,8,["item"])]))),128))])):A("",!0)],32)}}});var Lo=I(Bo,[["__scopeId","data-v-8e2b3a3a"]]);const To=N({props:{mouse:null,items:null},emits:["event_callback"],setup(t,{emit:e}){const n=t,o=O({items:n.items,pos_x:-1,pos_y:-1,style:"display:none"});j(()=>n.mouse,(a,l)=>{console.log("props"),o.pos_x=n.mouse.clientX,o.pos_y=n.mouse.clientY,o.items=n.items,o.style="display:block"});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{o.style=a?"display:block":"display:none"};return(a,l)=>(v(),w("div",{class:"menu",style:Z(m(o).style),onMouseover:l[0]||(l[0]=c=>i(!0)),onMouseleave:l[1]||(l[1]=c=>i(!1))},[(v(!0),w(U,null,X(m(o).items,c=>(v(),w("div",{key:c.path},[S(Lo,{item:c,onEvent_callback:s},null,8,["item"])]))),128))],36))}});var Ft=I(To,[["__scopeId","data-v-0bb8e3e5"]]);const jo=N({props:{objMenu:null},emits:["event_callback"],setup(t,{emit:e}){const o=O({items:t.objMenu,event:void 0}),s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{console.log("onClick"),o.event=a};return(a,l)=>{const c=H("fa");return v(),w("div",{class:"dropdown",onClick:i},[S(c,{icon:"bars"}),S(Ft,{mouse:m(o).event,items:m(o).items,onEvent_callback:s},null,8,["mouse","items"])])}}});var Oo=I(jo,[["__scopeId","data-v-2baeb9a8"]]);const No={class:"base"},Ao={key:0,class:"dropdown"},Io=["onClick"],Ro={class:"title_sub2"},Fo={class:"title"},Po={class:"title_sub"},Vo=N({props:{objMenuItem:null},emits:["event_callback"],setup(t,{emit:e}){const n=t,o=O({items:[],items2:[],isShowDlg:!1});j(()=>n.objMenuItem,(l,c)=>{o.items=s(l),o.items2=o.items.slice(0,5)});const s=l=>{console.log("[cnvLstRecent]");function c(d,p){const u=d.atime,h=p.atime;let _=0;return u>h?_=-1:u<h&&(_=1),_}const r=[...l];return r.sort(c),r.slice(0,15)},i=l=>{const c=o.items[l].path;e("event_callback","open_file",c),o.isShowDlg=!1},a=l=>{o.isShowDlg=l};return(l,c)=>{const r=H("fa");return v(),w("div",No,[y("span",{class:"_base",onMouseover:c[0]||(c[0]=d=>a(!0)),onMouseleave:c[1]||(c[1]=d=>a(!1))},[S(r,{icon:"history",class:"_item"}),m(o).isShowDlg?(v(),w("ul",Ao,[(v(!0),w(U,null,X(m(o).items,(d,p)=>(v(),w("li",{class:"item",key:p,onClick:u=>i(p)},[S(r,{class:"title_item",icon:"file-alt"}),y("span",Ro,P(d.group)+"/ ",1),y("span",Fo,P(d.title),1),y("span",Po," ["+P(d.atime)+"]",1)],8,Io))),128))])):A("",!0)],32)])}}});var zo=I(Vo,[["__scopeId","data-v-0145e15d"]]);const Ho=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],Ko=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],Go=[{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],Pt={dlg_import:{init:(t,e)=>{t.title="Restore",t.isFileOpen=!0,t.isNoEdit=!0,t.edit=""},action:t=>["import"]},dlg_delete:{init:(t,e)=>{t.title="Delete",t.isReadOnly=!0,t.edit=e},action:t=>["delete",t.edit,""]},dlg_rename:{init:(t,e)=>{t.title="Rename",t.edit=e},action:t=>["rename",t.edit,t.edit_org]},dlg_new:{init:(t,e)=>{t.title="Create",t.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:t=>["new",t.edit,""]},dlg_path_rename:{init:(t,e)=>{t.title="Rename of Path",t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_rename",t.edit,t.edit_org]},dlg_path_delete:{init:(t,e)=>{t.title="Delete of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_delete",t.edit,""]},dlg_path_merge:{init:(t,e)=>{t.title="Merge of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_merge",t.edit,""]},dlg_tweet:{init:(t,e)=>{t.title="Tweet",t.edit=""},action:t=>["tweet",t.edit,""]},dlg_bookmark:{init:(t,e)=>{t.title="Bookmark",t.edit="",t.isMulti=!0},action:t=>["bookmark",t.edit,""]},dlg_filter:{init:(t,e)=>{t.title="Filter",t.title2="target under folder",t.edit="",t.edit_org="@",t.isCheck=!0},action:t=>(console.log("dlg_filter"),["filter",t.filename,{filter:t.edit,isCheck:t.check}])}};const Uo=t=>(Lt("data-v-a16678bc"),t=t(),Tt(),t),Jo={class:"nav"},Yo=["title"],Wo={class:"cmd"},qo=Uo(()=>y("span",{class:"item"},null,-1)),Xo=N({emits:["event_callback"],setup(t,{emit:e}){const{store_data:n}=ee();Re();const o=$(null),s=O({filename:"@",objMenu:Ho,dctMenu:[]}),i=(r,d)=>{console.log(`[event_callback] cmd=${r}`),r=="top"?o.value.scrollIntoView({}):e("event_callback",r,d)};Q(()=>{console.log("[mounted]")});const a=r=>{console.log(`[doAction] cmd=${r}`),e("event_callback",r,!0)};j(()=>n.state.filename,(r,d)=>{console.log(`[watch:filename] ${r}`),c(r)}),j(()=>n.state.dictMenu,(r,d)=>{s.dctMenu=r}),j(()=>n.state.jump,(r,d)=>{window.setTimeout(()=>{l()},500)});const l=()=>{o.value.scrollIntoView({})},c=r=>{console.log(`[onChanged_filename] new=${r}`),s.filename=r,l()};return(r,d)=>{const p=H("fa");return v(),w("header",{class:"appbar",ref_key:"appbar",ref:o,onClick:d[6]||(d[6]=u=>i("top",!0))},[y("nav",Jo,[S(Oo,{class:"item",objMenu:m(s).objMenu,onEvent_callback:i,title:"menu"},null,8,["objMenu"]),y("section",{class:"item logo",onClick:d[0]||(d[0]=u=>i("filelist",!0)),title:m(s).filename},"Oden",8,Yo),S(zo,{class:"item",objMenuItem:m(s).dctMenu,onEvent_callback:i,title:"history"},null,8,["objMenuItem"]),m(s).filename!==""?(v(),w("span",{key:0,class:"item name",onClick:d[1]||(d[1]=u=>i("dlg_rename",null))}," ["+P(m(s).filename)+"] ",1)):A("",!0),y("span",{class:"item mark",onClick:d[2]||(d[2]=u=>a("toggle_editor")),title:"editor/viewer"},[S(p,{icon:"edit"})])]),y("span",Wo,[y("span",{class:"item",onClick:d[3]||(d[3]=u=>a("dlg_filter")),title:"filter"},[S(p,{icon:"paw"})]),y("span",{class:"item",onClick:d[4]||(d[4]=u=>a("dlg_tweet")),title:"tweet"},[S(p,{icon:"grimace"})]),y("span",{class:"item",onClick:d[5]||(d[5]=u=>a("dlg_bookmark")),title:"bookmark"},[S(p,{icon:"bookmark"})]),qo])],512)}}});var Vt=I(Xo,[["__scopeId","data-v-a16678bc"]]);const Zo=["title","onContextmenu"],Qo={key:0},es=N({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const n=t,o=O({isOpen:!1,item:n.item,isFolder:n.item.children&&n.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:s}=ee();j(()=>s.state.filename,(u,h)=>{r(u)});const i=(u,h)=>{console.log(`[event_callback] cmd=${u}`),e("event_callback",u,h)},a=(u,h)=>{console.log(`[event_callbackEx] cmd=${u}`),e("event_callback",u,o.item.path)};Q(()=>{r(s.state.filename)});const l=u=>{if(o.isFolder)console.log("onClick-folder"),o.isOpen=!o.isOpen;else{const h=u.path;console.log(`onClick-filename=${h}`),s.do_cmd("open_file",h)}},c=u=>{console.log("onClickEx"),o.menu=o.isFolder?Go:Ko,o.event=u},r=u=>{o.item.path==u,u.indexOf(o.item.name)!=-1&&(o.isOpen=!0),o.class_item=o.item.path==u?"item active":"item"},d=()=>o.isFolder?"folder":o.class_item,p=()=>o.isFolder?o.isOpen?"folder-open":"folder":o.item.file=="mm"?"pen":"file";return(u,h)=>{const _=H("fa"),b=H("tree-item",!0);return v(),w("div",{class:"file_tree",onContextmenu:h[1]||(h[1]=Ue(()=>{},["prevent"]))},[S(Ft,{mouse:m(o).event,items:m(o).menu,onEvent_callback:a},null,8,["mouse","items"]),y("div",{class:V(d()),title:m(o).item.time,onClick:h[0]||(h[0]=B=>l(m(o).item)),onContextmenu:Ue(c,["prevent"])},[S(_,{icon:p(),onClick:c},null,8,["icon"]),pe(" "+P(m(o).item.name),1)],42,Zo),m(o).isOpen?(v(),w("div",Qo,[(v(!0),w(U,null,X(m(o).item.children,(B,x)=>(v(),w("div",{key:x},[S(b,{item:B,onEvent_callback:i},null,8,["item"])]))),128))])):A("",!0)],32)}}});var ts=I(es,[["__scopeId","data-v-6b50d36f"]]);const ns={class:"tree"},os=N({emits:["event_callback"],setup(t,{emit:e}){const n=O({items:void 0}),{store_data:o}=ee();j(()=>o.state.dictMenu,(a,l)=>{i(a)});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)};Q(()=>{console.log("[mounted]"),i(o.state.dictMenu)});const i=a=>{console.log("[onChanged_dictMenu]"),n.items=void 0;const l=a,c={name:"",children:[],path:"",file:"",time:""},r="/",d={[r]:c},p=u=>u.split(".").slice(1);l.forEach(function(u){u.key.split("/").reduce(function(h,_){if(h[_])return h[_];{const b={name:_,children:[],path:u.path,file:p(_),time:u.atime};return h[r].children.push(b),h[r].file="",h[_]={[r]:b}}},d)}),console.dir(c),setTimeout(()=>{n.items=c.children},500)};return(a,l)=>(v(),w("div",ns,[S(jn,{_appear:"",name:"flip-list",tag:"div"},{default:Ie(()=>[(v(!0),w(U,null,X(m(n).items,c=>(v(),w("div",{key:c.path},[S(ts,{item:c,onEvent_callback:s},null,8,["item"])]))),128))]),_:1})]))}});var zt=I(os,[["__scopeId","data-v-2ccb3c4f"]]);const ss=N({props:{level:null},setup(t){const e=t,n=ne(()=>`h${e.level}`);return(o,s)=>(v(),re(On(m(n)),{class:"h_tag"},{default:Ie(()=>[Nn(o.$slots,"default",{},void 0,!0)]),_:3}))}});var is=I(ss,[["__scopeId","data-v-7eb56ab3"]]);const as=N({emits:["event_callback"],components:{heading:is},setup(t,e){const{store_data:n}=ee(),o=O({listTag:[]});j(()=>n.state.tags,(a,l)=>{o.listTag=a});function s(a){n.do_cmd("update_jump",a)}function i(a){return`${a.text}`}return{state:o,dispTitle:i,jumpSource:s}}}),ls={class:"tag"},cs=["onClick"];function rs(t,e,n,o,s,i){const a=H("heading");return v(),w("div",ls,[(v(!0),w(U,null,X(t.state.listTag,(l,c)=>(v(),w("div",{key:c,onClick:r=>t.jumpSource(c),class:"item"},[S(a,{level:l.tag},{default:Ie(()=>[pe(P(t.dispTitle(l)),1)]),_:2},1032,["level"])],8,cs))),128))])}var ds=I(as,[["render",rs],["__scopeId","data-v-c506de12"]]);const us=N({emits:["event_callback"],setup(t,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(s,i)=>{console.log(`cmd=${s}, name=${i}`),e.emit("event_callback",s,i)}}}}),hs={class:"main",style:{_height:"100px"}},ps=["onClick","title"];function gs(t,e,n,o,s,i){const a=H("fa");return v(),w("div",hs,[(v(!0),w(U,null,X(t.objToolbar,(l,c)=>(v(),w("button",{class:"btn-item",key:c,onClick:r=>t.event_callback("action",l.cmd),title:l.cmd},[S(a,{icon:l.icon},null,8,["icon"])],8,ps))),128))])}var ms=I(us,[["render",gs],["__scopeId","data-v-495368bc"]]);const Be={};class _s{constructor(e,n){Me(this,"cmdid",0);Me(this,"monaco",null);Me(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=n}add(e,n,o,s,i=null){let a;switch(s.length){case 0:a=this.generateCommand(e,i);break;case 1:a=this.generateHeaderCommand(s[0]);break;case 2:a=this.generateWrapperCommand(s[0],s[1]);break}Be[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:o,contextMenuGroupId:n&&"navigation",contextMenuOrder:n&&1.5,run:Be[e]})}generateCommand(e,n){return(o,s)=>{n(o)}}generateWrapperCommand(e,n){const o=e.length+n.length;return this.editor,this.editor.getModel(),this.monaco,(s,i)=>{const a=s.getModel(),l=s.getSelections();if(l==null)return;const c=[];return l.forEach(r=>{c.push(new i.Selection(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn+o)),a.pushEditOperations([],[{range:{startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.startLineNumber,endColumn:r.startColumn},text:e},{range:{startLineNumber:r.endLineNumber,startColumn:r.endColumn,endLineNumber:r.endLineNumber,endColumn:r.endColumn},text:n}])}),s.setSelections(c),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(n,o)=>{const s=n.getModel();let i=n.getSelections();return i==null&&(i=[n.getSelection()]),i.forEach(a=>{const l=s.findNextMatch("^(#+ )",{lineNumber:a.startLineNumber,column:1},!0,!1,null,!0);if(l!=null&&l.range.startLineNumber==a.startLineNumber&&l.range.startColumn==1){if(l.matches[1]==e)return;s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:l.matches[1].length+1},text:""}])}s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:1},text:e}])}),null}}}function fs(t,e){const n=s=>{const i=a=>`00${a}`.slice(-2);return`${s.getFullYear()}/${i(s.getMonth()+1)}/${i(s.getDate())} ${i(s.getHours())}:${i(s.getMinutes())}:${i(s.getSeconds())}`};console.log("[setupShortcutKeys]");const o=new _s(t,e);o.add("Bold","8_",[],["**","**"]),o.add("Italic","1_",[],["__","__"]),o.add("Underline","9_",[],["<u>","</u>"]),o.add("Strikethrough",!1,[t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.KEY_S],["~~","~~"]),o.add("Code",!1,[],["`","`"]),o.add("Link",!1,[],["[","]()"]),o.add("Link-2",!1,[],["[](",")"]),o.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),o.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),o.add("Header 1",!1,[],["# ",""]),o.add("Header 2",!1,[],["## ",""]),o.add("Header 3",!1,[],["### ",""]),o.add("Header 4",!1,[],["#### ",""]),o.add("Header 5",!1,[],["##### ",""]),o.add("Header 6",!1,[],["###### ",""]),o.add("Check",!1,[],["- [ ] ",""]),o.add("Blockquotes",!1,[],["> ",""]),o.add("Today",!1,[],[`${n(new Date)}`,""]),o.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),o.add("Format","8_",[],[],s=>{console.log("format"),s.getAction("editor.action.formatDocument").run()})}const vs={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},bs=N({emits:["event_callback"],components:{ToolbarEditor:ms},props:{isActive_preview:{type:Boolean,default:!1}},setup(t,e){const n=$(null),o={editor:void 0},{store_data:s}=ee(),i=O({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});Q(()=>{console.log("[mounted]"),l(),_(s.state.obj.content)}),j(()=>s.state.obj.content,(g,f)=>{console.log("[watch-body]"),i.filename!=""&&x(),_(g),C(s.state.obj.position,!0),i.filename=s.state.filename}),j(()=>s.state.ObjTag,(g,f)=>{console.log(`[watch](ObjTag)-${g}`),a(g)}),j(()=>t.isActive_preview,(g,f)=>{console.log(`[watch](editor_toggle)-${g}`),g==!0&&B()});const a=g=>{const f=T=>{u(T)};console.log(`[jump_cursor]ObjTag={${Object.values(g)}}`);const M=g.line;f(M),setTimeout(()=>{const T=o.editor;i.pos_scroll=T.getScrollTop()},500)},l=()=>{const g=()=>{const f=(Y,se)=>{fs(Y,se)},M=document.getElementById("container");if(console.log(`root=${M}`),M==null)return;const T=An.create(M,vs);return f(dt,T),console.log(`editor=${T}`),T.onDidScrollChange(Y=>{i.scrollInfo.height=Y.scrollHeight,i.scrollInfo.top=Y.scrollTop}),T};o.editor=g(),c()},c=()=>{o.editor.onDidBlurEditorText(g=>{B()})},r=(g,f)=>{switch(console.log(`[event_callback] cmd=${g}`),g){case"action":d(f);break;case"save":B();break}},d=g=>{console.log("[action]"),Be[g]!=null&&Be[g](o.editor,dt)},p=()=>o.editor.getValue(),u=g=>{const f=new In(g+1,0,g+1,0);console.log(`Line=${g}`),o.editor.revealRangeAtTop(f)},h=()=>o.editor.getModel().getAlternativeVersionId(),_=g=>{o.editor.setValue(g),i.iVersion=h()},b=()=>{const g=h();return console.info(`iVersion=${i.iVersion}, iVersion_cur=${g}`),i.iVersion!=g},B=(g=!1)=>{if(!b())return;g||x();const f=p();s.do_cmd("save_file",f),i.iVersion=h(),console.info(`iVersion=${i.iVersion}`)},x=()=>{const g=o.editor,f={top:g.getScrollTop(),height:g.getScrollHeight(),contentHeight:g.getLayoutInfo().height,scrolled:i.pos_scroll!=g.getScrollTop()};return b()?(s.do_cmd("update_position",f,void 0),B(!0)):s.do_cmd("update_position",f,i.filename),f},C=(g,f=!1)=>{if(g==null)return;console.log(`[e-set]value=${JSON.stringify(g)}`);const M=o.editor;if(f?!0:g.scrolled){const Y=g.top/g.height;console.log(`per=${Y}`);const se=M.getScrollHeight();M.setScrollTop(se*Y)}else a(s.state.ObjTag);setTimeout(()=>{i.pos_scroll=M.getScrollTop()},500)};ne(()=>o.editor.getScrollTop());const E=ne(()=>`${s.state.height-27}px`);return{editorEx:o,event_callback:r,HeightEx:E,md_editor_monaco:n,get_position:x,set_position:C}}}),ws={class:"editor"};function ys(t,e,n,o,s,i){const a=H("ToolbarEditor");return v(),w("div",ws,[S(a,{class:"toolbar",onEvent_callback:t.event_callback},null,8,["onEvent_callback"]),y("div",{id:"container",ref:"md_editor_monaco",class:"core",style:Z({height:t.HeightEx})},null,4)])}var ks=I(bs,[["render",ys],["__scopeId","data-v-3c6b08d8"]]);const xs=N({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(t,e){const n=$(null),{store_data:o}=ee(),s=O({contentsPosition:[],tocMap:new Map,observer:null,elm_target_before:null,pos_scroll:-1,filename:""});Q(()=>{function p(){const u=new Ve.Renderer;u.link=function(h,_,b){return h.indexOf("http")!=-1?`<a target="_blank" href="${h}">${b}</a>`:`<a target="_blank" href="#${h}">${b}</a>`},Ve.setOptions({renderer:u,langPrefix:"",breaks:!0})}console.log("[mounted]"),p()}),j(()=>o.state.obj.content,(p,u)=>{console.log("[watch-body]"),n.value,s.filename!=""&&l(),setTimeout(()=>{i(),c(o.state.obj.position,!0),s.filename=o.state.filename},0)});function i(){const p=E=>{E.forEach(g=>{const f=s.tocMap.get(g.target);console.log(g.intersectionRatio),g.intersectionRatio?(s.elm_target_before!=null&&s.elm_target_before.classList.remove("active"),f.classList.add("active"),s.elm_target_before=null):s.elm_target_before=f})};if(console.log(`md_viewer=${n.value}`),n.value==null)return;const u={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},h=new IntersectionObserver(p,u),_=new Map,B=document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),C=document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5");console.log(`el_contents=${B.length}`),console.log(`el_toc=${C.length}/${JSON.stringify(C)}`),B.forEach((E,g)=>{h.observe(E),_.set(C.item(g),E),_.set(E,C.item(g))}),s.tocMap=_,s.observer=h}j(()=>o.state.ObjTag,(p,u)=>{console.log(`[watch](ObjTag)-${p}`),a(p)}),j(()=>t.isActive_preview,(p,u)=>{console.log(`[watch](editor_toggle)-${p}`)}),ne(()=>n.value.querySelector(".md_core_viewer"));function a(p){const u=(b,B)=>{console.log(`tag=${b}, num=${B}`);const x=n.value,C=x.querySelectorAll(".md_core_viewer > h"+b);C.length!=0&&(x.scrollTop=C[B].getBoundingClientRect().top-x.getBoundingClientRect().top+x.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(p)}}`);const h=p.tag,_=p.num;p.line,u(h,_),setTimeout(()=>{const b=n.value;s.pos_scroll=b.scrollTop},0)}const l=()=>{const p=n.value,u={top:p.scrollTop,height:p.scrollHeight,contentHeight:0,scrolled:s.pos_scroll!=p.scrollTop};return o.do_cmd("update_position",u,s.filename),u},c=(p,u=!1)=>{if(console.log(`[v-set]value=${JSON.stringify(p)}`),n.value==null)return;const h=n.value;if(p==null){h.scrollTop=0;return}if(u?!0:p.scrolled){const b=p.top/p.height;console.log(`per=${b}`),console.log(`scrollTop=${h.scrollTop}, scrollHeight=${h.scrollHeight}`),h.scrollTop=h.scrollHeight*b}else a(o.state.ObjTag);setTimeout(()=>{s.pos_scroll=h.scrollTop},0)},r=ne(()=>Ve.parse(o.state.obj.content)),d=ne(()=>o.state.height+"px");return{status,Markdown:r,HeightEx:d,md_viewer:n,get_position:l,set_position:c}}}),$s=["innerHTML"];function Es(t,e,n,o,s,i){return v(),w("div",{class:"md_core_viewer note",innerHTML:t.Markdown,style:Z({height:t.HeightEx}),ref:"md_viewer"},null,12,$s)}var Ht=I(xs,[["render",Es],["__scopeId","data-v-3d0ee89a"]]);const Cs=N({components:{MarkdownEditor:ks,MarkdownViewer:Ht},props:{editor_toggle:{type:Boolean,default:!0}},setup(t,e){const n=$(),o=$(),s=O({isActive_preview:!0});j(()=>t.editor_toggle,(l,c)=>{console.log(`[watch](editor_toggle)-${l}`),a()}),Q(()=>{console.log("[mounted]"),document.addEventListener("keydown",i)}),Qe(()=>{document.removeEventListener("keydown",i)});const i=l=>{if(l.keyCode===83&&l.ctrlKey){l.preventDefault(),console.log("save"),a();return}else if(l.keyCode===69&&l.ctrlKey){l.preventDefault(),console.log("toggle"),a();return}},a=()=>{var r;const l=s.isActive_preview?{now:n,next:o}:{now:o,next:n},c=(r=l.now.value)==null?void 0:r.get_position();console.log(`isActive_preview=${s.isActive_preview}, scrollIndo=${JSON.stringify(c)}`),s.isActive_preview=!s.isActive_preview,setTimeout(()=>{var d;(d=l.next.value)==null||d.set_position(c)},500)};return{state:s,MdViewer:n,MdEditor:o}}});function Ss(t,e,n,o,s,i){const a=H("MarkdownViewer"),l=H("MarkdownEditor");return v(),w("div",null,[t.state.isActive_preview?(v(),re(a,{key:0,class:"md_viewer",ref:"MdViewer",isActive_preview:t.state.isActive_preview},null,8,["isActive_preview"])):(v(),re(l,{key:1,class:"md_editor",ref:"MdEditor",isActive_preview:t.state.isActive_preview},null,8,["isActive_preview"]))])}var Ms=I(Cs,[["render",Ss]]);const Ds={class:"modal-mask"},Bs={class:"modal-wrapper"},Ls={class:"modal-container"},Ts={class:"header"},js=["disabled"],Os=["disabled"],Ns={class:"modal-actions"},As=["disabled"],Is=N({emits:["event_callback"],setup(t,{emit:e}){const{store_dlg:n}=Re(),{store_data:o}=ee(),s=$(null),i=O({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});j(()=>n.state.objParam,u=>{a(u)});const a=u=>{const h=(_,b=!1)=>_!=null?_:b;console.log("[onChanged_objParam]"),i.title=u.title,i.title2=u.title2,i.edit=u.edit,i.edit_org=h(u.edit_org,u.edit),i.check=0,i.isShowDlg=!0,i.isNoEdit=h(u.isNoEdit),i.isFileOpen=h(u.isFileOpen),i.isReadOnly=h(u.isReadOnly),i.isCheck=h(u.isCheck),i.isMulti=h(u.isMulti),i.isDisabled=!0,i.action=u.action,d(!0),setTimeout(()=>{s.value.focus()},500)},l=u=>{if(console.log(`[doAction] flg=${u}, edit=${i.edit}`),u){const h=i.action(i);o.do_cmd(h[0],h[1],h[2])}i.isShowDlg=!1,d(!1)},c=u=>{const _=(u.target.files||u.dataTransfer.files)[0],b=i.action(i);o.do_cmd(b[0],_),i.isShowDlg=!1,d(!1)},r=()=>{const u=i.edit_org,h=i.edit==u&&!i.isReadOnly;return console.log(`[isDisabled]=${h}`),h},d=u=>{u==!0,document.addEventListener("keydown",p)},p=u=>{const h=u.key;switch(console.log(`key = ${h}`),h){case"Enter":u.preventDefault(),l(!0);break;case"Escape":u.preventDefault(),l(!1);break}};return(u,h)=>{const _=H("fa");return ae((v(),re(Fn,{persistent:""},{default:Ie(()=>[y("div",Ds,[y("div",Bs,[y("div",Ls,[y("div",Ts,P(m(i).title)+"?",1),y("form",{ref_key:"form",ref:s,class:"form"},[m(i).isFileOpen==!0?(v(),w("input",{key:0,class:"input",type:"file",onChange:c},null,32)):A("",!0),m(i).isNoEdit==!1?(v(),w(U,{key:1},[m(i).isMulti==!0?ae((v(),w("textarea",{key:0,class:"input",_autofocus:"","onUpdate:modelValue":h[0]||(h[0]=b=>m(i).edit=b),disabled:m(i).isReadOnly,_ref:"edit"},null,8,js)),[[Je,m(i).edit]]):ae((v(),w("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":h[1]||(h[1]=b=>m(i).edit=b),disabled:m(i).isReadOnly},null,8,Os)),[[Je,m(i).edit]])],64)):A("",!0),m(i).isCheck==!0?(v(),w(U,{key:2},[ae(y("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":h[2]||(h[2]=b=>m(i).check=b)},null,512),[[Ot,m(i).check]]),pe(" "+P(m(i).title2),1)],64)):A("",!0)],512),y("div",Ns,[y("button",{class:"btn btn-ok",ref:"ok",disabled:r(),onKeydown:h[3]||(h[3]=Rn(b=>l(!0),["enter"])),onClick:h[4]||(h[4]=b=>l(!0))},[S(_,{icon:"check"}),pe(" "+P(m(i).title),1)],40,As),y("button",{class:"btn btn-can",onClick:h[5]||(h[5]=b=>l(!1))},"cancel")])])])])]),_:1},512)),[[jt,m(i).isShowDlg]])}}});var Kt=I(Is,[["__scopeId","data-v-2e457ced"]]);const Rs={class:"container"},Fs={class:"main"},Ps=N({emits:["event_callback"],setup(t,{emit:e}){const{store_data:n}=ee(),{store_dlg:o}=Re();Ze();const s=Ae(),i=O({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});Q(()=>{console.log("[mounted]"),a(),window.addEventListener("resize",l),document.body.style.overflow="hidden"}),Qe(()=>{console.log("unmounted!"),window.removeEventListener("resize",l)});const a=()=>{const d=h=>{n.do_cmd("restore_file","")};console.log("init");const u=s.fullPath.split("api_bookmark?=");if(console.log(u),u.length==2){n.do_cmd("bookmark",decodeURIComponent(u.pop()));return}s.path.substring(1),n.do_cmd("filter_menu",null),d(),l()},l=()=>{const d=window.innerHeight-40;console.log(`height=${d}`),i.height=d,n.update_height(d)},c=async(d,p)=>{switch(console.log(`[event_callback] cmd=${d}, va0=${p}`),d){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"config":i.objDlgConf={cmd:d,filename:"",commit:""};break;case"filelist":document.querySelector(".col-3");const u=!i.toggle_list;i.toggle_list=u,console.log(i.toggle_list);break;default:if(d.indexOf("dlg_")!=-1){const h=Object.assign({},r(d,p));o.update_param(h)}else n.do_cmd(d,p);break}},r=(d,p)=>{const u=Pt[d],h=p!=null?p:n.state.filename;return u.init(u,h),u};return(d,p)=>(v(),w("div",Rs,[S(Vt,{ref:"appbar",onEvent_callback:c},null,512),S(Kt,{objParam:m(i).objDlgCmn,onEvent_callback:c},null,8,["objParam"]),y("div",Fs,[m(i).toggle_list?(v(),re(zt,{key:0,class:"col-3",onEvent_callback:c,style:Z({height:m(i).height+"px"})},null,8,["style"])):A("",!0),S(Ms,{class:"col-2",ref:"pane",editor_toggle:m(i).editor_toggle,style:Z({height:m(i).height+"px"})},null,8,["editor_toggle","style"]),S(ds,{class:"col-1",onEvent_callback:c,style:Z({height:m(i).height+"px"})},null,8,["style"])])]))}});var Vs=I(Ps,[["__scopeId","data-v-44b61a1c"]]);const zs={_class:"container"},Hs=N({emits:["event_callback"],setup(t,{emit:e}){ee();const n=Ae(),o=O({filename:"",height:window.innerHeight,timer3:-1});Q(()=>{console.log("[mounted]"),s(),document.body.style.overflow="hidden"});const s=()=>{console.log("init");const i=n.path.substring(1);n.fullPath,console.log(`filename=${i}`),o.filename=i,o.timer3=window.setTimeout(()=>{clearTimeout(o.timer3),window.print()},500)};return(i,a)=>(v(),w("div",zs,[pe(P(m(o).filename)+" ",1),S(Ht,{class:"md_viewer",_ref:"MdViewer",style:{"{\n          height":"initial"}})]))}}),D=Pn(),Ks="_container_1hhdk_1",Gs="_svg_1hhdk_18",Us="_trigger_1hhdk_44",Js="_dragging_1hhdk_47",Ys="_hidden_1hhdk_53",Ws="_text_1hhdk_73",qs="_selected_1hhdk_79",Xs="_content_1hhdk_79",Zs="_root_1hhdk_82",Qs="_edited_1hhdk_86",ei="_outline_1hhdk_89",ti="_collapse_1hhdk_99",ni="_disabled_1hhdk_145",oi="_gps_1hhdk_156",si="_fit_1hhdk_159",ii="_download_1hhdk_162",ai="_prev_1hhdk_165",li="_next_1hhdk_168",ci="_close_1hhdk_171";var k={container:Ks,"svg-wrapper":"_svg-wrapper_1hhdk_1","asst-svg":"_asst-svg_1hhdk_12",svg:Gs,trigger:Us,dragging:Js,"add-btn":"_add-btn_1hhdk_47",hidden:Ys,"expand-btn":"_expand-btn_1hhdk_64",text:Ws,selected:qs,content:Xs,root:Zs,edited:Qs,outline:ei,collapse:ti,"button-list":"_button-list_1hhdk_103","right-bottom":"_right-bottom_1hhdk_106","right-top":"_right-top_1hhdk_110",disabled:ni,gps:oi,fit:si,download:ii,prev:ai,next:li,close:ci};const ce=$(),G=$(),me=$(),He=$(),ie=$(),W=$();function ri(){const t=this.querySelector(`g.${k["add-btn"]}`);t&&(t.style.opacity="1")}function di(){const t=this.querySelector(`g.${k["add-btn"]}`);t&&(t.style.opacity="0")}const ui=t=>{const{g:e}=K;!e||(Oe.value=t.transform,e.attr("transform",t.transform.toString()))};function Gt(t,e){console.log("[onSelect]"),t.stopPropagation(),z(e)}function tt(t,e){var l,c;console.log("[onEdit]");const{foreign:n}=K;if(!cn||!n||!W.value)return;const o=(l=this.parentNode)==null?void 0:l.parentNode;o.classList.add(k.edited),D.emit("edit-flag",!1),console.log(`name/id=${e.name}/${e.id}`),n.attr("x",e.x-2-(e.left?e.width:0)).attr("y",e.y-L.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const s=W.value;s.textContent=e.name,s.focus(),(c=getSelection())==null||c.selectAllChildren(s);const i=o.querySelector(`:scope > .${k.content}`);i&&fn(i);const a=r=>{const d=r.key;switch(console.log(`[onEdit] keydown=${d}`),d){case"Enter":if(r.shiftKey)return;r.stopPropagation(),Ye(new FocusEvent("")),setTimeout(()=>{z(e),G.value.focus()},250);break;case"Escape":r.stopPropagation(),Ye(new FocusEvent(""),!0),G.value.focus();break}};s.addEventListener("keydown",a)}const Ye=(t,e=!1)=>{var i;if(console.log("[onEditBlur]"),(i=document.getElementsByClassName(k.edited)[0])==null||i.classList.remove(k.edited),ie.value==null||W.value==null){console.log("skip not active foreign");return}if(ie.value.style.display=="none"){console.log("skip display=none");return}ie.value.style.display="none";const n=ie.value.getAttribute("data-id"),o=ie.value.getAttribute("data-name"),s=W.value.textContent;e||n&&s!==null&&s!==o&&fa(n,s)},ut=t=>{if(t.preventDefault(),!ce.value)return;const e=Oi(ce.value,t);qt.value=e;const o=t.composedPath().find(s=>{var i;return(i=s.classList)==null?void 0:i.contains("node")});if(o){const{classList:s}=o,i=s.contains(k.root),a=s.contains(k.collapse);s.contains(k.selected)||z(o),Qt.value.disabled=i,on.value.disabled=i,sn.value.disabled=i,tn.value.disabled=i,nn.value.disabled=i,en.value.disabled=i,Zt.value.disabled=!a,Xt.value.disabled=a||s.contains("leaf"),We.value=!1}else We.value=!0;D.emit("showContextmenu",!0)},F=(t,e)=>{var n,o;switch(console.log(`[onClickMenu] name=${t}`),t){case"zoomfit":De();break;case"zoomin":mt(!1);break;case"zoomout":mt(!0);break;case"add":Ut(new MouseEvent("click"),R());break;case"delete":{const s=R(),i=s.parent;St(s.id),z(i)}break;case"delete-one":{const s=R(),i=s.parent;ba(s.id),z(i)}break;case"collapse":{const s=R();wa(R().id),z(s)}break;case"expand":{const s=R();Sn(R().id),z(s)}break;case"add-sibling":{const s=R(),i=Mt(s.id,"");i&&(z(i),we(i))}break;case"add-sibling-before":{const s=R(),i=Mt(s.id,"",!0);i&&(we(i),z(i))}break;case"add-parent":{const s=R(),i=ya(s.id,"");i&&(we(i),z(i))}break;case"cut":{const{id:s}=R(),i=(n=L.find(s))==null?void 0:n.rawData;i&&navigator.clipboard.writeText(JSON.stringify(i)),St(s)}break;case"copy":{const s=R(),i=(o=L.find(s.id))==null?void 0:o.rawData;i&&navigator.clipboard.writeText(JSON.stringify(i))}break;case"paste":{const s=R();navigator.clipboard.readText().then(i=>{const a=Ri(i)||{name:i},l=Cn(s.id,a);z(l)})}break;case"edit":we(R());break;case"undo":st();break;case"redo":ot();break;case"move_focus_x":hi(e==null?void 0:e.direct);break;case"move_focus_y":pi(e==null?void 0:e.direct);break}},hi=t=>{let e=null;const n=R();if(console.log(`seleData.left=${n.left}`),!!(n.left&&t==!1||n.left==!1&&t))if(console.log("to child"),n.children.length!=0)e=n.children[0];else return;else if(console.log("to parent"),n.parent!=null)e=n.parent;else return;z(e)},pi=t=>{let e=null;const n=R();if(n.parent==null)return;let o=+n.id.split("-").pop(),s=n.parent.children.length,i=o+(t?1:-1);0<=i&&i<s&&(e=n.parent.children[i],z(e))},Ut=(t,e)=>{const n=Cn(e.id,"");n&&(we(n,t),z(e))};function we(t,e=new MouseEvent("click")){const{g:n}=K;if(!n)return;const s=n.selectAll(`g[data-id='${Fe(t)}'] > g.${k.content} > g.${k.text}`).node();s&&(D.emit("edit-flag",!0),tt.call(s,e,t))}const gi=(t,e)=>{Sn(e.id)};function mi(t,e){var c;const n=(c=this.parentNode)==null?void 0:c.parentNode;G.value&&G.value.classList.add(k.dragging);const{g:o}=K;if(!o)return;_n(n,e,[t.x-e.x,t.y-e.y]);const s=Vn(t,me.value);s[1]+=L.data.y;const i=o.selectAll("g.node").filter(r=>{if(r!==e&&r!==e.parent&&!r.id.startsWith(e.id)){let d=q,p=r.width+q;r.left&&r.depth!==0&&([d,p]=[p,d]);const u={x0:r.x-d,x1:r.x+p,y0:r.y-q,y1:r.y+r.height+q};return s[0]>u.x0&&s[1]>u.y0&&s[0]<u.x1&&s[1]<u.y1}return!1}),a=Array.from(document.getElementsByClassName(k.outline)),l=i.node();a.forEach(r=>{r!==l&&r.classList.remove(k.outline)}),l==null||l.classList.add(k.outline)}function _i(t,e){var u;const n=(u=this.parentNode)==null?void 0:u.parentNode;G.value&&G.value.classList.remove(k.dragging);const o=document.getElementsByClassName(k.outline)[0];if(o){o.classList.remove(k.outline);const h=o.getAttribute("data-id");if(h)e.px=0,e.py=0,va(h,e.id);else throw new Error("outline data-id null");console.log("@1");return}const s=e.x-L.getRootWidth()/2;console.log(`d.x/getRootWidth=${e.x}/${L.getRootWidth()}`);const i=e.depth===1&&s*(s+e.px)<0,a=i?h=>h.left!==e.left:h=>h.left===e.left;console.log(`xToCenter/lr=${s}/${i}`);const l=n.parentNode;let c=i?{y:1/0,id:e.id}:e,r=i?{y:-1/0,id:e.id}:e;const d=le(l).selectAll(`g.${at(e).join(".")}`).filter(h=>h!==e&&a(h)),p=e.y+e.py;d.each(h=>{(i||h.y>e.y)&&h.y<p&&h.y>r.y&&(r=h),(i||h.y<e.y)&&h.y>p&&h.y<c.y&&(c=h)}),i?(e.px=0,e.py=0,ka(e.id),console.log("@4")):c.id!==e.id?(e.px=0,e.py=0,Ct(e.id,c.id),console.log("@2")):r.id!==e.id?(e.px=0,e.py=0,Ct(e.id,r.id,1),console.log("@3")):(_n(n,e,[0,0],500),console.log("@5"))}const ht=t=>{const{svg:e}=K;!e||(t?(Se(e),e.on("dblclick.zoom",null)):e.on(".zoom",null))},fi=t=>{const{g:e}=K;if(!W.value||!e)return;const n=e.selectAll(`g.${k.text}`);t?n.on("click",tt):n.on("click",null)},vi=t=>{const{g:e}=K;if(!e)return;const n=e.selectAll(`g.${k.text}`);t?n.on("mousedown",Gt):n.on("mousedown",null)},pt=t=>{!ce.value||(t?(console.log("@switchContextmenu"),ce.value.addEventListener("contextmenu",ut)):ce.value.removeEventListener("contextmenu",ut))},bi=t=>{const{g:e}=K;if(!e)return;const n=e.selectAll(`g.node:not(.${k.root}) > g > g.${k.text}`);t?dn(n):n.on(".drag",null)};let Jt,nt,Yt,Wt;D.on("selection-svg",t=>Jt=t);D.on("selection-g",t=>nt=t);D.on("selection-asstSvg",t=>Yt=t);D.on("selection-foreign",t=>Wt=t);const We=$(!0),qt=$({left:0,top:0}),Xt=$({name:"collapse",disabled:!0}),Zt=$({name:"expand",disabled:!0}),Qt=$({name:"delete",disabled:!1}),wi=$({name:"add",disabled:!1}),en=$({name:"add-parent",disabled:!1}),tn=$({name:"add-sibling",disabled:!1}),nn=$({name:"add-sibling-before",disabled:!0}),on=$({name:"cut",disabled:!1}),yi=$({name:"copy",disabled:!1}),ki=$({name:"paste",disabled:!1}),sn=$({name:"delete-one",disabled:!1}),xi=ne(()=>[[wi.value,en.value,tn.value,nn.value],[on.value,yi.value,ki.value,Qt.value,sn.value],[{name:"selectall",disabled:!0}],[Xt.value,Zt.value]].filter((t,e)=>e===0||e===1?he.value.edit:!0)),$i=ne(()=>[[{name:"zoomin",disabled:Oe.value.k>=ve[1]},{name:"zoomout",disabled:Oe.value.k<=ve[0]},{name:"zoomfit",disabled:!1}],[{name:"selectall",disabled:!0}]]),Ei=ne(()=>We.value?$i.value:xi.value),an=zn().source(t=>t.source).target(t=>t.target),Ci=Hn().curve(Kn),Si=({source:t,target:e})=>Ci([t,e]);let Le=!1,ln=an;const Te=$(!1);D.on("sharp_corner",t=>{Le!==t&&(Te.value=!0),Le=!!t,ln=t?Si:an});let je=4;D.on("branch",t=>je=t||je);let ve=[.1,8];D.on("scale-extent",t=>ve=t||ve);let cn=!1;D.on("edit-flag",t=>cn=!!t);const Mi=6,ge=10;let _e=16,ke=64,q=Math.min(_e/2-1,ge);D.on("gap",t=>{!t||(ke=t.xGap,_e=t.yGap,q=Math.min(_e/2-1,ge),q=Math.min(ke/2-1,q))});const Di=new ResizeObserver(t=>{const{foreign:e}=K;if(!e)return;const n=t[0],o=n.target,{width:s,height:i}=n.contentRect,a=parseInt(getComputedStyle(o).paddingLeft||"0",10),l=parseInt(getComputedStyle(o.parentNode).borderTopWidth||"0",10),c=(a+l)*2;e.attr("width",s+c).attr("height",i+c),e.style("display")!=="none"&&fn(o),console.log("observer")}),be={side:12,padding:2,margin:8},rn=be.side+be.padding*2,ue={width:16,height:4,radius:2},Oe=$(Nt),Se=Gn().on("zoom",ui).scaleExtent(ve),dn=Un().container(Ni).on("drag",mi).on("end",_i),Ee=$(!1);let un;D.on("mindmap-context",t=>t?un=t:null);const he=$({drag:!1,edit:!1});class Bi{constructor(e=20){this.length=e,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(e){const n=ye.exports.cloneDeep(e);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(n),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,ye.exports.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,ye.exports.cloneDeep(this.snapshots[this.cursor])):null}}const Ce=new Bi,hn=$(!1),pn=$(!1),Li=()=>{hn.value=Ce.hasPrev,pn.value=Ce.hasNext},Ti=(t,e)=>{const n=-e/2,o=-t/2,s=t/2,i=e/2;return`M${i},${s}H${s}V${i}H${o}V${s}H${n}V${o}H${o}V${n}H${s}V${o}H${i}V${s}Z`},gn=t=>{const e=t.split(`
`);return e.length>1&&e[e.length-1]===""&&e.pop(),e},ji=(t,e)=>{Yn(t).then(n=>{const o=n.toDataURL(),s=open();s&&(s.document.write(`<img src='${o}'>`),s.document.title=e,s.document.close())})},mn=(t,e)=>Jn().duration(t).ease(e),Oi=(t,e)=>{const{pageX:n,pageY:o}=e,s=t.getBoundingClientRect(),i=s.left+window.pageXOffset,a=s.top+window.pageYOffset;return{left:n-i,top:o-a}};function Ni(){var t,e;return(e=(t=this.parentNode)==null?void 0:t.parentNode)==null?void 0:e.parentNode}function z(t){const e=t instanceof SVGGElement?t:document.querySelector(`g[data-id='${Fe(t)}']`),n=document.getElementsByClassName(k.selected)[0];if(e)n?n!==e?(n.classList.remove(k.selected),e.classList.add(k.selected),console.log("remove & add selected")):(console.log("edit-flag - same"),D.emit("edit-flag",!0)):(console.log("add selected"),e.classList.add(k.selected));else throw new Error("selectGNode failed")}function R(){console.log("getSelectedGData");const e=le(`.${k.selected}`).data();if(e.length==0)return null;const n=e[0];return console.log(`id/name=${n.id}/${n.name}`),n}const gt=t=>{const{asstSvg:e}=K;if(!e)throw new Error("asstSvg undefined");const n=gn(t),o=e.append("text");o.selectAll("tspan").data(n).enter().append("tspan").text(i=>i).attr("x",0);const s=o.node().getBBox();return o.remove(),{width:Math.max(s.width,22),height:Math.max(s.height,22)*n.length}},_n=(t,e,n,o=0)=>{const s=mn(o,At);e.px=n[0],e.py=n[1],le(t).transition(s).attr("transform",vn),le(`g[data-id='${Fe(e)}'] > path`).transition(s).attr("d",i=>Ne(i))},Ke=()=>{const{svg:t}=K;if(!t)return;const e=L.data;Se.translateTo(t,0+e.width/2,0+e.height/2)},De=()=>{const{svg:t}=K;if(!t||!me.value||!G.value)return;const e=me.value.getBBox(),n=G.value.getBoundingClientRect(),o=Math.min(n.width/e.width,n.height/e.height),s={x:n.width/2,y:n.height/2},i={x:e.width*o/2,y:e.height*o/2},a=Nt.translate(-e.x*o+s.x-i.x,-e.y*o+s.y-i.y).scale(o);Se.transform(t,a)},fn=t=>{const{svg:e}=K;if(e&&G.value){const{k:n}=Oe.value,o=t.getBoundingClientRect(),{x:s,y:i,width:a,height:l}=G.value.getBoundingClientRect(),c=o.x-s,r=c+o.width,d=o.y-i,p=d+o.height,u=2;let h=0,_=0;c<0&&(h=-c/n+u),(o.width>a||r>a)&&(h=-(r-a)/n-u),d<0&&(_=-d/n+u),(o.height>l||p>l)&&(_=-(p-l)/n-u),Se.translateBy(e,h,_)}},mt=t=>{const{svg:e}=K;!e||Se.scaleBy(e,t?1.1:.9)},Ai=()=>{!ce.value||ji(ce.value,L.data.name)},ot=()=>{const t=Ce.next();t&&(L.data=t,J(!1))},st=()=>{const t=Ce.prev();t&&(L.data=t,J(!1))},Ii=()=>{console.log("bindForeignDiv:pre"),W.value&&(console.log("bindForeignDiv:enter"),Di.observe(W.value),W.value.addEventListener("blur",Ye),W.value.addEventListener("mousedown",t=>{t.stopPropagation(),console.log("foreignDivEle@mousedown")}),W.value.addEventListener("keydown",t=>{t.stopPropagation();const e=t.key;console.log(`foreignDivEle@keydown=${e}`)}),G.value.addEventListener("keydown",t=>{const e=t.key;switch(console.log(`svgEle@keydown=${e}`),e){case"ArrowRight":F("move_focus_x",{direct:!0});break;case"ArrowLeft":F("move_focus_x",{direct:!1});break;case"ArrowDown":F("move_focus_y",{direct:!0});break;case"ArrowUp":F("move_focus_y",{direct:!1});break;case"Insert":case"i":t.preventDefault(),F(t.ctrlKey?"add-sibling":"add");break;case"b":t.preventDefault(),F("add-sibling");break;case"Delete":case"d":F(t.ctrlKey?"delete":"delete-one");break;case"Enter":t.preventDefault(),F("edit");break;case"@":F("zoomfit");{const n=R();z(n)}break;case"[":F("zoomout");break;case"]":F("zoomin");break;case"c":F("copy");break;case"v":F("paste");break;case"z":st();break;case"y":ot();break;case"o":F("collapse");break;case"e":F("expand");break}}))},Ri=t=>{let e;try{return e=JSON.parse(t),"name"in e?e:!1}catch{return!1}},it=()=>3,at=t=>{const e=["node"];return t&&e.push(`depth-${t.depth}`),e},Fi=t=>{const e=at(t);return t&&(t.depth===0&&e.push(k.root),t.collapse?e.push(k.collapse):(!t.children||t.children.length===0)&&e.push("leaf")),e},Pi=t=>{const e=[k["add-btn"]];return t.collapse&&e.push(k.hidden),e},vn=t=>`translate(${t.dx+t.px},${t.dy+t.py})`,Fe=t=>t.id,bn=t=>{const e=gn(t.name),n=t.height/e.length;return e.map(o=>({name:o,height:n}))},Ne=t=>{let e=0,n=0;const o=Math.max(q-3,0);let s=t.width+o;const i=it();let a=i;const{parent:l}=t;l&&(e=l.width,n=l.height,l.depth===0&&(Le||(e/=2),n/=2,a=0)),t.left&&(l&&(l.depth!==0?e=-e:Le&&(e=0)),s=-s);const c=[-t.dx+e-t.px,-t.dy+n+a-t.py],r=[0,t.height+i];return`${ln({source:c,target:r})}L${s},${r[1]}`},Vi=(t,e)=>{const n=t.depth===0?t.height/2:t.height+it();let o=t.width+e+rn/2+be.margin;return t.left&&(o=-o),`translate(${o},${n})`},zi=(t,e)=>{const o=t.depth===0?t.height/2:t.height+it();let s=t.width+e+ue.width/2+4;return t.left&&(s=-s),`translate(${s},${o})`},wn=(t,e,n,o,s)=>{t?(bt(e,ge),_t(n,ge,Mi),ft(o,ge),s&&vt(s,ge)):(bt(e,q),_t(n,q),ft(o,q),s&&vt(s,q))},yn=(t,e)=>{const n=t.attr("class",s=>Fi(s).join(" ")).attr("data-id",Fe);(e?n.transition(e):n).attr("transform",vn)},kn=(t,e)=>{(e?t.transition(e):t).attr("transform",o=>`translate(${o.left?-o.width:0},0)`)},lt=t=>{t.attr("alignment-baseline","text-before-edge").text(e=>e.name||" ").attr("x",0).attr("dy",(e,n)=>n?e.height:0)},Hi=t=>{const{side:e,padding:n}=be,o=4,s=-n-e/2,i=e+n*2;t.attr("x",s).attr("y",s).attr("rx",o).attr("ry",o).attr("width",i).attr("height",i)},Ki=t=>{t.attr("x",-ue.width/2).attr("y",-ue.height/2).attr("width",ue.width).attr("height",ue.height).attr("rx",ue.radius).attr("ry",ue.radius).attr("stroke",e=>e.color||"grey").attr("fill",e=>e.color||"grey")},Ge=(t,e)=>{t.attr("cx",e).attr("cy",0).attr("r",1)},_t=(t,e,n=4)=>{t.attr("x",o=>-e-(o.left?o.width:0)).attr("y",-e).attr("rx",n).attr("ry",n).attr("width",o=>o.width+e*2).attr("height",o=>o.height+e*2)},ft=(t,e)=>{t.attr("class",k["expand-btn"]).attr("transform",n=>zi(n,e)).style("color",n=>n.color)},vt=(t,e)=>{t.attr("class",n=>Pi(n).join(" ")).attr("transform",n=>Vi(n,e))},bt=(t,e)=>{const n=rn+be.margin,o=e*2;t.attr("class",k.trigger).attr("x",s=>-e-(s.left?s.width+n:0)).attr("y",-e).attr("width",s=>s.width+o+n).attr("height",s=>s.height+o)},xn=(t,e)=>{const n=t.attr("stroke",o=>o.color).attr("stroke-width",je);if(e){const o=n.transition(e);Te.value?o.attrTween("d",Gi):o.attr("d",Ne)}else n.attr("d",Ne)};function Gi(t,e,n){const s=Ne(t),i=n[e],a=i.cloneNode(),l=i.getTotalLength();a.setAttribute("d",s);const c=a.getTotalLength(),r=[0],d=10/Math.max(l,c);let p=0;for(;(p+=d)<1;)r.push(p);r.push(1);const u=r.map(h=>{const _=i.getPointAtLength(h*l),b=a.getPointAtLength(h*c);return Wn([_.x,_.y],[b.x,b.y])});return h=>h<1?"M"+u.map(_=>_(h)).join("L"):s}const Ui=t=>{const e=t.append("tspan");return lt(e),e},Ji=t=>(lt(t),t),Yi=t=>{const e=t.append("g");return Hi(e.append("rect")),e.append("path").attr("d",Ti(2,be.side)),e},$n=t=>{const e=Yi(t);return e.on("click",Ut),e},Wi=t=>{const e=t.append("g");return Ki(e.append("rect")),Ge(e.append("circle"),-4),Ge(e.append("circle"),0),Ge(e.append("circle"),4),e},qi=(t,e)=>{if(t.select(`:scope > g.${k.content} > g.${k["expand-btn"]}`).on("click",gi),he.value.drag||he.value.edit){const o=t.select(`:scope > g.${k.content} > g.${k.text}`);o.on("mousedown",Gt),he.value.drag&&!e&&dn(o),he.value.edit&&o.on("click",tt)}Ee.value&&t.select(`:scope > g.${k.content}`).on("mouseenter",ri).on("mouseleave",di)},Xi=t=>{var p;const e=!((p=t.data()[0])!=null&&p.depth),n=t.append("g");yn(n),xn(n.append("path"));const o=n.append("g").attr("class",k.content),s=o.append("rect"),i=o.append("g").attr("class",k.text),a=i.append("rect"),l=i.append("text");kn(l);const c=l.selectAll("tspan").data(bn).enter().append("tspan");lt(c);let r;Ee.value&&(r=$n(o));const d=Wi(o);return wn(e,s,a,d,r),qi(n,e),n.each((u,h)=>{!u.children||fe(u.children,n.filter((_,b)=>h===b))}),o.raise(),n},Zi=t=>{var d;const e=!((d=t.data()[0])!=null&&d.depth),n=mn(500,At);yn(t,n),xn(t.select(":scope > path"),n);const o=t.select(`:scope > g.${k.content}`),s=o.select(":scope > rect"),i=o.select(`g.${k.text}`),a=i.select("rect"),l=i.select("text");kn(l,n),l.selectAll("tspan").data(bn).join(Ui,Ji,p=>p.remove());let c=o.select(`g.${k["add-btn"]}`);const r=o.select(`g.${k["expand-btn"]}`);return Ee.value?c.node()||(c=$n(o)):c.remove(),wn(e,s,a,r,c),t.each((p,u)=>{!p.children||fe(p.children,t.filter((h,_)=>u===_))}),o.raise(),t},fe=(t=[L.data],e=nt)=>{e.selectAll(`g.${at(t[0]).join(".")}`).data(t,o=>o.gKey).join(Xi,Zi)};class Qi{constructor(e,n,o,s){this.w=e,this.h=n,this.y=o,this.c=s,this.cs=s.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function wt(t){t.cs===0?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function xe(t){return t.y+t.h}class ea{constructor(e,n,o){this.lowY=e,this.index=n,this.next=o}}function yt(t,e,n){for(;n!==null&&t>=n.lowY;)n=n.next;return new ea(t,e,n)}function ta(t,e,n,o){if(n!==e-1){const s=e-n;t.c[n+1].shift+=o/s,t.c[e].shift-=o/s,t.c[e].change-=o-o/s}}function na(t,e,n,o){t.c[e].mod+=o,t.c[e].msel+=o,t.c[e].mser+=o,ta(t,e,n,o)}function oa(t){return t.cs===0?t.tl:t.c[0]}function sa(t){return t.cs===0?t.tr:t.c[t.cs-1]}function ia(t,e,n,o){const s=t.c[0].el;s.tl=n;const i=o-n.mod-t.c[0].msel;s.mod+=i,s.prelim-=i,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}function aa(t,e,n,o){const s=t.c[e].er;s.tr=n;const i=o-n.mod-t.c[e].mser;s.mod+=i,s.prelim-=i,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}function la(t,e,n){let o=t.c[e-1],s=o.mod,i=t.c[e],a=i.mod;for(;o!==null&&i!==null;){xe(o)>n.lowY&&(n=n.next);const l=s+o.prelim+o.w-(a+i.prelim);l>0&&(a+=l,na(t,e,n.index,l));const c=xe(o),r=xe(i);c<=r&&(o=sa(o),o!==null&&(s+=o.mod)),c>=r&&(i=oa(i),i!==null&&(a+=i.mod))}o===null&&i!==null?ia(t,e,i,a):o!==null&&i===null&&aa(t,e,o,s)}function ca(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}function qe(t){if(t.cs===0){wt(t);return}qe(t.c[0]);let e=yt(xe(t.c[0].el),0,null);for(let n=1;n<t.cs;n++){qe(t.c[n]);const o=xe(t.c[n].er);la(t,n,e),e=yt(o,n,e)}ca(t),wt(t)}function ra(t){let e=0,n=0;for(let o=0;o<t.cs;o++)e+=t.c[o].shift,n+=e+t.c[o].change,t.c[o].mod+=n}function En(t,e){e+=t.mod,t.x=t.prelim+e,ra(t);for(let n=0;n<t.cs;n++)En(t.c[n],e)}function da(t){qe(t),En(t,0)}class ua{constructor(e,n){this.gap=e,this.bottomPadding=n}addBoundingBox(e,n){return{width:e+this.gap,height:n+this.bottomPadding}}removeBoundingBox(e,n){return{x:e+this.gap/2,y:n}}}class ha{constructor(e){this.bb=e}layout(e){const n=this.convert(e);da(n);const{boundingBox:o,result:s}=this.assignLayout(n,e);return{result:s,boundingBox:o}}convert(e,n=0){const{width:o,height:s}=this.bb.addBoundingBox(e.width,e.height),i=[];if(e.children&&e.children.length)for(let a=0;a<e.children.length;a++)i[a]=this.convert(e.children[a],n+s);return new Qi(o,s,n,i)}assignCoordinates(e,n){const{x:o,y:s}=this.bb.removeBoundingBox(e.x,e.y);n.x=o,n.y=s;for(let i=0;i<e.c.length;i++)this.assignCoordinates(e.c[i],n.children[i])}getSize(e,n){const{x:o,y:s,width:i,height:a}=e;if(n||(n={left:o,right:o+i,top:s,bottom:s+a}),n.left=Math.min(n.left,o),n.right=Math.max(n.right,o+i),n.top=Math.min(n.top,s),n.bottom=Math.max(n.bottom,s+a),e.children)for(const l of e.children)this.getSize(l,n);return n}assignLayout(e,n,o){const{x:s,y:i}=this.bb.removeBoundingBox(e.x,e.y);n.x=s,n.y=i;const{width:a,height:l}=n;o||(o={left:s,right:s+a,top:i,bottom:i+l}),o.left=Math.min(o.left,s),o.right=Math.max(o.right,s+a),o.top=Math.min(o.top,i),o.bottom=Math.max(o.bottom,i+l);for(let c=0;c<e.c.length;c++)this.assignLayout(e.c[c],n.children[c],o);return{result:n,boundingBox:o}}}const kt=t=>[t.width,t.height]=[t.height,t.width],pa=t=>{t.parent?(t.dx=t.x-t.parent.x,t.dy=t.y-t.parent.y):(t.dx=0,t.dy=0)},de=(t,e)=>t.id=e,ga=t=>{t.parent?t.depth=t.parent.depth+1:t.depth=0},xt=t=>{t.parent&&t.parent.color&&(t.color=t.parent.color)},ma=t=>{t.depth>1&&t.parent&&(t.left=t.parent.left)},_a=t=>{const e=Object.assign({},t),n=Object.assign({},t);if(!t.collapse){const{children:o}=t;e.children=[],n.children=[],o.forEach(s=>{s.left?e.children.push(s):n.children.push(s),s.parent&&(s.parent=n)})}return{left:e,right:n}},Xe=(t,e,n="0")=>{var s;e.forEach(i=>{i(t,n)});const{children:o}=t;if(o)for(let i=0;i<o.length;){const a=o[i];a.id==="del"?(o.splice(i,1),(s=t.rawData.children)==null||s.splice(i,1)):(Xe(a,e,`${n}-${i}`),i+=1)}},$t=(t,e)=>{const n=new ua(e,t);return new ha(n)};class Et{constructor(e,n,o,s,i=qn(Xn)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.colorScale=i,this.getSize=s,this.layout=$t(n,o),this.data=this.createMdataFromData(e,"0"),this.renew()}createMdataFromData(e,n,o=null){n=="0-0"&&console.log("@");const{name:s,collapse:i,children:a}=e,{width:l,height:c}=this.getSize(s),r=o?o.depth+1:0;let d=!1,p=o?o.color:"";r===1?(d=!!e.left,p=this.colorScale(`${this.colorNumber+=1}`)):r!==0&&o&&(d=o.left);const u={id:n,name:s,rawData:e,parent:o,left:d,color:p,depth:r,x:0,y:0,dx:0,dy:0,px:0,py:0,width:l,height:c,children:[],_children:[],collapse:!!i,gKey:this.gKey+=1};return a&&(u.collapse?a.forEach((h,_)=>{u._children.push(this.createMdataFromData(h,`${n}-${_}`,u))}):a.forEach((h,_)=>{u.children.push(this.createMdataFromData(h,`${n}-${_}`,u))})),u}renew(...e){Xe(this.data,[kt,ga,ma]),this.data=this.l(this.data);const n=[kt,this.renewXY.bind(this),pa];Xe(this.data,n.concat(e))}l(e){const{left:n,right:o}=_a(e);return this.layout.layout(n),this.layout.layout(o),this.diffY=o.x-n.x,this.rootWidth=n.height,o.children=e.children,o}renewXY(e){[e.x,e.y]=[e.y,e.x],e.left&&(e.x=-e.x+this.rootWidth,e.y+=this.diffY)}getRootWidth(){return this.rootWidth}setBoundingBox(e,n){this.layout=$t(e,n),this.renew()}find(e){const n=e.split("-").map(s=>~~s);let o=this.data;for(let s=1;s<n.length;s++){const i=n[s],{children:a}=o;if(i<a.length)o=a[i];else return null}return o.id===e?o:null}rename(e,n){if(e.length>0){const o=this.find(e);if(o&&o.name!==n){o.name=n,o.rawData.name=n;const s=this.getSize(o.name);o.width=s.width,o.height=s.height,this.renew()}return o}else return null}moveChild(e,n){var a,l;if(e===n)return null;const o=this.find(e),s=this.find(n),i=n.split("-").pop();if(i&&o&&s){const c=s.parent;(a=c==null?void 0:c.children)==null||a.splice(~~i,1),(l=c==null?void 0:c.rawData.children)==null||l.splice(~~i,1),s.parent=o,s.gKey=this.gKey+=1,s.depth=s.parent.depth+1,s.depth===1?s.color=this.colorScale(`${this.colorNumber+=1}`):s.left=s.parent.left,o.collapse?o._children.push(s):o.children.push(s),o.rawData.children?o.rawData.children.push(s.rawData):o.rawData.children=[s.rawData],this.renew(de,xt)}return s}moveSibling(e,n,o=0){const s=e.split("-"),i=n.split("-");let a=s.pop(),l=i.pop();if(e===n||s.length!==i.length||!a||!l)return null;const c=this.find(e),r=this.find(n);if(r&&c&&c.parent){a=parseInt(a,10),l=parseInt(l,10),a<l&&(l-=1);const{children:d}=c.parent,{children:p}=c.parent.rawData;if(d&&p)return d.splice(a,1),d.splice(l+o,0,c),p.splice(a,1),p.splice(l+o,0,c.rawData),c.depth===1&&(c.left=r.left),this.renew(de),c}return null}add(e,n){const o=this.find(e);if(o)if(o.collapse&&this.expand(e),o.rawData.children||(o.rawData.children=[]),typeof n=="string"){const s=n,i=this.getSize(s),a={name:s},l=o.color?o.color:this.colorScale(`${this.colorNumber+=1}`),c={id:`${o.id}-${o.children.length}`,name:s,rawData:a,parent:o,left:o.left,collapse:!1,color:l,gKey:this.gKey+=1,width:i.width,height:i.height,depth:o.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return o.children.push(c),o.rawData.children.push(a),this.renew(),c}else{const s=n,i=this.createMdataFromData(s,`${o.id}-${o.children.length}`,o);return o.children.push(i),o.rawData.children.push(s),this.renew(),i}return null}expand(e){return this.eoc(e,!1,[xt,de])}collapse(e){return this.eoc(e,!0)}eoc(e,n,o=[]){const s=this.find(e);return s&&(s.collapse=n,s.rawData.collapse=n,[s._children,s.children]=[s.children,s._children],this.renew(...o)),s}delete(e){const n=this.find(e);if(n&&n.parent)n.id="del",this.renew(de);else throw new Error(n?"\u6682\u4E0D\u652F\u6301\u5220\u9664\u6839\u8282\u70B9":"\u672A\u627E\u5230\u9700\u8981\u5220\u9664\u7684\u8282\u70B9")}deleteOne(e){var o;const n=this.find(e);if(n&&n.parent){const{parent:s,children:i,_children:a,collapse:l,rawData:c}=n,r=parseInt(e.split("-").pop(),10);s.children.splice(r,1,...l?a:i),(o=s.rawData.children)==null||o.splice(r,1,...c.children||[]),i.forEach(d=>{d.parent=s,d.depth===1&&(d.rawData.left=d.left)}),this.renew(de)}}addSibling(e,n,o=!1){var i;console.log(`[addSibling] id=${e},name=${n}`);const s=this.find(e);if(s&&s.parent){const a=parseInt(e.split("-").pop(),10),{parent:l,left:c}=s,r={name:n,left:c},d=this.getSize(n),p=o?a:a+1,u=l.color?l.color:this.colorScale(`${this.colorNumber+=1}`),h={name:n,parent:l,children:[],_children:[],color:u,collapse:!1,rawData:r,id:`${l.id}-${p}`,left:c,gKey:this.gKey+=1,depth:s.depth,width:d.width,height:d.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return l.children.splice(p,0,h),(i=l.rawData.children)==null||i.splice(p,0,r),console.log(`index=${a},start=${p},sibling.id=${h.id}`),this.renew(de),h}return null}addParent(e,n){var s;const o=this.find(e);if(o&&o.parent){const{parent:i,left:a,color:l}=o,c=this.getSize(n),r=parseInt(o.id.split("-").pop(),10),d={name:n,children:[o.rawData],left:a};(s=i.rawData.children)==null||s.splice(r,1,d);const p={rawData:d,left:a,name:n,color:l,collapse:!1,parent:i,id:o.id,depth:o.depth,width:c.width,height:c.height,gKey:this.gKey+=1,children:[o],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return o.parent=p,i.children.splice(r,1,p),this.renew(de),p}return null}changeLeft(e){console.log("changeLeft");const n=this.find(e);return n&&(n.left=!n.left,n.rawData.left=n.left,this.renew()),n}}let L;D.on("mmdata",t=>t?L=t:null);const J=(t=!0)=>{console.log("afterOperation"),t&&Ce.snap(L.data),un.emit("update:modelValue",Zn([L.data.rawData])),Li(),fe()},fa=(t,e,n=!1)=>{console.log(`rename: id/name=${t}/${e}`),L.rename(t,e),n||J()},va=(t,e)=>{L.moveChild(t,e),J()},Ct=(t,e,n=0)=>{L.moveSibling(t,e,n),J()},Cn=(t,e)=>{const n=L.add(t,e);return J(),n},St=t=>{L.delete(t),J()},ba=t=>{L.deleteOne(t),J()},Sn=t=>{L.expand(t),J()},wa=t=>{L.collapse(t),J()},Mt=(t,e,n=!1)=>{const o=L.addSibling(t,e,n);return J(),o},ya=(t,e)=>{const n=L.addParent(t,e);return J(),n},ka=t=>{L.changeLeft(t),J()};var xa={translation:{contextmenu:{collapse:"\u6298\u53E0\u8282\u70B9",expand:"\u5C55\u5F00\u8282\u70B9",delete:"\u5220\u9664\u8282\u70B9","delete-one":"\u5220\u9664\u5355\u4E2A\u8282\u70B9",add:"\u65B0\u5EFA\u5B50\u8282\u70B9","add-parent":"\u65B0\u5EFA\u7236\u8282\u70B9","add-sibling":"\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9","add-sibling-before":"\u5728\u6B64\u4E4B\u524D\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9",cut:"\u526A\u5207",copy:"\u62F7\u8D1D",paste:"\u7C98\u8D34",selectall:"\u5168\u9009",zoomin:"\u653E\u5927",zoomout:"\u7F29\u5C0F",zoomfit:"\u7F29\u653E\u81F3\u5408\u9002\u5927\u5C0F"}}},$a={translation:{contextmenu:{collapse:"collapse",expand:"expand",delete:"delete","delete-one":"delete a single node",add:"add child node","add-parent":"add parent node","add-sibling":"add sibling node","add-sibling-before":"add sibling node before",cut:"cut",copy:"copy",paste:"paste",selectall:"select all",zoomin:"zoom in",zoomout:"zoom out",zoomfit:"zoom fit"}}};et.init({fallbackLng:"zh",lng:"zh",resources:{zh:xa,en:$a}});const Ea="_container_wezgq_1",Ca="_menu_wezgq_1",Sa="_disabled_wezgq_57";var Ma={container:Ea,menu:Ca,disabled:Sa};const Da=N({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(t,e){const n=$(!1),o=Qn(),s=$(),i=$(),a=O({top:0,left:0}),l=8;D.on("showContextmenu",async d=>{if(!s.value||!i.value)return;n.value=!!d,await eo();const{offsetWidth:p,offsetHeight:u}=s.value,{offsetWidth:h,offsetHeight:_}=i.value,{top:b,left:B}=t.position;a.top=b+_>u?u-_-l:b,a.left=B+h>p?B-h:B});const c=()=>n.value=!1;return{style:o,show:n,close:c,onClick:d=>{c(),e.emit("click-item",d)},menuEle:i,containerEle:s,pos:a,i18n:et}}}),Ba=["id"],La=["onClick"];function Ta(t,e,n,o,s,i){return ae((v(),w("div",{class:V(t.style.container),ref:"containerEle"},[y("div",{onMousedown:e[0]||(e[0]=(...a)=>t.close&&t.close(...a))},null,32),y("div",{ref:"menuEle",id:t.style.menu,style:Z({top:t.pos.top+"px",left:t.pos.left+"px"})},[(v(!0),w(U,null,X(t.groups,(a,l)=>(v(),w("ul",{key:l},[(v(!0),w(U,null,X(a,c=>(v(),w("li",{class:V(c.disabled?t.style.disabled:""),key:c.name,onClick:r=>t.onClick(c.name)},P(t.i18n.t(`contextmenu.${c.name}`)),11,La))),128))]))),128))],12,Ba)],2)),[[jt,t.show]])}const Mn={};Mn.$style=Ma;var ja=I(Da,[["render",Ta],["__cssModules",Mn]]);const Oa=N({name:"Mindmap",emits:["event_callback"],components:{Contextmenu:ja},props:{update:Boolean,modelValue:{type:Array,required:!0},xGap:{type:Number,default:ke},yGap:{type:Number,default:_e},branch:{type:Number,default:je,validator:t=>t>=1&&t<=6},scaleExtent:{type:Object,default:ve},sharpCorner:Boolean,centerBtn:Boolean,fitBtn:Boolean,downloadBtn:Boolean,timetravel:Boolean,addNodeBtn:Boolean,edit:Boolean,drag:Boolean,keyboard:Boolean,ctm:Boolean,zoom:Boolean,locale:{type:String,default:"zh"}},setup(t,e){return te(()=>et.changeLanguage(t.locale)),te(()=>D.emit("scale-extent",t.scaleExtent)),te(()=>D.emit("branch",t.branch)),te(()=>D.emit("sharp-corner",t.sharpCorner)),te(()=>D.emit("gap",{xGap:t.xGap,yGap:t.yGap})),te(()=>D.emit("mindmap-context",e)),te(()=>Ee.value=t.edit&&t.addNodeBtn),te(()=>he.value.drag=t.drag),te(()=>he.value.edit=t.edit),Q(()=>{if(!G.value||!me.value||!He.value||!ie.value||!W.value)return;D.emit("selection-svg",le(G.value)),D.emit("selection-g",le(me.value)),D.emit("selection-asstSvg",le(He.value)),D.emit("selection-foreign",le(ie.value)),D.emit("mmdata",new Et(ye.exports.cloneDeep(t.modelValue[0]),ke,_e,gt)),Te.value=!1,J();const{svg:n,foreign:o}=K;o==null||o.raise(),Ii(),Ke(),De(),n==null||n.on("mousedown",()=>{console.log("svg@mousedown");const s=document.getElementsByClassName(k.selected)[0];s==null||s.classList.remove(k.selected)}),n==null||n.on("blur",()=>{console.log("svg@blur")}),ht(t.zoom),pt(t.ctm)}),j(()=>[t.modelValue],n=>{console.log("props.modelValue"),D.emit("mmdata",new Et(ye.exports.cloneDeep(t.modelValue[0]),ke,_e,gt)),fe(),Ke(),De()}),j(()=>[t.branch,Ee.value,t.sharpCorner],()=>{fe(),Te.value=!1}),j(()=>[t.xGap,t.yGap],n=>{L.setBoundingBox(n[0],n[1]),fe()}),j(()=>[t.drag,t.edit],n=>{vi(n[0]||n[1]),bi(n[0]),fi(n[1])}),j(()=>t.zoom,n=>ht(n)),j(()=>t.ctm,n=>pt(n)),{wrapperEle:ce,svgEle:G,gEle:me,style:k,asstSvgEle:He,foreignEle:ie,foreignDivEle:W,centerView:Ke,fitView:De,download:Ai,menu:Ei,contextmenuPos:qt,onClickMenu:F,next:ot,prev:st,hasPrev:hn,hasNext:pn}}}),Na=["id"],Aa={ref:"gEle"},Ia={ref:"foreignEle",style:{display:"none"}},Ra={ref:"foreignDivEle",contenteditable:""};function Fa(t,e,n,o,s,i){const a=H("contextmenu");return v(),w("div",{class:V(t.style.container)},[y("div",{id:t.style["svg-wrapper"],ref:"wrapperEle"},[(v(),w("svg",{class:V(t.style.svg),ref:"svgEle"},[y("g",Aa,[(v(),w("foreignObject",Ia,[y("div",Ra,null,512)],512))],512)],2))],8,Na),(v(),w("svg",{ref:"asstSvgEle",class:V(t.style["asst-svg"])},null,2)),y("div",{class:V([t.style["button-list"],t.style["right-bottom"]])},[t.centerBtn?(v(),w("button",{key:0,onClick:e[0]||(e[0]=l=>t.centerView())},[y("i",{class:V(t.style.gps)},null,2)])):A("",!0),t.fitBtn?(v(),w("button",{key:1,onClick:e[1]||(e[1]=l=>t.fitView())},[y("i",{class:V(t.style.fit)},null,2)])):A("",!0),t.downloadBtn?(v(),w("button",{key:2,onClick:e[2]||(e[2]=l=>t.download())},[y("i",{class:V(t.style.download)},null,2)])):A("",!0)],2),t.timetravel?(v(),w("div",{key:0,class:V([t.style["button-list"],t.style["right-top"]])},[y("button",{onClick:e[3]||(e[3]=(...l)=>t.prev&&t.prev(...l)),class:V({[t.style.disabled]:!t.hasPrev})},[y("i",{class:V(t.style.prev)},null,2)],2),y("button",{onClick:e[4]||(e[4]=(...l)=>t.next&&t.next(...l)),class:V({[t.style.disabled]:!t.hasNext})},[y("i",{class:V(t.style.next)},null,2)],2)],2)):A("",!0),t.ctm?(v(),re(a,{key:1,position:t.contextmenuPos,groups:t.menu,onClickItem:t.onClickMenu},null,8,["position","groups","onClickItem"])):A("",!0)],2)}var Pa=I(Oa,[["render",Fa]]);const ct=t=>(Lt("data-v-a97db694"),t=t(),Tt(),t),Va={class:"container"},za={class:"main"},Ha=ct(()=>y("label",{for:"language-select"},"Language",-1)),Ka=ct(()=>y("option",{value:"zh"},"\u7B80\u4F53\u4E2D\u6587",-1)),Ga=ct(()=>y("option",{value:"en"},"English",-1)),Ua=[Ka,Ga],Ja=["name","onUpdate:modelValue","disabled"],Ya=["for"],Wa=["name","onUpdate:modelValue","min","max"],qa=["for"],Xa=N({emits:["event_callback"],setup(t,{emit:e}){const{store_data:n}=ee(),{store_dlg:o}=Re();Ze();const s=Ae();$(null);const i=O({height:window.innerHeight,update:!1,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});Q(()=>{console.log("[mounted]"),l(),window.addEventListener("resize",c),document.addEventListener("keydown",a),document.body.style.overflow="hidden"}),Qe(()=>{console.log("unmounted!"),window.removeEventListener("resize",c),document.removeEventListener("keydown",a)});const a=x=>{if(x.keyCode===83&&x.ctrlKey){x.preventDefault(),console.log("save"),_(p.value);return}},l=()=>{const x=C=>{n.do_cmd("restore_file","")};console.log("init"),s.path.substring(1),s.fullPath,x(),n.do_cmd("filter_menu",null),c()},c=()=>{const x=window.innerHeight-40;console.log(`height=${x}`),i.height=x,n.update_height(x)},r=O({center_btn:{value:!0},fit_btn:{value:!0},timetravel:{value:!0},download_btn:{value:!0},add_node_btn:{value:!0},keyboard:{value:!1,disabled:!0},zoom:{value:!0},drag:{value:!0},edit:{value:!0},contextmenu:{value:!0},sharp_corner:{value:!1},vertical:{value:!1,disabled:!0}}),d=O({branch:{value:4,min:1,max:6},x_gap:{value:42,min:0,max:100},y_gap:{value:9,min:0,max:100}}),p=$([{name:"start",children:[]}]),u=$("en");j(()=>n.state.obj.content,(x,C)=>{console.log("[watch-body]"),h(x)});const h=x=>{try{p.value=JSON.parse(x)}catch(C){console.log(C),p.value=[{name:"@start",children:[]}]}i.update=!i.update},_=x=>{n.do_cmd("save_file",JSON.stringify(p.value))},b=async(x,C)=>{switch(console.log(`[event_callback] cmd=${x}, va0=${C}`),x){case"toggle_editor":_(p.value);break;case"filelist":document.querySelector(".col-3");const E=!i.toggle_list;i.toggle_list=E,console.log(i.toggle_list);break;default:if(x.indexOf("dlg_")!=-1){const g=Object.assign({},B(x,C));console.log(g),o.update_param(g)}else n.do_cmd(x,C);break}},B=(x,C)=>{const E=Pt[x],g=C!=null?C:n.state.filename;return E.init(E,g),E};return(x,C)=>(v(),w("div",Va,[S(Vt,{ref:"appbar",onEvent_callback:b},null,512),S(Kt,{objParam:m(i).objDlgCmn,onEvent_callback:b},null,8,["objParam"]),y("div",za,[m(i).toggle_list?(v(),re(zt,{key:0,class:"col-3",onEvent_callback:b,style:Z({height:m(i).height+"px"})},null,8,["style"])):A("",!0),S(m(Pa),{class:"col-2",modelValue:p.value,"onUpdate:modelValue":C[0]||(C[0]=E=>p.value=E),update:m(i).update,branch:m(d).branch.value,"x-gap":m(d).x_gap.value,"y-gap":m(d).y_gap.value,zoom:m(r).zoom.value,"fit-btn":m(r).fit_btn.value,"center-btn":m(r).center_btn.value,"download-btn":m(r).download_btn.value,drag:m(r).drag.value,edit:m(r).edit.value,"add-node-btn":m(r).add_node_btn.value,"sharp-corner":m(r).sharp_corner.value,ctm:m(r).contextmenu.value,timetravel:m(r).timetravel.value,locale:u.value,style:Z({height:m(i).height+"px"}),onEvent_callback:b},null,8,["modelValue","update","branch","x-gap","y-gap","zoom","fit-btn","center-btn","download-btn","drag","edit","add-node-btn","sharp-corner","ctm","timetravel","locale","style"]),m(i).toggle_list?(v(),w("div",{key:1,class:"col-3",style:Z({height:m(i).height+"px"})},[y("div",null,[Ha,ae(y("select",{id:"language-select","onUpdate:modelValue":C[1]||(C[1]=E=>u.value=E)},Ua,512),[[to,u.value]])]),(v(!0),w(U,null,X(m(r),(E,g)=>(v(),w("div",{key:g},[ae(y("input",{type:"checkbox",name:g.toString(),"onUpdate:modelValue":f=>E.value=f,disabled:E.disabled},null,8,Ja),[[Ot,E.value]]),y("label",{for:g.toString()},P(g),9,Ya)]))),128)),(v(!0),w(U,null,X(m(d),(E,g)=>(v(),w("div",{key:g},[ae(y("input",{type:"range",name:g,"onUpdate:modelValue":f=>E.value=f,min:E.min,max:E.max},null,8,Wa),[[Je,E.value,void 0,{number:!0}]]),y("label",{for:g},P(g)+"\uFF08"+P(E.value)+"\uFF09",9,qa)]))),128))],4)):A("",!0)])]))}});var Za=I(Xa,[["__scopeId","data-v-a97db694"]]);const Qa=[{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Hs},{name:".mm",path:"/mm/:pathMatch(.*)",component:Za},{name:".md",path:"/:pathMatch(.*)*",component:Vs}],el=no({history:oo(),routes:Qa});function tl(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:s,onRegisterError:i}=t;let a;const l=async(c=!0)=>{};return"serviceWorker"in navigator&&(a=new so("./sw.js",{scope:"./"}),a.addEventListener("activated",c=>{c.isUpdate?window.location.reload():o==null||o()}),a.register({immediate:e}).then(c=>{s==null||s(c)}).catch(c=>{i==null||i(c)})),l}tl();io.add(ao);lo(Eo).use(el).component("fa",co).mount("#app");
