var gn=Object.defineProperty;var mn=(t,e,o)=>e in t?gn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var $e=(t,e,o)=>(mn(t,typeof e!="symbol"?e+"":e,o),o);import{D as fn,a as at,i as $t,p as Et,u as Xe,b as Oe,r as j,d as O,c as re,e as P,o as v,f as w,g as _,h as E,j as ge,t as V,k as G,F as J,l as te,w as Me,m as L,n as Q,q as k,s as C,v as W,x as _n,y as vn,z as R,A as Le,T as bn,B as ne,C as yn,E as wn,G as kn,H as lt,R as xn,I as je,J as Ie,K as $n,L as En,M as Cn,N as Sn,O as ie,P as Mn,Q as Dn,S as Tn,U as Bn,V as On,W as Ct,X as ve,Y as Ln,Z as jn,_ as St,$ as Fn,a0 as An,a1 as Nn,a2 as Mt,a3 as Rn,a4 as In,a5 as fe,a6 as Dt,a7 as Pn,a8 as ct,a9 as zn,aa as Vn,ab as Hn,ac as Kn,ad as Jn,ae as Un,af as qn,ag as Yn,ah as Gn,ai as Wn}from"./vendor.b57efba5.js";var A=Object.freeze(Object.defineProperty({__proto__:null,get svg(){return Nt},get g(){return Qe},get asstSvg(){return Rt},get foreign(){return It}},Symbol.toStringTag,{value:"Module"}));const Xn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=o(s);fetch(s.href,i)}};Xn();class ee{constructor(){this.id=-1,this.content="",this.path="",this.title="",this.group="",this.atime=Date(),this.ctime=Date(),this.tags=[],this.htags=[],this.position=void 0}set(e,o="",n=[],s=!1){o!=""&&(this.path=o),n!=[]&&(this.tags=n),this.content=e;const i=this.get_time();this.atime=i,s==!0&&(this.ctime=i)}set_default(e){this.path=e,this.content="",this.tags=[];const o=this.get_time();this.atime=o,this.ctime=o}copy(e){Object.assign(this,e)}duplicate(e,o=""){const n=new ee;return n.copy(this),n.content=e,n.path=o,n.update_time(),n.update_tag(),n}update_content2(e){this.content=e}update_time(){console.log(`update_time path=${this.path}`),this.atime=this.get_time()}update_tag(){return this.tags=this.build_tag(this.content),this.tags}update_position(e){this.position=e}get_time(){return this.cnv_time(new Date)}cnv_time(e){const o=n=>`00${n}`.slice(-2);return`${e.getFullYear()}/${o(e.getMonth()+1)}/${o(e.getDate())} ${o(e.getHours())}:${o(e.getMinutes())}:${o(e.getSeconds())}`}update_time_all(){this.atime=this.cnv_time(new Date(this.atime)),this.ctime=this.cnv_time(new Date(this.ctime))}static rebuild_body(e){return e}build_tag(e){const o=[],n=[0,0,0,0,0],s=e.split(/\r\n|\n|\r/);for(let i=0;i<s.length;i++)if(s[i].search(/^\s*#/)!=-1){const l=s[i].split(" "),c=l[0].length;l.shift();const u=l.join(" ");o.push({text:u,line:i,tag:c,num:n[c]}),n[c]++}return o}split(e){const o=[],n=this.content.split(/\r\n|\n|\r/),s=this.tags.filter(function(u){return u.tag==e}),i=[],a=n.length;for(var l=0;l<s.length;l++){const u=s[l].line;i.push({start:u,end:a,title:s[l].text}),l!=0&&(i[l-1].end=u-1)}const c=this.path.replace(".","_");return i.reverse(),i.forEach(u=>{const d=n.splice(u.start,u.end).join(`\r
`),h=this.duplicate(d,`${c}/${u.title}`);o.push(h)}),o.reverse(),o}}class Zn extends fn{constructor(){super("OdenDB");this.version(2).stores({viewer:"key, ctime"}),this.viewer=this.table("viewer")}}class Qn{constructor(e){this.db=new Zn,this.ctime="",this.atime="",this.getStrageEx=async()=>await this.getAll(),this.read=async o=>{const n=await this.dbx.get(o);return n!=null?n.data:null},this.write=async(o,n)=>{const s=JSON.stringify(n);await this.dbx.put({key:o,data:s,ctime:this.set_time_DB()}),this.set_time_DB()},this.delete=async o=>{console.log(`delete key=${o}`),await this.dbx.delete(o),this.set_time_DB()},this.caller=e,this.dbx=this.db.viewer,this.getAll()}get_dbx(){return this.db.viewer}async getAll(){const e=[];return(await this.dbx.toArray()).forEach(n=>{e[n.key]=n.data}),this.atime=this.get_time_DB(),e}async sync_DB(){this.check_async_DB()==!1&&await this.getAll()}check_async_DB(){return this.atime==this.get_time_DB()}set_time_DB(){const e=JSON.stringify(new Date);return localStorage.setItem("update_DB_time",e),this.atime=e,e}get_time_DB(){var e;return(e=localStorage.getItem("update_DB_time"))!=null?e:""}}class eo{constructor(e){this.ctime="",this.atime="",this.read=async o=>{const n=new URLSearchParams;n.append("filename",o);const s=await this.post_cmdEx("load_file_md",n);return s!=null?s.data:null},this.write=async(o,n)=>{const s=new URLSearchParams;return s.append("filename",o),s.append("source",JSON.stringify(n)),console.dir(s),this.post_cmdEx("save",s)},this.get_cmdEx=async o=>{const n="http://localhost:5000/api_oden/"+o;return console.log(`[store_RST:get_cmdEx] api=${n}`),at.get(n).then(s=>s.data).catch(s=>{throw s.response.status})},this.post_cmdEx=async(o,n)=>{const s="http://localhost:5000/api_oden/"+o;return console.log(`[store_RST:post_cmdEx] api=${s}`),console.dir(n),at.post(s,n).then(i=>(console.log("response.data = ",i.data),i.data)).catch(i=>(console.log("Error = ",i.response),i.response))},this.caller=e}}class to{constructor(e){this.write=(o,n)=>{this.storeDB.write(o,n),this.storeRST.write(o,n)},this.delete=o=>{this.storeDB.delete(o)},this.rename=async(o,n,s)=>{console.log(`[rename] _key_org=${o}, _key_new=${n}`);const i=this.as(await this.get(o));return i.path=n,await this.write(n,i),s&&await this.delete(o),i},this.split=async o=>{console.log(`[split] _key_org=${o}`);const s=this.as(await this.get(o)).split(1);return s.forEach(i=>{this.write(i.path,i)}),s},this.merge=(o,n)=>{console.log(`[merge] _path=${o}`);const s=new ee;return s.set_default(o),s.update_content2(n),s.update_time(),s.update_tag(),this.write(o,s),s},this.as=o=>Object.assign(new ee,o),this.sync_DB=()=>this.storeDB.sync_DB(),this._=e,this.storeDB=new Qn(this._),this.storeRST=new eo(this._)}async get(e){console.log(`[get] _key=${e}`);const o=await this.read(e);return o!=null?JSON.parse(o):this.create(e)}async exist(e){return console.log(`[exist] _key=${e}`),await this.read(e)!=null}async set(e,o){console.log(`[set] _key=${e}`);const n=this.as(await this.get(e));return n.path==""&&(n.path=e),n.update_content2(o),n.update_time(),n.update_tag(),this.write(e,n),n}async set_ex(e,o,n){console.log(`[set_ex] _key=${e}`);const s=this.as(o);return o.path==""&&(o.path=e),n!=null&&n.hasOwnProperty("no_upate_time")||s.update_time(),s.update_tag(),this.write(e,s),s}async read(e){return await this.storeDB.read(e)}create(e){console.log(`[create] _key=${e}`);const o=new ee;return e!=null&&(o.set_default(e),this.write(e,o)),o}}const Pe="menu.json";class no{constructor(e){this._=e}async rebuildMenu(e=null){console.log("[rebuildMenu]");const o=await this._.mgrCache.getLstContent(e),n=this.buildMenu(o);return console.log(`${o.length}/${n.length}`),this._.contentEx.set(Pe,JSON.stringify(n)),n}async getMenu(e){if(console.log(`[getMenu] _filter=${JSON.stringify(e)}`),e!=null)return await this.rebuildMenu(e);{const o=await this._.contentEx.get(Pe);return JSON.parse(o.content)}}buildMenu(e){function o(s){const i=new Set;return s.forEach(a=>{i.add(a.group)}),[...i]}function n(s){console.log("storeEx_index:buildMenuEx");const i=o(s);return s.reduce((a,l)=>{if(l.path==Pe)return a;let c=l.group,u=l.title,r=`${c}/${u}`;return i.includes(r)&&(c=r,u=".index",r=`${c}/${u}`),a.push({key:r,group:c,title:u,path:l.path,atime:l.atime}),a},[])}return n(e).sort(this.compare_group)}compare_group(e,o){let n=e.group,s=o.group;n==s&&(n=`${e.group}/${e.title}`,s=`${o.group}/${o.title}`);const i=n.toUpperCase(),a=s.toUpperCase();let l=0;return i>a?l=1:i<a&&(l=-1),l}}class oo{constructor(e){this.backupEx=(o,n,s)=>{const i=(l=!0)=>{const c=new URLSearchParams;c.append("lstContent",JSON.stringify(o)),c.append("is_divide",JSON.stringify(l)),this.storeRST.post_cmdEx("backup",c).then(u=>console.log(u)).catch(u=>console.log(u))},a=()=>{const l=new Blob([JSON.stringify(o)],{type:"text/plain"}),c=(r,d)=>{const h=new Date,p=g=>`00${g}`.slice(-2);return`${r}_${h.getFullYear()}${p(h.getMonth()+1)}${p(h.getDate())}_${p(h.getHours())}.${d}`},u=document.createElement("a");u.download=c("lstData","json"),u.href=URL.createObjectURL(l),u.click(),URL.revokeObjectURL(u.href)};switch(console.log(`[backup] mode=${n}`),n){case"backup":i();break;case"backupEx":i(!1);break;case"export":a();break}},this._=e,this.storeRST=e.contentEx.storeRST}async restoreEx(e,o,n){function s(c){c.forEach(u=>{const r=new ee;r.copy(u),r.update_tag(),l.write(r.path,r)})}async function i(c,u,r=!0){new URLSearchParams().append("is_divide",JSON.stringify(r)),this.storeRST.get_cmdEx(r?"restore":"restoreEx").then(h=>{s(h),c(h)}).catch(h=>{console.log(h),u(null)})}async function a(c,u,r){const d=new FileReader;d.onload=()=>{var g;console.log("onload");const h=(g=d.result)!=null?g:"",p=JSON.parse(h);s(p),u(p)},d.onerror=h=>{r("error")},d.readAsText(c)}console.log("[importExport:restore]");const l=this._.contentEx;return new Promise(function(c,u){switch(e){case"restore":i(c,u);break;case"restoreEx":i(c,u,!1);break;case"import":a(o,c,u);break}})}}class so{constructor(e){this.journal2=async(o,n)=>{const s=(a,l)=>`
## ${this._.contentEx.as(a).cnv_time(n)}
${l}
`;console.log("[journal]");const i=await this.geolocation();return o.content+=s(o,i),o},this.geolocation=()=>new Promise(o=>{let n="";navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{n=`(Latitude,longitude)=(${s.coords.latitude},${s.coords.longitude})
`,o(n)},s=>{switch(s.code){case 1:n="<li>\u4F4D\u7F6E\u60C5\u5831\u306E\u5229\u7528\u304C\u8A31\u53EF\u3055\u308C\u3066\u3044\u307E\u305B\u3093</li>";break;case 2:n="<li>\u30C7\u30D0\u30A4\u30B9\u306E\u4F4D\u7F6E\u304C\u5224\u5B9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F</li>";break;case 3:n="<li>\u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u304C\u767A\u751F\u3057\u307E\u3057\u305F</li>";break}o(n)}):(window.alert("<li>Geolocation API\u304C\u642D\u8F09\u3055\u308C\u3066\u3044\u306A\u3044\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002</li>"),o(n))}),this.chat=async(o,n,s)=>{const i=g=>["sun","mon","tue","wed","thu","fri","sat"][g],a=g=>{const b=Z=>`00${Z}`.slice(-2),x=`${g.getFullYear()}/${b(g.getMonth()+1)}/${b(g.getDate())}(${i(g.getDay())})`,B=`${b(g.getHours())}:${b(g.getMinutes())}`;return[x,B]},l=(g,b)=>g!==b?`
## ${b}
`:"",c=g=>{const b=s.isNoList?"":"- ",x=s.isAddTime?`${g} : `:"";return`${b}${x}${n}
${h}`};console.log("[chat]");const u=o.content.indexOf(`
`),[r,d]=a(new Date),h=s.isAddGeo?await this.geolocation()+`
`:"",p=l(o.content.substring(0,u),r)+c(d);return o.content=`${r}${o.content.substring(u)}${p}`,o},this._=e}async path_rename(e,o,n){console.log(`_from=${e}, _to=${o}`);const s=this.collect_filename_by_group(e,n);for(let i=0;i<s.length;i++){const a=s[i],l=`${a[1]}/${a[0]}`,c=`${o}${a[2]}/${a[0]}`;await this._.contentEx.rename(l,c)}}async path_delete(e,o){console.log(`_path=${e}`);const n=this.collect_filename_by_group(e,o);for(let s=0;s<n.length;s++){const i=n[s],a=`${i[1]}/${i[0]}`;await this._.contentEx.delete(a)}}async path_merge(e,o,n){console.log(`_path=${e}`);const s=[],i=this.collect_filename_by_group(e,n);for(let l=0;l<i.length;l++){const c=i[l],u=`${c[1]}/${c[0]}`,r=await this._.contentEx.get(u);s.push(r.content)}const a=s.join(`\r
`);return this._.contentEx.merge(o,a)}collect_filename_by_group(e,o){console.log(`[collect_filename_by_group] pat=${e}`);const n=[],s=e.length!=0?1:0;return o.forEach((i,a)=>{if(i.group==e){const l=i.group.substring(e.length+s);n.push([i.title,i.group,l.length!=0?`/${l}`:""])}}),n}}class io{constructor(e){this._=e}async getLstContent(e){console.log("[getLstContent]");const o=i=>{const a=e.path==""?!0:i.path.indexOf(e.path)!=-1,l=e.keyword==""?!0:i.content.toLowerCase().indexOf(e.keyword)!=-1;return a&&l},n=await this.buildLstContent();return e!=null?n.filter(o):n}async buildLstContent(){var i;console.log("[buildLstContent]");const e=a=>{var u,r;let l=a.path;(l==""||l==null)&&(l=`@test/${new Date().toLocaleString()}`);const c=l.split("/");return a.title=(u=c.pop())!=null?u:".",a.group=(r=c.join("/"))!=null?r:"@test",a.tags=[],a.htags=[],a},o=await this._.contentEx.storeDB.getStrageEx(),n=[],s=a=>o[a];for(const a of Object.keys(o))try{n.push(e(JSON.parse((i=s(a))!=null?i:"")))}catch(l){console.log(`@ error key=${a},e=${l} - other error`)}return n}}class ao{constructor(){this.contentEx=new to(this),this.mgrExchange=new oo(this),this.mgrEtc=new so(this),this.mgrMenu=new no(this),this.mgrCache=new io(this),console.log("[constructor]")}async cmd_getMenu(e=null){return this.mgrMenu.getMenu(e)}async cmd_load(e){return this.contentEx.get(e)}async cmd_create(e){return await this.contentEx.get(e)}async cmd_save(e,o){return this.contentEx.set(e,o)}async cmd_save_ex(e,o,n){return this.contentEx.set_ex(e,o,n)}async cmd_delete(e){await this.contentEx.delete(e)}async cmd_copy(e,o){await this.contentEx.rename(e,o,!1)}async cmd_rename(e,o,n){await this.contentEx.rename(e,o,n)}async cmd_exist(e){return this.contentEx.exist(e)}async cmd_backup(e,o="",n=null){const s=await this.mgrCache.getLstContent(n);this.mgrExchange.backupEx(s,e,o)}async cmd_restoreEx(e,o,n=""){await this.mgrExchange.restoreEx(e,o,n)}async cmd_rebuild(){return this.mgrMenu.rebuildMenu()}async cmd_split(e){await this.contentEx.split(e)}async cmd_path_rename(e,o){const n=await this.cmd_getMenu();await this.mgrEtc.path_rename(e,o,n)}async cmd_path_delete(e){const o=await this.cmd_getMenu();await this.mgrEtc.path_delete(e,o)}async cmd_path_merge(e,o){const n=await this.cmd_getMenu();await this.mgrEtc.path_merge(e,o,n)}async cmd_chat(e,o,n){const i=(()=>{const c=new Date;return`${e}${n.mode}_${c.getFullYear()}.md`})();console.log(`[cmd_chat] filename= ${i}`);const a=await this.contentEx.get(i),l=await this.mgrEtc.chat(a,o,n);return await this.contentEx.set(i,l.content),[l,i]}}class lo{constructor(e){this.KEY="",console.log(e),this.KEY=e}get(e){var o;if(localStorage.getItem(this.KEY)!=null){const n=JSON.parse((o=localStorage.getItem(this.KEY))!=null?o:"");e(n),console.log(n)}}set(e){localStorage.setItem(this.KEY,JSON.stringify(e)),console.log(e)}}const co=1e3*60*10,Tt=Symbol(),ro=()=>{const t=Xe();Oe();const e=j({storeEx:new ao,persisted:new lo("lifeLog-Viewer-params"),filename:"",obj:new ee,tags:[],isViewer:!1,dictMenu:[],ObjTag:[],jump:-1,height:500,path_expand:"(o_o)/",intervalId_autoSave:null,mode:0}),o=m=>{console.log(`[update_filename] : new=${m}`),n(m)},n=async m=>{if(console.log(`[load_obj] : new=${m}`),e.persisted.set({filename:m}),t.currentRoute.value.name.toString(),m!=""){e.mode=m.indexOf(".mm")!=-1?1:0;const f=await e.storeEx.cmd_load(m);l(f)}else l(c(""));e.filename=m},s=()=>{console.log("restore_filename"),e.persisted.get(m=>{o(m.filename)})},i=async m=>{if(m==""){console.log("skip save - empty data");return}c(m,{update_time:!0,update:!0}),await e.storeEx.cmd_save_ex(e.filename,e.obj),d()},a=()=>{console.log("[auto_save] start"),e.intervalId_autoSave&&(console.log("[auto_save] clearTimeout"),clearTimeout(e.intervalId_autoSave)),e.intervalId_autoSave=setTimeout(async()=>{console.log("[auto_save] execute"),await Z("export",null,null),e.intervalId_autoSave=null},co)},l=(m,f)=>{const $=m instanceof ee?m:Object.assign(new ee,m);f!=null&&f.hasOwnProperty("update_time")&&$.update_time(),e.tags=$.update_tag(),e.obj=$},c=(m,f)=>(e.obj.content=m,f!=null&&f.hasOwnProperty("update_time")&&e.obj.update_time(),e.tags=e.obj.update_tag(),e.obj),u=async(m,f)=>{if(console.log(m),f!=null){const $=await e.storeEx.cmd_load(f);$.position=m,await e.storeEx.cmd_save_ex(f,$,{no_upate_time:!0})}else e.obj.position=m},r=m=>{e.dictMenu=m},d=()=>{setTimeout(async()=>{r(await e.storeEx.cmd_rebuild()),a()},250)},h=m=>{e.jump=m,m!=-1&&(console.log(`jump=${m}`),e.ObjTag=JSON.parse(JSON.stringify(e.tags[m])),console.log(JSON.stringify(e.ObjTag)))},p=m=>{e.height=m},g=async(m,f)=>{const[$,M]=await e.storeEx.cmd_chat(e.path_expand,m,f);l($,{update_time:!0}),o(M),d()},b=async(m,f)=>{const $=await e.storeEx.cmd_exist(m);if(f==$)return!0;{const M=f?`error : ${m} is not exist. please enter exist filename.`:`error : ${m} is already exist. please enter other filename.`;return console.log(M),!1}},x=async(m,f,$=!0)=>{await b(m,!1)&&(o(""),await e.storeEx.cmd_rename(f,m,$),o(m),d())},B=async(m,f)=>{const $=q(f)[0],M=q(m)[0];o(""),await e.storeEx.cmd_path_rename($,M),d()},Z=async(m,f,$)=>{console.log(`[do_cmd] mode=${m}`);let M=f!=""?f:e.filename,z="",oe;switch(m){case"update_jump":h(f);break;case"rebuild_menu":d();break;case"filter_menu":const Re=f;f!=null&&(Re.path=Re.isUnderFolder?q(e.filename)[0]:""),r(await e.storeEx.cmd_getMenu(Re));break;case"open_file":o(f);break;case"restore_file":s();break;case"save_file":await i(f);break;case"new":await b(f,!1)&&(await e.storeEx.cmd_create(f),o(f),d());break;case"delete":await b(M,!0)&&(o(""),await e.storeEx.cmd_delete(M),d());break;case"rename":x(f,$);break;case"copy":x(f,$,!1);break;case"backup":e.storeEx.cmd_backup("backup");break;case"backupEx":e.storeEx.cmd_backup("backupEx");break;case"export":e.storeEx.cmd_backup("export");break;case"restore":await e.storeEx.cmd_restoreEx("restore",null),d();break;case"restoreEx":await e.storeEx.cmd_restoreEx("restoreEx",null),d();break;case"import":await e.storeEx.cmd_restoreEx("import",f),d();break;case"split":await b(M,!0)&&(await e.storeEx.cmd_split(M),d());break;case"path_rename":B(f,$);break;case"path_delete":z=q(f)[0],await e.storeEx.cmd_path_delete(z),o(""),d();break;case"path_merge":z=q(f)[0],M=`${z}.md`,await b(M,!1)&&(await e.storeEx.cmd_path_merge(z,M),o(M),d());break;case"print":const hn=t.resolve({path:`/print/${e.filename}`});window.open(hn.href,"_blank");break;case"journal":g("",{mode:"journal",isAddGeo:!0,isAddTime:!0,isNoList:!1});break;case"tweet":g(f,{mode:"tweet",isAddGeo:!1,isAddTime:!0,isNoList:!1});break;case"bookmark":g(f,{mode:"bookmark",isAddGeo:!1,isAddTime:!1,isNoList:!0});break;case"filter":oe={keyword:$.filter.toLowerCase(),isUnderFolder:$.isCheck,path:""},r(await e.storeEx.cmd_getMenu(oe));break;case"update_position":await u(f,$);break;case"move_archive":x(`@archive/${f}`,f);break;case"move_path_archive":B(`@archive/${f}`,f);break;case"export_archive":oe={keyword:"",isUnderFolder:!0,path:"@archive/"},e.storeEx.cmd_backup("export","",oe);break}},q=m=>{const f=m.split("/"),$=f[f.length-1];return[f.slice(0,-1).join("/"),$]};return{store_data:{state:e,update_height:p,do_cmd:Z}}},uo=()=>{Et(Tt,ro())},X=()=>$t(Tt),po=()=>{const t=j({objParam:null});return{store_dlg:{state:t,update_param:o=>{t.objParam=o}}}},Bt=Symbol(),ho=()=>{Et(Bt,po())},ke=()=>$t(Bt);const go=O({setup(t){return uo(),ho(),(e,o)=>{const n=P("routerView");return v(),re(n)}}});var F=(t,e)=>{const o=t.__vccOpts||t;for(const[n,s]of e)o[n]=s;return o};const mo={key:0},fo={key:1,class:"line"},_o={key:2,class:"dropdown"},vo=O({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=j({isOpen:!1,item:o.item,isFolder:o.item.children&&o.item.children.length,isActive:!0}),s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const l=a.cmd;s(l,null)}};return(a,l)=>{const c=P("fa"),u=P("MenuTreeItem",!0);return v(),w("div",{class:"menu_tree",onClick:l[0]||(l[0]=r=>i(_(n).item)),onContextmenu:l[1]||(l[1]=Me(()=>{},["right","prevent"]))},[_(n).item.title!=""?(v(),w("div",mo,[E(c,{icon:_(n).item.icon},null,8,["icon"]),ge(" "+V(_(n).item.title),1)])):G("",!0),_(n).item.title==""?(v(),w("div",fo)):G("",!0),_(n).isFolder?(v(),w("div",_o,[(v(!0),w(J,null,te(_(n).item.children,(r,d)=>(v(),w("div",{key:d},[E(u,{item:r,onEvent_callback:s},null,8,["item"])]))),128))])):G("",!0)],32)}}});var bo=F(vo,[["__scopeId","data-v-69f3eeaa"]]);const yo=O({props:{mouse:null,items:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=j({items:o.items,pos_x:-1,pos_y:-1,style:"display:none"});L(()=>o.mouse,(a,l)=>{console.log("props"),n.pos_x=o.mouse.clientX,n.pos_y=o.mouse.clientY,n.items=o.items,n.style="display:block"});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)},i=a=>{n.style=a?"display:block":"display:none"};return(a,l)=>(v(),w("div",{class:"menu",style:Q(_(n).style),onMouseover:l[0]||(l[0]=c=>i(!0)),onMouseleave:l[1]||(l[1]=c=>i(!1))},[(v(!0),w(J,null,te(_(n).items,c=>(v(),w("div",{key:c.path},[E(bo,{item:c,onEvent_callback:s},null,8,["item"])]))),128))],36))}});var Ot=F(yo,[["__scopeId","data-v-62ad7429"]]);const wo=O({props:{objMenu:null},emits:["event_callback"],setup(t,{emit:e}){const n=j({items:t.objMenu,event:void 0,style:"display:none"}),s=(l,c)=>{console.log(`[event_callback] cmd=${l}`),e("event_callback",l,c)},i=l=>{console.log("onClick"),n.event=l},a=l=>{n.style=l?"display:block":"display:none"};return(l,c)=>{const u=P("fa");return v(),w("div",{class:"dropdown",onClick:i,onMouseover:c[0]||(c[0]=r=>a(!0)),onMouseleave:c[1]||(c[1]=r=>a(!1))},[E(u,{icon:"bars"}),E(Ot,{class:"menu",mouse:_(n).event,items:_(n).items,onEvent_callback:s,style:Q(_(n).style)},null,8,["mouse","items","style"])],32)}}});var ko=F(wo,[["__scopeId","data-v-1a158634"]]);const xo={key:0,class:"dropdown"},$o=["onClick"],Eo={class:"title_sub2"},Co={class:"title"},So={class:"title_sub"},Mo=O({props:{objMenuItem:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=j({items:[],items2:[],isShowDlg:!1});L(()=>o.objMenuItem,(l,c)=>{n.items=s(l),n.items2=n.items.slice(0,5)});const s=l=>{console.log("[cnvLstRecent]");function c(r,d){const h=r.atime,p=d.atime;let g=0;return h>p?g=-1:h<p&&(g=1),g}const u=[...l];return u.sort(c),u.slice(0,15)},i=l=>{const c=n.items[l].path;e("event_callback","open_file",c),n.isShowDlg=!1},a=l=>{n.isShowDlg=l};return(l,c)=>{const u=P("fa");return v(),w("span",{onMouseover:c[0]||(c[0]=r=>a(!0)),onMouseleave:c[1]||(c[1]=r=>a(!1))},[E(u,{icon:"history"}),_(n).isShowDlg?(v(),w("ul",xo,[(v(!0),w(J,null,te(_(n).items,(r,d)=>(v(),w("li",{class:"item",key:d,onClick:h=>i(d)},[E(u,{class:"title_item",icon:"file-alt"}),k("span",Eo,V(r.group)+"/",1),k("span",Co,V(r.title),1),k("span",So,"["+V(r.atime)+"]",1)],8,$o))),128))])):G("",!0)],32)}}});var Do=F(Mo,[["__scopeId","data-v-b83f6c68"]]);const To=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"chat",icon:"folder-open",cmd:"",children:[{title:"journal",cmd:"journal",icon:"file",children:[]},{title:"tweet",cmd:"dlg_tweet",icon:"file",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"bacup/restore",icon:"folder-open",cmd:"",children:[{title:"backup",cmd:"backup",icon:"cloud-upload-alt",children:[]},{title:"restore",cmd:"restore",icon:"cloud-download-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"backup(json)",cmd:"backupEx",icon:"cloud-upload-alt",children:[]},{title:"restore(json)",cmd:"restoreEx",icon:"cloud-download-alt",children:[]}]},{title:"export/import",icon:"folder-open",cmd:"",children:[{title:"export",cmd:"export",icon:"file-export",children:[]},{title:"import",cmd:"dlg_import",icon:"file-import",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"export @archive",cmd:"export_archive",icon:"file-export",children:[]}]},{title:"",cmd:"",icon:"minus",children:[]},{title:"filter",cmd:"dlg_filter",icon:"paw",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"config",cmd:"config",icon:"paw",children:[]},{title:"print",cmd:"print",icon:"print",children:[]}],Bo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"rename",cmd:"dlg_rename",icon:"pen",children:[]},{title:"copy",cmd:"dlg_copy",icon:"copy",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"delete",cmd:"dlg_delete",icon:"trash-alt",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"split",cmd:"split",icon:"file",children:[]},{title:"move @archive",cmd:"move_archive",icon:"file-export",children:[]}],Oo=[{title:"new",cmd:"dlg_new",icon:"file",children:[]},{title:"path_rename",cmd:"dlg_path_rename",icon:"sync",children:[]},{title:"path_merge",cmd:"dlg_path_merge",icon:"file",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"path_delete",cmd:"dlg_path_delete",icon:"sync",children:[]},{title:"",cmd:"",icon:"minus",children:[]},{title:"move @archive",cmd:"move_path_archive",icon:"file-export",children:[]}],Lo={dlg_import:{init:(t,e)=>{t.title="Restore",t.isFileOpen=!0,t.isNoEdit=!0,t.edit=""},action:t=>["import"]},dlg_delete:{init:(t,e)=>{t.title="Delete",t.isReadOnly=!0,t.edit=e},action:t=>["delete",t.edit,""]},dlg_rename:{init:(t,e)=>{t.title="Rename",t.edit=e},action:t=>["rename",t.edit,t.edit_org]},dlg_new:{init:(t,e)=>{t.title="Create",t.edit=e.split("/").slice(0,-1).join("/")+"/*.md"},action:t=>["new",t.edit,""]},dlg_copy:{init:(t,e)=>{t.title="Copy",t.edit=e},action:t=>["copy",t.edit,t.edit_org]},dlg_path_rename:{init:(t,e)=>{t.title="Rename of Path",t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_rename",t.edit,t.edit_org]},dlg_path_delete:{init:(t,e)=>{t.title="Delete of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_delete",t.edit,""]},dlg_path_merge:{init:(t,e)=>{t.title="Merge of Path",t.isReadOnly=!0,t.edit=e.split("/").slice(0,-1).join("/")+"/"},action:t=>["path_merge",t.edit,""]},dlg_tweet:{init:(t,e)=>{t.title="Tweet",t.edit=""},action:t=>["tweet",t.edit,""]},dlg_bookmark:{init:(t,e)=>{t.title="Bookmark",t.edit="",t.isMulti=!0},action:t=>["bookmark",t.edit,""]},dlg_filter:{init:(t,e)=>{t.title="Filter",t.title2="target under folder",t.edit="",t.edit_org="@",t.isCheck=!0},action:t=>(console.log("dlg_filter"),["filter",t.filename,{filter:t.edit,isCheck:t.check}])}};const jo=t=>(_n("data-v-389d700f"),t=t(),vn(),t),Fo={class:"nav"},Ao=["title"],No={class:"form"},Ro={class:"cmd"},Io=jo(()=>k("span",{class:"item"},null,-1)),Po=O({emits:["event_callback"],setup(t,{emit:e}){const{store_data:o}=X();ke();const n=C(null),s=C(null),i=j({filename:"@",objMenu:To,dctMenu:[]}),a=(r,d)=>{if(console.log(`[event_callback] cmd=${r}`),r!="top")if(r=="cmd"){const h=s.value,p=h.getAttribute("url"),g=h.getAttribute("cmd");console.log(`url=${p}`),console.log(`cmd=${g}`),g=="add_bookmark"&&a("bookmark",p)}else e("event_callback",r,d)};W(()=>{console.log("[mounted]")});const l=r=>{console.log(`[doAction] cmd=${r}`),e("event_callback",r,!0)};L(()=>o.state.filename,(r,d)=>{console.log(`[watch:filename] ${r}`),u(r)}),L(()=>o.state.dictMenu,(r,d)=>{i.dctMenu=r}),L(()=>o.state.jump,(r,d)=>{window.setTimeout(()=>{c()},500)});const c=()=>{n.value.scrollIntoView({})},u=r=>{console.log(`[onChanged_filename] new=${r}`),i.filename=r,c()};return(r,d)=>{const h=P("fa");return v(),w("header",{class:"appbar",ref_key:"appbar",ref:n,_click:"event_callback('top', true)"},[k("nav",Fo,[E(ko,{class:"item",objMenu:_(i).objMenu,onEvent_callback:a,title:"menu"},null,8,["objMenu"]),k("section",{class:"item logo",onClick:d[0]||(d[0]=p=>a("filelist",!0)),title:_(i).filename},"Oden",8,Ao),E(Do,{class:"item",objMenuItem:_(i).dctMenu,onEvent_callback:a,title:"history"},null,8,["objMenuItem"]),_(i).filename!==""?(v(),w("span",{key:0,class:"item name",onClick:d[1]||(d[1]=p=>a("dlg_rename",null))},"["+V(_(i).filename)+"]",1)):G("",!0),k("span",{class:"item mark",onClick:d[2]||(d[2]=p=>l("toggle_editor")),title:"editor/viewer"},[E(h,{icon:"edit"})]),k("form",No,[k("span",{class:"item",id:"api_do",url:"",cmd:"",onClick:d[3]||(d[3]=p=>a("cmd")),ref_key:"api",ref:s},"cmd",512)])]),k("span",Ro,[k("span",{class:"item",onClick:d[4]||(d[4]=p=>l("dlg_filter")),title:"filter"},[E(h,{icon:"paw"})]),k("span",{class:"item",onClick:d[5]||(d[5]=p=>l("dlg_tweet")),title:"tweet"},[E(h,{icon:"grimace"})]),k("span",{class:"item",onClick:d[6]||(d[6]=p=>l("dlg_bookmark")),title:"bookmark"},[E(h,{icon:"bookmark"})]),Io])],512)}}});var zo=F(Po,[["__scopeId","data-v-389d700f"]]);const Vo=["title","onContextmenu","onDblclick"],Ho={key:0},Ko=O({props:{item:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,n=j({isOpen:!1,item:o.item,isFolder:o.item.children&&o.item.children.length,menu:[],event:null,class_item:"item"}),{store_data:s}=X();L(()=>s.state.filename,(h,p)=>{u(h)});const i=(h,p)=>{console.log(`[event_callback] cmd=${h}`),e("event_callback",h,p)},a=(h,p)=>{console.log(`[event_callbackEx] cmd=${h}`),e("event_callback",h,n.item.path)};W(()=>{u(s.state.filename)});const l=h=>{if(n.isFolder)console.log("onClick-folder"),n.isOpen=!n.isOpen;else{const p=h.path;console.log(`onClick-filename=${p}`),s.do_cmd("open_file",p)}},c=h=>{console.log("onClickEx"),n.menu=n.isFolder?Oo:Bo,n.event=h},u=h=>{n.item.path==h,h.indexOf(n.item.name)!=-1&&(n.isOpen=!0),n.class_item=n.item.path==h?"item active":"item"},r=()=>n.isFolder?"folder":n.class_item,d=()=>n.isFolder?n.isOpen?"folder-open":"folder":n.item.file=="mm"?"pen":"file";return(h,p)=>{const g=P("fa"),b=P("tree-item",!0);return v(),w("div",{class:"file_tree",onContextmenu:p[1]||(p[1]=Me(()=>{},["prevent"]))},[E(Ot,{mouse:_(n).event,items:_(n).menu,onEvent_callback:a},null,8,["mouse","items"]),k("div",{class:R(r()),title:_(n).item.time,onClick:p[0]||(p[0]=x=>l(_(n).item)),onContextmenu:Me(c,["prevent"]),onDblclick:Me(c,["prevent"])},[E(g,{icon:d(),onClick:c},null,8,["icon"]),ge(" "+V(_(n).item.name),1)],42,Vo),_(n).isOpen?(v(),w("div",Ho,[(v(!0),w(J,null,te(_(n).item.children,(x,B)=>(v(),w("div",{key:B},[E(b,{item:x,onEvent_callback:i},null,8,["item"])]))),128))])):G("",!0)],32)}}});var Jo=F(Ko,[["__scopeId","data-v-21024690"]]);const Uo={class:"tree"},qo=O({emits:["event_callback"],setup(t,{emit:e}){const o=j({items:void 0}),{store_data:n}=X();L(()=>n.state.dictMenu,(a,l)=>{i(a)});const s=(a,l)=>{console.log(`[event_callback] cmd=${a}`),e("event_callback",a,l)};W(()=>{console.log("[mounted]"),i(n.state.dictMenu)});const i=a=>{console.log("[onChanged_dictMenu]"),o.items=void 0;const l=a,c={name:"",children:[],path:"",file:"",time:""},u="/",r={[u]:c},d=h=>h.split(".").slice(1);l.forEach(function(h){h.key.split("/").reduce(function(p,g){if(p[g])return p[g];{const b={name:g,children:[],path:h.path,file:d(g),time:h.atime};return p[u].children.push(b),p[u].file="",p[g]={[u]:b}}},r)}),console.dir(c),setTimeout(()=>{o.items=c.children},250)};return(a,l)=>(v(),w("div",Uo,[E(bn,{_appear:"",name:"flip-list",tag:"div"},{default:Le(()=>[(v(!0),w(J,null,te(_(o).items,c=>(v(),w("div",{key:c.path},[E(Jo,{item:c,onEvent_callback:s},null,8,["item"])]))),128))]),_:1})]))}});var Yo=F(qo,[["__scopeId","data-v-bb89d624"]]);const Go=O({props:{level:null},setup(t){const e=t,o=ne(()=>`h${e.level}`);return(n,s)=>(v(),re(yn(_(o)),{class:"h_tag"},{default:Le(()=>[wn(n.$slots,"default",{},void 0,!0)]),_:3}))}});var Wo=F(Go,[["__scopeId","data-v-f257f458"]]);const Xo=O({emits:["event_callback"],components:{heading:Wo},setup(t,e){const{store_data:o}=X(),n=j({listTag:[]});L(()=>o.state.tags,(a,l)=>{n.listTag=a});function s(a){o.do_cmd("update_jump",a)}function i(a){return`${a.text}`}return{state:n,dispTitle:i,jumpSource:s}}}),Zo={class:"tag"},Qo=["onClick"];function es(t,e,o,n,s,i){const a=P("heading");return v(),w("div",Zo,[(v(!0),w(J,null,te(t.state.listTag,(l,c)=>(v(),w("div",{key:c,onClick:u=>t.jumpSource(c),class:"item"},[E(a,{level:l.tag},{default:Le(()=>[ge(V(t.dispTitle(l)),1)]),_:2},1032,["level"])],8,Qo))),128))])}var ts=F(Xo,[["render",es],["__scopeId","data-v-39c9834e"]]);const ns=O({emits:["event_callback"],setup(t,e){return{objToolbar:[{icon:"bold",cmd:"Bold"},{icon:"italic",cmd:"Italic"},{icon:"underline",cmd:"Underline"},{icon:"strikethrough",cmd:"Strikethrough"},{icon:"code",cmd:"Code"},{icon:"check-square",cmd:"Check"},{icon:"table",cmd:"Table"},{icon:"link",cmd:"Link"},{icon:"chevron-right",cmd:"Blockquotes"},{icon:"paint-roller",cmd:"ColorText"},{icon:"calendar",cmd:"Today"},{icon:"expand",cmd:"Expand"},{icon:"bolt",cmd:"Format"}],event_callback:(s,i)=>{console.log(`cmd=${s}, name=${i}`),e.emit("event_callback",s,i)}}}}),os={class:"main",style:{_height:"100px"}},ss=["onClick","title"];function is(t,e,o,n,s,i){const a=P("fa");return v(),w("div",os,[(v(!0),w(J,null,te(t.objToolbar,(l,c)=>(v(),w("button",{class:"btn-item",key:c,onClick:u=>t.event_callback("action",l.cmd),title:l.cmd},[E(a,{icon:l.icon},null,8,["icon"])],8,ss))),128))])}var as=F(ns,[["render",is],["__scopeId","data-v-51a9c01b"]]);const Te={};class ls{constructor(e,o){$e(this,"cmdid",0);$e(this,"monaco",null);$e(this,"editor",null);console.log("[constructer]"),this.monaco=e,this.editor=o}add(e,o,n,s,i=null){console.log("[add]");let a;switch(s.length){case 0:a=this.generateCommand(e,i);break;case 1:a=this.generateHeaderCommand(s[0]);break;case 2:a=this.generateWrapperCommand(s[0],s[1]);break}Te[e]=a,this.editor.addAction({id:"markdown-"+this.cmdid++,label:e,keybindings:n,contextMenuGroupId:o&&"navigation",contextMenuOrder:o&&1.5,run:Te[e]})}generateCommand(e,o){return(n,s)=>{o(n)}}generateWrapperCommand(e,o){const n=e.length+o.length,i=this.editor.getModel();return this.monaco,(a,l)=>{const c=a.getSelections();if(c==null)return;const u=[];return c.forEach(r=>{u.push(new l.Selection(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn+n)),i.pushEditOperations([],[{range:{startLineNumber:r.startLineNumber,startColumn:r.startColumn,endLineNumber:r.startLineNumber,endColumn:r.startColumn},text:e},{range:{startLineNumber:r.endLineNumber,startColumn:r.endColumn,endLineNumber:r.endLineNumber,endColumn:r.endColumn},text:o}])}),a.setSelections(u),null}}generateHeaderCommand(e){return this.editor,this.editor.getModel(),(o,n)=>{const s=o.getModel();let i=o.getSelections();return i==null&&(i=[o.getSelection()]),i.forEach(a=>{const l=s.findNextMatch("^(#+ )",{lineNumber:a.startLineNumber,column:1},!0,!1,null,!0);if(l!=null&&l.range.startLineNumber==a.startLineNumber&&l.range.startColumn==1){if(l.matches[1]==e)return;s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:l.matches[1].length+1},text:""}])}s.pushEditOperations([],[{range:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.startLineNumber,endColumn:1},text:e}])}),null}}}function cs(t,e){const o=s=>{const i=a=>`00${a}`.slice(-2);return`${s.getFullYear()}/${i(s.getMonth()+1)}/${i(s.getDate())} ${i(s.getHours())}:${i(s.getMinutes())}:${i(s.getSeconds())}`};console.log("[setupShortcutKeys]");const n=new ls(t,e);n.add("Bold","8_",[],["**","**"]),n.add("Italic","1_",[],["__","__"]),n.add("Underline","9_",[],["<u>","</u>"]),n.add("Strikethrough",!1,[t.KeyMod.CtrlCmd|t.KeyMod.Shift|t.KeyCode.KEY_S],["~~","~~"]),n.add("Code",!1,[],["`","`"]),n.add("Link",!1,[],["[","]()"]),n.add("Link-2",!1,[],["[](",")"]),n.add("ColorText",!1,[],['<span style="color: red; ">',"</span>"]),n.add("Expand",!1,[],["<details><summary>",["</summary>","</details>"].join(`
`)]),n.add("Header 1",!1,[],["# ",""]),n.add("Header 2",!1,[],["## ",""]),n.add("Header 3",!1,[],["### ",""]),n.add("Header 4",!1,[],["#### ",""]),n.add("Header 5",!1,[],["##### ",""]),n.add("Header 6",!1,[],["###### ",""]),n.add("Check",!1,[],["- [ ] ",""]),n.add("Blockquotes",!1,[],["> ",""]),n.add("Today",!1,[],[`${o(new Date)}`,""]),n.add("Table",!1,[],[["| Column | Column | Column |","| ------ | ------ | ------ |","| Text   | Text   | Text   |",""].join(`
`),""]),n.add("Format","8_",[],[],s=>{console.log("format"),s.getAction("editor.action.formatDocument").run()})}const rs={lineNumbersMinChars:4,minimap:{enabled:!0},wordWrap:"on",renderWhitespace:"all",selectOnLineNumbers:!0,automaticLayout:!0,fontSize:16,scrollBeyondLastLine:!1,language:"markdown",theme:"vs",formatOnPaste:!0,formatOnType:!0,quickSuggestions:!1},ds=O({emits:["event_callback"],components:{ToolbarEditor:as},props:{isActive_preview:{type:Boolean,default:!1}},setup(t,e){const o=C(null),n={editor:void 0},{store_data:s}=X(),i=j({iVersion:-1,scrollInfo:{height:0,top:0},pos_scroll:-1,filename:""});W(()=>{console.log("[mounted]"),l(),g(s.state.obj.content)}),L(()=>s.state.obj.content,(m,f)=>{console.log("[watch-body]"),i.filename!=""&&B(),g(m),Z(s.state.obj.position,!0),i.filename=s.state.filename}),L(()=>s.state.ObjTag,(m,f)=>{console.log(`[watch](ObjTag)-${m}`),a(m)}),L(()=>t.isActive_preview,(m,f)=>{console.log(`[watch](editor_toggle)-${m}`),m==!0&&x()});const a=m=>{const f=M=>{h(M)};console.log(`[jump_cursor]ObjTag={${Object.values(m)}}`);const $=m.line;f($),setTimeout(()=>{const M=n.editor;i.pos_scroll=M.getScrollTop()},500)},l=()=>{const m=()=>{const f=(z,oe)=>{cs(z,oe)},$=document.getElementById("container");if(console.log(`root=${$}`),$==null)return;const M=kn.create($,rs);return f(lt,M),console.log(`editor=${M}`),M.onDidScrollChange(z=>{i.scrollInfo.height=z.scrollHeight,i.scrollInfo.top=z.scrollTop}),M};n.editor=m(),c()},c=()=>{n.editor.onDidBlurEditorText(m=>{x()})},u=(m,f)=>{switch(console.log(`[event_callback] cmd=${m}`),m){case"action":r(f);break;case"save":x();break}},r=m=>{console.log("[action]"),Te[m]!=null&&Te[m](n.editor,lt)},d=()=>n.editor.getValue(),h=m=>{const f=new xn(m+1,0,m+1,0);console.log(`Line=${m}`),n.editor.revealRangeAtTop(f)},p=()=>n.editor.getModel().getAlternativeVersionId(),g=m=>{n.editor.setValue(m),i.iVersion=p()},b=()=>{const m=p();return console.info(`iVersion=${i.iVersion}, iVersion_cur=${m}`),i.iVersion!=m},x=(m=!1)=>{if(!b())return;m||B();const f=d();s.do_cmd("save_file",f),i.iVersion=p(),console.info(`iVersion=${i.iVersion}`)},B=()=>{const m=n.editor,f={top:m.getScrollTop(),height:m.getScrollHeight(),contentHeight:m.getLayoutInfo().height,scrolled:i.pos_scroll!=m.getScrollTop()};return b()?(s.do_cmd("update_position",f,void 0),x(!0)):s.do_cmd("update_position",f,i.filename),f},Z=(m,f=!1)=>{if(m==null)return;console.log(`[e-set]value=${JSON.stringify(m)}`);const $=n.editor;if(f?!0:m.scrolled){const z=m.top/m.height;console.log(`per=${z}`);const oe=$.getScrollHeight();$.setScrollTop(oe*z)}else a(s.state.ObjTag);setTimeout(()=>{i.pos_scroll=$.getScrollTop()},500)};ne(()=>n.editor.getScrollTop());const q=ne(()=>`${s.state.height-27}px`);return{editorEx:n,event_callback:u,HeightEx:q,md_editor_monaco:o,get_position:B,set_position:Z}}}),us={class:"editor"};function ps(t,e,o,n,s,i){const a=P("ToolbarEditor");return v(),w("div",us,[E(a,{class:"toolbar",onEvent_callback:t.event_callback},null,8,["onEvent_callback"]),k("div",{id:"container",ref:"md_editor_monaco",class:"core",style:Q({height:t.HeightEx})},null,4)])}var hs=F(ds,[["render",ps],["__scopeId","data-v-7e52ad8b"]]);const gs=O({components:{},props:{isActive_preview:{type:Boolean,default:!1}},setup(t){const e=C(null),{store_data:o}=X(),n=j({pos_scroll:-1,filename:"",observer_scroll:null});W(()=>{function r(){const d=new Ie.Renderer;d.link=function(h,p,g){return console.log(`href=${h}, title=${p}, text=${g}`),h.indexOf("http")!=-1?`<a target="_blank" href="${h}">${g}</a>`:`<a target="_blank" href="#${h}">${g}</a>`},d.code=function(h,p,g){return h.match(/^sequenceDiagram/)||h.match(/^graph/)||h.match(/^gantt/)?'<div class="mermaid">'+h+`
</div>`:`<pre><code>
`+$n.highlightAuto(h).value+`
</code></pre>`},Ie.setOptions({renderer:d,langPrefix:"",breaks:!0}),window.setTimeout(()=>{En.init()},500)}console.log("[mounted]"),r(),n.observer_scroll=new s}),je(()=>{}),L(()=>o.state.obj.content,(r,d)=>{console.log("[watch-body]"),n.filename!=""&&a(),setTimeout(()=>{n.observer_scroll.build(),l(o.state.obj.position,!0),n.filename=o.state.filename},0)});class s{constructor(){this.observer=null,this.tocMap=null,this.elm_target_before=null}destructor(){}build(){const d=()=>document.querySelector(".md_core_viewer").querySelectorAll(".md_viewer > h1, h2, h3, h4, h5"),h=()=>document.querySelector(".tag").querySelectorAll(".item > h1, h2, h3, h4, h5"),p=(B,Z)=>{const q=this.tocMap.get(B);Z?(this.elm_target_before!=null&&this.elm_target_before.classList.remove("active"),q.classList.add("active"),this.elm_target_before=null):this.elm_target_before=q},g={root:document.querySelector(".md_core_viewer"),rootMargin:"-1px 0px -99% 0px"},b=this.set_callback(p,g),x=this.build_toc_map(b,d(),h());this.observer=b,this.tocMap=x}set_callback(d,h){const p=g=>{g.forEach(b=>{d(b.target,b.intersectionRatio)})};return new IntersectionObserver(p,h)}build_toc_map(d,h,p){const g=new Map;return console.log(`el_contents=${h.length}`),console.log(`el_tocs=${p.length}`),h.forEach((b,x)=>{d.observe(b),g.set(p.item(x),b),g.set(b,p.item(x))}),g}}L(()=>o.state.ObjTag,(r,d)=>{console.log(`[watch](ObjTag)-${r}`),i(r)});function i(r){const d=(g,b)=>{console.log(`tag=${g}, num=${b}`);const x=e.value,B=x.querySelectorAll(".md_core_viewer > h"+g);B.length!=0&&(x.scrollTop=B[b].getBoundingClientRect().top-x.getBoundingClientRect().top+x.scrollTop)};console.log(`[jump_cursor]ObjTag={${Object.values(r)}}`);const h=r.tag,p=r.num;d(h,p),setTimeout(()=>{const g=e.value;n.pos_scroll=g.scrollTop},0)}const a=()=>{const r=e.value,d={top:r.scrollTop,height:r.scrollHeight,contentHeight:0,scrolled:n.pos_scroll!=r.scrollTop};return o.do_cmd("update_position",d,n.filename),d},l=(r,d=!1)=>{if(console.log(`[v-set]value=${JSON.stringify(r)}`),e.value==null)return;const h=e.value;if(r==null){h.scrollTop=0;return}if(d?!0:r.scrolled){const g=r.top/r.height;console.log(`per=${g}`),console.log(`scrollTop=${h.scrollTop}, scrollHeight=${h.scrollHeight}`),h.scrollTop=h.scrollHeight*g}else i(o.state.ObjTag);setTimeout(()=>{n.pos_scroll=h.scrollTop},0)},c=ne(()=>Ie.parse(o.state.obj.content)),u=ne(()=>o.state.height+"px");return{status,Markdown:c,HeightEx:u,md_viewer:e,get_position:a,set_position:l}}}),ms=["innerHTML"];function fs(t,e,o,n,s,i){return v(),w("div",{class:"md_core_viewer note",innerHTML:t.Markdown,style:Q({height:t.HeightEx}),ref:"md_viewer"},null,12,ms)}var _s=F(gs,[["render",fs],["__scopeId","data-v-bf27e4fa"]]);const vs=O({props:{editor_toggle:null},emits:["event_callback"],setup(t,{emit:e}){const o=t;X(),ke();const n=j({isActive_preview:!0}),s=C(),i=C();W(()=>{console.log("[mounted]"),document.addEventListener("keydown",a)}),je(()=>{console.log("unmounted!"),document.removeEventListener("keydown",a)}),L(()=>o.editor_toggle,(c,u)=>{console.log(`[watch](editor_toggle)-${c}`),l()});const a=c=>{if(c.keyCode===83&&c.ctrlKey){c.preventDefault(),console.log("save"),l();return}else if(c.keyCode===69&&c.ctrlKey){c.preventDefault(),console.log("toggle"),l();return}},l=()=>{var r;const c=n.isActive_preview?{now:s,next:i}:{now:i,next:s},u=(r=c.now.value)==null?void 0:r.get_position();console.log(`isActive_preview=${n.isActive_preview}, scrollIndo=${JSON.stringify(u)}`),n.isActive_preview=!n.isActive_preview,setTimeout(()=>{var d;(d=c.next.value)==null||d.set_position(u)},500)};return(c,u)=>(v(),w("div",null,[_(n).isActive_preview?(v(),re(_s,{key:0,class:"md_viewer",ref_key:"MdViewer",ref:s,isActive_preview:_(n).isActive_preview},null,8,["isActive_preview"])):(v(),re(hs,{key:1,class:"md_editor",ref_key:"MdEditor",ref:i,isActive_preview:_(n).isActive_preview},null,8,["isActive_preview"]))]))}}),T=Cn(),bs="_container_evb0m_1",ys="_svg_evb0m_18",ws="_trigger_evb0m_44",ks="_dragging_evb0m_47",xs="_hidden_evb0m_53",$s="_text_evb0m_73",Es="_selected_evb0m_79",Cs="_content_evb0m_79",Ss="_root_evb0m_82",Ms="_edited_evb0m_86",Ds="_outline_evb0m_89",Ts="_collapse_evb0m_99",Bs="_disabled_evb0m_145",Os="_gps_evb0m_156",Ls="_fit_evb0m_159",js="_download_evb0m_162",Fs="_prev_evb0m_165",As="_next_evb0m_168",Ns="_close_evb0m_171";var y={container:bs,"svg-wrapper":"_svg-wrapper_evb0m_1","asst-svg":"_asst-svg_evb0m_12",svg:ys,trigger:ws,dragging:ks,"add-btn":"_add-btn_evb0m_47",hidden:xs,"expand-btn":"_expand-btn_evb0m_64",text:$s,selected:Es,content:Cs,root:Ss,edited:Ms,outline:Ds,collapse:Ts,"button-list":"_button-list_evb0m_103","right-bottom":"_right-bottom_evb0m_106","right-top":"_right-top_evb0m_110",disabled:Bs,gps:Os,fit:Ls,download:js,prev:Fs,next:As,close:Ns};const Y=C(),I=C(),he=C(),ze=C(),se=C(),H=C();function Rs(){const t=this.querySelector(`g.${y["add-btn"]}`);t&&(t.style.opacity="1");const e=this.querySelector(`g.${y["expand-btn"]}`);e&&(e.style.opacity="1")}function Is(){const t=this.querySelector(`g.${y["add-btn"]}`);t&&(t.style.opacity="0");const e=this.querySelector(`g.${y["expand-btn"]}`);e&&(e.style.opacity="0.5")}const Ps=t=>{const{g:e}=A;!e||(ce.value=t.transform,e.attr("transform",t.transform.toString()))};function Lt(t,e){console.log("[onSelect]"),t.stopPropagation();const o=U(e);console.dir(o)}function Ze(t,e){var l,c;console.log("[onEdit]");const{foreign:o}=A;if(!Vt||!o||!H.value)return;const n=(l=this.parentNode)==null?void 0:l.parentNode;n.classList.add(y.edited),T.emit("edit-flag",!1),console.log(`name/id=${e.name}/${e.id}`),o.attr("x",e.x-2-(e.left?e.width:0)).attr("y",e.y-S.data.y-2).attr("data-id",e.id).attr("data-name",e.name).style("display","");const s=H.value;s.textContent=e.name,s.focus(),(c=getSelection())==null||c.selectAllChildren(s);const i=n.querySelector(`:scope > .${y.content}`);i&&Fe(i);const a=u=>{const r=u.key;switch(console.log(`[onEdit] keydown=${r}`),r){case"Enter":if(u.shiftKey)return;u.stopPropagation(),Ke(new FocusEvent("")),setTimeout(()=>{U(e),I.value.focus()},250);break;case"Escape":u.stopPropagation(),Ke(new FocusEvent(""),!0),I.value.focus();break}};s.addEventListener("keydown",a)}const Ke=(t,e=!1)=>{var i;if(console.log("[onEditBlur]"),(i=document.getElementsByClassName(y.edited)[0])==null||i.classList.remove(y.edited),se.value==null||H.value==null){console.log("skip not active foreign");return}if(se.value.style.display=="none"){console.log("skip display=none");return}se.value.style.display="none";const o=se.value.getAttribute("data-id"),n=se.value.getAttribute("data-name"),s=H.value.textContent;e||o&&s!==null&&s!==n&&cn(o,s)},Ee=t=>{if(t.preventDefault(),!Y.value)return;console.log("onContextmenu"),console.log(JSON.stringify(t));const e=hi(Y.value,t);Pt.value=e;const o=t.composedPath(),n=o.find(a=>{var l;return(l=a.classList)==null?void 0:l.contains("node")}),s=o.find(a=>a.tagName=="foreignObject");let i=n?1:s?2:0;if(console.log(i),i==1){const{classList:a}=n;a.contains(y.selected)||U(n),tt.value=a}et.value=i,T.emit("showContextmenu",!0)},jt=["#000000","#C0C0C0","#808080","#FFFFFF","#800000","#FF0000","#800080","#FF00FF","#008000","#00FF00","#808000","#FFFF00","#000080","#0000FF","#008080","#00FFFF"];let Ce=0;const zs=jt.length-1,D=(t,e)=>{var s,i,a;if(console.log(`[onClickMenu] name=${t},param=${e}`),t.indexOf("icon_")!=-1){const l=pe(),c=(s=S.find(l.id))==null?void 0:s.rawData;c&&(console.log(c),cn(l.id,`${t.slice(5)}${c.name}`));return}let o=pe();const n=o==null?void 0:o.id;switch(t){case"zoomfit":De();break;case"zoomin":dt(!1);break;case"zoomout":dt(!0);break;case"add":Ft(new MouseEvent("click"),pe());break;case"delete":o=o.parent,kt(n);break;case"delete-one":o=o.parent,Xi(n);break;case"collapse":un(n);break;case"expand":dn(n);break;case"add-sibling":{const l=xt(n,"");l&&(U(l),_e(l))}break;case"add-sibling-before":{const l=xt(n,"",!0);l&&(U(l),_e(l))}break;case"add-parent":{const l=Zi(n,"");l&&(U(l),_e(l))}break;case"cut":{const l=(i=S.find(n))==null?void 0:i.rawData;l&&navigator.clipboard.writeText(JSON.stringify(l)),o=o.parent,kt(n)}break;case"copy":{const l=(a=S.find(n))==null?void 0:a.rawData;l&&navigator.clipboard.writeText(JSON.stringify(l))}break;case"paste":navigator.clipboard.readText().then(l=>{const c=vi(l)||{name:l},u=rn(n,c);U(u)});break;case"edit":_e(pe());break;case"undo":qe();break;case"redo":Ue();break;case"move_focus_x":Vs(e==null?void 0:e.direct),o=null;break;case"move_focus_y":Hs(e==null?void 0:e.direct),o=null;break;case"text-bold":He(n,{"font-weight":"bold"});break;case"text-line":He(n,{"text-decoration":"line-through"});break;case"change_color":Ce=Ce>zs?0:Ce+1,He(n,{color:jt[Ce]},!0);break;case"change_color_bk":et.value=2,T.emit("showContextmenu",!0);break;case"next":Ue();break;case"prev":qe();break}o&&U(o)},Vs=t=>{let e=null;const o=pe();if(console.log(`seleData.left=${o.left}`),!!(o.left&&t==!1||o.left==!1&&t))if(console.log("to child"),o.children.length!=0)e=o.children[0];else return;else if(console.log("to parent"),o.parent!=null)e=o.parent;else return;const s=U(e);Fe(s),console.log("@")},Hs=t=>{let e=null;const o=pe();if(o==null||o.parent==null)return;let n=+o.id.split("-").pop(),s=o.parent.children.length,i=n+(t?1:-1);if(0<=i&&i<s){e=o.parent.children[i];const a=U(e);Fe(a)}},Ft=(t,e)=>{const o=rn(e.id,"");o&&(_e(o,t),U(e))};function _e(t,e=new MouseEvent("click")){const{g:o}=A;if(!o)return;const s=o.selectAll(`g[data-id='${Ae(t)}'] > g.${y.content} > g.${y.text}`).node();s&&(T.emit("edit-flag",!0),Ze.call(s,e,t))}const At=(t,e)=>{e.collapse?dn(e.id):un(e.id)};function Ks(t,e){var c;const o=(c=this.parentNode)==null?void 0:c.parentNode;I.value&&I.value.classList.add(y.dragging);const{g:n}=A;if(!n)return;Wt(o,e,[t.x-e.x,t.y-e.y]);const s=Sn(t,he.value);s[1]+=S.data.y;const i=n.selectAll("g.node").filter(u=>{if(u!==e&&u!==e.parent&&!u.id.startsWith(e.id)){let r=K,d=u.width+K;u.left&&u.depth!==0&&([r,d]=[d,r]);const h={x0:u.x-r,x1:u.x+d,y0:u.y-K,y1:u.y+u.height+K};return s[0]>h.x0&&s[1]>h.y0&&s[0]<h.x1&&s[1]<h.y1}return!1}),a=Array.from(document.getElementsByClassName(y.outline)),l=i.node();a.forEach(u=>{u!==l&&u.classList.remove(y.outline)}),l==null||l.classList.add(y.outline)}function Js(t,e){var h;const o=(h=this.parentNode)==null?void 0:h.parentNode;I.value&&I.value.classList.remove(y.dragging);const n=document.getElementsByClassName(y.outline)[0];if(n){n.classList.remove(y.outline);const p=n.getAttribute("data-id");if(p)e.px=0,e.py=0,Wi(p,e.id);else throw new Error("outline data-id null");return}const s=e.x-S.getRootWidth()/2,i=e.depth===1&&s*(s+e.px)<0,a=i?p=>p.left!==e.left:p=>p.left===e.left,l=o.parentNode;let c=i?{y:1/0,id:e.id}:e,u=i?{y:-1/0,id:e.id}:e;const r=ie(l).selectAll(`g.${st(e).join(".")}`).filter(p=>p!==e&&a(p)),d=e.y+e.py;r.each(p=>{(i||p.y>e.y)&&p.y<d&&p.y>u.y&&(u=p),(i||p.y<e.y)&&p.y>d&&p.y<c.y&&(c=p)}),i?(e.px=0,e.py=0,Qi(e.id)):c.id!==e.id?(e.px=0,e.py=0,wt(e.id,c.id)):u.id!==e.id?(e.px=0,e.py=0,wt(e.id,u.id,1)):Wt(o,e,[0,0],500)}const Us=t=>{const{svg:e}=A;!e||(t?(xe(e),e.on("dblclick.zoom",null)):e.on(".zoom",null))},qs=t=>{const{g:e}=A;if(!H.value||!e)return;const o=e.selectAll(`g.${y.text}`);t?o.on("click",Ze):o.on("click",null)},Ys=t=>{const{g:e}=A;if(!e)return;const o=e.selectAll(`g.${y.text}`);t?o.on("mousedown",Lt):o.on("mousedown",null)},Gs=t=>{!Y.value||(t?(console.log("@switchContextmenu"),Y.value.addEventListener("contextmenu",Ee),Y.value.addEventListener("dblclick",Ee)):(Y.value.removeEventListener("contextmenu",Ee),Y.value.removeEventListener("dblclick",Ee)))},Ws=t=>{const{g:e}=A;if(!e)return;const o=e.selectAll(`g.node:not(.${y.root}) > g > g.${y.text}`);t?Kt(o):o.on(".drag",null)};let Nt,Qe,Rt,It;T.on("selection-svg",t=>Nt=t);T.on("selection-g",t=>Qe=t);T.on("selection-asstSvg",t=>Rt=t);T.on("selection-foreign",t=>It=t);const et=C(0),Pt=C({left:0,top:0}),tt=C(),zt=j({delete:{name:"delete",disabled:!1,note:"Del",check:1},deleteOne:{name:"delete-one",disabled:!1,note:"ctrl+ del",check:1},zoomin:{name:"zoomin",disabled:!0,note:"]",check:4},zoomout:{name:"zoomout",disabled:!1,note:"[",check:4},zoomfit:{name:"zoomfit",disabled:!1,note:"@"},text_bold:{name:"text-bold",disabled:!1,note:"ctrl+ b"},text_line:{name:"text-line",disabled:!1,note:"ctrl+ l"},change_color:{name:"change_color",disabled:!1,note:"ctrl+ h"},change_color_bk:{name:"change_color_bk",disabled:!1,note:"ctrl+ h"},collapse:{name:"collapse",disabled:!0,note:"ctrl+ o",check:3},expand:{name:"expand",disabled:!0,note:"ctrl+ e",check:2},add:{name:"add",disabled:!1,note:"shift+ enter"},addParent:{name:"add-parent",disabled:!1,note:"",check:1},addSibling:{name:"add-sibling",disabled:!1,note:"ctrl+ enter",check:1},addSiblingBefore:{name:"add-sibling-before",disabled:!0,note:"",check:1},cut:{name:"cut",disabled:!1,note:"ctrl+ x",check:1},copy:{name:"copy",disabled:!1,note:"ctrl+ c"},paste:{name:"paste",disabled:!1,note:"ctrl+ v"}}),Xs=[["add","addParent","addSibling","addSiblingBefore"],["cut","copy","paste"],["delete","deleteOne"],["text_bold","text_line"],["collapse","expand"],["zoomin","zoomout","zoomfit"]],Zs=ne(()=>{const t=tt.value;console.log(`classList=${JSON.stringify(t)}`);const e=n=>{let s=!1;switch(n){case 1:s=t.contains(y.root);break;case 2:s=!t.contains(y.collapse),console.log(y.collapse);break;case 3:s=t.contains(y.collapse)||t.contains("leaf"),console.log(y.collapse);break;case 4:s=ce.value.k>=ae[1];break;case 5:s=ce.value.k<=ae[0];break}return s};return nt(Xs,n=>{const s=zt[n],i=s.hasOwnProperty("check")?s.check:0;return{name:s.name,disabled:e(i),note:s.note}})}),Qs=[["zoomin","zoomout","zoomfit"]],ei=ne(()=>{tt.value;const t=o=>{let n=!1;switch(o){case 4:n=ce.value.k>=ae[1];break;case 5:n=ce.value.k<=ae[0];break}return console.log(`zoom=${ce.value.k}, scale=${JSON.stringify(ae)}`),n};return nt(Qs,o=>{const n=zt[o],s=n.hasOwnProperty("check")?n.check:0;return{name:n.name,disabled:t(s),note:n.note}})}),ti=[["\u2705","\u274E","\u{1F195}","\u{1F196}","\u{1F197}"],["\u{1F4D1}","\u{1F4C3}","\u{1F4DD}","\u2B50","\u{1F514}","\u{1F6A7}"],["\u{1F642}","\u{1F610}","\u{1F616}","\u{1F635}","\u{1F62B}","\u{1F631}"],["\u26D4","\u{1F6AB}","\u{1F516}","\u{1F380}","\u{1F388}"],["\u{1F648}","\u{1F649}","\u{1F64A}","\u{1F44D}","\u{1F449}","\u{1F448}"],["\u{1F340}","\u{1F463}","\u{1F5EF}","\u{1F4A5}","\u{1F4A6}"],["\u23F0"]],nt=(t,e)=>{let o=[];return t.forEach(n=>{let s=[];n.forEach(i=>{s.push(e(i))}),o.push(s)}),o},ni=ne(()=>nt(ti,e=>({name:e}))),oi=ne(()=>{let t;switch(et.value){case 0:t=ei.value;break;case 1:t=Zs.value;break;case 2:t=ni.value;break}return console.dir(t),t}),si=Mn().source(t=>t.source).target(t=>t.target);Dn().curve(Tn);let ii=si;const ai=C(!1);let Je=4;T.on("branch",t=>Je=t||Je);let ae=[.1,8];T.on("scale-extent",t=>ae=t||ae);let Vt=!1;T.on("edit-flag",t=>Vt=!!t);const li=6,ue=10;let ye=16,Be=64,K=Math.min(ye/2-1,ue);T.on("gap",t=>{!t||(Be=t.xGap,ye=t.yGap,K=Math.min(ye/2-1,ue),K=Math.min(Be/2-1,K))});const ci=new ResizeObserver(t=>{const{foreign:e}=A;if(!e)return;const o=t[0],n=o.target,{width:s,height:i}=o.contentRect,a=parseInt(getComputedStyle(n).paddingLeft||"0",10),l=parseInt(getComputedStyle(n.parentNode).borderTopWidth||"0",10),c=(a+l)*2;e.attr("width",s+c).attr("height",i+c),e.style("display")!=="none"&&Fe(n),console.log("observer")}),me={side:12,padding:2,margin:8},Ht=me.side+me.padding*2,de={width:16,height:8,radius:4},ce=C(Ct),xe=Bn().on("zoom",Ps).scaleExtent(ae),Kt=On().container(gi).on("drag",Ks).on("end",Js),ot=C(!0);let Jt;T.on("mindmap-context",t=>t?Jt=t:null);const Se=C({drag:!0,edit:!0});class ri{constructor(e=20){this.length=e,this.snapshots=[],this.cursor=-1}get hasPrev(){return this.cursor>0}get hasNext(){return this.snapshots.length>this.cursor+1}snap(e){const o=ve.exports.cloneDeep(e);for(;this.cursor<this.snapshots.length-1;)this.snapshots.pop();this.snapshots.push(o),this.snapshots.length>this.length&&this.snapshots.shift(),this.cursor=this.snapshots.length-1}prev(){return this.hasPrev?(this.cursor-=1,ve.exports.cloneDeep(this.snapshots[this.cursor])):null}next(){return this.hasNext?(this.cursor+=1,ve.exports.cloneDeep(this.snapshots[this.cursor])):null}}const we=new ri,Ut=C(!1),qt=C(!1),di=()=>{Ut.value=we.hasPrev,qt.value=we.hasNext},ui=(t,e)=>{const o=-e/2,n=-t/2,s=t/2,i=e/2;return`M${i},${s}H${s}V${i}H${n}V${s}H${o}V${n}H${n}V${o}H${s}V${n}H${i}V${s}Z`},Yt=t=>{const e=t.split(`
`);return e.length>1&&e[e.length-1]===""&&e.pop(),e},pi=(t,e)=>{jn(t).then(o=>{const n=o.toDataURL(),s=open();s&&(s.document.write(`<img src='${n}'>`),s.document.title=e,s.document.close())})},Gt=(t,e)=>Ln().duration(t).ease(e),hi=(t,e)=>{const{pageX:o,pageY:n}=e,s=t.getBoundingClientRect(),i=s.left+window.pageXOffset,a=s.top+window.pageYOffset;return{left:o-i,top:n-a}};function gi(){var t,e;return(e=(t=this.parentNode)==null?void 0:t.parentNode)==null?void 0:e.parentNode}function U(t){const e=t instanceof SVGGElement?t:document.querySelector(`g[data-id='${Ae(t)}']`),o=document.getElementsByClassName(y.selected)[0];if(e)o?o!==e?(console.log("remove & add selected"),o.classList.remove(y.selected),e.classList.add(y.selected)):(console.log("edit-flag - same"),T.emit("edit-flag",!0)):(console.log("add selected"),e.classList.add(y.selected));else throw new Error("selectGNode failed");return e}function pe(){console.log("getSelectedGData");const t=ie(`.${y.selected}`),e=t==null?void 0:t.data();if((e==null?void 0:e.length)==0)return console.log("data null"),null;const o=e[0];return console.log(`id/name=${o.id}/${o.name}`),o}const rt=t=>{const{asstSvg:e}=A;if(!e)throw new Error("asstSvg undefined");const o=Yt(t),n=e.append("text");n.selectAll("tspan").data(o).enter().append("tspan").text(i=>i).attr("x",0);const s=n.node().getBBox();return n.remove(),{width:Math.max(s.width,22),height:Math.max(s.height,22)*o.length}},Wt=(t,e,o,n=0)=>{const s=Gt(n,St);e.px=o[0],e.py=o[1],ie(t).transition(s).attr("transform",Zt),ie(`g[data-id='${Ae(e)}'] > path`).transition(s).attr("d",i=>Ye(i))},mi=()=>{const{svg:t}=A;if(!t)return;const e=S.data;xe.translateTo(t,0+e.width/2,0+e.height/2)},De=()=>{const{svg:t}=A;if(!t||!he.value||!I.value)return;const e=he.value.getBBox(),o=I.value.getBoundingClientRect(),n=Math.min(o.width/e.width,o.height/e.height),s={x:o.width/2,y:o.height/2},i={x:e.width*n/2,y:e.height*n/2},a=Ct.translate(-e.x*n+s.x-i.x,-e.y*n+s.y-i.y).scale(n);xe.transform(t,a)},Fe=t=>{const{svg:e}=A;if(e&&I.value){const{k:o}=ce.value,n=t.getBoundingClientRect(),{x:s,y:i,width:a,height:l}=I.value.getBoundingClientRect(),c=n.x-s,u=c+n.width,r=n.y-i,d=r+n.height,h=2;let p=0,g=0;c<0&&(p=-c/o+h),(n.width>a||u>a)&&(p=-(u-a)/o-h),r<0&&(g=-r/o+h),(n.height>l||d>l)&&(g=-(d-l)/o-h),xe.translateBy(e,p,g)}},dt=t=>{const{svg:e}=A;!e||xe.scaleBy(e,t?1.1:.9)},fi=()=>{!Y.value||pi(Y.value,S.data.name)},Ue=()=>{const t=we.next();t&&(S.data=t,N(!1))},qe=()=>{const t=we.prev();t&&(S.data=t,N(!1))},_i=()=>{H.value&&(console.log("bindForeignDiv:enter"),ci.observe(H.value),H.value.addEventListener("blur",Ke),H.value.addEventListener("mousedown",t=>{t.stopPropagation()}),H.value.addEventListener("keydown",t=>{t.stopPropagation(),t.key}),I.value.addEventListener("keydown",t=>{const e=t.key;if(console.log(`svgEle@keydown=${e}`),t.preventDefault(),t.ctrlKey)switch(e){case"Delete":case"d":D("delete-one");break;case"Enter":D("add-sibling");break;case"Insert":case"i":D("add-sibling");break;case"b":D("text-bold");break;case"l":D("text-line");break;case"c":D("copy");break;case"v":D("paste");break;case"z":D("prev");break;case"y":D("next");break}else if(t.shiftKey)switch(e){case"Enter":D("add");break}else switch(e){case"ArrowRight":D("move_focus_x",{direct:!0});break;case"ArrowLeft":D("move_focus_x",{direct:!1});break;case"ArrowDown":D("move_focus_y",{direct:!0});break;case"ArrowUp":D("move_focus_y",{direct:!1});break;case"Insert":case"i":D("add");break;case"Delete":case"d":D("delete");break;case"F2":D("edit");break;case"@":D("zoomfit");break;case"[":D("zoomout");break;case"]":D("zoomin");break;case"o":D("collapse");break;case"e":D("expand");break;case"t":D("change_color");break;case"h":D("change_color_bk");break}}))},vi=t=>{let e;try{return e=JSON.parse(t),"name"in e?e:!1}catch{return!1}},Xt=()=>3,st=t=>{const e=["node"];return t&&e.push(`depth-${t.depth}`),e},bi=t=>{const e=st(t);return t&&(t.depth===0&&e.push(y.root),t.collapse?e.push(y.collapse):t.children||(t.children.length===0?e.push("leaf"):e.push(y.collapse))),e},yi=t=>[y["add-btn"]],Zt=t=>`translate(${t.dx+t.px},${t.dy+t.py})`,Ae=t=>t.id,Qt=t=>{const e=Yt(t.name),o=t.height/e.length,n=t.attr;return e.map(s=>({name:s,height:o,attr:n}))},Ye=t=>{let e=0,o=0;const n=Math.max(K-3,0);let s=t.width+n;const i=Xt();let a=i;const{parent:l}=t;l&&(e=l.width,o=l.height,l.depth===0&&(e/=2,o/=2,a=0)),t.left&&(l&&l.depth!==0&&(e=-e),s=-s);const c=[-t.dx+e-t.px,-t.dy+o+a-t.py],u=[0,t.height+i];return`${ii({source:c,target:u})}L${s},${u[1]}`},wi=(t,e)=>{const o=t.height/2;let n=t.width+e+Ht/2+me.margin;return t.left&&(n=-n),`translate(${n},${o})`},ki=(t,e)=>{const n=t.height+Xt();let s=t.width+e+4;return t.left&&(s=-s),`translate(${s},${n})`},en=(t,e,o,n,s)=>{t?(gt(e,ue),ut(o,ue,li),n&&pt(n,ue),s&&ht(s,ue)):(gt(e,K),ut(o,K),n&&pt(n,K),s&&ht(s,K))},tn=(t,e)=>{const o=t.attr("class",s=>bi(s).join(" ")).attr("data-id",Ae);(e?o.transition(e):o).attr("transform",Zt)},nn=(t,e)=>{(e?t.transition(e):t).attr("transform",n=>`translate(${n.left?-n.width:0},0)`)},it=t=>{t.attr("alignment-baseline","text-before-edge").attr("font-weight",e=>{var o;return(o=e.attr)!=null&&o.hasOwnProperty("font-weight")?e.attr["font-weight"]:""}).attr("text-decoration",e=>{var o;return(o=e.attr)!=null&&o.hasOwnProperty("text-decoration")?e.attr["text-decoration"]:""}).attr("fill",e=>{var o;return(o=e.attr)!=null&&o.hasOwnProperty("color")?e.attr.color:""}).text(e=>e.name||" ").attr("x",0).attr("dy",(e,o)=>o?e.height:0)},xi=t=>{const{side:e,padding:o}=me,n=4,s=-o-e/2,i=e+o*2;t.attr("x",s).attr("y",s).attr("rx",n).attr("ry",n).attr("width",i).attr("height",i)},$i=t=>{t.attr("x",-de.width/2).attr("y",-de.height/2).attr("width",de.width).attr("height",de.height).attr("rx",de.radius).attr("ry",de.radius).attr("stroke",e=>e.color||"grey").attr("fill",e=>e.color||"grey")},Ve=(t,e)=>{t.attr("cx",e).attr("cy",0).attr("r",1.2)},ut=(t,e,o=4)=>{t.attr("x",n=>-e-(n.left?n.width:0)).attr("y",-e).attr("rx",o).attr("ry",o).attr("width",n=>n.width+e*2).attr("height",n=>n.height+e*2)},pt=(t,e)=>{t.attr("class",y["expand-btn"]).attr("transform",o=>ki(o,e)).style("color",o=>o.color)},ht=(t,e)=>{t.attr("class",o=>yi().join(" ")).attr("transform",o=>wi(o,e))},gt=(t,e)=>{const o=Ht+me.margin,n=e*2;t.attr("class",y.trigger).attr("x",s=>-e-(s.left?s.width+o:0)).attr("y",-e).attr("width",s=>s.width+n+o).attr("height",s=>s.height+n)},on=(t,e)=>{const o=t.attr("stroke",n=>n.color).attr("stroke-width",Je);e?o.transition(e).attr("d",Ye):o.attr("d",Ye)},Ei=t=>{const e=t.append("tspan");return it(e),e},Ci=t=>(it(t),t),Si=t=>{const e=t.append("g");return xi(e.append("rect")),e.append("path").attr("d",ui(2,me.side)),e},Mi=t=>{const e=t.append("g");return $i(e.append("rect")),Ve(e.append("circle"),-5),Ve(e.append("circle"),0),Ve(e.append("circle"),5),e},sn=t=>{const e=Si(t);return e.on("click",Ft),e},an=t=>{const e=Mi(t);return e.on("click",At),e},Di=(t,e)=>{if(t.select(`:scope > g.${y.content} > g.${y["expand-btn"]}`).on("click",At),Se.value.drag||Se.value.edit){const n=t.select(`:scope > g.${y.content} > g.${y.text}`);n.on("mousedown",Lt),Se.value.drag&&!e&&Kt(n),Se.value.edit&&n.on("click",Ze)}ot.value&&t.select(`:scope > g.${y.content}`).on("mouseenter",Rs).on("mouseleave",Is)},Ti=t=>{var h;const e=!((h=t.data()[0])!=null&&h.depth),o=t.append("g");tn(o),on(o.append("path"));const n=o.append("g").attr("class",y.content),s=n.append("rect"),i=n.append("g").attr("class",y.text),a=i.append("rect"),l=i.append("text");nn(l);const c=l.selectAll("tspan").data(Qt).enter().append("tspan");it(c);const u=ot.value?sn(n):void 0;let r;const d=t.data();return d.length!=0&&d[0].children.length!=0&&(r=an(n)),en(e,s,a,r,u),Di(o,e),o.each((p,g)=>{!p.children||Ne(p.children,o.filter((b,x)=>g===x))}),n.raise(),o},Bi=t=>{var r;const e=!((r=t.data()[0])!=null&&r.depth),o=Gt(500,St);tn(t,o),on(t.select(":scope > path"),o);const n=t.select(`:scope > g.${y.content}`),s=n.select(":scope > rect"),i=n.select(`g.${y.text}`),a=i.select("rect"),l=i.select("text");nn(l,o),l.selectAll("tspan").data(Qt).join(Ei,Ci,d=>d.remove());let c=n.select(`g.${y["add-btn"]}`),u=n.select(`g.${y["expand-btn"]}`);if(ot.value?c.node()||(c=sn(n)):c.remove(),!u.node()){const d=t.data();d.length!=0&&d[0].children.length!=0&&(u=an(n))}return en(e,s,a,u,c),t.each((d,h)=>{!d.children||Ne(d.children,t.filter((p,g)=>h===g))}),n.raise(),t},Ne=(t=[S.data],e=Qe)=>{e.selectAll(`g.${st(t[0]).join(".")}`).data(t,n=>n.gKey).join(Ti,Bi)};class Oi{constructor(e,o,n,s){this.w=e,this.h=o,this.y=n,this.c=s,this.cs=s.length,this.x=0,this.prelim=0,this.mod=0,this.shift=0,this.change=0,this.tl=null,this.tr=null,this.el=null,this.er=null,this.msel=0,this.mser=0}}function mt(t){t.cs===0?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function be(t){return t.y+t.h}class Li{constructor(e,o,n){this.lowY=e,this.index=o,this.next=n}}function ft(t,e,o){for(;o!==null&&t>=o.lowY;)o=o.next;return new Li(t,e,o)}function ji(t,e,o,n){if(o!==e-1){const s=e-o;t.c[o+1].shift+=n/s,t.c[e].shift-=n/s,t.c[e].change-=n-n/s}}function Fi(t,e,o,n){t.c[e].mod+=n,t.c[e].msel+=n,t.c[e].mser+=n,ji(t,e,o,n)}function Ai(t){return t.cs===0?t.tl:t.c[0]}function Ni(t){return t.cs===0?t.tr:t.c[t.cs-1]}function Ri(t,e,o,n){const s=t.c[0].el;s.tl=o;const i=n-o.mod-t.c[0].msel;s.mod+=i,s.prelim-=i,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}function Ii(t,e,o,n){const s=t.c[e].er;s.tr=o;const i=n-o.mod-t.c[e].mser;s.mod+=i,s.prelim-=i,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}function Pi(t,e,o){let n=t.c[e-1],s=n.mod,i=t.c[e],a=i.mod;for(;n!==null&&i!==null;){be(n)>o.lowY&&(o=o.next);const l=s+n.prelim+n.w-(a+i.prelim);l>0&&(a+=l,Fi(t,e,o.index,l));const c=be(n),u=be(i);c<=u&&(n=Ni(n),n!==null&&(s+=n.mod)),c>=u&&(i=Ai(i),i!==null&&(a+=i.mod))}n===null&&i!==null?Ri(t,e,i,a):n!==null&&i===null&&Ii(t,e,n,s)}function zi(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}function Ge(t){if(t.cs===0){mt(t);return}Ge(t.c[0]);let e=ft(be(t.c[0].el),0,null);for(let o=1;o<t.cs;o++){Ge(t.c[o]);const n=be(t.c[o].er);Pi(t,o,e),e=ft(n,o,e)}zi(t),mt(t)}function Vi(t){let e=0,o=0;for(let n=0;n<t.cs;n++)e+=t.c[n].shift,o+=e+t.c[n].change,t.c[n].mod+=o}function ln(t,e){e+=t.mod,t.x=t.prelim+e,Vi(t);for(let o=0;o<t.cs;o++)ln(t.c[o],e)}function Hi(t){Ge(t),ln(t,0)}class Ki{constructor(e,o){this.gap=e,this.bottomPadding=o}addBoundingBox(e,o){return{width:e+this.gap,height:o+this.bottomPadding}}removeBoundingBox(e,o){return{x:e+this.gap/2,y:o}}}class Ji{constructor(e){this.bb=e}layout(e){const o=this.convert(e);Hi(o);const{boundingBox:n,result:s}=this.assignLayout(o,e);return{result:s,boundingBox:n}}convert(e,o=0){const{width:n,height:s}=this.bb.addBoundingBox(e.width,e.height),i=[];if(e.children&&e.children.length)for(let a=0;a<e.children.length;a++)i[a]=this.convert(e.children[a],o+s);return new Oi(n,s,o,i)}assignCoordinates(e,o){const{x:n,y:s}=this.bb.removeBoundingBox(e.x,e.y);o.x=n,o.y=s;for(let i=0;i<e.c.length;i++)this.assignCoordinates(e.c[i],o.children[i])}getSize(e,o){const{x:n,y:s,width:i,height:a}=e;if(o||(o={left:n,right:n+i,top:s,bottom:s+a}),o.left=Math.min(o.left,n),o.right=Math.max(o.right,n+i),o.top=Math.min(o.top,s),o.bottom=Math.max(o.bottom,s+a),e.children)for(const l of e.children)this.getSize(l,o);return o}assignLayout(e,o,n){const{x:s,y:i}=this.bb.removeBoundingBox(e.x,e.y);o.x=s,o.y=i;const{width:a,height:l}=o;n||(n={left:s,right:s+a,top:i,bottom:i+l}),n.left=Math.min(n.left,s),n.right=Math.max(n.right,s+a),n.top=Math.min(n.top,i),n.bottom=Math.max(n.bottom,i+l);for(let c=0;c<e.c.length;c++)this.assignLayout(e.c[c],o.children[c],n);return{result:o,boundingBox:n}}}const _t=t=>[t.width,t.height]=[t.height,t.width],Ui=t=>{t.parent?(t.dx=t.x-t.parent.x,t.dy=t.y-t.parent.y):(t.dx=0,t.dy=0)},le=(t,e)=>t.id=e,qi=t=>{t.parent?t.depth=t.parent.depth+1:t.depth=0},vt=t=>{t.parent&&t.parent.color&&(t.color=t.parent.color)},Yi=t=>{t.depth>1&&t.parent&&(t.left=t.parent.left)},Gi=t=>{const e=Object.assign({},t),o=Object.assign({},t);if(!t.collapse){const{children:n}=t;e.children=[],o.children=[],n.forEach(s=>{s.left?e.children.push(s):o.children.push(s),s.parent&&(s.parent=o)})}return{left:e,right:o}},We=(t,e,o="0")=>{var s;e.forEach(i=>{i(t,o)});const{children:n}=t;if(n)for(let i=0;i<n.length;){const a=n[i];a.id==="del"?(n.splice(i,1),(s=t.rawData.children)==null||s.splice(i,1)):(We(a,e,`${o}-${i}`),i+=1)}},bt=(t,e)=>{const o=new Ki(e,t);return new Ji(o)};class yt{constructor(e,o,n,s,i=Fn(An)){this.colorNumber=0,this.gKey=0,this.rootWidth=0,this.diffY=0,this.update=!1,this.colorScale=i,this.getSize=s,this.layout=bt(o,n),this.data=this.createMdataFromData(e,"0"),this.renew(),this.update=!1}createMdataFromData(e,o,n=null){const{name:s,collapse:i,children:a,attr:l}=e,{width:c,height:u}=this.getSize(s),r=n?n.depth+1:0;let d=!1,h=n?n.color:"";r===1?(d=!!e.left,h=this.colorScale(`${this.colorNumber+=1}`)):r!==0&&n&&(d=n.left);const p={id:o,name:s,rawData:e,parent:n,left:d,color:h,depth:r,x:0,y:0,dx:0,dy:0,px:0,py:0,width:c,height:u,children:[],_children:[],collapse:i==!0,gKey:this.gKey+=1,attr:l};return a&&(p.collapse?a.forEach((g,b)=>{p._children.push(this.createMdataFromData(g,`${o}-${b}`,p))}):a.forEach((g,b)=>{p.children.push(this.createMdataFromData(g,`${o}-${b}`,p))})),this.update=!1,p}renew(...e){We(this.data,[_t,qi,Yi]),this.data=this.l(this.data);const o=[_t,this.renewXY.bind(this),Ui];We(this.data,o.concat(e)),this.update=!0}l(e){const{left:o,right:n}=Gi(e);return this.layout.layout(o),this.layout.layout(n),this.diffY=n.x-o.x,this.rootWidth=o.height,n.children=e.children,n}renewXY(e){[e.x,e.y]=[e.y,e.x],e.left&&(e.x=-e.x+this.rootWidth,e.y+=this.diffY)}isUpdate(){return this.update}getRootWidth(){return this.rootWidth}setBoundingBox(e,o){this.layout=bt(e,o),this.renew()}find(e){const o=e.split("-").map(s=>~~s);let n=this.data;for(let s=1;s<o.length;s++){const i=o[s],{children:a}=n;if(i<a.length)n=a[i];else return null}return n.id===e?n:null}rename(e,o){if(e.length>0){const n=this.find(e);if(n&&n.name!==o){n.name=o,n.rawData.name=o;const s=this.getSize(n.name);n.width=s.width,n.height=s.height,this.renew()}return n}else return null}moveChild(e,o){var a,l;if(e===o)return null;const n=this.find(e),s=this.find(o),i=o.split("-").pop();if(i&&n&&s){const c=s.parent;(a=c==null?void 0:c.children)==null||a.splice(~~i,1),(l=c==null?void 0:c.rawData.children)==null||l.splice(~~i,1),s.parent=n,s.gKey=this.gKey+=1,s.depth=s.parent.depth+1,s.depth===1?s.color=this.colorScale(`${this.colorNumber+=1}`):s.left=s.parent.left,n.collapse?n._children.push(s):n.children.push(s),n.rawData.children?n.rawData.children.push(s.rawData):n.rawData.children=[s.rawData],this.renew(le,vt)}return s}moveSibling(e,o,n=0){const s=e.split("-"),i=o.split("-");let a=s.pop(),l=i.pop();if(e===o||s.length!==i.length||!a||!l)return null;const c=this.find(e),u=this.find(o);if(u&&c&&c.parent){a=parseInt(a,10),l=parseInt(l,10),a<l&&(l-=1);const{children:r}=c.parent,{children:d}=c.parent.rawData;if(r&&d)return r.splice(a,1),r.splice(l+n,0,c),d.splice(a,1),d.splice(l+n,0,c.rawData),c.depth===1&&(c.left=u.left),this.renew(le),c}return null}add(e,o){const n=this.find(e);if(n)if(n.collapse&&this.expand(e),n.rawData.children||(n.rawData.children=[]),typeof o=="string"){const s=o,i=this.getSize(s),a={name:s},l=n.color?n.color:this.colorScale(`${this.colorNumber+=1}`),c={id:`${n.id}-${n.children.length}`,name:s,rawData:a,parent:n,left:n.left,collapse:!1,color:l,gKey:this.gKey+=1,width:i.width,height:i.height,depth:n.depth+1,x:0,y:0,dx:0,dy:0,px:0,py:0,children:[],_children:[]};return n.children.push(c),n.rawData.children.push(a),this.renew(),c}else{const s=o,i=this.createMdataFromData(s,`${n.id}-${n.children.length}`,n);return n.children.push(i),n.rawData.children.push(s),this.renew(),i}return null}expand(e){return this.eoc(e,!1,[vt,le])}collapse(e){return this.eoc(e,!0)}eoc(e,o,n=[]){const s=this.find(e);return s&&(s.collapse=o,s.rawData.collapse=o,[s._children,s.children]=[s.children,s._children],this.renew(...n)),s}delete(e){const o=this.find(e);if(o&&o.parent)o.id="del",this.renew(le);else throw new Error(o?"\u6682\u4E0D\u652F\u6301\u5220\u9664\u6839\u8282\u70B9":"\u672A\u627E\u5230\u9700\u8981\u5220\u9664\u7684\u8282\u70B9")}deleteOne(e){var n;const o=this.find(e);if(o&&o.parent){const{parent:s,children:i,_children:a,collapse:l,rawData:c}=o,u=parseInt(e.split("-").pop(),10);s.children.splice(u,1,...l?a:i),(n=s.rawData.children)==null||n.splice(u,1,...c.children||[]),i.forEach(r=>{r.parent=s,r.depth===1&&(r.rawData.left=r.left)}),this.renew(le)}}addSibling(e,o,n=!1){var i;console.log(`[addSibling] id=${e},name=${o}`);const s=this.find(e);if(s&&s.parent){const a=parseInt(e.split("-").pop(),10),{parent:l,left:c}=s,u={name:o,left:c},r=this.getSize(o),d=n?a:a+1,h=l.color?l.color:this.colorScale(`${this.colorNumber+=1}`),p={name:o,parent:l,children:[],_children:[],color:h,collapse:!1,rawData:u,id:`${l.id}-${d}`,left:c,gKey:this.gKey+=1,depth:s.depth,width:r.width,height:r.height,x:0,y:0,dx:0,dy:0,px:0,py:0};return l.children.splice(d,0,p),(i=l.rawData.children)==null||i.splice(d,0,u),console.log(`index=${a},start=${d},sibling.id=${p.id}`),this.renew(le),p}return null}addParent(e,o){var s;const n=this.find(e);if(n&&n.parent){const{parent:i,left:a,color:l}=n,c=this.getSize(o),u=parseInt(n.id.split("-").pop(),10),r={name:o,children:[n.rawData],left:a};(s=i.rawData.children)==null||s.splice(u,1,r);const d={rawData:r,left:a,name:o,color:l,collapse:!1,parent:i,id:n.id,depth:n.depth,width:c.width,height:c.height,gKey:this.gKey+=1,children:[n],_children:[],x:0,y:0,dx:0,dy:0,px:0,py:0};return n.parent=d,i.children.splice(u,1,d),this.renew(le),d}return null}changeLeft(e){console.log("changeLeft");const o=this.find(e);return o&&(o.left=!o.left,o.rawData.left=o.left,this.renew()),o}applayAttr(e,o,n){console.log("applayAttr");const s=this.find(e);if(s){let i=s.attr?s.attr:{},a=Object.keys(o)[0];i.hasOwnProperty(a)&&!n?delete i[a]:Object.assign(i,o),console.log(JSON.stringify(i)),s.attr=i,s.rawData.attr=i,this.renew()}return s}}let S;T.on("mmdata",t=>t?S=t:null);const N=(t=!0)=>{t&&we.snap(S.data),Jt.emit("update:modelValue",Nn([S.data.rawData])),di(),Ne()},cn=(t,e,o=!1)=>{console.log(`rename: id/name=${t}/${e}`),S.rename(t,e),o||N()},Wi=(t,e)=>{S.moveChild(t,e),N()},wt=(t,e,o=0)=>{S.moveSibling(t,e,o),N()},rn=(t,e)=>{const o=S.add(t,e);return N(),o},kt=t=>{S.delete(t),N()},Xi=t=>{S.deleteOne(t),N()},dn=t=>{S.expand(t),N()},un=t=>{S.collapse(t),N()},xt=(t,e,o=!1)=>{const n=S.addSibling(t,e,o);return N(),n},Zi=(t,e)=>{const o=S.addParent(t,e);return N(),o},Qi=t=>{S.changeLeft(t),N()},He=(t,e,o=!1)=>{S.applayAttr(t,e,o),N()};var ea={translation:{contextmenu:{collapse:"\u6298\u53E0\u8282\u70B9",expand:"\u5C55\u5F00\u8282\u70B9",delete:"\u5220\u9664\u8282\u70B9","delete-one":"\u5220\u9664\u5355\u4E2A\u8282\u70B9",add:"\u65B0\u5EFA\u5B50\u8282\u70B9","add-parent":"\u65B0\u5EFA\u7236\u8282\u70B9","add-sibling":"\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9","add-sibling-before":"\u5728\u6B64\u4E4B\u524D\u65B0\u5EFA\u5144\u5F1F\u8282\u70B9",cut:"\u526A\u5207",copy:"\u62F7\u8D1D",paste:"\u7C98\u8D34",selectall:"\u5168\u9009",zoomin:"\u653E\u5927",zoomout:"\u7F29\u5C0F",zoomfit:"\u7F29\u653E\u81F3\u5408\u9002\u5927\u5C0F"}}},ta={translation:{contextmenu:{collapse:"collapse",expand:"expand",delete:"delete","delete-one":"delete a single node",add:"add child node","add-parent":"add parent node","add-sibling":"add sibling node","add-sibling-before":"add sibling node before",cut:"cut",copy:"copy",paste:"paste",selectall:"select all",zoomin:"zoom in",zoomout:"zoom out",zoomfit:"zoom fit"}}};Mt.init({fallbackLng:"zh",lng:"zh",resources:{zh:ea,en:ta}});const na="_container_cqgs9_1",oa="_menu_cqgs9_1",sa="_disabled_cqgs9_47";var ia={container:na,menu:oa,disabled:sa};const aa=O({name:"contextmenu",props:{position:{default:{top:0,left:0}},groups:Array},emits:["click-item"],setup(t,e){const o=C(!1),n=Rn(),s=C(),i=C(),a=j({top:0,left:0}),l=8;T.on("showContextmenu",async d=>{if(!s.value||!i.value)return;console.log("showContextmenu"),o.value=!!d,await In();const{offsetWidth:h,offsetHeight:p}=s.value,{offsetWidth:g,offsetHeight:b}=i.value,{top:x,left:B}=t.position;a.top=x+b>p?p-b-l:x,a.left=B+g>h?B-g:B});const c=()=>o.value=!1;return{style:n,show:o,close:c,onClick:d=>{const h=p=>p.disabled==null?`icon_${p.name}`:p.name;c(),e.emit("click-item",h(d))},menuEle:i,containerEle:s,pos:a,i18n:Mt,note:d=>d?`( ${d} )`:""}}}),la=["id"],ca=["onClick"];function ra(t,e,o,n,s,i){return fe((v(),w("div",{class:R(t.style.container),ref:"containerEle"},[k("div",{onMousedown:e[0]||(e[0]=(...a)=>t.close&&t.close(...a))},null,32),k("div",{ref:"menuEle",id:t.style.menu,style:Q({top:t.pos.top+"px",left:t.pos.left+"px"})},[k("table",null,[(v(!0),w(J,null,te(t.groups,(a,l)=>(v(),w("tr",{key:l},[(v(!0),w(J,null,te(a,c=>(v(),w("td",{key:c.name},[k("div",{class:R(c.disabled?t.style.disabled:""),onClick:u=>t.onClick(c)},[k("div",null,V(c.name),1),k("div",null,V(t.note(c.note)),1)],10,ca)]))),128))]))),128))])],12,la)],2)),[[Dt,t.show]])}const pn={};pn.$style=ia;var da=F(aa,[["render",ra],["__cssModules",pn]]);const ua=O({name:"Mindmap",emits:["event_callback"],components:{Contextmenu:da},props:{update:Boolean,modelValue:{type:Array,required:!0}},setup(t,e){Pn(()=>T.emit("mindmap-context",e)),W(()=>{if(!I.value||!he.value||!ze.value||!se.value||!H.value)return;T.emit("selection-svg",ie(I.value)),T.emit("selection-g",ie(he.value)),T.emit("selection-asstSvg",ie(ze.value)),T.emit("selection-foreign",ie(se.value)),T.emit("mmdata",new yt(ve.exports.cloneDeep(t.modelValue[0]),Be,ye,rt)),ai.value=!1,N();const{svg:n,foreign:s}=A;s==null||s.raise(),_i(),n==null||n.on("mousedown",()=>{console.log("svg@mousedown"),document.getElementsByClassName(y.selected)[0]}),n==null||n.on("blur",()=>{console.log("svg@blur"),S.isUpdate()&&o("blur","")}),Us(!0),Gs(!0),Ys(!0),Ws(!0),qs(!0),De()}),L(()=>[t.update],n=>{console.log("props.update"),T.emit("mmdata",new yt(ve.exports.cloneDeep(t.modelValue[0]),Be,ye,rt)),Ne(),setTimeout(async()=>{De()},500)});const o=(n,s)=>{console.log(`cmd=${n}, name=${s}`),e.emit("event_callback",n,s)};return{wrapperEle:Y,svgEle:I,gEle:he,style:y,asstSvgEle:ze,foreignEle:se,foreignDivEle:H,centerView:mi,fitView:De,download:fi,menu:oi,contextmenuPos:Pt,onClickMenu:D,next:Ue,prev:qe,hasPrev:Ut,hasNext:qt}}}),pa=["id"],ha={ref:"gEle"},ga={ref:"foreignEle",style:{display:"none"}},ma={ref:"foreignDivEle",contenteditable:""};function fa(t,e,o,n,s,i){const a=P("contextmenu");return v(),w("div",{class:R(t.style.container)},[k("div",{id:t.style["svg-wrapper"],ref:"wrapperEle"},[(v(),w("svg",{class:R(t.style.svg),ref:"svgEle"},[k("g",ha,[(v(),w("foreignObject",ga,[k("div",ma,null,512)],512))],512)],2))],8,pa),(v(),w("svg",{ref:"asstSvgEle",class:R(t.style["asst-svg"])},null,2)),k("div",{class:R([t.style["button-list"],t.style["right-bottom"]])},[k("button",{onClick:e[0]||(e[0]=l=>t.fitView())},[k("i",{class:R(t.style.fit)},null,2)]),k("button",{onClick:e[1]||(e[1]=l=>t.download())},[k("i",{class:R(t.style.download)},null,2)])],2),k("div",{class:R([t.style["button-list"],t.style["right-top"]])},[k("button",{onClick:e[2]||(e[2]=(...l)=>t.prev&&t.prev(...l)),class:R({[t.style.disabled]:!t.hasPrev})},[k("i",{class:R(t.style.prev)},null,2)],2),k("button",{onClick:e[3]||(e[3]=(...l)=>t.next&&t.next(...l)),class:R({[t.style.disabled]:!t.hasNext})},[k("i",{class:R(t.style.next)},null,2)],2)],2),E(a,{position:t.contextmenuPos,groups:t.menu,onClickItem:t.onClickMenu},null,8,["position","groups","onClickItem"])],2)}var _a=F(ua,[["render",fa]]);const va={class:"mindmap"},ba=O({props:{editor_toggle:null},emits:["event_callback"],setup(t,{emit:e}){const o=t,{store_data:n}=X(),{store_dlg:s}=ke();Xe(),Oe(),C(null);const i=C([{name:"start",children:[]}]),a=j({height:window.innerHeight,update:!1,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1});W(()=>{console.log("[mounted]"),document.addEventListener("keydown",l)}),je(()=>{console.log("unmounted!"),document.removeEventListener("keydown",l)});const l=d=>{if(d.keyCode===83&&d.ctrlKey){d.preventDefault(),console.log("save"),u(i.value);return}};L(()=>o.editor_toggle,(d,h)=>{console.log(`[watch](editor_toggle)-${d}`),change_mode()}),L(()=>n.state.obj,(d,h)=>{console.log("[watch-body]"),c(d.content)});const c=d=>{try{i.value=JSON.parse(d)}catch(h){console.log(h),i.value=[{name:"@start",children:[]}]}console.log("onChanged_body"),a.update=!a.update},u=d=>{n.do_cmd("save_file",JSON.stringify(i.value))},r=async(d,h)=>{switch(console.log(`[event_callback] cmd=${d}, va0=${h}`),d){case"toggle_editor":u(i.value);break;case"filelist":document.querySelector(".col-3");const p=!a.toggle_list;a.toggle_list=p,console.log(a.toggle_list);break;case"blur":u(i.value);break;default:if(d.indexOf("dlg_")!=-1){const g=Object.assign({},set_filename(d,h));console.log(g),s.update_param(g)}else n.do_cmd(d,h);break}};return(d,h)=>(v(),w("div",va,[E(_a,{modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=p=>i.value=p),update:_(a).update,onEvent_callback:r},null,8,["modelValue","update"])]))}});var ya=F(ba,[["__scopeId","data-v-982d6098"]]);const wa={class:"modal-mask"},ka={class:"modal-wrapper"},xa={class:"modal-container"},$a={class:"header"},Ea={class:"form"},Ca=["disabled"],Sa=["disabled"],Ma={class:"modal-actions"},Da=["disabled"],Ta=O({emits:["event_callback"],setup(t,{emit:e}){const{store_dlg:o}=ke(),{store_data:n}=X(),s=C(null),i=C(null),a=j({title:"",edit:"",edit_org:"",check:0,title2:"",isShowDlg:!1,isNoEdit:!1,isFileOpen:!1,isReadOnly:!1,isDisabled:!0,isCheck:!1,action:()=>{},isMulti:!1});L(()=>o.state.objParam,p=>{l(p)});const l=p=>{const g=(b,x=!1)=>b!=null?b:x;console.log("[onChanged_objParam]"),a.title=p.title,a.title2=p.title2,a.edit=p.edit,a.edit_org=g(p.edit_org,p.edit),a.check=0,a.isShowDlg=!0,a.isNoEdit=g(p.isNoEdit),a.isFileOpen=g(p.isFileOpen),a.isReadOnly=g(p.isReadOnly),a.isCheck=g(p.isCheck),a.isMulti=g(p.isMulti),a.isDisabled=!0,a.action=p.action,d(!0),setTimeout(()=>{a.isMulti==!0?s.value.focus():i.value.focus()},500)},c=p=>{if(console.log(`[doAction] flg=${p}, edit=${a.edit}`),p){const g=a.action(a);n.do_cmd(g[0],g[1],g[2])}a.isShowDlg=!1,d(!1)},u=p=>{const b=(p.target.files||p.dataTransfer.files)[0],x=a.action(a);n.do_cmd(x[0],b),a.isShowDlg=!1,d(!1)},r=()=>{const p=a.edit_org,g=a.edit==p&&!a.isReadOnly;return console.log(`[isDisabled]=${g}`),g},d=p=>{p==!0?document.addEventListener("keydown",h):document.removeEventListener("keydown",h)},h=p=>{const g=p.key;switch(console.log(`key = ${g}`),g){case"Enter":p.preventDefault(),c(!0);break;case"Escape":p.preventDefault(),c(!1);break}};return(p,g)=>{const b=P("fa");return fe((v(),re(Hn,{persistent:""},{default:Le(()=>[k("div",wa,[k("div",ka,[k("div",xa,[k("div",$a,V(_(a).title)+"?",1),k("form",Ea,[_(a).isFileOpen==!0?(v(),w("input",{key:0,class:"input",type:"file",onChange:u},null,32)):G("",!0),_(a).isNoEdit==!1?(v(),w(J,{key:1},[_(a).isMulti==!0?fe((v(),w("textarea",{key:0,class:"input",autofocus:"","onUpdate:modelValue":g[0]||(g[0]=x=>_(a).edit=x),disabled:_(a).isReadOnly,ref_key:"edit",ref:s},null,8,Ca)),[[ct,_(a).edit]]):fe((v(),w("input",{key:1,class:"input",type:"search",autofocus:"","onUpdate:modelValue":g[1]||(g[1]=x=>_(a).edit=x),disabled:_(a).isReadOnly,ref_key:"edit2",ref:i,placeholder:"type text.."},null,8,Sa)),[[ct,_(a).edit]])],64)):G("",!0),_(a).isCheck==!0?(v(),w(J,{key:2},[fe(k("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":g[2]||(g[2]=x=>_(a).check=x)},null,512),[[zn,_(a).check]]),ge(" "+V(_(a).title2),1)],64)):G("",!0)]),k("div",Ma,[k("button",{class:"btn btn-ok",ref:"ok",disabled:r(),onKeydown:g[3]||(g[3]=Vn(x=>c(!0),["enter"])),onClick:g[4]||(g[4]=x=>c(!0))},[E(b,{icon:"check"}),ge(" "+V(_(a).title),1)],40,Da),k("button",{class:"btn btn-can",onClick:g[5]||(g[5]=x=>c(!1))},"cancel")])])])])]),_:1},512)),[[Dt,_(a).isShowDlg]])}}});var Ba=F(Ta,[["__scopeId","data-v-54e808bd"]]);const Oa={class:"container"},La={class:"main"},ja=O({emits:["event_callback"],setup(t,{emit:e}){const{store_data:o}=X(),{store_dlg:n}=ke();Xe();const s=Oe(),i=j({editor_toggle:!1,height:window.innerHeight,objDlgCmn:void 0,objDlgConf:void 0,toggle_list:!1,mode:0});W(()=>{console.log("[mounted]"),a(),window.addEventListener("resize",l),document.body.style.overflow="hidden"}),je(()=>{console.log("unmounted!"),window.removeEventListener("resize",l)});const a=()=>{const r=d=>{o.do_cmd("restore_file","")};console.log("init"),s.fullPath,s.path.substring(1),r(),o.do_cmd("filter_menu",null),l()},l=()=>{const r=window.innerHeight-40;console.log(`height=${r}`),i.height=r,o.update_height(r)},c=async(r,d)=>{switch(console.log(`[event_callback] cmd=${r}, va0=${d}`),r){case"toggle_editor":i.editor_toggle=!i.editor_toggle;break;case"config":i.objDlgConf={cmd:r,filename:"",commit:""};break;case"filelist":document.querySelector(".col-3");const h=!i.toggle_list;i.toggle_list=h,console.log(i.toggle_list);break;default:if(r.indexOf("dlg_")!=-1){const p=Object.assign({},u(r,d));n.update_param(p)}else o.do_cmd(r,d);break}},u=(r,d)=>{const h=Lo[r],p=d!=null?d:o.state.filename;return h.init(h,p),h};return L(()=>o.state.mode,(r,d)=>{console.log("[watch-mode]"),i.mode=r}),(r,d)=>(v(),w("div",Oa,[E(zo,{ref:"appbar",onEvent_callback:c},null,512),E(Ba,{objParam:_(i).objDlgCmn,onEvent_callback:c},null,8,["objParam"]),k("div",La,[_(i).toggle_list?(v(),re(Yo,{key:0,class:"col-3",onEvent_callback:c,style:Q({height:_(i).height+"px"})},null,8,["style"])):G("",!0),_(i).mode==0?(v(),w(J,{key:1},[E(vs,{class:"col-2",ref:"pane",editor_toggle:_(i).editor_toggle,style:Q({height:_(i).height+"px"})},null,8,["editor_toggle","style"]),E(ts,{class:"col-1",onEvent_callback:c,style:Q({height:_(i).height+"px"})},null,8,["style"])],64)):(v(),re(ya,{key:2,class:"col-4",ref:"pane",editor_toggle:_(i).editor_toggle,style:Q({height:_(i).height+"px"})},null,8,["editor_toggle","style"]))])]))}});var Fa=F(ja,[["__scopeId","data-v-1baaddaa"]]);const Aa={_class:"container"},Na=O({emits:["event_callback"],setup(t,{emit:e}){const o=Oe(),n=j({filename:"",height:window.innerHeight,timer3:-1});W(()=>{console.log("[mounted]"),s(),document.body.style.overflow="hidden"});const s=()=>{console.log("init");const i=o.path.substring(1);console.log(`filename=${i}`),n.filename=i,n.timer3=window.setTimeout(()=>{clearTimeout(n.timer3),window.print()},500)};return(i,a)=>{const l=P("MarkdownViewer");return v(),w("div",Aa,[ge(V(_(n).filename)+" ",1),E(l,{class:"md_viewer",style:{"{\n          height":"initial"}})])}}}),Ra=[{name:"viewer_print",path:"/print/:pathMatch(.*)",component:Na},{name:".md",path:"/:pathMatch(.*)*",component:Fa}],Ia=Kn({history:Jn(),routes:Ra});function Pa(t={}){const{immediate:e=!1,onNeedRefresh:o,onOfflineReady:n,onRegistered:s,onRegisterError:i}=t;let a;const l=async(c=!0)=>{};return"serviceWorker"in navigator&&(a=new Un("./sw.js",{scope:"./"}),a.addEventListener("activated",c=>{c.isUpdate?window.location.reload():n==null||n()}),a.register({immediate:e}).then(c=>{s==null||s(c)}).catch(c=>{i==null||i(c)})),l}Pa();qn.add(Yn);Gn(go).use(Ia).component("fa",Wn).mount("#app");
